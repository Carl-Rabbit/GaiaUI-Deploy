(function(e){function t(t){for(var a,o,s=t[0],c=t[1],l=t[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&p.push(n[o][0]),n[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(p.length)p.shift()();return i.push.apply(i,l||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],a=!0,s=1;s<r.length;s++){var c=r[s];0!==n[c]&&(a=!1)}a&&(i.splice(t--,1),e=o(o.s=r[0]))}return e}var a={},n={app:0},i=[];function o(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=a,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(r,a,function(t){return e[t]}.bind(null,a));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;i.push([7,"chunk-vendors"]),r()})({0:function(e,t){},"034b":function(e,t,r){},"062f":function(e,t,r){},"0764":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var a=r("ade3");class n{constructor(){Object(a["a"])(this,"start",void 0),Object(a["a"])(this,"offset",void 0),Object(a["a"])(this,"duration",void 0),Object(a["a"])(this,"yoyo",void 0)}static getDefaultTiming(){const e=new n;return e.start=0,e.offset=0,e.duration=1,e.yoyo=void 0,e}static simplifyJSON(e){if("object"!==typeof e)return e;const t={};if("start"in e&&0!==e.start&&"0"!==e.start){const r=parseFloat(e.start);isNaN(r)||(t.start=r)}if("offset"in e&&0!==e.offset&&"0"!==e.offset){const r=parseFloat(e.offset);isNaN(r)||(t.offset=r)}if("duration"in e&&0!==e.duration&&"0"!==e.duration){const r=parseFloat(e.duration);isNaN(r)||(t.duration=r)}if("yoyo"in e){const r=Object.assign({},n.getDefaultYoyo(),e.yoyo);1===r.repeat&&0===r.delay||(t.yoyo=e.yoyo)}return 0===Object.keys(t).length?void 0:t}static getDefaultYoyo(){return{repeat:1,delay:0}}getComputedTiming(){const e=n.getDefaultTiming();return Object.keys(this).forEach(t=>{"yoyo"!==t&&null!=this[t]&&(e[t]=this[t])}),!0===this.yoyo?e.yoyo=n.getDefaultYoyo():this.yoyo&&"object"===typeof this.yoyo&&(e.yoyo=n.getDefaultYoyo(),Object.keys(this.yoyo).forEach(t=>{null!=this.yoyo[t]&&(e.yoyo[t]=this.yoyo[t])})),e}startPlusOffset(){var e,t;return(null!==(e=this.start)&&void 0!==e?e:0)+(null!==(t=this.offset)&&void 0!==t?t:0)}}},"0ee5":function(e,t,r){},1:function(e,t){},10:function(e,t){},"106a":function(e,t,r){},11:function(e,t){},12:function(e,t){},13:function(e,t){},14:function(e,t){},"143c":function(e,t,r){},15:function(e,t){},16:function(e,t){},17:function(e,t){},18:function(e,t){},19:function(e,t){},1974:function(e,t,r){"use strict";r("3e9b6")},2:function(e,t){},20:function(e,t){},21:function(e,t){},"2bc8":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var a=r("f720");class n extends a["a"]{constructor(e={}){super(e),this.type="native"}setTarget(e){return super.setTarget(e),this}updateTarget(e){return super.updateTarget(e),this}setTiming(e){return super.setTarget(e),this}updateTiming(e){return super.updateTiming(e),this}getDefaultSettings(){return{}}updateSettings(e){return Object.assign(this.settings,e),this}set(e,t){return this.settings[e]=t,this}computePossibleElements(e){const t=e.getGlyphs(this.target);return new Set(t)}computeDuration(e){var t;const{yoyo:r}=this.timing.getComputedTiming();if(null!==(t=this.timing)&&void 0!==t&&t.duration)return this.timing.duration;const a=this.create(e);if(!a)return 0;r&&(a.yoyo(!0),a.repeat(r.repeat),a.repeatDelay(r.delay));const n=a.duration();return a.clear&&a.clear(!0),a.kill(),n}}},3:function(e,t){},"30dd":function(e,t,r){},"35c2":function(e,t,r){"use strict";r("cc38")},"35db":function(e,t,r){"use strict";r("106a")},"363b":function(e,t,r){"use strict";r("9dfd")},3875:function(e,t,r){"use strict";r("dd03")},"3e9b6":function(e,t,r){},4:function(e,t){},4267:function(e,t,r){"use strict";r("30dd")},4617:function(e,t,r){"use strict";r("034b")},"4b58":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var a=r("ade3"),n=r("8f52"),i=r("c66e");class o{constructor(){Object(a["a"])(this,"templateName",void 0),Object(a["a"])(this,"parameters",void 0),Object(a["a"])(this,"type",void 0),Object(a["a"])(this,"settings",void 0),this.templateName=Object(n["a"])(),this.parameters=[],this.type="unknown",this.settings={}}clone(){const e=this.constructor();return Object.assign(e,this)}instantiate(e,t=!0){const r=this.getDefaultSettings();return this.settings=e?Object.assign(r,e):r,t&&!this.isValid()?(console.warn("Failed to instantiate using template "+this.templateName+". Params are not valid"),null):this.createAnimation()}getDefaultSettings(){const e={};return this.parameters.forEach(t=>e[t.paramName]=t.defaultValue),e}parseSettingsJSON(e){if(!e||"object"!==typeof e)return;const t={};return this.parameters.forEach(r=>{if(r.paramName in e){const a=e[r.paramName];if(void 0===a)return;switch(r.paramType){case i["a"].NUMBER:if("string"===typeof a){const e=parseFloat(a);isNaN(e)||(t[r.paramName]=e)}else t[r.paramName]=a;break;case i["a"].STRING:""!==a&&(t[r.paramName]=a);break;default:t[r.paramName]=a}}}),0===Object.keys(t).length?void 0:t}getParamValue(e){return this.getParamValues()[e]}getParamValues(e=null){if(null==e||!Array.isArray(e))return this.settings;const t={};return e.forEach(e=>{t[e]=this.getParamValue(e)}),t}isValid(){return this.parameters.every(e=>!e.required||void 0!==this.getParamValue(e.paramName))}createAnimation(){throw"Template is not implemented"}}},"4d08":function(e,t,r){"use strict";r("614b")},5:function(e,t){},"52d4":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return FilterTransform}));var _Users_carl_Code_Research_MSRA_GaiaUI_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ade3"),core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("5b81"),core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1__),_core_entities_spec_BaseTransform__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("ef41");class FilterTransform extends _core_entities_spec_BaseTransform__WEBPACK_IMPORTED_MODULE_2__["a"]{constructor(){super(),Object(_Users_carl_Code_Research_MSRA_GaiaUI_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"type",void 0),Object(_Users_carl_Code_Research_MSRA_GaiaUI_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"expr",void 0),this.type="filter",this.expr="true"}execute(selection){const expr=this.expr.replaceAll("@classList","__node__.classList").replaceAll("@id",'__node__.getAttribute("id")').replaceAll("@index","__index__").replaceAll("@datum",'(JSON.parse(__node__.getAttribute("ac-data")) ?? {})').replaceAll("@el","__node__"),nodes=selection.nodes(),keepArray=nodes.map((__node__,__index__)=>eval(expr));return selection.filter((e,t)=>keepArray[t])}}},"56d7":function(e,t,r){"use strict";r.r(t),r.d(t,"eventBus",(function(){return Ws}));var a=r("2b0e"),n=r("8c4f"),i=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},o=[],s={name:"App"},c=s,l=(r("35c2"),r("2877")),u=Object(l["a"])(c,i,o,!1,null,null,null),d=u.exports,p=function(){var e=this,t=e._self._c;return t("div",{staticClass:"test-view"},[t("svg")])},h=[],f=r("898b"),g=(r("14d9"),r("705b")),m=r.n(g);function y(){let e,t=f["p"](),r=75,a=!0,n=!1,i=!0,o={start:function(){},draw:function(){},end:function(){}};function s(s){let c,l,u,d,p=s.append("g").attr("class","lasso"),h=p.append("path").attr("class","drawn"),g=p.append("path").attr("class","loop_close"),y=p.append("circle").attr("class","origin"),v=f["d"]().on("start",_).on("drag",b).on("end",T);function _(e){d=[],c="",h.attr("d",null),g.attr("d",null),t.nodes().forEach((function(e){e.__lasso.possible=!1,e.__lasso.selected=!1,e.__lasso.hoverSelect=!1,e.__lasso.loopSelect=!1;let t=e.getBoundingClientRect();e.__lasso.lassoPoint=[Math.round(t.left+t.width/2),Math.round(t.top+t.height/2)]})),i&&t.on("mouseover.lasso",(function(){this.__lasso.hoverSelect=!0})),o.start(e)}function b(e){let i,s;"touchmove"===e.sourceEvent.type?(i=e.sourceEvent.touches[0].clientX,s=e.sourceEvent.touches[0].clientY):(i=e.sourceEvent.clientX,s=e.sourceEvent.clientY);let p=f["h"](e,this)[0],v=f["h"](e,this)[1];""===c?(c=c+"M "+p+" "+v,l=[i,s],u=[p,v],y.attr("cx",p).attr("cy",v).attr("r",4).attr("display",null)):c=c+" L "+p+" "+v,d.push([i,s]);let _=Math.sqrt(Math.pow(i-l[0],2)+Math.pow(s-l[1],2)),b="M "+p+" "+v+" L "+u[0]+" "+u[1];h.attr("d",c),g.attr("d",b),n=_<=r,n&&a?g.attr("display",null):g.attr("display","none"),t.nodes().forEach((function(e){e.__lasso.loopSelect=!(!n||!a)&&m()(d,e.__lasso.lassoPoint)<1,e.__lasso.possible=e.__lasso.hoverSelect||e.__lasso.loopSelect})),o.draw(e)}function T(e){t.on("mouseover.lasso",null),t.nodes().forEach((function(e){e.__lasso.selected=e.__lasso.possible,e.__lasso.possible=!1})),h.attr("d",null),g.attr("d",null),y.attr("display","none"),o.end(e)}e.call(v)}return s.items=function(e){if(!arguments.length)return t;t=e;let r=t.nodes();return r.forEach((function(e){e.__lasso={possible:!1,selected:!1}})),s},s.possibleItems=function(){return t.filter((function(){return this.__lasso.possible}))},s.selectedItems=function(){return t.filter((function(){return this.__lasso.selected}))},s.notPossibleItems=function(){return t.filter((function(){return!this.__lasso.possible}))},s.notSelectedItems=function(){return t.filter((function(){return!this.__lasso.selected}))},s.closePathDistance=function(e){return arguments.length?(r=e,s):r},s.closePathSelect=function(e){return arguments.length?(a=!0===e,s):a},s.isPathClosed=function(e){return arguments.length?(n=!0===e,s):n},s.hoverSelect=function(e){return arguments.length?(i=!0===e,s):i},s.on=function(e,t){if(!arguments.length)return o;if(1===arguments.length)return o[e];let r=["start","draw","end"];return r.indexOf(e)>-1&&(o[e]=t),s},s.targetArea=function(t){return arguments.length?(e=t,s):e},s}var v={name:"TestView",components:{},data(){return{}},methods:{initLasso(){let e=new Array(100).fill(null).map(()=>[Math.random(),Math.random()]),t=960,r=500,a=3.5,n=f["n"](this.$el).select("svg").attr("width",t).attr("height",r),i=n.selectAll("circle").data(e).enter().append("circle").attr("cx",e=>e[0]*t).attr("cy",e=>e[1]*r).attr("r",a),o=y().closePathSelect(!0).closePathDistance(100).items(i).targetArea(n),s=function(){o.items().attr("r",3.5).classed("not_possible",!0).classed("selected",!1)},c=function(){o.possibleItems().classed("not_possible",!1).classed("possible",!0),o.notPossibleItems().classed("not_possible",!0).classed("possible",!1)},l=function(){o.items().classed("not_possible",!1).classed("possible",!1),o.selectedItems().classed("selected",!0).attr("r",7),o.notSelectedItems().attr("r",3.5)};o.on("start",s).on("draw",c).on("end",l),n.call(o)}},mounted(){this.initLasso()},computed:{}},_=v,b=(r("4d08"),Object(l["a"])(_,p,h,!1,null,"a96b42aa",null)),T=b.exports,w=function(){var e=this,t=e._self._c;return t("el-row",{staticClass:"editor-view",attrs:{tabindex:"0"},on:{keyup:function(t){return(t.type.indexOf("key")||67===t.keyCode)&&t.altKey?e.clickLeftCollapseButton.apply(null,arguments):null}}},[t("div",{staticClass:"header-container",style:{height:e.headerHeight+"px"}},[t("el-row",{staticStyle:{height:"100%"},attrs:{gutter:5,type:"flex",align:"middle"}},[t("el-col",{attrs:{span:3}},[t("span",{staticClass:"header-text",staticStyle:{"user-select":"none",cursor:"pointer"},attrs:{title:"Gaia Homepage"},on:{click:e.clickHeaderText}},[e._v("Gaia")])]),t("el-col",{staticStyle:{"text-align":"left"},attrs:{span:10}},[t("el-button",{staticStyle:{"font-size":"0.9rem","margin-left":"10px"},attrs:{icon:"el-icon-folder-opened",type:"primary",plain:"",size:"medium"},on:{click:e.openProjSelPanel}},[e._v("Load")]),t("el-button",{staticStyle:{"font-size":"0.9rem","margin-left":"20px"},attrs:{icon:"el-icon-download",type:"primary",plain:"",size:"medium"},on:{click:e.saveSpec}},[e._v("Save Spec")])],1),t("el-col",{staticStyle:{"text-align":"center"},attrs:{span:5,offset:6}},[t("el-button",{staticStyle:{"font-size":"0.9rem"},attrs:{icon:"el-icon-magic-stick",type:e.showCode?"primary":"",size:"medium"},on:{click:e.clickLeftCollapseButton}},[e._v("Code Panel ")])],1),t("el-col",{attrs:{span:0}},[t("audio",{ref:"audioEl",staticStyle:{"margin-left":"auto",display:"none"},attrs:{controls:"controls",src:e.audioSrc}})])],1)],1),t("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.isExportingFiles,expression:"isExportingFiles"}],staticClass:"content-container",attrs:{"element-loading-text":"Exporting...It will take a few minutes."}},[t("div",{staticClass:"left-aside-container",staticStyle:{"margin-right":"4px"},style:{width:e.asideWidth+"px"}},[t("DebugPanel",{staticStyle:{width:"calc(100% - 3px)"},style:{height:"100%"},attrs:{"pane-height":e.debugPanelHeight,"pane-width":e.asideWidth}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:null===e.asideWidthCache,expression:"asideWidthCache === null"}],staticClass:"v-resizer",attrs:{id:"resize-left"}}),t("div",{staticClass:"middle-container",staticStyle:{"margin-left":"-2px"}},[t("div",{ref:"mainContainer",staticClass:"main-container",style:{height:e.svgHeight+"px"},on:{click:e.clearSelection}},[t("ExportSVGContainer",{staticStyle:{position:"absolute","z-index":"992"}}),t("SVGContainer",{directives:[{name:"show",rawName:"v-show",value:"stop"===e.aniStatus,expression:"aniStatus === 'stop'"}],staticStyle:{position:"absolute","z-index":"993"}}),t("div",{staticStyle:{width:"90%",height:"90%",background:"white",position:"absolute","z-index":"995"},style:{visibility:"playing"===e.aniStatus?"visible":"hidden"}}),t("AniSVGContainer",{directives:[{name:"show",rawName:"v-show",value:"stop"!==e.aniStatus,expression:"aniStatus !== 'stop'"}],staticStyle:{position:"absolute","z-index":"995"}})],1),t("div",{staticClass:"footer-container",style:{height:e.footerHeight+"px"}},[t("div",{staticClass:"h-resizer",style:{width:e.controlPanelWidth+"px",bottom:e.footerHeight-6+"px"},attrs:{id:"hResizer"},on:{mousedown:e.bottomResizerMousedown}}),t("ControlPanel",{attrs:{footerHeight:e.footerHeight}})],1)])]),t("el-dialog",{attrs:{title:"Load",visible:e.projSelPanelVisible,"lock-scroll":"",fullscreen:"",width:"800px"},on:{"update:visible":function(t){e.projSelPanelVisible=t}}},[t("ProjSelectionPanel",{on:{closeProjSelPanel:e.closeProjSelPanel}})],1)],1)},S=[],x=r("2f62"),C=function(){var e=this,t=e._self._c;return t("div",{staticClass:"footer"},[t("div",{staticClass:"operation-group"},[t("el-button-group",{},[t("el-button",{staticStyle:{"font-size":"0.9rem"},attrs:{icon:"el-icon-data-board",size:"mini"},on:{click:function(t){return e.loadExample("animation")}}},[e._v("Load Animations")]),t("el-button",{staticStyle:{"font-size":"0.9rem"},attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetScene}},[e._v("Reset Scene")])],1),t("el-button",{staticStyle:{width:"100px","font-size":"0.9rem","margin-left":"auto"},attrs:{plain:"",icon:e.runIcon,size:"mini"},on:{click:e.switchRunningState}},[e._v(e._s(this.running?"Pause":"Play")+" ")]),t("el-button",{staticStyle:{"margin-right":"30px",width:"100px","font-size":"0.9rem"},attrs:{plain:"",icon:"el-icon-refresh-right",size:"mini"},on:{click:e.restart}},[e._v("Restart")])],1),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.audioCompiling,expression:"audioCompiling"}],staticClass:"timeline-group",attrs:{"element-loading-text":"Updating Audio","element-loading-spinner":"el-icon-loading"}},[t("TextPanel",{directives:[{name:"show",rawName:"v-show",value:"text"===e.timelineMode&&!1,expression:"timelineMode === 'text' && false"}],style:{width:e.tlContainerWidth+"px"},attrs:{panelHeight:e.showTimeline?.4*e.emptyHeight:e.emptyHeight,audioRunning:e.running,compile:e.compile},on:{aniChange:e.handleAniChange}}),t("el-slider",{directives:[{name:"show",rawName:"v-show",value:"time"===e.timelineMode,expression:"timelineMode === 'time'"}],staticClass:"slider",style:{width:e.timelineWidth+"px"},attrs:{max:e.duration,marks:e.marks,disabled:e.disabled,"format-tooltip":e.formatTooltip},on:{input:e.changeTime},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}}),t("TimelinePanel",{directives:[{name:"show",rawName:"v-show",value:e.showTimeline,expression:"showTimeline"}],attrs:{duration:e.duration,panelHeight:e.emptyHeight},on:{aniChange:e.handleAniChange,timeChange:e.handleTimeChange}})],1)])},A=[],$=function(){var e=this,t=e._self._c;return t("div",{staticClass:"timeline-panel",style:{height:e.panelHeight+"px"},attrs:{draggable:"false"},on:{wheel:e.wheelHandler}},[t("div",{staticClass:"timeline-cursor-tooltip noSelection",class:{"hided-div":!e.cursorInRange()},style:{"margin-left":e.cursorLeft-e.documentScrollLeft-22+"px"},on:{mousedown:function(t){return e.moveTimeCursor()}}},[e._v(" "+e._s(e.getTimeString())+" ")]),t("div",{staticClass:"timeline-scroller",style:{width:e.tlContainerWidth+"px",cursor:"auto","overflow-x":"auto","overflow-y":"hidden"},on:{scroll:function(t){return e.updateDocumentScrollLeft(t)},mousedown:function(t){return e.mousedownTimeline(t)},mouseup:function(t){return e.mouseupTimeline()},mousemove:function(t){return e.mousemoveTimeline(t)}}},[t("div",{style:{width:e.timelineWidth+"px","padding-bottom":"20px"}},[t("div",{staticClass:"timerow-scroller",staticStyle:{"overflow-y":"auto"},style:{height:e.panelHeight-55+"px"}},e._l(e.rowMapList,(function(r,a){return t("div",{key:"row-"+a,staticClass:"timeline-row",style:{height:e.rowHeight+"px",width:"100%"}},[e._l(r.get(e.ItemType.HIDDEN),(function(r,a){return t("div",{key:"rect-"+r.uuid,staticClass:"timeline-item",staticStyle:{cursor:"pointer"},style:{height:e.rectHeight+"px",width:r.width+"px",left:r.startX+"px",top:"1px",background:e.getColor(r)},attrs:{id:"rect-"+r.uuid,"item-idx":a,title:`${e.getVItemTitle(r)} (${e.getDurationString(r)})`}},[t("div",{staticClass:"timeline-item-container",on:{click:function(t){return e.clickVItem(r)}}},[t("font-awesome-icon",{staticStyle:{"margin-right":"2px"},style:{"background-color":"white",color:e.getColor(r),"border-color":e.getColor(r)},attrs:{id:"animationIcon",icon:e.getAnimationIcon(r)}}),t("div",[e._v(" "+e._s(e.getVItemTitle(r))+" ("+e._s(e.getDurationString(r))+") ")])],1),t("div",{staticClass:"timeline-item-cover"})])})),e._l(r.get(e.ItemType.SHOWN),(function(r,a){return t("div",{key:"rect-"+r.uuid,staticClass:"timeline-item",style:{height:e.rectHeight+"px",width:r.width+"px",left:r.startX+"px",top:"1px",background:e.getColor(r)},attrs:{id:"rect-"+r.uuid,"item-idx":a,title:`${e.getVItemTitle(r)} (${e.getDurationString(r)})`}},[t("div",{staticClass:"timeline-item-container",on:{mouseenter:function(t){return e.mouseenter(r)},mouseleave:function(t){return e.mouseleave(r)},mousedown:function(t){return e.mousedown(t,r,a)}}},[t("font-awesome-icon",{staticStyle:{"margin-right":"2px"},style:{"background-color":"white",color:e.getColor(r),"border-color":e.getColor(r)},attrs:{id:"animationIcon",icon:e.getAnimationIcon(r)}}),t("div",[e._v(" "+e._s(e.getVItemTitle(r))+" ("+e._s(e.getDurationString(r))+") ")])],1)])})),e._l(r.get(e.ItemType.SHOWN),(function(r,a){return t("div",{key:"tooltip-"+r.uuid,staticClass:"timeline-item-tooltip",style:{height:e.rectHeight+"px",width:r.width+"px",left:r.startX+"px",top:"2px"},attrs:{id:"tooltip-"+r.uuid,"item-idx":a},on:{mouseenter:function(t){return e.mouseenter(r)},mouseleave:function(t){return e.mouseleave(r)},mousedown:function(t){return e.mousedown(t,r,a)}}},[t("div",{staticClass:"button-container",staticStyle:{position:"absolute",top:"0",height:"100%","border-radius":"5px 0 0 5px"},style:{left:`-${e.dragButtonWidth}px`,width:e.dragButtonWidth+"px",clipPath:`url(#rect-${r.uuid})`,cursor:e.isFadeColor(r.originItem)?"auto":"e-resize"},on:{mousedown:function(t){return e.dragEdge(t,r,"left")}}},[t("el-icon",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"el-icon-arrow-left my-icon"})],1),t("div",{staticClass:"button-container",staticStyle:{position:"absolute",top:"0",height:"100%","border-radius":"0 5px 5px 0"},style:{right:`-${e.dragButtonWidth+2}px`,width:e.dragButtonWidth+"px",cursor:e.isFadeColor(r.originItem)?"auto":"e-resize"},on:{mousedown:function(t){return e.dragEdge(t,r,"right")}}},[t("el-icon",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"el-icon-arrow-right my-icon"})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:r.mouseOn||r===e.movingVItem,expression:"vItem.mouseOn || vItem === movingVItem"}],staticClass:"button-container foot-button-container",staticStyle:{position:"absolute",width:"100%",left:"0","min-width":"50px","justify-content":"start","border-radius":"0 0 4px 4px"},style:{marginTop:e.rectHeight+"px",height:"25px"}})])})),e.newItem?t("div",{staticClass:"timeline-item",style:{height:"16px",width:e.newItem.width+"px",left:e.newItem.startX+"px",top:"1px"}},[t("span",{staticClass:"timeline-item-text"},[e._v(e._s(e.newItem.use))])]):e._e()],2)})),0)])]),t("div",{staticStyle:{position:"relative","pointer-events":"none"},style:{"margin-top":-(e.panelHeight-55)-e.rowHeight+"px"},attrs:{id:"timeline-cursor-wrapper"}},[t("div",{staticClass:"timeline-marks noSelection",staticStyle:{"pointer-events":"all",position:"absolute","margin-top":"-25px",height:"25px","z-index":"-10",overflow:"hidden"},style:{}},[t("svg",{staticStyle:{height:"100%"},style:{"margin-left":-e.documentScrollLeft+"px",width:e.timelineWidth+"px"},attrs:{id:"timeline-marks-svg"}})]),t("div",{staticClass:"timeline-cursor noSelection",class:{"red-bg":e.cursorInRange()},style:{"margin-top":"24px","margin-left":e.cursorLeft-e.documentScrollLeft+"px",height:(e.rowHeight+1)*e.visRows.length+"px"}})])])},k=[],P=r("8f52"),R=r("ad3d"),E=r("c074"),O={name:"TimelinePanel",components:{FontAwesomeIcon:R["a"]},props:["duration","panelHeight"],data(){return{rowHeight:44,rectHeight:40,tipHeight:20,dragButtonWidth:20,newItem:null,inMoving:!1,movingVItem:null,visRows:[],shownVisRows:[],hiddenVisRows:[],cursorLeft:0,iconLeft:[],faFlag:E["c"],documentScrollLeft:0,moveTimeline:!1,moveTimelineX:0,moveTimelineY:0,ItemType:{SHOWN:"shown",HIDDEN:"hidden"}}},methods:{cursorInRange(){return this.cursorLeft-this.documentScrollLeft>-1},wheelHandler(e){this.$store.commit("editor/updateTimelineScale",e.deltaY>0?1.1:.9),this.$store.commit("editor/fixScrollPos",e)},moveTimeCursor(){if("stop"===this.aniStatus)return void this.$notify({type:"warning",title:"Click play button first"});const e=document.getElementById("timeline-cursor-wrapper").getBoundingClientRect().left;document.onmousemove=t=>{this.cursorLeft=Math.max(t.clientX-e,0),this.cursorLeft=Math.min(this.cursorLeft,this.timelineWidth),this.$store.commit("editor/changeTime",this.cursorLeft*this.duration/this.timelineWidth)},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null,this.$emit("timeChange")}},mousedown(e,t,r){if(e.stopPropagation(),this.isFadeColor(t.originItem))return;const a=document.getElementById("rect-"+t.uuid),n=e.clientX-a.offsetLeft;let i=a.getBoundingClientRect().top,o=this.visRows.findIndex(e=>e.includes(t));this.inMoving=!1,this.movingVItem=null,this.changeIconLeft(r,0);let s=5;document.onmousemove=e=>{if(s-- >0)return;this.inMoving=!0,this.movingVItem=t;const r=e.clientX-n,a=Math.round(100*this.timelineScale.invert(r))/100,c=this.timelineScale(a),l=e.clientY-i,u=c+t.width,d=this.timelineRows.length,p=Math.floor(l/this.rowHeight);let h=o+p;h=Math.max(0,h),h=Math.min(d-1,h),0!==p&&(this.moveVItemBetweenRow(t,o,h),i+=this.rowHeight*p,o=h),c<0||u>this.timelineWidth||(this.$store.commit("editor/updateItemTiming",{itemId:t.originItem.id,start:a}),t.startX=c)},document.onmouseup=e=>{if(this.movingVItem=null,document.onmousemove=null,document.onmouseup=null,!this.inMoving)return void this.clickVItem(t);this.inMoving=!1;const r=e.clientX-n,a=r+t.width;a>this.timelineWidth&&this.extend(),this.$store.commit("editor/updateAniJSONUsingTimelineRows"),this.$store.commit("editor/updateItemRow",{item:t.originItem,rowIdx:o}),this.$emit("aniChange")}},clickVItem(e){},deleteVItem(e){this.$store.commit("editor/deleteItem",e.originItem),this.$emit("aniChange")},mouseenter(e){this.inMoving&&this.movingVItem!==e||(e.mouseOn=!0,this.$store.commit("editor/changeHighlightItem",e.originItem))},mouseleave(e){this.inMoving&&this.movingVItem!==e||(e.mouseOn=!1,this.itemForSettings!==this.highlightItem&&this.$store.commit("editor/changeHighlightItem",null))},ifOverlap(e){const t=this.overlapVisRows.get(e.startX);return 1!==t.length&&t.indexOf(e)===t.length-1},flatIcons(e,t=!1){t||(e.clicked=!e.clicked);let r=0;this.visRows.flat().forEach((t,a)=>{t.startX===e.startX&&(this.changeIconLeft(a,r),r+=e.clicked?25:5)})},dragEdge(e,t,r){if(e.stopPropagation(),this.isFadeColor(t.originItem))return;console.log("mousedown",e,t,r);const a=e.target;if(console.log("target",a),this.inMoving=!1,this.movingVItem=null,"left"===r){const r=document.getElementById("rect-"+t.uuid),a=e.clientX-r.offsetLeft;document.onmousemove=e=>{this.inMoving=!0,this.movingVItem=t;const r=e.clientX-a,n=Math.round(100*this.timelineScale.invert(r))/100,i=this.timelineScale(n);if(i<0||i>t.endX)return;const o=t.width+t.startX-i,s=this.timelineScale.invert(o)-this.timelineScale.invert(0),c=Math.round(100*s)/100;this.$store.commit("editor/updateItemTiming",{itemId:t.originItem.id,start:n,duration:c}),t.width=this.timelineScale(c)-this.timelineScale(0),t.startX=i},document.onmouseup=e=>{const r=e.clientX-a,n=r+t.width;n>this.timelineWidth&&this.extend(),this.inMoving=!1,this.movingVItem=null,document.onmousemove=null,document.onmouseup=null,this.$store.commit("editor/updateAniJSONUsingTimelineRows")}}else if("right"===r){const r=document.getElementById("rect-"+t.uuid),a=e.clientX-r.offsetLeft-t.width;document.onmousemove=e=>{this.inMoving=!0;const r=e.clientX-a,n=Math.round(100*this.timelineScale.invert(r))/100,i=this.timelineScale(n);if(i<=t.startX||i>this.timelineWidth)return;const o=i-t.startX,s=this.timelineScale.invert(o)-this.timelineScale.invert(0),c=Math.round(100*s)/100;this.$store.commit("editor/updateItemTiming",{itemId:t.originItem.id,duration:c}),t.width=this.timelineScale(c)-this.timelineScale(0),t.endX=i},document.onmouseup=e=>{const r=e.clientX-a,n=r+t.width;n>this.timelineWidth&&this.extend(),this.inMoving=!1,document.onmousemove=null,document.onmouseup=null,this.$store.commit("editor/updateAniJSONUsingTimelineRows"),this.$emit("aniChange")}}},moveVItemBetweenRow(e,t,r){const a=this.visRows[t],n=this.visRows[r];a.splice(a.indexOf(e),1),n.push(e)},extend(){console.log("extend"),this.$store.commit("editor/changeTimelineWidth",1.5*this.timelineWidth)},compress(){console.log("compress")},dragover(e){e.preventDefault()},drop(e,t,r){const a=e.dataTransfer.getData("templateName");if(console.log("drop",a),!a)return;const n=e.clientX-document.querySelector(".timeline-row").getBoundingClientRect().left;this.$store.commit("editor/appendTimelineItem",{rowIdx:r,templateName:a,startX:n})},computeVisRows(){this.visRows=this.timelineRows.map(e=>e.map(e=>{var t;const r=e.computedTotalDuration,a={...e,originItem:e,uuid:Object(P["a"])(),mouseOn:!1};return a.startX=this.timelineScale(null!==(t=e.timing.offset)&&void 0!==t?t:0),a.width=this.timelineScale(r)-this.timelineScale(0),a.endX=a.startX+a.width,a}))},getColor(e){return"#3692d1"},getAnimationIcon(e){return E["h"]},getVItemTitle(e){const t=e.originItem;return t.initialRefSrc?t.initialRefSrc.ref:t.name},storeVItemTitle(e){this.$store.commit("editor/storeVItemTitle",e)},getDurationString(e){let t=e.originItem.computedTotalDuration;return t=(Math.round(100*t)/100).toFixed(2),t+"s"},getTimeString(){return(this.time/1e3).toFixed(2)+"s"},updateCursorPositionByTime(){this.cursorLeft=Math.max(this.time/this.duration*this.timelineWidth,0)},changeIconLeft(e,t){this.iconLeft[e]=t},updateDocumentScrollLeft(e){this.documentScrollLeft=e.target.scrollLeft},mousedownTimeline(e){this.moveTimeline=!0,this.moveTimelineX=e.x,this.moveTimelineY=e.y},mousemoveTimeline(e){if(this.moveTimeline){const t=this.moveTimelineX-e.x,r=this.moveTimelineY-e.y;this.moveTimelineX=e.x,this.moveTimelineY=e.y,this.timelineScroller.scrollLeft+=t,this.timerowScroller.scrollTop+=r}},mouseupTimeline(){this.moveTimeline=!1,this.moveTimelineX=0,this.moveTimelineY=0},getCoverItems(e){return null===this.highlightItem?[]:e.filter(e=>e.originItem!==this.highlightItem)},isFadeColor(e){return null!==this.highlightItem&&this.highlightItem!==e},hasHighlightItem(){return null!==this.highlightItem}},mounted(){this.$store.commit("editor/mountTimelinePanel",this.$el)},watch:{timelineRenderSign(){this.computeVisRows()},time(){this.updateCursorPositionByTime()},timelineWidth(){this.updateCursorPositionByTime(),this.$store.commit("editor/updateTimelineSvg")},overlapVisRows(e){this.iconLeft=Array.apply(0,Array(e.length)).map((function(){})),this.visRows.flat().forEach(e=>{this.flatIcons(e,!0)})},scrollLeft(e){this.timelineScroller.scrollLeft=e}},computed:{...Object(x["c"])("editor",{sceneEl:e=>e.sceneEl,time:e=>e.time,timelineRows:e=>e.timelineRows,timelineScale:e=>e.timelineScale,tlContainerWidth:e=>e.tlContainerWidth,timelineWidth:e=>e.timelineWidth,timelineRenderSign:e=>e.timelineRenderSign,durationMap:e=>e.durationMap,animationStyle:e=>e.animationStyle,useToAniMap:e=>e.useToAniMap,scrollLeft:e=>e.scrollLeft,highlightItem:e=>e.highlightItem,itemForSettings:e=>e.itemForSettings,aniStatus:e=>e.aniStatus}),overlapVisRows(){return f["e"](this.visRows.flat(),e=>e.startX)},timelineScroller(){return document.querySelector(".timeline-scroller")},timerowScroller(){return document.querySelector(".timerow-scroller")},rowMapList(){return this.visRows.map(e=>{const t=new Map;if(null!==this.highlightItem){const r=e.filter(e=>e.originItem===this.highlightItem),a=e.filter(e=>e.originItem!==this.highlightItem);t.set(this.ItemType.SHOWN,r),t.set(this.ItemType.HIDDEN,a)}else t.set(this.ItemType.SHOWN,e),t.set(this.ItemType.HIDDEN,[]);return t})}}},I=O,N=(r("3875"),Object(l["a"])(I,$,k,!1,null,"2d62a274",null)),M=N.exports,L=function(){var e=this,t=e._self._c;return t("div",{ref:"textPanel",staticClass:"text-panel",style:{height:e.panelHeight+"px"},attrs:{id:"text-panel"},on:{click:e.click}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.inEditMode,expression:"inEditMode"}],staticStyle:{padding:"0 10px",position:"relative"},attrs:{id:"editBox"}},[t("el-input",{attrs:{type:"textarea",placeholder:"Enter your script here",rows:5,autosize:""},model:{value:e.textPanelText,callback:function(t){e.textPanelText=t},expression:"textPanelText"}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.inEditMode,expression:"!inEditMode"}],staticStyle:{padding:"0 10px",position:"relative"},attrs:{id:"showBox"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.audioRunning&&e.showToolbox,expression:"!audioRunning&&showToolbox"}],staticClass:"timeStampWrapper",style:{top:e.timeStampTop,left:e.timeStampLeft},attrs:{contenteditable:"false"}},[t("span",{staticClass:"timeStamp"},[e._v(" "+e._s(e.timeStamp)+" ")])]),t("div",{staticClass:"word-container"},e._l(e.words,(function(r,a){return t("div",{key:"word-"+a,ref:"word-"+a,refInFor:!0,class:"narration-wrapper-"+a},[e._l(e.wordIdxIcons(a),(function(r,n){return t("div",{key:"animationIcon-"+n,staticClass:"narration-icon noSelection",staticStyle:{display:"contents"},attrs:{id:"animationIcon-wrapper-"+a+"-"+n}},[t("el-tooltip",{attrs:{placement:"top",content:r.use}},[t("div",{staticClass:"animationIcon",attrs:{id:"animationIcon-"+a+"-"+n},on:{click:function(t){return e.clickIcon(r,!0)},mouseenter:function(t){return e.mouseenterIcon(r)},mouseleave:function(t){return e.mouseleaveIcon(r)}}},[t("font-awesome-icon",{style:{"background-color":e.animationTypeToColor(r,"background"),color:e.animationTypeToColor(r,"color"),"border-color":e.animationTypeToColor(r,"border")},attrs:{id:"animationIcon",icon:e.animationTypeToIcon(r)}})],1)]),t("span",{staticClass:"narration-word noSelection"},[e._v(" ")])],1)})),e._l(e.keywordIcons(a),(function(r,n){return t("div",{key:"keywordIcon-"+n,staticClass:"narration-icon noSelection",staticStyle:{display:"contents"},attrs:{id:"keywordIcon-wrapper-"+a}},[t("div",{staticClass:"keywordIcon",attrs:{id:"keywordIcon-"+a+"-"+n},on:{click:function(t){return e.clickIcon(r,!1)},mouseenter:function(t){return e.mouseenterIcon(r)},mouseleave:function(t){return e.mouseleaveIcon(r)}}},[t("font-awesome-icon",{style:{"background-color":e.keywordIconStyle(r,"background"),color:e.keywordIconStyle(r,"color"),"border-color":e.keywordIconStyle(r,"border")},attrs:{id:"keywordIcon",icon:r.icon}})],1),t("span",{staticClass:"narration-word noSelection"},[e._v(" ")])])})),t("span",{staticClass:"narration-word noSelection",class:{"highlight-word":!e.audioRunning&&e.highlightWordIndex===a,"selected-word":e.inSelectedRange(a),"audio-word":"stop"!==e.aniStatus&&e.audioWordIndex===a,"underline-word":e.isLinkedWord(a)},attrs:{id:"narration-word-"+a},on:{mousedown:function(t){return e.mousedown(t,a)},mouseenter:function(t){return e.mouseenter(a)},mouseleave:function(t){return e.mouseleave(a)}}},[e._v(e._s(r.word))]),t("span",{staticClass:"narration-word noSelection",class:{"selected-word":e.inSelectedRange(a)&&a!==Math.max(e.selectedStart,e.selectedEnd),"underline-word":e.isLinkedWord(a)&&a!==Math.max(e.linkedStart,e.linkedEnd)},on:{mousedown:function(t){return e.mousedown(t,a)}}},[e._v(" ")])],2)})),0)])])},j=[];const B={NORMAL:"normal",RECT:"rect",LASSO:"lasso",CLICK:"click",COMP:"component"};var Z={name:"TextPanel",components:{FontAwesomeIcon:R["a"]},props:["audioRunning","compile","panelHeight"],data(){return{highlightWordIndex:-1,audioWordIndex:-1,textChanged:!1,selectedStart:-1,selectedEnd:-1,isSelecting:!1,linkedStart:-1,linkedEnd:-1,textPanelWords:[],showToolbox:!1,isTargetButtonClicked:!1,timeStamp:0,timeStampTop:0,timeStampLeft:0,animationButtonsTop:0,animationButtonsLeft:0,animationTargets:null,justHoveredIcon:null,animationActions:[],isPreviewingIcon:!1,isEditingIcon:!1,iconHasChanged:!1,isEditingText:!1,textHasChanged:!1,changeHighlightItemInTextPanel:!1,isCreatingItem:!1}},methods:{handleSelect(e,t){console.log(e,t)},shortNotify(e="Please commit your selection before continuing."){this.$notify({title:e,type:"warning"})},inRange(e,t,r){return Math.min(t,r)<=e&&Math.max(t,r)>=e},inSelectedRange(e){return this.inRange(e,this.selectedStart,this.selectedEnd)},isLinkedWord(e){return this.inRange(e,this.linkedStart,this.linkedEnd)},animationTypeToIcon(e){var t,r;const a=null!==(t=null!==(r=this.useToAniMap[e.use])&&void 0!==r?r:e.ani_type)&&void 0!==t?t:"Other";return this.animationStyle[a].icon},animationTypeToColor(e,t){var r,a;const n=null!==(r=null!==(a=this.useToAniMap[e.use])&&void 0!==a?a:e.ani_type)&&void 0!==r?r:"Other";return"background"===t?e.originItem===this.highlightItem?this.animationStyle[n].color:"white":"color"===t?e.originItem===this.highlightItem?"white":this.animationStyle[n].color:"border"===t?this.animationStyle[n].color:void 0},keywordIconStyle(e,t){return"background"===t?e.originItem===this.highlightItem?"gray":"white":"color"===t?e.originItem===this.highlightItem?"white":"gray":"border"===t?"gray":void 0},click(e){const t=e.target;if(t!==this.$refs.textPanel)return void(t.id.includes("animationIcon")||t.id.includes("keywordIcon")||this.keyup(e));const r=(e,t)=>{e&&(t?this.$store.commit("editor/clearSelectionConfirm",!0):this.$store.commit("editor/clearSelectionLeave",!0),this.$store.commit("editor/changeSelectionTool",B.NORMAL)),this.selectedStart=this.selectedEnd=-1};this.isEditingText?this.textHasChanged?this.$confirm("Do you want to save your edit before leaving? (Close to cancel)","Warning",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning",distinguishCancelAndClose:!0}).then(()=>r(!0,!0)).catch(e=>{"cancel"===e&&r(!0,!1)}):r(!0,!1):r(!1)},changeTextContent(e){let t="";this.textPanelWords=[],this.textPanelWords=e.target.innerText.split(/[\s\n]/).filter(e=>e),this.textPanelWords.forEach((e,r)=>{e.includes("s")&&0===r||(t+=e+" ")}),t=t.slice(0,-1),this.textPanelText!=t&&(this.textPanelText=t,this.$emit("textChange"))},keyup(){this.isTargetButtonClicked},handleKeyDelete(e){e.stopPropagation();const t=this.$refs.textPanel,r=t.getElementsByClassName("animationIcon");if(r.length!==this.animationActions.length){const e=Array.from(r).map(e=>e.id);for(let t in this.animationActions){const r=this.animationActions[t],a=this.animationActions.filter(e=>e.startIdx===r.startIdx).indexOf(r),n="animationIcon-"+r.startIdx+"-"+a;e.find(e=>e===n)||(this.animationActions.splice(t,1),this.$store.commit("editor/deleteItemByIcon",r))}}const a=t.getElementsByClassName("keywordIcon");if(r.length!==this.wordTargetIconPos.length){const e=Array.from(a).map(e=>e.id);for(let t in this.wordTargetIconPos){const r=this.wordTargetIconPos[t],a=this.wordTargetIconPos.filter(e=>e.startIdx===r.startIdx).indexOf(r),n="keywordIcon-"+r.startIdx+"-"+a;e.find(e=>e===n)||this.$store.commit("editor/deleteWordTarget",r)}}},mousedown(e,t){const r=()=>{console.log("mousedown",t),this.selectedStart=this.selectedEnd=t,this.isSelecting=!1,this.transcriptSrc.words.forEach(e=>e.selected=!1),document.onmousemove=()=>{if(!this.isTargetButtonClicked&&(this.isSelecting=!0,-1!==this.highlightWordIndex)){this.selectedEnd=this.highlightWordIndex;const e=Math.min(this.selectedStart,this.selectedEnd),t=Math.max(this.selectedStart,this.selectedEnd);for(let r=e;r<=t;r++)this.transcriptSrc.words.selected=!0}},document.onmouseup=()=>{this.isTargetButtonClicked||(console.log("select:",this.selectedStart,this.selectedEnd),this.isSelecting=!1,document.onmousemove=null,document.onmouseup=null,this.clickTargetButton())}};if(this.isTargetButtonClicked){if(!this.isEditingText)return void this.shortNotify("Please commit your edit before continuing.");const e=(e,t)=>{e&&(t?this.$store.commit("editor/clearSelectionConfirm",!0):this.$store.commit("editor/clearSelectionLeave",!0)),r()};this.textHasChanged?this.$confirm("Do you want to save your edit before leaving? (Close to cancel)","Warning",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning",distinguishCancelAndClose:!0}).then(()=>e(!0,!0)).catch(t=>{"cancel"===t&&e(!0,!1)}):e(!0,!1)}else r()},mouseenter(e){this.highlightWordIndex=e;const t=this.$refs["word-"+e][0],r=this.words[e];this.timeStamp=parseFloat(r.startTime).toFixed(2)+"s",this.computeTopLeft(t,[-15,0]),this.showToolbox=!0},mouseleave(){this.highlightWordIndex=-1,this.showToolbox=!1},createNewItem(){const e=Math.min(this.selectedStart,this.selectedEnd),t=Math.max(this.selectedStart,this.selectedEnd),r=this.words[e].startTime,a=this.words[t].endTime,n=Math.round(1e3*(a-r))/1e3;return{use:"",target:"",timing:{start:r,offset:0,duration:n},ani_type:""}},clickTargetButton(){this.isTargetButtonClicked=!0,this.animationTargets=null;const e=this.aniStatus;this.isEditingText=!0,this.textHasChanged=!1,this.$store.commit("editor/changeMode","animation"),this.$nextTick(()=>{this.$store.commit("target/changeSelectedTargets",[]),this.$store.commit("target/changeSvgSelectionChangeSign")});const t=()=>{this.selectedStart=this.selectedEnd=-1,this.isEditingText=!1,this.$store.commit("editor/changeMode","normal"),this.$store.commit("target/changeSelectedTargets",[]),this.$store.commit("editor/changeTempAnimationSelection",{aniName:"",aniType:""}),this.$store.commit("editor/changeSettingPanelVisible",!1)};this.$store.commit("editor/registerSelectionConfirm",()=>{this.commitSelectedChange(Math.min(this.selectedStart,this.selectedEnd),Math.max(this.selectedStart,this.selectedEnd)),t()}),this.$store.commit("editor/registerSelectionLeave",()=>{t(),this.$store.commit("editor/changeAniStatus",e)})},commitSelectedChange(e,t){0!==this.selectedTargets.length?this.tempAnimationName&&""!==this.tempAnimationName?(this.$store.commit("editor/appendItemByTextView",{minWordIdx:e,maxWordIdx:t,target:this.computeAniTarget(this.selectedTargets),toFitDuration:!0,settings:this.aniSettings}),this.$emit("aniChange"),this.selectedStart=this.selectedEnd=-1):this.shortNotify("No animation selected!"):this.shortNotify("No element selected!")},computeAniTarget(e){var t="";return e?(e.forEach(e=>{t+="#"+e.id+", "}),t=t.slice(0,-2),t):null},clickIcon(e){if(this.audioRunning)return;if(this.selectionTool!==B.NORMAL){if(this.isTargetButtonClicked&&!this.isEditingIcon)return void this.shortNotify();if(!this.isTargetButtonClicked&&!this.isPreviewingIcon)return void this.shortNotify()}const t=()=>{e.clicked=!1,e.hovered=!1,this.isEditingIcon=!1,this.linkedStart=-1,this.linkedEnd=-1,this.$store.commit("editor/changeMode","normal"),this.$store.commit("target/changeSelectedTargets",[]),this.$store.commit("editor/changeHighlightItem",null),this.$store.commit("editor/changeItemForSettings",null)},r=(r,a)=>{r&&(a?this.$store.commit("editor/clearSelectionConfirm",!0):this.$store.commit("editor/clearSelectionLeave",!0),this.$store.commit("editor/changeSelectionTool",B.CLICK),this.$nextTick(()=>{this.$store.commit("target/changeSelectedTargetsByIcon",e),this.$store.commit("target/changeSvgSelectionChangeSign")})),this.$store.commit("editor/showToolBox"),this.$store.commit("editor/changeHighlightItem",e.originItem),this.$store.commit("editor/changeItemForSettings",e.originItem),this.$store.commit("editor/registerSelectionConfirm",()=>{this.$store.commit("editor/updateItemByTextView",{item:e.originItem,target:this.computeAniTarget(this.selectedTargets)}),this.$emit("aniChange"),this.selectedStart=this.selectedEnd=-1,t()}),this.$store.commit("editor/registerSelectionLeave",()=>{t()}),this.isTargetButtonClicked=!0,this.isEditingIcon=!0,this.isPreviewingIcon=!1,this.iconHasChanged=!1,e.clicked=!0,e.hovered=!0,this.linkedStart=e.startIdx,this.linkedEnd=Math.max(e.startIdx,e.endIdx-1),this.$store.commit("editor/changeMode","animation")};this.isEditingIcon?this.iconHasChanged?this.$confirm("Do you want to save your edit before editing another icon? (Close to cancel)","Warning",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning",distinguishCancelAndClose:!0}).then(()=>r(!0,!0)).catch(e=>{"cancel"===e&&r(!0,!1)}):r(!0,!1):this.isPreviewingIcon&&r(!1,!1)},mouseenterIcon(e){this.changeHighlightItemInTextPanel=!0,this.mouseenterIconHandler(e)},mouseenterIconHandler(e){this.audioRunning||this.isPreviewingIcon||this.isEditingIcon||this.aniPlaying||this.selectionTool===B.NORMAL&&(this.isSelecting||(this.$store.commit("editor/changeHighlightItem",e.originItem),e.hovered=!0,this.isPreviewingIcon=!0,this.linkedStart=e.startIdx,this.linkedEnd=Math.max(e.startIdx,e.endIdx-1),this.$nextTick(()=>{this.$store.commit("target/changeSelectedTargetsByIcon",e),this.$store.commit("target/changeSvgSelectionChangeSign")})))},mouseleaveIcon(e){this.changeHighlightItemInTextPanel=!0,this.mouseleaveIconHandler(e)},mouseleaveIconHandler(e){this.isPreviewingIcon&&(this.isPreviewingIcon=!1,this.$store.commit("editor/changeHighlightItem",null),this.$store.commit("editor/changeSelectionTool",B.NORMAL),e.hovered=!1,this.linkedStart=-1,this.linkedEnd=-1)},computeTopLeft(e,t){const r=document.getElementsByClassName("text-panel")[0],a=r.getBoundingClientRect(),n=e.getBoundingClientRect();this.timeStampTop=n.top-a.top+r.scrollTop+t[0]+"px",this.timeStampLeft=n.left-a.left+t[1]+"px"},computeDuration(e,t){const r=Math.max(1,this.wordToEndTime(t)-this.wordToStartTime(e));return parseFloat(r.toFixed(3))},startTimeToWord(e){for(let t in this.words)if(e<this.words[t].startTime)return parseInt(t)-1},endTimeToWord(e,t){for(let r=e;r<this.words.length;r++)if(this.words[r].startTime>t)return r-1;return this.words.length-1},wordToStartTime(e){return this.words[e].startTime},wordToEndTime(e){return this.words[e].endTime},updateIconTiming(e){e.timing.start=this.wordToStartTime(e.startIdx),e.timing.duration=this.computeDuration(e.startIdx,e.endIdx),this.$store.commit("editor/updateItemTimingByIcon",e)},createAnimationAction(e,t,r,a,n,i,o,s,c=!1){this.animationActions.push({ani_type:e,target:t,timing:{start:r,offset:a,duration:i},startIdx:n,endIdx:this.endTimeToWord(n,i+r+a),clicked:c,hovered:c,use:o,originItem:s})},createAniActionsBytimelineRows(e,t,r=!1){var a,n,i;const o=null!==(a=null===t||void 0===t?void 0:t.duration)&&void 0!==a?a:1,s=null!==(n=null===t||void 0===t?void 0:t.start)&&void 0!==n?n:0,c=null!==(i=null===t||void 0===t?void 0:t.offset)&&void 0!==i?i:0,l=this.startTimeToWord(s+c);this.createAnimationAction(e.ani_type,e.target,s,c,l,o,e.use,e,r)},initAniActions(){if(this.animationActions=[],this.timelineRows.flat().forEach(e=>{if(e.sequence){var t,r,a,n;const i=null!==(t=null!==(r=null===(a=e.sequence)||void 0===a?void 0:a.sync)&&void 0!==r?r:null===(n=e.sequence)||void 0===n?void 0:n.concat)&&void 0!==t?t:[];i.forEach(t=>{this.createAniActionsBytimelineRows(t,e.timing)})}else this.createAniActionsBytimelineRows(e,e.timing)}),this.highlightItem){const e=this.animationActions.find(e=>e.originItem===this.highlightItem);e&&(e.clicked=!0,e.hovered=!0)}},renewAniIconByItem(e,t){},handleOutsideResize(){this.$store.commit("editor/changeTlContainerWidth",80)},isFadeColor(e){return null!==this.highlightItem&&this.highlightItem!==e.originItem}},mounted(){this.$store.commit("editor/mountTextPanel",this.$el)},watch:{windowWidth(){this.handleOutsideResize()},leftPanelWidth(){this.handleOutsideResize()},targetPanelWidth(){this.handleOutsideResize()},selectionTool(){this.selectionTool===B.NORMAL&&(this.isTargetButtonClicked=!1)},time(e){this.audioWordIndex=this.startTimeToWord(e/1e3),this.audioRunning&&(this.selectedStart=this.selectedEnd=-1)},timelineRows(){this.initAniActions()},selectedStart(){this.animationTargets=null,this.isTargetButtonClicked=!1},transcriptSrc(){this.audioWordIndex=-1},tableSelectionChangeSign(){this.isEditingIcon&&(this.iconHasChanged=!0),this.isEditingText&&(this.textHasChanged=!0)},inEditMode(){this.inEditMode?this.textChanged=!1:this.textChanged&&this.$store.commit("editor/updateAudio",this.textPanelText)},textPanelText(){this.inEditMode&&(this.textChanged=!0)},projectId(){this.selectedStart=this.selectedEnd=-1},clearTextHighlightSign(){this.linkedStart=-1,this.linkedEnd=-1},itemUpdateTuple(){if(null==this.itemUpdateTuple)return;const{item:e}=this.itemUpdateTuple,t=this.animationActions.find(t=>t.originItem===e);this.renewAniIconByItem(t,e),t.originItem===this.highlightItem&&(this.linkedStart=t.startIdx,this.linkedEnd=Math.max(t.startIdx,t.endIdx-1))},highlightItem(e,t){if(this.changeHighlightItemInTextPanel)this.changeHighlightItemInTextPanel=!1;else if(null!==e){const t=this.animationActions.find(t=>t.originItem===e);this.mouseenterIconHandler(t)}else if(null!==t){const e=this.animationActions.find(e=>e.originItem===t);this.mouseleaveIconHandler(e)}},clickIconSignal(){const e=this.animationActions.find(e=>e.originItem===this.clickIconSignal);this.clickIcon(e)}},computed:{...Object(x["c"])("editor",{time:e=>e.time,timelineRows:e=>e.timelineRows,tlContainerWidth:e=>e.tlContainerWidth,transcriptSrc:e=>e.transcriptSrc,wordTargetIconPos:e=>e.wordTargetIconPos,animationStyle:e=>e.animationStyle,selectionTool:e=>e.selectionTool,windowWidth:e=>e.windowWidth,leftPanelWidth:e=>e.leftPanelWidth,targetPanelWidth:e=>e.targetPanelWidth,aniStatus:e=>e.aniStatus,tempAnimationName:e=>e.animationName,useToAniMap:e=>e.useToAniMap,aniSettings:e=>e.aniSettings,currentMode:e=>e.currentMode,itemForSettings:e=>e.itemForSettings,clearTextHighlightSign:e=>e.clearTextHighlightSign,itemUpdateTuple:e=>e.itemUpdateTuple,highlightItem:e=>e.highlightItem,clickIconSignal:e=>e.clickIconSignal}),...Object(x["c"])("target",{selectedTargets:e=>e.selectedTargets,tableSelectionChangeSign:e=>e.tableSelectionChangeSign}),...Object(x["c"])("resource",{projectId:e=>e.projectId}),...Object(x["b"])("editor",["aniPlaying"]),animationName(){var e,t;return null!==(e=null===(t=this.itemForSettings)||void 0===t?void 0:t.use)&&void 0!==e?e:""},textPanelText:{set(e){this.$store.commit("editor/changetextPanelText",e)},get(){return this.$store.state.editor.textPanelText}},words(){return this.transcriptSrc.words},wordIdxIcons(){return e=>this.animationActions.filter(t=>t.startIdx===e)},keywordIcons(){return e=>this.wordTargetIconPos.filter(t=>t.startIdx===e)},inEditMode(){return"text"===this.currentMode}}},D=Z,G=(r("1974"),Object(l["a"])(D,L,j,!1,null,"6c09299e",null)),U=G.exports,F={name:"ControlPanel",components:{TimelinePanel:M,TextPanel:U},props:["footerHeight"],data(){return{animationRate:1,duration:1,running:!1,disabled:!0,needAudio:!1,needCompile:!0,audioReadyCallback:null,marks:{},timelineMode:"text",audioNotification:"Audio",updateAudioNotificationTimeout:null,showTimeline:!0,showAnimationPane:!1,emptyHeight:0}},methods:{init(){this.time=0,this.running=!1,this.disabled=!0,this.needCompile=!0,this.needAudio=!1,this.$store.commit("editor/changeAniStatus","stop")},compile(e=!0,t=null){this.$store.commit("editor/changeAniStatus","pause"),this.$store.commit("editor/changeAniSvgRenderSign");let r=function(){this.time=this.timeline.progress()*this.duration}.bind(this);this.$store.commit("editor/changeSelectionTool",B.NORMAL),this.$store.commit("target/changeSelectedTargets",[]);const a=()=>{this.$nextTick(()=>{this.$store.commit("editor/compile",{onUpdateFunc:r,notification:e}),this.compileSuccess&&(this.disabled=!1,this.needCompile=!1,this.restart(),t&&t())})};this.needAudio?(this.getAudio(),this.audioReadyCallback=a):a()},handleTextChange(){this.needAudio=!0},handleAniChange(){this.needCompile=!0},handleTimeChange(){this.audioReady&&this.useAudio&&(this.audioEl.currentTime=this.time/1e3)},changeEditMode(){"normal"===this.currentMode?this.$store.commit("editor/changeMode","text"):this.$store.commit("editor/changeMode","normal")},resetScene(){this.$store.commit("editor/initWorkspace"),this.$store.commit("editor/resetEditor")},loadExample(e="animation"){"animation"===e?this.$store.commit("editor/initWorkspace",!0):this.$store.commit("editor/initLinking")},deleteAniItem(e){this.$store.commit("editor/deleteItem",this.itemForSettings),this.selectionTool!==B.NORMAL&&(this.$store.commit("editor/clearSelectionLeave",!0),this.stopLeave||(this.$store.commit("editor/changeSelectionTool",B.NORMAL),this.$store.commit("editor/clearSelectionConfirm",!1)));let t=e.target;"I"!==t.nodeName&&"SPAN"!==t.nodeName||(t=e.target.parentNode),t.blur()},getWordLinking(){this.$store.dispatch("editor/queryNLPParseResult")},getNLPResult(){this.$store.dispatch("editor/queryNLPGenerateResult"),this.$store.commit("editor/changeSelectionTool",B.NORMAL),this.needCompile=!0},getAudio(){const e=this.textPanelText;this.$store.commit("editor/updateAudio",e),this.needAudio=!1,this.restart()},changeTimelineDisplay(){this.showTimeline=!this.showTimeline},updateTimelineMarks(){const e=10,t=e*this.timelineWidth/this.tlContainerWidth,r=this.timelineScale.ticks(t),a=this.timelineScale.tickFormat(t,".2"),n=r.map(a),i={};n.forEach(e=>i[1e3*parseInt(e)]=e),this.marks=i},switchRunningState(){this.$store.commit("editor/changeSelectionTool",B.NORMAL),this.$store.commit("target/changeSelectedTargets",[]),this.needCompile||this.needAudio?this.compile(!0,()=>{this.running?this.pause():(this.stop(),this.seek(this.time),this.resume())}):this.running?this.pause():this.resume()},pause(){this.running=!1,this.timeline.pause(),this.audioReady&&this.useAudio&&this.audioEl.pause(),this.$store.commit("editor/changeAniStatus","pause")},restart(){this.stop(),setTimeout(()=>this.resume())},seek(e){this.timeline.seek(e/1e3),this.audioReady&&this.useAudio&&(this.audioEl.currentTime=e/1e3)},stop(){this.$store.commit("editor/changeSelectionTool",B.NORMAL),this.$store.commit("target/changeSelectedTargets",[]),this.running=!1,this.timeline&&(this.timeline.time(0),this.timeline.pause()),this.audioReady&&this.useAudio&&(this.audioEl.pause(),this.audioEl.currentTime=0),this.$store.commit("editor/changeAniStatus","stop")},resume(){this.running=!0,this.timeline.play(),this.audioReady&&this.useAudio&&this.audioEl.play(),this.$store.commit("editor/changeAniStatus","play")},formatTooltip(e){return e/=1e3,e.toFixed(2)},changeTime(e){if(!this.timeline)return;let t=e/this.duration;this.timeline.progress(t)},changeRate(e){try{const t=parseFloat(e);if(t<=0)return;this.timeline&&this.timeline.timeScale(t),this.audioReady&&(this.audioEl.playbackRate=t)}catch(t){console.error(t)}},changeTimelineMode(e){this.timelineMode=e},recomputeHeight(){const e=document.getElementsByClassName("operation-group")[0];this.emptyHeight=this.footerHeight-e.clientHeight}},mounted(){this.init(),this.$store.commit("editor/changeTlContainerWidth",80)},watch:{footerHeight(){this.recomputeHeight()},controllerInitSign(){this.init()},audioReady(){if(this.audioReady&&this.audioReadyCallback&&(this.audioReadyCallback(),this.audioReadyCallback=null),this.audioReady){const e=1e3*this.audioEl.duration+2e3;this.duration<e&&(this.duration=e,this.$store.commit("editor/updateTimelineScaleByAudio",this.duration),this.updateTimelineMarks())}},timeline(){},timelineWidth(){this.duration=1e3*this.timelineScale.invert(this.timelineWidth),this.updateTimelineMarks()},audioSrc(){},audioCompiling(e){this.audioNotification=e?"Generating audio...":"Audio updated",e?clearTimeout(this.updateAudioNotificationTimeout):this.updateAudioNotificationTimeout=setTimeout(()=>{this.audioNotification="Audio"},2e3)},aniStatus(){"preview"===this.aniStatus&&(this.needCompile=!0)},aniChangeSign(){this.needCompile=!0}},computed:{...Object(x["c"])("resource",{}),...Object(x["c"])("editor",{controllerInitSign:e=>e.controllerInitSign,timeline:e=>e.timeline,timelineScale:e=>e.timelineScale,timelineWidth:e=>e.timelineWidth,tlContainerWidth:e=>e.tlContainerWidth,nlpLoading:e=>e.nlpLoading,nlpLinking:e=>e.nlpLinking,audioEl:e=>e.audioEl,audioReady:e=>e.audioReady,audioSrc:e=>e.audioSrc,transcriptSrc:e=>e.transcriptSrc,textPanelText:e=>e.textPanelText,audioCompiling:e=>e.audioCompiling,refresh:e=>e.refresh,compileSuccess:e=>e.compileSuccess,wordTargetIconPos:e=>e.wordTargetIconPos,selectionTool:e=>e.selectionTool,currentMode:e=>e.currentMode,aniStatus:e=>e.aniStatus,itemForSettings:e=>e.itemForSettings,aniChangeSign:e=>e.aniChangeSign}),...Object(x["b"])("editor",["svgPanelInSelecting"]),useAudio:{get(){return this.$store.state.editor.useAudio},set(e){this.$store.commit("editor/changeUseAudio",e)}},time:{get(){return this.$store.state.editor.time},set(e){this.$store.commit("editor/changeTime",e)}},showPotential:{get(){return this.$store.state.editor.showPotential},set(e){this.$store.commit("editor/changeShowPotential",e)}},runIcon:function(){return this.running?"el-icon-video-pause":"el-icon-video-play"},linkButtonIcon(){return this.nlpLinking?"el-icon-loading":"el-icon-link"},nlpButtonIcon(){return this.nlpLoading?"el-icon-loading":"el-icon-magic-stick"},linked(){return this.wordTargetIconPos.length>0},editModeDisabled(){return this.selectionTool!==B.NORMAL},inEditMode(){return"text"===this.currentMode},showAniItemButton(){return null!=this.itemForSettings}}},z=F,V=(r("ce5a"),Object(l["a"])(z,C,A,!1,null,"4a588628",null)),H=V.exports,W=function(){var e=this,t=e._self._c;return t("div",{staticClass:"svg-container-master"},[t("svg",{ref:"svg"},[t("g",{staticClass:"scene"})])])},K=[],q={name:"SVGContainer",data(){return{svg:null,scene:null}},methods:{loadSVG(){this.scene.innerHTML=this.svgStr,this.scene._gsap=null,this.scene.removeAttribute("transform"),this.$store.commit("editor/updateChartSize")}},mounted(){this.svg=this.$refs.svg,this.scene=this.svg.querySelector(".scene"),this.$store.commit("editor/mountSvgElement",this.svg),this.$store.commit("editor/mountSceneElement",this.scene)},watch:{svgRenderSign(){this.loadSVG()}},computed:{...Object(x["c"])("editor",{svgRenderSign:e=>e.svgRenderSign,svgStr:e=>{var t,r;return null!==(t=null===(r=e.scene)||void 0===r?void 0:r.svgStr)&&void 0!==t?t:""}})}},J=q,Y=(r("4617"),Object(l["a"])(J,W,K,!1,null,"62cf0b57",null)),X=Y.exports,Q=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ani-svg-container-master"},[t("svg",{ref:"svg"},[t("g",{staticClass:"scene"})])])},ee=[],te={name:"AniSVGContainer",data(){return{svg:null,scene:null}},methods:{loadSVG(){this.svg.querySelectorAll("*:not(.scene)").forEach(e=>e.remove()),this.scene.innerHTML=this.svgStr,this.scene._gsap=null,this.scene.removeAttribute("transform")}},mounted(){this.svg=this.$refs.svg,this.scene=this.svg.querySelector(".scene"),this.$store.commit("editor/mountAniSvgElement",this.svg),this.$store.commit("editor/mountAniSceneElement",this.scene)},watch:{aniSvgRenderSign(){this.loadSVG()}},computed:{...Object(x["c"])("editor",{aniSvgRenderSign:e=>e.aniSvgRenderSign,svgStr:e=>{var t,r;return null!==(t=null===(r=e.scene)||void 0===r?void 0:r.svgStr)&&void 0!==t?t:""}})}},re=te,ae=(r("363b"),Object(l["a"])(re,Q,ee,!1,null,"a2e67a44",null)),ne=ae.exports,ie=function(){var e=this,t=e._self._c;return t("div",{staticClass:"template-panel"},[t("el-tabs",{attrs:{"tab-position":"top","active-name":e.activePaneName,type:"card"},on:{"tab-click":e.changeTab}},[t("el-tab-pane",{staticClass:"spec-pane",style:{height:e.paneHeight+"px"},attrs:{label:"Animation",name:"animation"}},[t("span",{staticClass:"normal-span",attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-edit-outline"}),e._v(" Animation ")]),t("codemirror",{ref:"animationTextEditor",attrs:{value:e.animationText,options:e.cmOptions},on:{changes:e.animationTextChange}}),e.isSpecTextValid?e._e():t("div",{staticStyle:{position:"absolute",top:"0","text-align":"center",width:"100%",background:"#f56c6c","z-index":"999"}},[e._v(" Specification is not valid! "+e._s(e.specTextErrorMsg)+" ")])],1),t("el-tab-pane",{staticClass:"spec-pane",style:{height:e.paneHeight+"px"},attrs:{label:"Template",name:"template"}},[t("span",{staticClass:"normal-span",attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-files"}),e._v(" Template ")]),t("codemirror",{ref:"templateTextEditor",attrs:{value:e.templateText,options:e.cmOptions},on:{changes:e.templateTextChange}}),e.isSpecTextValid?e._e():t("div",{staticStyle:{position:"absolute",top:"0","text-align":"center",width:"100%",background:"#f56c6c","z-index":"999"}},[e._v(" Specification is not valid! "+e._s(e.specTextErrorMsg)+" ")])],1),t("el-tab-pane",{staticClass:"spec-pane",style:{height:e.paneHeight+"px"},attrs:{label:"Binder",name:"binder"}},[t("span",{staticClass:"normal-span",attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-connection"}),e._v(" Binder ")]),t("codemirror",{ref:"binderTextEditor",attrs:{value:e.binderText,options:Object.assign({readOnly:!0},e.cmOptions)}}),t("div",{staticStyle:{position:"absolute",top:"10px",right:"24px","text-align":"center",width:"100px",background:"rgba(203,203,203,0.27)","z-index":"999","border-radius":"3px"}},[e._v(" Read Only ")])],1),t("el-tab-pane",{staticClass:"spec-pane",style:{height:e.paneHeight+"px"},attrs:{label:"Target",name:"target"}},[t("span",{staticClass:"normal-span",attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-aim"}),e._v(" Virtual target model ")]),t("codemirror",{ref:"virtualModelTextEditor",attrs:{value:e.virtualModelText,options:e.cmHTMLOptions}}),t("div",{staticStyle:{position:"absolute",top:"10px",right:"24px","text-align":"center",width:"100px",background:"rgba(203,203,203,0.27)","z-index":"999","border-radius":"3px"}},[e._v(" Read Only ")])],1)],1)],1)},oe=[],se=r("5e48"),ce=r.n(se),le=r("8f94"),ue=r.n(le);r("a7be"),r("b866"),r("f9d4"),r("d5e0"),r("8822"),r("d2de"),r("31c5"),r("05dd"),r("4895"),r("cbc8"),r("697e"),r("aedd"),r("a2c1"),r("8c332");function de(e){return pe(e,0)}function pe(e,t=0){const r="  ".repeat(t),a=Array.from(e.attributes).map(e=>`${e.name}="${e.value.replace(/"/g,"'")}"`).join(" "),n=`<${e.tagName.toLowerCase()}${""===a?"":" "}${a}>`,i=`</${e.tagName.toLowerCase()}>`,o=Array.from(e.childNodes).map(e=>e instanceof Element?pe(e,t+1):`${"  ".repeat(t+1)}${e.textContent}`).filter(e=>""!==e.trim()).join("\n");return""===o?`${r}${n}${i}`:`${r}${n}\n${o}\n${r}${i}`}var he={name:"DebugPanel",components:{codemirror:le["codemirror"]},props:["paneHeight","paneWidth"],data(){return{activePaneName:"animation",templateContentDialogVisible:!0,cmOptions:{tabSize:2,mode:"application/json",theme:"idea",lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,gutters:["CodeMirror-lint-markers","CodeMirror-linenumbers","CodeMirror-foldgutter"],foldGutter:!0,line:!0},codeUpdateTimeoutId:null,cmHTMLOptions:{tabSize:2,mode:"text/html",htmlMode:!0,theme:"idea",lineNumbers:!0,matchBrackets:!0,readOnly:!0,styleActiveLine:!0,autoCloseTags:!0,gutters:["CodeMirror-lint-markers","CodeMirror-linenumbers","CodeMirror-foldgutter"],foldGutter:!0,line:!0},resourceText:"",templateText:"",animationText:"",binderText:"",virtualModelText:"",isHardChangeResource:!1,isHardChangeTemplate:!1,isHardChangeAnimation:!1,updateMark:!1}},methods:{emptyAnimation(){this.$store.commit("editor/emptyAnimation")},currentChange(e){this.currentPage=e},changeTab(e){this.activePaneName=e.name,setTimeout(()=>{var e,t,r,a,n;null===(e=this.$refs.resourceTextEditor)||void 0===e||e.refresh(),null===(t=this.$refs.templateTextEditor)||void 0===t||t.refresh(),null===(r=this.$refs.animationTextEditor)||void 0===r||r.refresh(),null===(a=this.$refs.binderTextEditor)||void 0===a||a.refresh(),null===(n=this.$refs.virtualModelTextEditor)||void 0===n||n.refresh()},0)},resourceTextChange(e){setTimeout(()=>{e.refresh()},50)},templateTextChange(e){this.isHardChangeTemplate?this.isHardChangeTemplate=!1:(clearTimeout(this.codeUpdateTimeoutId),this.codeUpdateTimeoutId=setTimeout(()=>{try{const t=ce.a.parse(e.getValue());this.$store.commit("editor/updateEditorUsingTemplateJSON",t),this.updateMark=!0,this.$store.commit("editor/emitAniChangeSign")}catch(t){console.error(t),this.$store.commit("editor/changeSpecTextValidState",{isValid:!1,errorMsg:t.message})}},1e3))},animationTextChange(e){this.isHardChangeAnimation?this.isHardChangeAnimation=!1:(clearTimeout(this.codeUpdateTimeoutId),this.codeUpdateTimeoutId=setTimeout(()=>{try{const t=ce.a.parse(e.getValue());this.$store.commit("editor/updateEditorUsingAnimationJSON",t),this.updateMark=!0,this.$store.commit("editor/emitAniChangeSign")}catch(t){console.error(t),this.$store.commit("editor/changeSpecTextValidState",{isValid:!1,errorMsg:t.message})}},1e3))},clickFilter(e){if(this.selectionTool===B.NORMAL)return void this.$notify({title:"Enter selection mode first",type:"warning"});const t=e.relatedTargets(this.fullTargetList);this.$store.commit("editor/changeSelectionTool",B.COMP),this.$nextTick(()=>{this.$store.commit("target/changeSelectedTargets",t),this.$store.commit("target/changeSvgSelectionChangeSign")})},enableFilterChange(e){this.$store.commit("editor/changeFilterSwitch",e)}},mounted(){},watch:{resourceJSONRenderSign(){},templateJSONRenderSign(){const e=ce.a.stringify(this.templateJSON,null,2);this.$refs.templateTextEditor.codemirror.getValue()!==e&&(this.isHardChangeTemplate=!0,this.templateText=e,this.$refs.templateTextEditor.codemirror.setValue(e))},animationJSONRenderSign(){const e=ce.a.stringify(this.animationJSON,null,2);this.$refs.animationTextEditor.codemirror.getValue()!==e&&(this.isHardChangeAnimation=!0,this.animationText=e,this.$refs.animationTextEditor.codemirror.setValue(e))},binderJSON(){const e=null!=this.binderJSON?ce.a.stringify(this.binderJSON,null,2):"(No binder)";this.binderText=e,this.$refs.binderTextEditor.codemirror.setValue(e)},targetModel(){let e="";if(null==this.targetModel)e="(No target model)";else{const t=this.targetModel.virtualModel,r=["\x3c!-- Root selection is a list of these elements --\x3e"];Array.from(t.children).forEach(e=>{r.push(de(e))}),e=r.join("\n")}this.virtualModelText=e,this.$refs.virtualModelTextEditor.codemirror.setValue(e);const t=this.$refs.virtualModelTextEditor.codemirror;console.log(">>",t),setTimeout(()=>{let e=0;while(e<t.doc.size){const r=t.getLine(e),a=r.includes("g-v-el");a&&t.foldCode(e),e++}})}},computed:{...Object(x["c"])("editor",{isSpecTextValid:e=>e.isSpecTextValid,specTextErrorMsg:e=>e.specTextErrorMsg,resourceJSON:e=>e.resourceJSON,templateJSON:e=>e.templateJSON,animationJSON:e=>e.animationJSON,resourceJSONRenderSign:e=>e.resourceJSONRenderSign,templateJSONRenderSign:e=>e.templateJSONRenderSign,animationJSONRenderSign:e=>e.animationJSONRenderSign,selectionTool:e=>e.selectionTool,enableFilter:e=>e.enableFilter,binderJSON:e=>e.binderJSON,targetModel:e=>e.targetModel}),...Object(x["c"])("target",{fullTargetList:e=>e.fullTargetList,selectedTargets:e=>e.selectedTargets,activeFilters:e=>e.activeFilters}),filterTable(){const e=[],t=this.activeFilters;for(let r=0;r<t.length;r+=this.numFilterPerRow)e.push(t.slice(r,r+this.numFilterPerRow));return e},numFilterPerRow(){return Math.max(1,Math.round((this.paneWidth-20)/190))}}},fe=he,ge=(r("b545"),Object(l["a"])(fe,ie,oe,!1,null,"2d34f2a1",null)),me=ge.exports,ye=function(){var e=this,t=e._self._c;return t("div",{staticClass:"proj-selection-panel"},[t("el-scrollbar",[t("div",{staticClass:"upload-title"},[e._v("Upload an SVG")]),t("el-upload",{staticClass:"drag-upload",staticStyle:{width:"100%"},attrs:{drag:"","on-success":e.handleFile,"http-request":e.uploadFile,"before-upload":e.fileFilter,"show-file-list":!1,"auto-upload":!0,action:"none",multiple:""}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("Drop or select file (.svg)")])]),t("el-divider"),e._l(e.projectGroups,(function(r){return t("div",{key:r.name},[t("div",{staticClass:"upload-title"},[e._v(e._s(r.name)+" ("+e._s(r.projects.length)+")")]),t("div",{staticClass:"svg-group"},e._l(r.projects,(function(r){return t("el-card",{key:r.id,staticClass:"svg-item clickable",attrs:{shadow:"hover","body-style":{padding:"0px"}},nativeOn:{click:function(t){return e.handleProjectClick(r)}}},[t("SvgPreviewer",{attrs:{project:r,height:160,width:240}}),t("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center",height:"20px"}},[e._v(e._s(r.label))])],1)})),1),t("el-divider")],1)})),t("div",{staticClass:"upload-title"},[e._v("Load uploaded charts ("+e._s(e.customCharts.length)+")")]),t("div",{staticClass:"svg-group"},e._l(e.customCharts,(function(r){return t("el-card",{key:r.id,staticClass:"svg-item clickable",attrs:{shadow:"hover","body-style":{padding:"0px"}},nativeOn:{click:function(t){return e.handleProjectClick(r)}}},[t("SvgPreviewer",{attrs:{project:r,height:160,width:240}}),t("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center",height:"20px"}},[e._v(e._s(r.label))])],1)})),1)],2)],1)},ve=[],_e=(r("5494"),r("cee4")),be=function(){var e=this,t=e._self._c;return t("div",{staticClass:"svg-previewer",style:{height:e.height+"px",width:e.width+"px"}},[t("svg",{ref:"svg",attrs:{height:e.height,width:e.width}},[t("g",{staticClass:"scene"})])])},Te=[],we={name:"SvgPreviewer",props:["project","width","height"],data(){return{svg:null,scene:null,created:!1}},methods:{loadSVG(){if(this.created)return;const e=this.staticSvgMap.get(this.project.id);e&&(this.created=!0,this.scene.innerHTML=e,this.$nextTick(()=>{const e=this.scene.querySelector("svg"),t=e.getAttribute("width"),r=e.getAttribute("height");this.svg.setAttribute("viewBox",`0 0 ${t} ${r}`)}))}},mounted(){this.svg=this.$refs.svg,this.scene=this.svg.querySelector(".scene")},watch:{staticSvgMapSign(){this.loadSVG()}},computed:{...Object(x["c"])("resource",{staticSvgMap:e=>e.staticSvgMap,staticSvgMapSign:e=>e.staticSvgMapSign})}},Se=we,xe=Object(l["a"])(Se,be,Te,!1,null,"ccece566",null),Ce=xe.exports,Ae={name:"ProjSelectionPanel",components:{SvgPreviewer:Ce},data(){return{customCharts:[]}},mounted(){this.$store.dispatch("resource/queryAllSvg").then(()=>{this.$store.commit("resource/changeStaticSvgMapSign")})},methods:{uploadFile(e){this.svgUrl=URL.createObjectURL(e.file),_e["a"].get(this.svgUrl).then(t=>{this.$store.dispatch("resource/addProject",{srcId:e.file.name.split(".")[0],svgStr:t.data})}).catch(e=>{this.$message.error(e)}),this.$emit("closeProjSelPanel")},handleFile(e,t){console.log(e,t)},fileFilter(e){const t="image/svg+xml"===e.type;return t||this.$message.error("Only support svg chart!"),t},handleProjectClick(e){console.log("change proj",e),this.$store.commit("resource/changeProjectId",e.id),this.$emit("closeProjSelPanel")}},watch:{staticSvgMap(){console.log(this.staticSvgMap)}},computed:{projectId:{set(e){this.$store.commit("resource/changeProjectId",e)},get(){return this.$store.state.resource.projectId}},...Object(x["c"])("resource",{projectList:e=>e.projectList,staticSvgMap:e=>e.staticSvgMap}),projectGroups(){const e=[],t=new Map;return this.projectList.forEach(r=>{const a=r.group;t.has(a)||(t.set(a,e.length),e.push({name:a,projects:[]})),e[t.get(a)].projects.push(r)}),console.log(">>>",e),e}}},$e=Ae,ke=(r("d6f6"),Object(l["a"])($e,ye,ve,!1,null,"63450a5a",null)),Pe=ke.exports,Re=function(){var e=this,t=e._self._c;return t("div",{staticClass:"export-svg-container-master"},[t("svg",{ref:"svg",attrs:{viewBox:`0 0 ${e.width} ${e.height}`}},[t("rect",{attrs:{x:"0",y:"0",width:e.width,height:e.height,fill:"#ffffff",stroke:"none"}}),t("g",{staticClass:"scene"})])])},Ee=[],Oe=(r("907a"),r("986a"),r("1d02"),r("3c5d"),r("6ce5"),r("2834"),r("4ea1"),r("a01c")),Ie=r("fcfb"),Ne=r.n(Ie),Me=r("3b59");function Le(e,t,r,a,n){const i=e.map(e=>je(e,r,a));return Be(i,t,r,a,n)}function je(e,t,r){const a=document.createElement("canvas");a.setAttribute("width",t),a.setAttribute("height",r);const n=a.getContext("2d"),i=Oe["a"].fromString(n,e);i.start();const o=a.toDataURL("img/png");return i.stop(),Object(Me["a"])(o)}function Be(e,t,r,a,n){var i,o;const s=e.map((e,t)=>({name:`image${t}.png`,data:new Uint8Array(e)})),c=Ze(t);s.push({name:"music.wav",data:c});let l="",u="",d=-1;const p=Ne()({MEMFS:s,arguments:["-i","music.wav","-ac","1","-framerate",""+n,"-i","image%d.png","-r",""+n,"-c:v","libx264","-s",`${r}x${a}`,"-pix_fmt","yuv420p","-ar","16000","output.mp4"],print:function(e){l+=e+"\n"},printErr:function(e){u+=e+"\n"},onExit:function(e){console.log("Video synthesis process exited with code "+e),0!==e&&(console.log(l),console.error(u)),d=e}});return{result:null!==(i=null===(o=p.MEMFS[0])||void 0===o?void 0:o.data)&&void 0!==i?i:null,code:d,message:l}}function Ze(e){let t,r,a=e.numberOfChannels,n=e.length*a*2+44,i=new ArrayBuffer(n),o=new DataView(i),s=[],c=0,l=0;function u(e){o.setUint16(l,e,!0),l+=2}function d(e){o.setUint32(l,e,!0),l+=4}for(d(1179011410),d(n-8),d(1163280727),d(544501094),d(16),u(1),u(a),d(e.sampleRate),d(2*e.sampleRate*a),u(2*a),u(16),d(1635017060),d(n-l-4),t=0;t<e.numberOfChannels;t++)s.push(e.getChannelData(t));while(l<n){for(t=0;t<a;t++)r=Math.max(-1,Math.min(1,s[t][c])),r=0|(.5+r<0?32768*r:32767*r),o.setInt16(l,r,!0),l+=2;c++}return i}function De(e,t){let r=window.URL.createObjectURL(new Blob([e],{type:"arraybuffer"}));const a=document.createElement("a");a.style.display="none",a.href=r,a.setAttribute("download",t),document.body.appendChild(a),a.click(),document.body.removeChild(a)}var Ge=r("ade3");r("5b81");class Ue{constructor(){Object(Ge["a"])(this,"charts",[]),Object(Ge["a"])(this,"imports",[]),Object(Ge["a"])(this,"targetDefs",[]),Object(Ge["a"])(this,"templates",[]),Object(Ge["a"])(this,"animation",void 0)}}var Fe=r("7891"),ze=r("52d4"),Ve=r("95d5");class He{static reviver(e,t){return""===e?He.fromJSON(t):t}static fromJSON(e){if(null==e||"object"!==typeof e)return null;switch(e.type){case"filter":return Object.assign(new ze["a"],e);case"sort":return Object.assign(new Ve["a"],e);default:return console.warn("Unsupported transform type "+e.type),null}}static fromObjectOrArray(e){if(null==e||"object"!==typeof e)return[];Array.isArray(e)||(e=[e]);const t=e.map(e=>He.fromJSON(e));return t.filter(e=>null!=e),t}}class We{static reviver(e,t){return""===e?We.fromJSON(t):t}static fromJSON(e){if(null==e||""===e)return Fe["b"].getDefaultTarget();if("string"===typeof e)return new Fe["a"](e);if("object"!==typeof e)return Fe["b"].getDefaultTarget();if("selector"in e||"transform"in e&&1===Object.keys(e).length){const t=He.fromObjectOrArray(e.transform);return Object.assign(Fe["b"].getDefaultTarget(),e,{transform:t})}throw"Target type is not supported"}}var Ke=r("f720"),qe=r("cffa");class Je extends Ke["a"]{constructor(e=[]){super(),Object(Ge["a"])(this,"sequence",void 0),this.type="sync",this.sequence={sync:e}}append(e){return this.sequence.sync.push(e),this}computeDuration(e){var t;const{yoyo:r}=this.timing.getComputedTiming();if(null!==(t=this.timing)&&void 0!==t&&t.duration)return this.timing.duration;let a=0;return this.sequence.sync.forEach(t=>{var r,n;const i=t.computeDuration(e.deriveBy(this.target));a=Math.max(a,i+(null!==(r=t.timing.start)&&void 0!==r?r:0)+(null!==(n=t.timing.offset)&&void 0!==n?n:0))}),r?a*(r.repeat+1)+r.delay*r.repeat:a}computePossibleElements(e){const t=new Set;return this.sequence.sync.forEach(r=>{const a=r.computePossibleElements(e.deriveByWithoutTransform(this.target));a.forEach(e=>t.add(e))}),t}create(e){var t;const r=qe["a"].timeline();this.sequence.sync.forEach(t=>{const a=t.create(e.deriveBy(this.target));null!==a&&r.add(a,t.timing.startPlusOffset())});const{yoyo:a}=this.timing.getComputedTiming();return null!==(t=this.timing)&&void 0!==t&&t.duration&&r.duration(this.timing.duration),a&&(r.yoyo(!0),r.repeat(a.repeat),r.repeatDelay(a.delay)),r}}class Ye extends Ke["a"]{constructor(e=[]){super(),Object(Ge["a"])(this,"sequence",void 0),this.type="concat",this.sequence={concat:e}}append(e){return this.sequence.concat.push(e),this}computeDuration(e){var t;const{yoyo:r}=this.timing.getComputedTiming();if(null!==(t=this.timing)&&void 0!==t&&t.duration)return this.timing.duration;let a=0;return this.sequence.concat.forEach(t=>{var r;const n=t.computeDuration(e.deriveBy(this.target));a=Math.max(a,a+n+(null!==(r=t.timing.offset)&&void 0!==r?r:0))}),r?a*(r.repeat+1)+r.delay*r.repeat:a}computePossibleElements(e){const t=new Set;return this.sequence.concat.forEach(r=>{const a=r.computePossibleElements(e.deriveByWithoutTransform(this.target));a.forEach(e=>t.add(e))}),t}create(e){var t;const r=qe["a"].timeline();this.sequence.concat.forEach(t=>{var a;const n=t.create(e.deriveBy(this.target));null!==n&&r.add(n,">"+(null!==(a=t.timing.offset)&&void 0!==a?a:0))});const{yoyo:a}=this.timing.getComputedTiming();return null!==(t=this.timing)&&void 0!==t&&t.duration&&r.duration(this.timing.duration),a&&(r.yoyo(!0),r.repeat(a.repeat),r.repeatDelay(a.delay)),r}}class Xe extends Ke["a"]{constructor(){super(),Object(Ge["a"])(this,"sequence",void 0),this.type="group"}computePossibleElements(e){return new Set}create(e){const t=qe["a"].timeline();return t}}class Qe extends Ke["a"]{constructor(e="",t={}){super(t),Object(Ge["a"])(this,"use",void 0),this.use=e,this.type="usage"}useTemplate(e){return this.use=e,this}computeDuration(e){var t,r;const{yoyo:a}=this.timing.getComputedTiming();if(null!==(t=this.timing)&&void 0!==t&&t.duration)return this.timing.duration;const n=this.instantiateUsingTemplate(e);let i=null!==(r=null===n||void 0===n?void 0:n.computeDuration(e.deriveBy(this.target)))&&void 0!==r?r:0;return a?i*(a.repeat+1)+a.delay*a.repeat:i}computePossibleElements(e){const t=this.instantiateUsingTemplate(e,!1);return t?t.computePossibleElements(e.deriveByWithoutTransform(this.target)):new Set}create(e){var t;const r=this.instantiateUsingTemplate(e);if(!r)return null;const a=r.create(e.deriveBy(this.target)),{yoyo:n}=this.timing.getComputedTiming();return null!==(t=this.timing)&&void 0!==t&&t.duration&&a.duration(this.timing.duration),n&&(a.yoyo(!0),a.repeat(n.repeat),a.repeatDelay(n.delay)),a}instantiateUsingTemplate(e,t=!0){if(!this.use||""===this.use)return null;const r=e.getTemplate(this.use);return null!=r?r.instantiate(this.settings,t):(console.warn(`Template ${this.use} not found.`),null)}}var et=r("0764");class tt{static reviver(e,t){return""===e?tt.fromJSON(t):t}static fromJSON(e){return"string"===typeof e?ce.a.parse(e,tt.reviver):"sequence"in e?tt.createSequenceAnimation(e):"use"in e?tt.createTemplateUsage(e):null}static createSequenceAnimation(e){var t;let r,a;if("sync"in e.sequence&&Array.isArray(e.sequence.sync))r=new Je,a={sync:e.sequence.sync.map(e=>tt.fromJSON(e))};else if("concat"in e.sequence&&Array.isArray(e.sequence.concat))r=new Ye,a={concat:e.sequence.concat.map(e=>tt.fromJSON(e))};else{if(!("animation"in e.sequence))return console.warn("create sequence animation failed",e),null;r=new Xe,a={grouping:e.sequence.grouping,animation:tt.fromJSON(e.sequence.animation)}}const n=We.fromJSON(e.target),i=Object.assign(r.timing,null!==(t=e.timing)&&void 0!==t?t:{});return!0===i.yoyo&&(i.yoyo=et["a"].getDefaultYoyo()),Object.assign(r,e,{target:n,sequence:a,timing:i})}static createTemplateUsage(e){var t,r;const a=new Qe,n=We.fromJSON(e.target),i=Object.assign(a.timing,null!==(t=e.timing)&&void 0!==t?t:{});!0===i.yoyo&&(i.yoyo=et["a"].getDefaultYoyo());const o=Object.assign(a.settings,null!==(r=e.settings)&&void 0!==r?r:{});return Object.assign(a,e,{target:n,timing:i,settings:o})}}var rt=r("4b58");function at(e,t){null!=e&&nt(e,t)}function nt(e,t){if(null==e||"object"!==typeof e)return!1;for(let r of Object.keys(e)){const a=e[r];let n=t(r,a,e);if(n)return!0;nt(a,t)}return!1}function it(e){if(void 0===e||null===e)return e;let t=Array.isArray(e)?[]:{};for(let r in e)t[r]="object"===typeof e[r]?it(e[r]):e[r];return void 0!==e.prototype&&(t.prototype=e.prototype),t}const ot={traversalObject:at,deepCopy:it};class st extends Ke["a"]{constructor(){super(),this.type="empty"}computeDuration(e){return 0}computePossibleElements(e){return new Set}create(e){return null}}class ct extends rt["a"]{constructor(e=null){super(),Object(Ge["a"])(this,"animation",void 0),this.animation=e,this.type="json"}createAnimation(){if(!this.animation)return new st;const e=JSON.parse(JSON.stringify(this.animation)),t=this.settings;return ot.traversalObject(e,(e,r,a)=>{if("string"===typeof r&&r.includes("$"))if(r=r.trim(),r.match(/^\$[0-9a-zA-Z]*$/)){const n=r.substr(1);n in t&&(a[e]=t[n])}else{let n=r;Object.keys(t).forEach(e=>{n=n.replaceAll("$"+e,t[e])}),a[e]=n}}),tt.fromJSON(e)}}var lt=r("a979");class ut{static reviver(e,t){return""===e?ut.fromJSON(t):t}static fromJSON(e){if("string"===typeof e)return ce.a.parse(e,ut.reviver);{const t=new lt["a"];return Object.assign(t,e)}}}class dt{static reviver(e,t){return""===e?dt.fromJSON(t):t}static fromJSON(e){if("string"===typeof e)return ce.a.parse(e,dt.reviver);if("object"!==typeof e)return null;const t=new ct;let r;return r=e.parameters&&Array.isArray(e.parameters)?e.parameters.map(e=>ut.fromJSON(e)):[],Object.assign(t,e,{parameters:r})}}class pt{static reviver(e,t){return""===e?pt.fromJSON(t):t}static fromJSON(e){if("string"===typeof e)return ce.a.parse(e,pt.reviver);{const t=new Ue;let r;r=e.templates&&Array.isArray(e.templates)?e.templates.map(e=>dt.fromJSON(e)):[];const a=tt.fromJSON(e.animation);return Object.assign(t,e,{templates:r,animation:a})}}}class ht{constructor(){Object(Ge["a"])(this,"json",void 0)}init(e){this.json=e}parse(){return pt.fromJSON(this.json)}}class ft{constructor(e,t,r,a=!1){Object(Ge["a"])(this,"renderContext",void 0),Object(Ge["a"])(this,"parentSelection",void 0),Object(Ge["a"])(this,"fakeRender",void 0),Object(Ge["a"])(this,"parentTarget",void 0),this.renderContext=e,this.parentSelection=t,this.parentTarget=r,this.fakeRender=a}derive(e,t){return new ft(this.renderContext,e,t,this.fakeRender)}deriveBy(e){const t=this.getSelection(e);var r,a;0!==this.parentSelection.size()&&0===t.size()&&console.warn(`Empty select result. \n      parentSelector=${null!==(r=null===(a=this.parentTarget)||void 0===a?void 0:a.selector)&&void 0!==r?r:"null"} \n      selector="${e.selector}"`,this);return this.derive(t,e)}deriveByWithoutTransform(e){if(e.selector.includes("$"))return this.derive(this.parentSelection);{const t=this.getSelectionWithoutTransform(e);return this.derive(t,e)}}getGlyphs(e){return this.fakeRender?this.getSelection(e).nodes().map(e=>e.cloneNode(!0)):this.getSelection(e).nodes()}getExclusiveGlyphs(e,t){let r=this.renderContext.targetModel.getExclusiveGlyphs(this.renderContext.rootSel.selectAll(t),this.parentTarget).nodes();return this.fakeRender?r.map(e=>e.cloneNode(!0)):r}getBBoxPosition(e){var t,r,a;const n=this.renderContext.rootSel,i=null!==(t=n.select("svg").node())&&void 0!==t?t:n.node(),o=i.createSVGPoint(),s=null!==(r=null===(a=e._original)||void 0===a?void 0:a.CTM)&&void 0!==r?r:e.getCTM(),c=o.matrixTransform(s),l=e.getBBox();var{x:u,y:d,width:p,height:h}={x:c.x,y:c.y,width:l.width,height:l.height};if("text"===e.nodeName)switch(e.getAttribute("text-anchor")){case"start":d-=.75*h;break;case"end":u-=p,d-=.75*h;break;case"middle":u-=p/2,d-=.75*h;break;default:break}else"path"===e.nodeName&&(d+=h/2);return{x:u,y:d,width:p,height:h}}getSelection(e){return this.renderContext.targetModel.getGlyphs(this.parentSelection,e)}getSelectionWithoutTransform(e){return this.renderContext.targetModel.getGlyphsWithoutTransform(this.parentSelection,e)}getTemplate(e){return this.renderContext.templateLib.getTemplate(e)}getRootSel(){return this.renderContext.rootSel}getDefsSel(){return this.renderContext.getDefsSel()}getRootSvg(){const e=this.renderContext.rootSel.node();return"svg"===e.tagName?e:e.querySelector("svg")}}var gt=r("ba84");class mt{constructor(e,t){Object(Ge["a"])(this,"rootSel",void 0),Object(Ge["a"])(this,"defsSel",void 0),Object(Ge["a"])(this,"templateLib",void 0),Object(Ge["a"])(this,"globalSelection",void 0),Object(Ge["a"])(this,"targetModel",void 0),this.rootSel=e,this.defsSel=null,this.templateLib=t,this.globalSelection=e.selectAll("*")}getTemplate(e){return this.templateLib.getTemplate(e)}createRootContext(e=!1){return new ft(this,this.globalSelection,null,e)}clean(){this.defsSel&&!this.defsSel.empty()&&(this.defsSel.selectAll(gt["c"]).remove(),this.defsSel.selectAll(gt["a"]).remove())}getDefsSel(){if(!this.defsSel){let e=this.rootSel.select("defs");e.empty()&&(e=this.rootSel.append("defs")),this.defsSel=e}return this.defsSel}}class yt{constructor(){Object(Ge["a"])(this,"globalSelection",void 0)}getGlyphs(e,t){throw"Target model is abstract"}getGlyphsWithoutTransform(e,t){throw"Target model is abstract"}}class vt extends yt{constructor(e){super(),Object(Ge["a"])(this,"globalSelection",void 0),this.globalSelection=e}getGlyphsWithoutTransform(e,t){return e.filter(t.selector)}getGlyphs(e,t){let r=e.filter(t.selector);return t.transform.forEach(e=>{r=e.execute(r)}),r}getExclusiveGlyphs(e,t){let r=e.filter(`:not(${t.selector})`);return t.transform.forEach(e=>{r=e.execute(r)}),r}}class _t{constructor(){Object(Ge["a"])(this,"renderContext",void 0),Object(Ge["a"])(this,"animationSpec",void 0)}init(e,t,r){this.renderContext=new mt(e,t),this.animationSpec=r}generate(){this.renderContext.targetModel=new vt(this.renderContext.globalSelection),this.renderContext.clean();const e=this.renderContext.createRootContext();return this.animationSpec.create(e)}computeDuration(){this.renderContext.targetModel=new vt(this.renderContext.globalSelection),this.renderContext.clean();const e=this.renderContext.createRootContext(!0);return this.animationSpec.computeDuration(e)}computePossibleElements(e){const t=this.renderContext.getTemplate(e);if(!t)return new Set;const r=t.instantiate({},!1);this.renderContext.targetModel=new vt(this.renderContext.globalSelection),this.renderContext.clean();const a=this.renderContext.createRootContext(!0);return r.computePossibleElements(a)}}class bt{constructor(){Object(Ge["a"])(this,"buildInTemplateMap",void 0),Object(Ge["a"])(this,"templateMap",void 0),this.buildInTemplateMap=new Map,this.templateMap=new Map}registerBuildInTemplate(e){this.buildInTemplateMap.has(e.templateName)&&console.warn("Duplicated template name in build-in scope"+e.templateName),this.buildInTemplateMap.set(e.templateName,e)}registerBuildInTemplates(...e){e.forEach(e=>this.registerBuildInTemplate(e))}registerTemplate(e){this.templateMap.has(e.templateName)&&console.warn("Duplicated template name in custom scope"+e.templateName),this.templateMap.set(e.templateName,e)}registerTemplates(...e){e.forEach(e=>this.registerTemplate(e))}getTemplate(e){var t;const r=null!==(t=this.templateMap.get(e))&&void 0!==t?t:this.buildInTemplateMap.get(e);return r?r.clone():null}getAllBuildInTemplates(){return Array.from(this.buildInTemplateMap.values())}getAllCustomTemplate(){return Array.from(this.templateMap.values())}reset(){this.templateMap=new Map}}const Tt={CUSTOM:"custom",TITLE:"title",BLANK:"blank",GENERAL:"general",HIGHLIGHT:"highlight",MOVE:"move",PATH:"path",TEXT:"text",CAMERA:"camera",ANNOTATION_ARROW:"annotation-arrow",BAR_CHART:"bar-chart",BAR_CHART_WITH_LEGEND:"bar-chart-with-legend",CIRCLE_CHART:"circle-chart",CIRCLE_CHART_WITH_LEGEND:"circle-chart-with-legend",PIE_CHART:"pie-chart",PIE_WITH_LEGEND:"pie-with-legend",LINE_CHART:"line-chart",LINE_CHART_WITH_LEGEND:"line-chart-with-legend",CHART_FRAMEWORK:"chart-framework"},wt={ENTER:"Enter",EXIT:"Exit",HIGHLIGHT:"Emphasis",ANNOTATION:"Annotate",OTHER:"Other"};class St{constructor(e,t=Tt.BLANK,r=wt.OTHER,a=[],n={},i,o=1,s={}){Object(Ge["a"])(this,"template",void 0),Object(Ge["a"])(this,"previewerType",void 0),Object(Ge["a"])(this,"animationType",void 0),Object(Ge["a"])(this,"templateLabels",void 0),Object(Ge["a"])(this,"templateSettings",void 0),Object(Ge["a"])(this,"target",void 0),Object(Ge["a"])(this,"staticProgress",void 0),Object(Ge["a"])(this,"previewSettings",void 0),this.type="previewer",this.template=e,this.previewerType=t,this.animationType=r,this.templateLabels=a,this.templateSettings=n,this.previewSettings=s,this.staticProgress=o,i?i instanceof Fe["b"]?this.target=i:this.target=We.fromJSON(i):this.target=Fe["b"].getDefaultTarget()}clone(){return new St(this.template.clone(),this.previewerType,this.animationType,[...this.templateLabels],ot.deepCopy(this.templateSettings),Object.assign(new Fe["b"],this.target),this.staticProgress,ot.deepCopy(this.previewSettings))}getTemplateName(){return this.template.templateName}getTemplateType(){return this.template.type}getTemplateParameters(){return this.template.parameters}createPreviewAnimation(){return null!=this.template?this.template.instantiate(this.templateSettings):(console.warn("Can't create animation since preview template is null"),null)}}class xt{constructor(e){Object(Ge["a"])(this,"templateLib",void 0),Object(Ge["a"])(this,"previewWrapperMap",void 0),Object(Ge["a"])(this,"previewerMap",void 0),this.templateLib=e,this.previewWrapperMap=new Map,this.previewerMap=new Map}registerPreviewWrapper(e){this.previewWrapperMap.set(e.template.templateName,e)}registerPreviewer(e){this.previewerMap.set(e.previewerType,e)}createDefaultPreviewer(e,t){const r=this.getDefaultWrapper(e),a=new mt(t,this.templateLib);a.targetModel=new vt(a.globalSelection);const n=this.previewerMap.get(r.previewerType).clone();return n.init(r,a),n}getDefaultWrapper(e){var t;let r=null===(t=this.previewWrapperMap.get(e))||void 0===t?void 0:t.clone();if(!r){const t=this.templateLib.getTemplate(e);r=new St(t)}return r}}var Ct=r("618e"),At=r("c66e");class $t extends Ct["a"]{constructor(){super(),this.templateName="Fade-in",this.parameters=[new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0)]}createAnimation(){const e=new Qe("Fade");return e.updateSettings(this.getParamValues()),e.updateSettings({fadeType:"in"}),e}}var kt=r("2bc8");const Pt={TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right",CENTER:"center",UNKNOWN:"unknown",AUTO:"auto"};class Rt extends Ct["a"]{constructor(){super(),this.templateName="Grow",this.parameters=[new lt["a"]("direction",At["a"].STRING,!1,Pt.BOTTOM),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0)]}createAnimation(){const e=new Et;return e.updateSettings(this.getParamValues()),e}}class Et extends kt["a"]{getDefaultSettings(){return{direction:Pt.BOTTOM,ease:"power1.out",stagger:0,duration:1}}create(e){const{stagger:t}=this.settings,r=e.getGlyphs(this.target),a=qe["a"].timeline();return r.forEach((e,r)=>{const n=this.createTwForOneGlyph(e),i=0===r?0:"<"+t;a.add(n,i)}),a}createTwForOneGlyph(e){const{direction:t,ease:r,duration:a}=this.settings,n=e.getBBox();let i,o,s;switch(t){case Pt.TOP:i="scaleY",o=.5,s=0;break;case Pt.BOTTOM:i="scaleY",o=.5,s=1;break;case Pt.LEFT:i="scaleX",o=0,s=.5;break;case Pt.RIGHT:i="scaleX",o=1,s=.5;break;default:return null}const c=`${o*n.width}px ${s*n.height}px`,l={transformOrigin:c,duration:a,ease:r};return l[i]=0,qe["a"].from(e,l)}}class Ot extends Ct["a"]{constructor(){super(),this.templateName="Move-to",this.parameters=[new lt["a"]("x",At["a"].ANY,!1,"+=0"),new lt["a"]("y",At["a"].ANY,!1,"+=0"),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0),new lt["a"]("yoyo",At["a"].OBJECT,!1,null)]}createAnimation(){const e=new Qe("move"),t={x:this.getParamValue("x"),y:this.getParamValue("y")};return e.set("to",t),e.set("duration",this.getParamValue("duration")),e.set("ease",this.getParamValue("ease")),e.set("stagger",this.getParamValue("stagger")),e.set("yoyo",this.getParamValue("yoyo")),e}}class It extends Ct["a"]{constructor(){super(),this.templateName="Move-from",this.parameters=[new lt["a"]("x",At["a"].ANY,!1,"+=0"),new lt["a"]("y",At["a"].ANY,!1,"+=0"),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0)]}createAnimation(){const e=new Qe("move"),t={x:this.getParamValue("x"),y:this.getParamValue("y")};return e.set("from",t),e.set("duration",this.getParamValue("duration")),e.set("ease",this.getParamValue("ease")),e.set("stagger",this.getParamValue("stagger")),e}}class Nt extends Ct["a"]{constructor(){super(),this.templateName="Float",this.parameters=[new lt["a"]("enterOrExit",At["a"].STRING,!1,"enter"),new lt["a"]("direction",At["a"].STRING,!1,"bottom"),new lt["a"]("distance",At["a"].NUMBER,!1,30),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0)]}createAnimation(){const e=new Mt;return e.updateSettings(this.getParamValues()),e}}class Mt extends kt["a"]{create(e){const{enterOrExit:t,distance:r,direction:a,ease:n,stagger:i,duration:o}=this.settings,s=a===Pt.LEFT||a===Pt.RIGHT?"x":"y",c=a===Pt.RIGHT||a===Pt.BOTTOM?1:-1;let l;const u=e.getGlyphs(this.target),d={opacity:0,ease:n,duration:o,stagger:i};if("enter"===t)d[s]=`+=${r*c}px`,l=qe["a"].from(u,d);else{if("exit"!==t)return console.warn("Wrong value of enterOrExit: "+t),null;d[s]=`-=${r*c}px`,l=qe["a"].to(u,d)}return l}}class Lt extends Ct["a"]{constructor(){super(),this.templateName="basic-zoom",this.parameters=[new lt["a"]("enterOrExit",At["a"].STRING,!1,"enter"),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"back.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0)]}createAnimation(){const e=new jt;return e.updateSettings(this.getParamValues()),e}}class jt extends kt["a"]{getDefaultSettings(){return{enterOrExit:"enter",ease:"power1.out",stagger:0,duration:1}}create(e){const{enterOrExit:t,ease:r,stagger:a}=this.settings,n=qe["a"].timeline(),i=e.getGlyphs(this.target);return i.forEach(e=>{let i;const o={scale:0,transformOrigin:"center center",ease:r};if("enter"===t)i=qe["a"].from(e,o);else{if("exit"!==t)return console.warn("Wrong value of enterOrExit: "+t),null;i=qe["a"].to(e,o)}const{duration:s,yoyo:c}=this.timing.getComputedTiming();i.duration(s),c&&(i.yoyo(!0),i.repeat(c.repeat),i.repeatDelay(c.delay)),n.add(i,"<"+a)}),n}}class Bt extends Ct["a"]{constructor(){super(),this.templateName="Zoom",this.parameters=[new lt["a"]("enterOrExit",At["a"].STRING,!1,"enter"),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("FadeEase",At["a"].STRING,!1,"power1.inOut"),new lt["a"]("zoomEase",At["a"].STRING,!1,"back.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0)]}createAnimation(){const e=this.getParamValue("enterOrExit");if("enter"===e){const e=new Qe("Fade-in").set("ease",this.getParamValue("FadeEase")).set("duration",this.getParamValue("duration")).set("stagger",this.getParamValue("stagger")),t=new Qe("Basic-zoom-enter").set("ease",this.getParamValue("zoomEase")).set("duration",this.getParamValue("duration")).set("stagger",this.getParamValue("stagger"));return new Je([e,t])}if("exit"===e){const e=new Qe("Fade-out").set("ease",this.getParamValue("FadeEase")).set("duration",this.getParamValue("duration")).set("stagger",this.getParamValue("stagger")),t=new Qe("basic-zoom-exit").set("ease",this.getParamValue("zoomEase")).set("duration",this.getParamValue("duration")).set("stagger",this.getParamValue("stagger"));return new Je([e,t])}return console.warn("Wrong value of param enterOrExit",e),null}}var Zt=r("8bce");class Dt extends Ct["a"]{constructor(){super(),this.templateName="Wipe",this.parameters=[new lt["a"]("enterOrExit",At["a"].STRING,!1,"enter"),new lt["a"]("direction",At["a"].STRING,!1,Pt.BOTTOM),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0),new lt["a"]("yoyo",At["a"].OBJECT,!1,null)]}createAnimation(){const e=new Gt;return e.updateSettings(this.getParamValues()),e}}class Gt extends kt["a"]{create(e){const t=e.getGlyphs(this.target),r=e.getDefsSel(),a=qe["a"].timeline(),{stagger:n}=this.settings;return t.forEach((e,t)=>{const i=this.addMaskRectToGlyph(r,e),o=this.createTwForMask(i,e),s=0===t?0:"<"+n;a.add(o,s)}),a}addMaskRectToGlyph(e,t){var r;t.getAttribute("id")||t.setAttribute("id",Object(Zt["a"])());const a="mask-"+t.getAttribute("id");let n=e.select("#"+a);n.empty()&&(n=e.append("mask").attr("id",a).classed(gt["c"],!0).attr("maskUnits","userSpaceOnUse"),t.setAttribute("mask",`url(#${a})`));const{enterOrExit:i}=this.settings,o=n.select(".wipe");if(!o.empty()&&"exit"===i)return o.node();const s=t.getBBox();let c,l,u,d,p=parseFloat(null!==(r=t.getAttribute("stroke-width"))&&void 0!==r?r:"0");f["n"](t).selectAll("*").each((function(){var e;const t=parseFloat(null!==(e=this.getAttribute("stroke-width"))&&void 0!==e?e:"0");p=Math.max(t,p)})),u=s.width+2*p,d=s.height+2*p,c=s.x-p,l=s.y-p;const h=n.append("rect").attr("transform","translate("+[c,l]+")").attr("class","Wipe").attr("width",u).attr("height",d).attr("stroke-width",p).attr("fill","white").attr("stroke","white");return h.node()}createTwForMask(e,t){const{enterOrExit:r,direction:a,ease:n,duration:i,yoyo:o}=this.settings,s=e.getBBox();let c,l;switch(a){case Pt.TOP:c=0,l=-1;break;case Pt.BOTTOM:c=0,l=1;break;case Pt.LEFT:c=-1,l=0;break;case Pt.RIGHT:c=1,l=0;break}const u=parseFloat(t.getAttribute("stroke-width")||"0"),d={x:"+="+c*(s.width+u),y:"+="+l*(s.height+u),duration:i,ease:n};var p,h;o&&(d.yoyo=!0,d.repeatDelay=null!==(p=o.delay)&&void 0!==p?p:0,d.repeat=null!==(h=o.repeat)&&void 0!==h?h:1);return"exit"===r?qe["a"].to(e,d):qe["a"].from(e,d)}}const Ut="ac-original-data--",Ft="@original-fill";class zt extends Ct["a"]{constructor(){super(),this.templateName="Change-color",this.parameters=[new lt["a"]("fill",At["a"].STRING,!0,"#e44a4e"),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0),new lt["a"]("yoyo",At["a"].OBJECT,!0,null)]}createAnimation(){const e=new Vt;return e.updateSettings(this.getParamValues()),e}}class Vt extends kt["a"]{getDefaultSettings(){return{duration:1,ease:"power1.out",stagger:0,yoyo:null}}create(e){const{stagger:t}=this.settings,r=e.getGlyphs(this.target),{duration:a,yoyo:n}=this.timing.getComputedTiming(),i=qe["a"].timeline();return r.forEach((e,r)=>{const a=this.createTwForOneGlyph(e);n&&(a.yoyo(!0),a.repeat(n.repeat),a.repeatDelay(n.delay));const o=0===r?0:"<"+t;i.add(a,o)}),i.duration(a),i}createTwForOneGlyph(e){let{fill:t,duration:r,ease:a,yoyo:n}=this.settings;const i={};n&&(!0===n&&(n=et["a"].getDefaultYoyo()),i.yoyo=!0,i.repeat=n.repeat,i.repeatDelay=n.delay,r/=i.repeat+1);const o=Ut+"color";if(t===Ft)t=e.getAttribute(o);else{const t=e.getAttribute("fill");e.setAttribute(o,t)}const s={fill:t,duration:r,ease:a,...i};return qe["a"].to(e,s)}}class Ht extends Ct["a"]{constructor(){super(),this.templateName="Show-path",this.parameters=[new lt["a"]("reverseDirection",At["a"].BOOLEAN,!1,!1),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0),new lt["a"]("displayTime",At["a"].NUMBER,!1,3)]}createAnimation(){const e=new Wt;return e.updateSettings(this.getParamValues()),e}}class Wt extends kt["a"]{create(e){const{displayTime:t,ease:r,stagger:a,duration:n,reverseDirection:i}=this.settings,o=qe["a"].timeline(),s=e.getGlyphs(this.target);return s.forEach((e,s)=>{let c,l=0;try{l=e.getTotalLength()}catch(u){}e.setAttribute("stroke-dasharray",l),c=qe["a"].fromTo(e,{strokeDashoffset:i?-l:l},{strokeDashoffset:0,ease:r,duration:n}),o.add(c,0===s?0:"<"+a),c=qe["a"].to(e,{strokeDashoffset:i?l:-l,ease:r,duration:n}),o.add(c,"+="+t)}),o}}function Kt(e,t){let r=e.indexOf(t);return-1!==r&&(e.splice(r,1),!0)}function qt(e){let t=e.length;return 0===t?null:e[t-1]}function Jt(e,t){return t.every(t=>e.includes(t))}function Yt(e,t,r,a=1){let n=[];for(let i=t;i<r;i+=a)n.push(e[i]);return n}function Xt(e,t){let r=[];return e.forEach(e=>{t.includes(e)&&r.push(e)}),r}const Qt={removeItem:Kt,getLastItem:qt,includes:Jt,slice:Yt,intersect:Xt};class er extends Ct["a"]{constructor(){super(),this.templateName="Highlight",this.parameters=[new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0)]}createAnimation(){const e=new tr;return e.updateSettings(this.getParamValues()),e}}class tr extends kt["a"]{getDefaultSettings(){return{duration:1,ease:"power1.out",stagger:0}}create(e){const{ease:t,stagger:r,duration:a}=this.settings;let n;const i=e.getGlyphs(this.target);let o=null;for(let d of i){let e=Qt.getLastItem(d.classList);if(null===o)o=e;else if(o!=e){o=null;break}}let s=null===o?"*":"."+o;const c=e.getExclusiveGlyphs(this.target,s),l={opacity:.3,ease:t,duration:.5,stagger:r},u=qe["a"].timeline();return n=qe["a"].to(c,l),n.yoyo(!0),n.repeat(1),n.repeatDelay(3),u.add(n,0),u}}class rr extends Ct["a"]{constructor(){super(),this.templateName="Camera-zoom",this.parameters=[new lt["a"]("scaleFactor",At["a"].STRING,!1,1.5),new lt["a"]("transformOrigin",At["a"].STRING,!1,"50% 50%"),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new ar;return e.updateSettings(this.getParamValues()),e}}class ar extends kt["a"]{getDefaultSettings(){return{transformOrigin:"50% 50%",duration:1,ease:"power1.out"}}create(e){const{scaleFactor:t,transformOrigin:r,ease:a,duration:n}=this.settings;let i;const o=e.renderContext.rootSel,s={scale:t,transformOrigin:r,ease:a,duration:n};return i=qe["a"].to(o.node(),s),i}}var nr={templateName:"Zoom-exit",parameters:[{paramName:"duration",paramType:"number",required:!1,defaultValue:1},{paramName:"zoomEase",paramType:"string",required:!1,defaultValue:"back.in"},{paramName:"FadeEase",paramType:"string",required:!1,defaultValue:"power1.inOut"},{paramName:"stagger",paramType:"string",required:!1,defaultValue:0}],animation:{use:"Zoom",target:"*",settings:{duration:"$duration",zoomEase:"$zoomEase",fadeEase:"$fadeEase",stagger:"$stagger",enterOrExit:"exit"}}},ir={templateName:"basic-zoom-exit",parameters:[{paramName:"duration",paramType:"number",required:!1,defaultValue:1},{paramName:"ease",paramType:"string",required:!1,defaultValue:"back.in"},{paramName:"stagger",paramType:"number",required:!1,defaultValue:0}],animation:{use:"basic-zoom",target:"*",settings:{duration:"$duration",ease:"$ease",stagger:"$stagger",enterOrExit:"exit"}}};class or extends Ct["a"]{constructor(){super(),this.templateName="Fade-out",this.parameters=[new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0)]}createAnimation(){const e=new Qe("Fade");return e.updateSettings(this.getParamValues()),e.updateSettings({fadeType:"out"}),e}}class sr extends Ct["a"]{constructor(){super(),this.templateName="Title",this.parameters=[new lt["a"]("titleStagger",At["a"].NUMBER,!1,.3)]}createAnimation(){const e=new Qe("Fade-in").setTarget(".title,.subtitle,.main-title,.sub-title").set("stagger",this.getParamValue("titleStagger"));return(new Je).append(e)}}class cr extends Ct["a"]{constructor(){super(),this.templateName="Axes float in",this.parameters=[new lt["a"]("titleStagger",At["a"].NUMBER,!1,.2),new lt["a"]("symbolStagger",At["a"].NUMBER,!1,.04),new lt["a"]("axisElementStagger",At["a"].NUMBER,!1,.04),new lt["a"]("ease",At["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new Qe("Float").setTarget(".title").set("stagger",this.getParamValue("titleStagger")),t=new Qe("Float").setTarget(".axis.symbol").set("stagger",this.getParamValue("symbolStagger")),r=new Qe("Fade-in").setTarget(".x-axis.domain").updateSettings({ease:this.getParamValue("ease")}),a=new Qe("Fade-in").setTarget(".y-axis.domain").updateSettings({ease:this.getParamValue("ease")}),n=new Qe("Float").setTarget(".axis.label").set("stagger",this.getParamValue("axisElementStagger")).updateTiming({offset:1}),i=new Qe("Fade-in").setTarget(".axis.tick").set("stagger",this.getParamValue("axisElementStagger")).updateTiming({offset:1});return(new Je).append(e).append(t).append(r).append(a).append(n).append(i)}}var lr={templateName:"Axes fade in",animation:{target:"*",sequence:{sync:[{use:"Fade-in",target:".title, .subtitle, .axis, .tick-group"}]}}};class ur extends Ct["a"]{constructor(){super(),this.templateName="Bar chart",this.parameters=[new lt["a"]("barDirection",At["a"].STRING,!1,"bottom"),new lt["a"]("titleStagger",At["a"].NUMBER,!1,.2),new lt["a"]("symbolStagger",At["a"].NUMBER,!1,0),new lt["a"]("axisElementStagger",At["a"].NUMBER,!1,0),new lt["a"]("ease",At["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new Qe("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new Qe("Grow").setTarget(".bar").updateTiming({offset:1}).updateSettings({ease:this.getParamValue("ease"),direction:this.getParamValue("barDirection")}),r=new Qe("Fade-in").setTarget(".bar-label").updateTiming({offset:2});return(new Je).append(e).append(t).append(r)}}class dr extends Ct["a"]{constructor(){super(),this.templateName="Bar chart with legend",this.parameters=[new lt["a"]("barDirection",At["a"].STRING,!1,"bottom"),new lt["a"]("titleStagger",At["a"].NUMBER,!1,.2),new lt["a"]("symbolStagger",At["a"].NUMBER,!1,0),new lt["a"]("axisElementStagger",At["a"].NUMBER,!1,0),new lt["a"]("ease",At["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new Qe("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new Qe("Fade-in").setTarget(".legend").updateTiming({offset:1}).updateSettings({stagger:.25}),r=new Qe("Grow").setTarget(".bar").updateTiming({offset:1}).updateSettings({ease:this.getParamValue("ease"),direction:this.getParamValue("barDirection"),stagger:.25}),a=new Qe("Fade-in").setTarget(".bar-label").updateTiming({offset:2});return(new Je).append(e).append(t).append(r).append(a)}}class pr extends Ct["a"]{constructor(){super(),this.templateName="Scatter chart with legend",this.parameters=[new lt["a"]("titleStagger",At["a"].NUMBER,!1,.2),new lt["a"]("symbolStagger",At["a"].NUMBER,!1,0),new lt["a"]("axisElementStagger",At["a"].NUMBER,!1,0),new lt["a"]("ease",At["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new Qe("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new Qe("Fade-in").setTarget(".legend").updateTiming({offset:1}),r=new Qe("Fade-in").setTarget(".circle, .point, .scatter").updateTiming({offset:2}).updateSettings({stagger:.02}),a=new Qe("Fade-in").setTarget(".circle-label").updateTiming({offset:3});return(new Je).append(e).append(t).append(r).append(a)}}class hr extends Ct["a"]{constructor(){super(),this.templateName="Line chart",this.parameters=[new lt["a"]("titleStagger",At["a"].NUMBER,!1,.2),new lt["a"]("symbolStagger",At["a"].NUMBER,!1,0),new lt["a"]("axisElementStagger",At["a"].NUMBER,!1,0),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("duration",At["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new Qe("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new Qe("Fade-in").setTarget(".circle, .point, .scatter").updateTiming({offset:1}).set("duration",this.getParamValue("duration")),r=new Qe("Wipe").setTarget(".mark.line").updateTiming({start:1}).updateSettings({stagger:.5,ease:this.getParamValue("ease"),direction:"left"}),a=new Qe("Fade-in").setTarget(".mark.label").updateTiming({start:1}).updateSettings({stagger:.1});return(new Je).append(e).append(t).append(r).append(a)}}class fr extends Ct["a"]{constructor(){super(),this.templateName="Line chart by legend",this.parameters=[new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("duration",At["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new Qe("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new Qe("Fade-in").setTarget(".legend").updateTiming({offset:1}).updateSettings({stagger:.25}),r=new Qe("Fade-in").setTarget(".circle, .point, .scatter").updateTiming({offset:1}).set("duration",this.getParamValue("duration")),a=new Qe("Wipe").setTarget(".mark.line").updateTiming({offset:1}).updateSettings({stagger:.5,ease:this.getParamValue("ease"),direction:"left"});return(new Je).append(e).append(t).append(r).append(a)}}class gr extends Ct["a"]{constructor(){super(),this.templateName="Line chart by order",this.parameters=[new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("duration",At["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new Qe("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new Qe("Fade-in").setTarget(".legend").updateTiming({offset:1}),r=new Qe("Fade-in").setTarget(".circle, .point, .scatter").updateTiming({offset:1}).set("duration",this.getParamValue("duration")),a=new Qe("Wipe").setTarget(".mark.line").updateTiming({offset:1}).updateSettings({ease:this.getParamValue("ease"),direction:"left"});return(new Je).append(e).append(t).append(r).append(a)}}class mr extends Ct["a"]{constructor(){super(),this.templateName="Pie-wheel",this.parameters=[new lt["a"]("titleStagger",At["a"].NUMBER,!1,.2),new lt["a"]("sectorStagger",At["a"].NUMBER,!1,.1),new lt["a"]("lineStagger",At["a"].NUMBER,!1,.1),new lt["a"]("labelStagger",At["a"].NUMBER,!1,.1)]}createAnimation(){const e=new Qe("Fade-in").setTarget(".title").set("stagger",this.getParamValue("titleStagger")),t=new Qe("simple-sector-wheel").setTarget(".sector,.arc,.pie").set("centerSelector",".sector,.arc,.pie").set("stagger",this.getParamValue("sectorStagger")),r=new Qe("Draw-path").setTarget(".sector-line,.arc-line").set("stagger",this.getParamValue("lineStagger")),a=new Qe("Fade-in").setTarget(".sector-label,.arc-label").set("stagger",this.getParamValue("labelStagger"));return(new Je).append(e).append(t).append(r).append(a)}}class yr extends Ct["a"]{constructor(){super(),this.templateName="Bar-grow",this.parameters=[new lt["a"]("barDirection",At["a"].STRING,!1,"auto"),new lt["a"]("ease",At["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new Qe("Grow-bar").setTarget(".bar").updateSettings({ease:this.getParamValue("ease"),direction:this.getParamValue("barDirection")}),t=new Qe("Fade-in").setTarget(".bar-label").updateTiming({offset:1});return(new Je).append(e).append(t)}}class vr extends Ct["a"]{constructor(){super(),this.templateName="Bar with legend",this.parameters=[new lt["a"]("barDirection",At["a"].STRING,!1,"bottom"),new lt["a"]("titleStagger",At["a"].NUMBER,!1,.2),new lt["a"]("symbolStagger",At["a"].NUMBER,!1,0),new lt["a"]("axisElementStagger",At["a"].NUMBER,!1,0),new lt["a"]("ease",At["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new Qe("Fade-in").setTarget(".legend").updateSettings({stagger:.25}),t=new Qe("Grow").setTarget(".bar").updateSettings({ease:this.getParamValue("ease"),direction:this.getParamValue("barDirection"),stagger:.25}),r=new Qe("Fade-in").setTarget(".bar-label").updateTiming({offset:1});return(new Je).append(e).append(t).append(r)}}class _r extends Ct["a"]{constructor(){super(),this.templateName="Bar with axis label",this.parameters=[new lt["a"]("symbol-ease",At["a"].STRING,!1,"back.out"),new lt["a"]("bar-ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("duration",At["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new Qe("basic-zoom").setTarget(".axis.symbol").updateSettings({ease:this.getParamValue("symbol-ease"),duration:this.getParamValue("duration")}),t=new Qe("Fade-in").setTarget(".x-axis.label").set("duration",this.getParamValue("duration")),r=new Qe("Grow").setTarget(".bar").updateSettings({ease:this.getParamValue("bar-ease"),duration:this.getParamValue("duration")}),a=new Qe("Fade-in").setTarget(".bar-label").set("duration",this.getParamValue("duration"));return(new Je).append(e).append(t).append(r).append(a)}}class br extends Ct["a"]{constructor(){super(),this.templateName="Scatter-fade in",this.parameters=[new lt["a"]("duration",At["a"].NUMBER,!1,1.5),new lt["a"]("titleStagger",At["a"].NUMBER,!1,.2),new lt["a"]("symbolStagger",At["a"].NUMBER,!1,0),new lt["a"]("axisElementStagger",At["a"].NUMBER,!1,0),new lt["a"]("ease",At["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new Qe("Fade-in").setTarget(".circle, .point, .scatter").set("duration",this.getParamValue("duration")),t=new Qe("Fade-in").setTarget(".circle-label,.point-label,.scatter-label").set("duration",this.getParamValue("duration"));return(new Je).append(e).append(t)}}class Tr extends Ct["a"]{constructor(){super(),this.templateName="Scatter with legend",this.parameters=[new lt["a"]("titleStagger",At["a"].NUMBER,!1,.2),new lt["a"]("symbolStagger",At["a"].NUMBER,!1,0),new lt["a"]("axisElementStagger",At["a"].NUMBER,!1,0),new lt["a"]("ease",At["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new Qe("Fade-in").setTarget(".legend"),t=new Qe("Fade-in").setTarget(".circle, .point, .scatter").updateTiming({offset:1}).updateSettings({stagger:.02}),r=new Qe("Fade-in").setTarget(".circle-label,.point-label,.scatter-label").updateTiming({offset:2});return(new Je).append(e).append(t).append(r)}}class wr extends Ct["a"]{constructor(){super(),this.templateName="Scatter chart",this.parameters=[new lt["a"]("titleStagger",At["a"].NUMBER,!1,.2),new lt["a"]("symbolStagger",At["a"].NUMBER,!1,0),new lt["a"]("axisElementStagger",At["a"].NUMBER,!1,0),new lt["a"]("ease",At["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new Qe("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new Qe("Fade-in").setTarget(".circle, .point, .scatter").updateTiming({offset:1}),r=new Qe("Fade-in").setTarget(".circle-label").updateTiming({offset:2});return(new Je).append(e).append(t).append(r)}}r("13d5");function Sr(e,t){const r=e.createSVGPoint(),a=t.getCTM(),n=r.matrixTransform(a);return{x:n.x,y:n.y}}function xr(e,t){const r=Sr(e,t),{x:a,y:n,width:i,height:o}=t.getBBox();return{x:a+r.x,y:n+r.y,width:i,height:o}}class Cr extends Ct["a"]{constructor(){super(),this.templateName="Grow-bar",this.parameters=[new lt["a"]("barDirection",At["a"].STRING,!1,"auto"),new lt["a"]("ease",At["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new Ar;return e.updateSettings(this.getParamValues()),e}}class Ar extends kt["a"]{getDefaultSettings(){return{direction:Pt.AUTO,ease:"power1.out",stagger:0,duration:1}}create(e){const{stagger:t,direction:r}=this.settings,a=e.getGlyphs(this.target),n=qe["a"].timeline();return r===Pt.AUTO&&(this.settings.direction=this.inferDirection(e),console.log("computed direction for bar:",this.settings.direction)),a.forEach((e,r)=>{const a=this.createTwForOneGlyph(e),i=0===r?0:"<"+t;n.add(a,i)}),n}createTwForOneGlyph(e){const{ease:t,duration:r,direction:a}=this.settings,n=e.getBBox();let i,o,s;switch(a){case Pt.TOP:i="scaleY",o=.5,s=0;break;case Pt.BOTTOM:i="scaleY",o=.5,s=1;break;case Pt.LEFT:i="scaleX",o=0,s=.5;break;case Pt.RIGHT:i="scaleX",o=1,s=.5;break;default:return null}const c=`${o*n.width}px ${s*n.height}px`,l={transformOrigin:c,duration:r,ease:t};return l[i]=0,qe["a"].from(e,l)}inferDirection(e){const t=e.getRootSel(),r=t.selectAll(".bar"),a=t.selectAll(".x-axis");return 0!==a.length&&0!==r.length?this.inferDirectionByBarsAndAxis(e,r,a):r.length>1?this.inferDirectionByBars(e,r):Pt.BOTTOM}inferDirectionByBars(e,t){const r=Array.from(t.nodes()),a=r.map(t=>xr(e.getRootSvg(),t)),n=a.map(e=>e.x),i=a.map(e=>e.x+e.width),o=a.map(e=>e.y),s=a.map(e=>e.y+e.height),c=[n,i,s,o].map(e=>Ar.getVariance(e));let l=0,u=c[0];for(let d=1;d<4;d++)c[d]<u&&(u=c[d],l=d);switch(l){case 0:return Pt.LEFT;case 1:return Pt.RIGHT;case 2:return Pt.BOTTOM;case 3:return Pt.TOP}}inferDirectionByBarsAndAxis(e,t,r){const a=Array.from(t.nodes()),n=Array.from(r.nodes()),i=a.map(t=>xr(e.getRootSvg(),t)),o=n.map(t=>xr(e.getRootSvg(),t)),s=o.map(e=>e.x+e.width/2).reduce((e,t)=>e+t,0),c=o.map(e=>e.y+e.height/2).reduce((e,t)=>e+t,0),l=s/o.length,u=c/o.length,d=i.map(e=>e.x),p=i.map(e=>e.x+e.width),h=i.map(e=>e.y),f=i.map(e=>e.y+e.height),g=[d,p].map(e=>Ar.getMSE(e,l)),m=[f,h].map(e=>Ar.getMSE(e,u)),y=[...g,...m];let v=0,_=y[0];for(let b=1;b<4;b++)y[b]<_&&(_=y[b],v=b);switch(v){case 0:return Pt.LEFT;case 1:return Pt.RIGHT;case 2:return Pt.BOTTOM;case 3:return Pt.TOP}}static getVariance(e){let t=e.reduce((e,t)=>e+t,0);const r=t/e.length;return Ar.getMSE(e,r)}static getMSE(e,t){let r=0;for(let a=0;a<e.length;a++)r+=Math.pow(e[a]-t,2);return r/e.length}}class $r extends Ct["a"]{constructor(){super(),this.templateName="Line-wipe",this.parameters=[new lt["a"]("titleStagger",At["a"].NUMBER,!1,.2),new lt["a"]("symbolStagger",At["a"].NUMBER,!1,0),new lt["a"]("axisElementStagger",At["a"].NUMBER,!1,0),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("duration",At["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new Qe("Fade-in").setTarget(".circle, .point, .scatter").set("duration",this.getParamValue("duration")),t=new Qe("Wipe").setTarget(".mark.line").updateTiming({start:0}).updateSettings({ease:this.getParamValue("ease"),direction:"left"}),r=new Qe("Fade-in").setTarget(".mark.label").updateTiming({start:0});return(new Je).append(e).append(t).append(r)}}class kr extends Ct["a"]{constructor(){super(),this.templateName="Lines by legend",this.parameters=[new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("duration",At["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new Qe("Fade-in").setTarget(".legend").updateSettings({stagger:.25}),t=new Qe("Fade-in").setTarget(".circle, .point, .scatter").set("duration",this.getParamValue("duration")),r=new Qe("Wipe").setTarget(".mark.line").updateSettings({stagger:.5,ease:this.getParamValue("ease"),direction:"left"});return(new Je).append(e).append(t).append(r)}}class Pr extends Ct["a"]{constructor(){super(),this.templateName="Lines by order",this.parameters=[new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("duration",At["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new Qe("Fade-in").setTarget(".legend"),t=new Qe("Fade-in").setTarget(".circle, .point, .scatter").set("duration",this.getParamValue("duration")),r=new Qe("Wipe").setTarget(".mark.line").updateSettings({ease:this.getParamValue("ease"),direction:"left"});return(new Je).append(e).append(t).append(r)}}class Rr extends Ct["a"]{constructor(){super(),this.templateName="Line-highlight",this.parameters=[new lt["a"]("titleStagger",At["a"].NUMBER,!1,.2),new lt["a"]("symbolStagger",At["a"].NUMBER,!1,0),new lt["a"]("axisElementStagger",At["a"].NUMBER,!1,0),new lt["a"]("ease",At["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new Qe("Draw-path").setTarget(".mark.line");return(new Je).append(e)}}class Er extends Ct["a"]{constructor(){super(),this.templateName="Pie with legend",this.parameters=[new lt["a"]("sectorStagger",At["a"].NUMBER,!1,1),new lt["a"]("legendStagger",At["a"].NUMBER,!1,0),new lt["a"]("labelStagger",At["a"].NUMBER,!1,1)]}createAnimation(){const e=new Qe("simple-sector-wheel").setTarget(".sector,.arc,.pie").set("centerSelector",".sector,.arc,.pie").set("duration",1),t=new Qe("Fade-in").setTarget(".sector-label,.arc-label"),r=new Qe("Fly-in").setTarget(".legend");return(new Je).append(r).append(e).append(t)}}class Or extends Ct["a"]{constructor(){super(),this.templateName="show-annotation-zoom",this.parameters=[new lt["a"]("displayTime",At["a"].NUMBER,!1,3),new lt["a"]("enter-ease",At["a"].STRING,!1,"back.out"),new lt["a"]("exit-ease",At["a"].STRING,!1,"back.in"),new lt["a"]("effect-duration",At["a"].NUMBER,!1,1)]}createAnimation(){const e=(new Qe).useTemplate("Zoom-enter").set("Zoom-ease",this.getParamValue("enter-ease")).set("duration",this.getParamValue("effect-duration")),t=(new Qe).useTemplate("Zoom-exit").set("Zoom-ease",this.getParamValue("exit-ease")).set("duration",this.getParamValue("effect-duration")).updateTiming({offset:this.getParamValue("displayTime")});return(new Ye).append(e).append(t).setTarget(new Fe["a"](".annotation"))}}class Ir extends Ct["a"]{constructor(){super(),this.templateName="Show-arrow-label",this.parameters=[new lt["a"]("distance",At["a"].NUMBER,!1,30),new lt["a"]("displayTime",At["a"].NUMBER,!1,3),new lt["a"]("effect-duration",At["a"].NUMBER,!1,1.5)]}createAnimation(){const e=(new Qe).useTemplate("Float").setTarget(".arrow").set("distance",this.getParamValue("distance")).set("duration",this.getParamValue("effect-duration")),t=new Qe("Fade-in").setTarget(".label,.text").set("duration",this.getParamValue("effect-duration")),r=(new Qe).useTemplate("Fade-out").setTarget("*").updateTiming({start:this.getParamValue("displayTime")});return(new Je).append(e).append(t).append(r).setTarget(new Fe["a"](".annotation"))}}class Nr extends Ct["a"]{constructor(){super(),this.templateName="Circle",this.parameters=[new lt["a"]("reverseDirection",At["a"].BOOLEAN,!1,!1),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0),new lt["a"]("displayTime",At["a"].NUMBER,!1,3)]}createAnimation(){const e=new Mr;return e.updateSettings(this.getParamValues()),e}}class Mr extends kt["a"]{create(e){const{displayTime:t,ease:r,stagger:a,duration:n,reverseDirection:i}=this.settings,o=e.getGlyphs(this.target),s=qe["a"].timeline();return o.forEach((o,c)=>{const l=this.addMaskRectToGlyph(e,o);let u,d=0;try{d=l.getTotalLength()}catch(p){}l.setAttribute("stroke-dasharray",d),u=qe["a"].fromTo(l,{strokeDashoffset:i?-d:d},{strokeDashoffset:0,ease:r,duration:n}),s.add(u,0===c?0:"<"+a),u=qe["a"].to(l,{strokeDashoffset:i?d:-d,ease:r,duration:n}),s.add(u,"+="+t)}),s}addMaskRectToGlyph(e,t){t.getAttribute("id")||t.setAttribute("id",Object(Zt["a"])());const{x:r,y:a,width:n,height:i}=e.getBBoxPosition(t),o=e.getRootSel(),s=o.select("svg").node()?o.select("svg"):o;let c=s.append("ellipse").attr("transform","translate("+[r+n/2,a-.2*i]+")").classed(gt["a"],!0).attr("rx",n/2*1.2).attr("ry",i/2*1.3).attr("stroke-width",2).attr("fill","none").attr("stroke","black");return c.node()}}var Lr={templateName:"Fade-in-then-fade-out",parameters:[{paramName:"displayTime",paramType:"number",required:!1,defaultValue:3}],animation:{target:"*",sequence:{sync:[{use:"Fade-in"},{use:"Fade-out",timing:{offset:"$displayTime"}}]}}};class jr extends Ct["a"]{constructor(){super(),this.templateName="Dynamic-number",this.parameters=[new lt["a"]("start",At["a"].NUMBER,!1,0),new lt["a"]("end",At["a"].NUMBER,!1,"@num"),new lt["a"]("formatter",At["a"].STRING,!1,"auto"),new lt["a"]("toFixed",At["a"].NUMBER,!1,0),new lt["a"]("duration",At["a"].NUMBER,!1,2),new lt["a"]("ease",At["a"].STRING,!1,"power3.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0)]}createAnimation(){const e=new Br;return e.updateSettings(this.getParamValues()),e}}class Br extends kt["a"]{create(e){const{start:t,end:r,formatter:a,toFixed:n,ease:i,stagger:o,duration:s}=this.settings,c=qe["a"].timeline(),l=e.getGlyphs(this.target);return l.forEach(e=>{let u;if("auto"===a){const t=e.innerHTML.match(/([^\d]*)(\d+)(.*)/);u=t?t[1]+"@num"+t[3]:"@num"}else u=a.includes("@num")?a:"@num";let d,p=t,h=r;if("@num"===t||"@num"===r){const a=e.innerHTML.match(u.replace("@num","([\\d.]+)"));"@num"===t&&(p=parseFloat(a[1])),"@num"===r&&(h=parseFloat(a[1]))}const f={tempNum:p},g=()=>{const e=f.tempNum.toFixed(n),t=u.replaceAll("@num",e);l.forEach(e=>e.innerHTML=t)};g(),d=qe["a"].to(f,{tempNum:h,ease:i,duration:s,onUpdate:g}),c.add(d,"<"+o)}),c}}class Zr extends Ct["a"]{constructor(){super(),this.templateName="Zoom-in-then-zoom-out",this.parameters=[new lt["a"]("displayTime",At["a"].STRING,!1,2)]}createAnimation(){const e=new Qe("Zoom-enter"),t=new Qe("Zoom-exit").updateTiming({offset:this.getParamValue("displayTime")});return new Ye([e,t])}}class Dr extends Ct["a"]{constructor(){super(),this.templateName="custom-effect",this.parameters=[new lt["a"]("attr",At["a"].STRING_OR_ARRAY),new lt["a"]("from",At["a"].ANY,!1,null),new lt["a"]("to",At["a"].ANY,!1,null),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0)]}isValid(){if(!super.isValid())return!1;const e=this.getParamValues();return!!e.attr&&(Array.isArray(e.attr)?null!==e.from&&null!==e.to?Array.isArray(e.from)&&e.from.length===e.attr.length&&Array.isArray(e.to)&&e.to.length===e.attr.length:null!==e.from?Array.isArray(e.from)&&e.from.length===e.attr.length:null!==e.to&&(Array.isArray(e.to)&&e.to.length===e.attr.length):null!==e.from||null!==e.to)}createAnimation(){const e=new Gr;return e.updateSettings(this.getParamValues()),e}}class Gr extends kt["a"]{create(e){const{attr:t,from:r,to:a,ease:n,stagger:i}=this.settings,{duration:o,yoyo:s}=this.timing.getComputedTiming(),c=e.getGlyphs(this.target);let l,u,d,p;Array.isArray(t)?(l=t,u=r,d=a):(l=[t],null!==r&&(u=[r]),null!==a&&(d=[a]));const h=(e,t,r)=>t.forEach((t,a)=>e[t]=r[a]);if(null!=r&&null!=a){const e={};h(e,l,u);const t={ease:n,duration:o,stagger:i};h(t,l,d),p=qe["a"].fromTo(c,e,t)}else if(null!=r){const e={ease:n,duration:o,stagger:i};h(e,l,u),p=qe["a"].from(c,e)}else{if(null==a)return null;{const e={ease:n,duration:o,stagger:i};h(e,l,d),p=qe["a"].to(c,e)}}return s&&(p.yoyo(!0),p.repeat(s.repeat),p.repeatDelay(s.delay)),p}}class Ur extends Ct["a"]{constructor(){super(),this.templateName="Fade",this.parameters=[new lt["a"]("FadeType",At["a"].STRING,!1,"in"),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0)]}createAnimation(){const e=new Fr;return e.updateSettings(this.getParamValues()),e}}class Fr extends kt["a"]{create(e){const{fadeType:t,ease:r,stagger:a,duration:n}=this.settings;let i;const o=e.getGlyphs(this.target),s={opacity:0,ease:r,duration:n,stagger:a};if("in"===t)i=qe["a"].from(o,s);else{if("out"!==t)return console.warn("Wrong value of fadeType: "+t),null;i=qe["a"].to(o,s)}return i}}var zr={templateName:"Zoom-enter",parameters:[{paramName:"duration",paramType:"number",required:!1,defaultValue:1},{paramName:"zoomEase",paramType:"string",required:!1,defaultValue:"back.out"},{paramName:"FadeEase",paramType:"string",required:!1,defaultValue:"power1.inOut"},{paramName:"stagger",paramType:"string",required:!1,defaultValue:0}],animation:{use:"Zoom",target:"*",settings:{duration:"$duration",zoomEase:"$zoomEase",fadeEase:"$fadeEase",stagger:"$stagger",enterOrExit:"enter"}}},Vr={templateName:"Basic-zoom-enter",parameters:[{paramName:"duration",paramType:"number",required:!1,defaultValue:1},{paramName:"ease",paramType:"string",required:!1,defaultValue:"back.out"},{paramName:"stagger",paramType:"number",required:!1,defaultValue:0}],animation:{use:"basic-zoom",target:"*",settings:{duration:"$duration",ease:"$ease",stagger:"$stagger",enterOrExit:"enter"}}};class Hr extends Ct["a"]{constructor(){super(),this.templateName="Bar-bounce",this.parameters=[new lt["a"]("symbol-ease",At["a"].STRING,!1,"back.out"),new lt["a"]("bar-ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("duration",At["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new Qe("Move-to").setTarget(".bar").updateSettings({y:"-=15",yoyo:!0}),t=new Qe("Move-to").setTarget(".bar-label").updateTiming({start:.4}).updateSettings({y:"-=15",yoyo:!0});return(new Je).append(e).append(t).setTarget(new Fe["a"](".bar,.axis.symbol,.bar-label"))}}class Wr extends Ct["a"]{constructor(){super(),this.templateName="Bar chart with axis label",this.parameters=[new lt["a"]("barDirection",At["a"].STRING,!1,"bottom"),new lt["a"]("titleStagger",At["a"].NUMBER,!1,.2),new lt["a"]("symbolStagger",At["a"].NUMBER,!1,0),new lt["a"]("axisElementStagger",At["a"].NUMBER,!1,0),new lt["a"]("ease",At["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new Qe("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new Qe("Grow").setTarget(".bar").updateTiming({offset:2}).updateSettings({ease:this.getParamValue("ease"),direction:this.getParamValue("barDirection")}),r=new Qe("Fade-in").setTarget(".bar-label").updateTiming({offset:3});return(new Je).append(e).append(t).append(r)}}class Kr extends Ct["a"]{constructor(){super(),this.templateName="move",this.parameters=[new lt["a"]("from",At["a"].OBJECT,!1,null),new lt["a"]("to",At["a"].OBJECT,!1,null),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0),new lt["a"]("yoyo",At["a"].OBJECT,!1,null)]}createAnimation(){const e=new qr;return e.updateSettings(this.getParamValues()),e}}class qr extends kt["a"]{getDefaultSettings(){return{duration:1,ease:"power1.out",stagger:0,yoyo:null}}create(e){const{from:t,to:r,ease:a,stagger:n}=this.settings;let i,{duration:o,yoyo:s}=this.settings;const c=e.getGlyphs(this.target),l={};if(s&&(!0===s&&(s=et["a"].getDefaultYoyo()),l.yoyo=!0,l.repeat=s.repeat,l.repeatDelay=s.delay,o/=l.repeat+1),null!=t&&null!=r){const e={...t},s={...r,ease:a,duration:o,stagger:n,...l};i=qe["a"].fromTo(c,e,s)}else if(null!=t){const e={...t,ease:a,duration:o,stagger:n,...l};i=qe["a"].from(c,e)}else{if(null==r)return null;{const e={...r,ease:a,duration:o,stagger:n,...l};i=qe["a"].to(c,e)}}return i}}class Jr extends Ct["a"]{constructor(){super(),this.templateName="wheel",this.parameters=[new lt["a"]("enterOrExit",At["a"].STRING,!1,"enter"),new lt["a"]("direction",At["a"].STRING,!1,"clockwise"),new lt["a"]("center",At["a"].STRING,!1,"50% 50%"),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0),new lt["a"]("startAngle",At["a"].NUMBER,!1,0),new lt["a"]("sweepAngle",At["a"].NUMBER,!1,360),new lt["a"]("grouped",At["a"].BOOLEAN,!1,!1)]}createAnimation(){const e=new Yr;return e.updateSettings(this.getParamValues()),e}}class Yr extends kt["a"]{create(e){const t=e.getGlyphs(this.target),r=e.getDefsSel(),a=qe["a"].timeline(),{grouped:n,stagger:i}=this.settings;if(0===t.length)return null;if(n&&1!==t.length){const e=this.addClipPathToEntirety(r,t),n=this.createTwForClipEntirety(e,t);a.add(n)}else t.forEach((e,t)=>{const n=this.addClipPathToGlyph(r,e),o=this.createTwForClip(n,e),s=0===t?0:"<"+i;a.add(o,s)});return a}addClipPathToGlyph(e,t){var r;t.getAttribute("id")||t.setAttribute("id",Object(Zt["a"])());const a="clip-path-"+t.getAttribute("id");let n=e.select("#"+a);n.empty()&&(n=e.append("clipPath").attr("id",a).classed(gt["b"],!0),t.setAttribute("clip-path",`url(#${a})`));const i=n.select(".wheel");if(!i.empty())return i.node();let o=parseFloat(null!==(r=t.getAttribute("stroke-width"))&&void 0!==r?r:"0");f["n"](t).selectAll("*").each((function(){var e;const t=parseFloat(null!==(e=this.getAttribute("stroke-width"))&&void 0!==e?e:"0");o=Math.max(t,o)}));const s=n.append("path").attr("class","wheel").attr("d","");return s.node()}addClipPathToEntirety(e,t){}createTwForClip(e,t){var r;const{ease:a,duration:n,startAngle:i,sweepAngle:o}=this.settings,s=t.getBBox();let c,l,u,d,p,h,g=parseFloat(null!==(r=t.getAttribute("stroke-width"))&&void 0!==r?r:"0");f["n"](t).selectAll("*").each((function(){var e;const t=parseFloat(null!==(e=this.getAttribute("stroke-width"))&&void 0!==e?e:"0");g=Math.max(t,g)})),c=s.width+2*g,l=s.height+2*g,u=s.x-g,d=s.y-g,p={startAngle:null!==i&&void 0!==i?i:0,sweepAngle:0,cx:u+c/2,cy:d+l/2,rx:c,ry:l},h=o;const m=function(){const t=Xr(p.cx,p.cy,p.rx,p.ry,p.startAngle,p.sweepAngle);e.setAttribute("d",t)};return m(),qe["a"].to(p,{sweepAngle:h,ease:a,onUpdate:m,duration:n})}createTwForClipEntirety(e,t){var r;const{ease:a,duration:n,startAngle:i,sweepAngle:o}=this.settings,s=t.getBBox();let c,l,u,d,p,h,g=parseFloat(null!==(r=t.getAttribute("stroke-width"))&&void 0!==r?r:"0");f["n"](t).selectAll("*").each((function(){var e;const t=parseFloat(null!==(e=this.getAttribute("stroke-width"))&&void 0!==e?e:"0");g=Math.max(t,g)})),c=s.width+2*g,l=s.height+2*g,u=s.x-g,d=s.y-g,p={startAngle:null!==i&&void 0!==i?i:0,sweepAngle:0,cx:u+c/2,cy:d+l/2,rx:c,ry:l},h=o;const m=function(){const t=Xr(p.cx,p.cy,p.rx,p.ry,p.startAngle,p.sweepAngle);e.setAttribute("d",t)};return m(),qe["a"].to(p,{sweepAngle:h,ease:a,onUpdate:m,duration:n})}}function Xr(e,t,r,a,n,i){if(!i)return`M${e} ${t}`;n%=360,i%=360;const o=0===i;o&&(i=180),i<0&&(i+=360);const s=i>180?1:0,c=n*Math.PI/180,l=(n+i)*Math.PI/180,u=e+r*Math.sin(c),d=t-a*Math.cos(c),p=e+r*Math.sin(l),h=t-a*Math.cos(l);return o?`\n      M ${u} ${d}\n      A ${r} ${a} 0 1 1 ${p} ${h}\n      A ${r} ${a} 0 1 1 ${u} ${d}z`:`\n    M ${u} ${d}\n    A ${r} ${a} 0 ${s} 1 ${p} ${h}\n    L ${e} ${t}z`}var Qr=r("6d0c");class ea extends Ct["a"]{constructor(){super(),this.templateName="Draw-path",this.parameters=[new lt["a"]("enterOrExit",At["a"].STRING,!1,"enter"),new lt["a"]("reverseDirection",At["a"].BOOLEAN,!1,!1),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0)]}createAnimation(){const e=new ta;return e.updateSettings(this.getParamValues()),e}}class ta extends kt["a"]{create(e){const{enterOrExit:t,ease:r,stagger:a,duration:n,reverseDirection:i}=this.settings,o=qe["a"].timeline(),s=e.getGlyphs(this.target);return s.forEach((e,s)=>{let c,l=0;try{l=e.getTotalLength()}catch(u){}if(e.setAttribute("stroke-dasharray",l),"enter"===t)c=qe["a"].fromTo(e,{strokeDashoffset:i?-l:l},{strokeDashoffset:0,ease:r,duration:n});else{if("exit"!==t)return void console.warn("Wrong value of enterOrExit: "+t);c=qe["a"].fromTo(e,{strokeDashoffset:0},{strokeDashoffset:i?l:-l,ease:r,duration:n})}o.add(c,0===s?0:"<"+a)}),o}}class ra extends Ct["a"]{constructor(){super(),this.templateName="Highlight-sector",this.parameters=[new lt["a"]("duration",At["a"].NUMBER,!1,1)]}createAnimation(){const e=new Qe("show-dynamic-number").setTarget(".anno-label,.sector-label").set("start",0).set("end","@num").set("formatter","@num%");return(new Je).append(e)}}class aa extends Ct["a"]{constructor(){super(),this.templateName="arc-wheel-with-legend",this.parameters=[]}createAnimation(){const e=new Qe("simple-sector-wheel").setTarget(".arc").updateSettings({centerSelector:".arc",endAngle:360,startAngle:0}),t=new Qe("Fly-in").setTarget(".legend").updateSettings({direction:"right"});return(new Je).append(e).append(t)}}class na extends Ct["a"]{constructor(){super(),this.templateName="show-dynamic-number",this.parameters=[new lt["a"]("start",At["a"].NUMBER,!1,0),new lt["a"]("end",At["a"].NUMBER,!1,100),new lt["a"]("formatter",At["a"].STRING,!1,"@num"),new lt["a"]("toFixed",At["a"].NUMBER,!1,0),new lt["a"]("numChangeDuration",At["a"].NUMBER,!1,1.9),new lt["a"]("FadeInDuration",At["a"].NUMBER,!1,.1),new lt["a"]("FadeOutDuration",At["a"].NUMBER,!1,1),new lt["a"]("notExit",At["a"].BOOLEAN,!1,!1),new lt["a"]("displayTime",At["a"].NUMBER,!1,3),new lt["a"]("ease",At["a"].STRING,!1,"power3.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0)]}createAnimation(){const e=new Qe("Fade-in").set("duration",this.getParamValue("FadeInDuration")),t=new Qe("Dynamic-number"),r={...this.getParamValues()};r["duration"]=r["numChangeDuration"],delete r["numChangeDuration"],delete r["FadeInDuration"],delete r["FadeOutDuration"],t.updateSettings(this.getParamValues());const a=[e,t];if(!this.getParamValue("notExit")){const e=new Qe("Fade-out").set("duration",this.getParamValue("FadeOutDuration")).updateTiming({offset:this.getParamValue("displayTime")});a.push(e)}return new Ye(a)}}class ia extends Ct["a"]{constructor(){super(),this.templateName="Show-annotation-auto-effect",this.parameters=[new lt["a"]("stagger",At["a"].NUMBER,!1,0),new lt["a"]("duration",At["a"].NUMBER,!1,1)]}createAnimation(){const e=new oa;return e.updateSettings(this.getParamValues()),e}}class oa extends kt["a"]{create(e){const{stagger:t,duration:r}=this.settings,a=qe["a"].timeline(),n=e.getGlyphs(this.target);return n.forEach(n=>{let i;switch(n.tagName){case"text":i=new Qe("Float");break;case"circle":i=new Qe("wheel");break;case"path":case"line":i=new Qe("Draw-path");break;default:i=new Qe("Fade-in")}i.setTarget("#"+n.id).set("duration",r);const o=i.create(e);o.yoyo(!0),o.repeat(1),a.add(o,"<"+t)}),a}}class sa extends Ct["a"]{constructor(){super(),this.templateName="Camera-move",this.parameters=[new lt["a"]("x",At["a"].ANY,!1,"+=50"),new lt["a"]("y",At["a"].ANY,!1,"+=50"),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("yoyo",At["a"].OBJECT,!1,null)]}createAnimation(){const e=new ca;return e.updateSettings(this.getParamValues()),e}}class ca extends kt["a"]{create(e){const{x:t,y:r,ease:a}=this.settings;let n,{duration:i,yoyo:o}=this.settings;const s=e.renderContext.rootSel,c={};o&&(!0===o&&(o=et["a"].getDefaultYoyo()),c.yoyo=!0,c.repeat=o.repeat,c.repeatDelay=o.delay,i/=c.repeat+1);const l=t.replace("+","-").replace("-","+"),u=r.replace("+","-").replace("-","+"),d={translateX:l,translateY:u,ease:a,duration:i};return n=qe["a"].to(s.node(),d),n}}class la extends Ct["a"]{constructor(){super(),this.templateName="simple-sector-wheel",this.parameters=[new lt["a"]("enterOrExit",At["a"].STRING,!1,"enter"),new lt["a"]("duration",At["a"].NUMBER,!1,1),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("centerSelector",At["a"].STRING,!1,null),new lt["a"]("startAngle",At["a"].NUMBER,!1,0),new lt["a"]("endAngle",At["a"].NUMBER,!1,360)]}createAnimation(){const e=new ua;return e.updateSettings(this.getParamValues()),e}}class ua extends kt["a"]{constructor(...e){super(...e),Object(Ge["a"])(this,"x",void 0),Object(Ge["a"])(this,"y",void 0),Object(Ge["a"])(this,"width",void 0),Object(Ge["a"])(this,"height",void 0)}create(e){const t=e.getGlyphs(this.target),r=e.getDefsSel(),a=qe["a"].timeline(),{stagger:n,centerSelector:i,startAngle:o,endAngle:s}=this.settings;let c,l=1/0,u=1/0,d=0,p=0;return c=null!=i?e.getRootSel().selectAll(i).nodes():t,c.forEach(e=>{const t=e.getBBox();l=Math.min(l,t.x),u=Math.min(u,t.y)}),this.x=l,this.y=u,c.forEach(e=>{const t=e.getBBox();d=Math.max(d,t.x+t.width-l),p=Math.max(p,t.y+t.height-u)}),this.width=d,this.height=p,console.log("sector",l,u,d,p),t.forEach((e,t)=>{const i=this.addClipPathToGlyph(r,e),c=this.createTwForClip(i,e,o,s),l=0===t?0:"<"+n;a.add(c,l)}),a}addClipPathToGlyph(e,t){var r;t.getAttribute("id")||t.setAttribute("id",Object(Zt["a"])());const a="clip-path-"+t.getAttribute("id");let n=e.select("#"+a);n.empty()&&(n=e.append("clipPath").attr("id",a).classed(gt["b"],!0),t.setAttribute("clip-path",`url(#${a})`));const i=n.select(".sector-wheel");if(!i.empty())return i.node();let o=parseFloat(null!==(r=t.getAttribute("stroke-width"))&&void 0!==r?r:"0");f["n"](t).selectAll("*").each((function(){var e;const t=parseFloat(null!==(e=this.getAttribute("stroke-width"))&&void 0!==e?e:"0");o=Math.max(t,o)}));const s=n.append("path").attr("class","sector-wheel").attr("d","");return s.node()}createTwForClip(e,t,r,a){const{ease:n,duration:i}=this.settings,o=r,s=a-r;let c,l;c={startAngle:null!==o&&void 0!==o?o:0,sweepAngle:0,cx:this.x+this.width/2,cy:this.y+this.height/2,rx:Math.max(this.width,this.height),ry:Math.max(this.width,this.height)},console.log(c.cx,c.cy,c),l=s;const u=function(){const t=da(c.cx,c.cy,c.rx,c.ry,c.startAngle,c.sweepAngle);e.setAttribute("d",t)};return u(),qe["a"].to(c,{sweepAngle:l,ease:n,onUpdate:u,duration:i})}}function da(e,t,r,a,n,i){if(!i)return`M${e} ${t}`;n%=360,i%=360;const o=0===i;o&&(i=180),i<0&&(i+=360);const s=i>180?1:0,c=n*Math.PI/180,l=(n+i)*Math.PI/180,u=e+r*Math.sin(c),d=t-a*Math.cos(c),p=e+r*Math.sin(l),h=t-a*Math.cos(l);return o?`\n      M ${u} ${d}\n      A ${r} ${a} 0 1 1 ${p} ${h}\n      A ${r} ${a} 0 1 1 ${u} ${d}z`:`\n    M ${u} ${d}\n    A ${r} ${a} 0 ${s} 1 ${p} ${h}\n    L ${e} ${t}z`}class pa extends Ct["a"]{constructor(){super(),this.templateName="Fly-in",this.parameters=[new lt["a"]("direction",At["a"].STRING,!1,Pt.RIGHT),new lt["a"]("duration",At["a"].NUMBER,!1,.2),new lt["a"]("ease",At["a"].STRING,!1,"power1.out"),new lt["a"]("stagger",At["a"].NUMBER,!1,0)]}createAnimation(){const e=new ha;return e.updateSettings(this.getParamValues()),e}}class ha extends kt["a"]{constructor(...e){super(...e),Object(Ge["a"])(this,"rootBBox",void 0)}create(e){const{stagger:t}=this.settings,r=e.getGlyphs(this.target);this.rootBBox=e.getRootSel().node().getBBox();const a=qe["a"].timeline();return r.forEach((e,r)=>{const n=this.createTwForOneGlyph(e),i=0===r?0:"<"+t;a.add(n,i)}),a}createTwForOneGlyph(e){const{direction:t,ease:r,duration:a}=this.settings;let n,i;switch(t){case Pt.TOP:n=0,i=-1;break;case Pt.BOTTOM:n=0,i=1;break;case Pt.LEFT:n=-1,i=0;break;case Pt.RIGHT:n=1,i=0;break;default:return null}const o="+="+n*this.rootBBox.width*.5,s="+="+i*this.rootBBox.height*.5,c={translateX:o,translateY:s,duration:a,ease:r};return qe["a"].from(e,c)}}class fa extends Ct["a"]{constructor(){super(),this.templateName="hide"}createAnimation(){return new ga}}class ga extends kt["a"]{create(e){const t=e.getGlyphs(this.target);return qe["a"].set(t,{opacity:0}),qe["a"].timeline()}}class ma extends Ct["a"]{constructor(){super(),this.templateName="empty",this.parameters=[new lt["a"]("duration",At["a"].NUMBER,!1,1)]}createAnimation(){const e=new ya;return e.updateSettings(this.getParamValues()),e}}class ya extends kt["a"]{create(e){const{duration:t}=this.settings;return qe["a"].to("empty-selector",{duration:t})}}var va={templateName:"show number",parameters:[{paramName:"dataName",paramType:"string"}],animation:{target:{selector:".annotation",transform:{type:"filter",expr:'@datum.name === "$dataName"'}},sequence:{sync:[{use:"Dynamic-number",target:".label"},{use:"Float",target:".label",settings:{distance:10}}]}}};const _a=[new Dr,new Rt,new Ur,new $t,new or,new Dt,new Nr,new er,new Bt,dt.fromJSON(zr),dt.fromJSON(nr),new Lt,dt.fromJSON(Vr),dt.fromJSON(ir),new Kr,new It,new Ot,new Nt,dt.fromJSON(Lr),new zt,new Jr,new pa,new fa,new ma,new rr,new sa,dt.fromJSON(lr),new cr,new ur,new Hr,new _r,new Wr,new dr,new vr,new yr,new Cr,new $r,new hr,new fr,new gr,new kr,new Pr,new Rr,new wr,new br,new pr,new Tr,new ea,new Ht,new Qr["a"],new la,new mr,new ra,new aa,new Er,new Ir,new Or,new Zr,new jr,new na,new ia,dt.fromJSON(va),new sr];console.log("buildInTemplates",_a);const ba=new St(new Ur,Tt.GENERAL,wt.OTHER,["general","any","opacity","enter","exit"],{},".second,.forth",.5),Ta=new St(dt.fromJSON(Vr),Tt.GENERAL,wt.ENTER,["general","any","zoom","enter"],{},".second,.forth",.5),wa=new St(dt.fromJSON(ir),Tt.GENERAL,wt.EXIT,["general","any","zoom","exit"],{},".second,.forth",.5),Sa=new St(new Lt,Tt.GENERAL,wt.OTHER,["general","any","zoom","enter","exit"],{},".second,.forth",.5),xa=new St(new zt,Tt.GENERAL,wt.HIGHLIGHT,["general","any","color","emphasize"],{fill:"#2171b5",duration:2},".second,.first",1),Ca=new St(new Dr,Tt.MOVE,wt.OTHER,["general","any","custom","enter","exit"],{attr:["fill","x"],to:["#fb9b5b","+=70px"],ease:"power1.inOut"},".target",.5),Aa=new St(new $t,Tt.GENERAL,wt.ENTER,["general","any","opacity","enter"],{},".second,.forth",.5),$a=new St(new or,Tt.GENERAL,wt.EXIT,["general","any","opacity","exit"],{},".second,.forth",.5),ka=new St(new Nt,Tt.GENERAL,wt.ENTER,["general","any","move","opacity","enter","exit"],{},".second,.forth",.5),Pa=new St(new pa,Tt.GENERAL,wt.ENTER,["general","any","move","opacity","enter","exit"],{},".second,.forth",.5),Ra=new St(new Rt,Tt.GENERAL,wt.ENTER,["general","any","width","height","enter"],{},".second,.forth",.5),Ea=new St(new Kr,Tt.MOVE,wt.OTHER,["general","any","move","from","to"],{to:{x:"+=70"},ease:"power1.inOut"},".target",.5),Oa=new St(new It,Tt.MOVE,wt.ENTER,["general","any","move","from"],{x:"+=70",ease:"power1.inOut"},".target",.5),Ia=new St(new Ot,Tt.MOVE,wt.ENTER,["general","any","move","to"],{x:"+=70",ease:"power1.inOut"},".target",.5),Na=new St(new Dt,Tt.GENERAL,wt.ENTER,["general","any","mask","enter","exit"],{},".second",.5),Ma=new St(dt.fromJSON(zr),Tt.GENERAL,wt.ENTER,["general","any","zoom","enter"],{},".second,.forth",.5),La=new St(dt.fromJSON(nr),Tt.GENERAL,wt.EXIT,["general","any","zoom","exit"],{},".second,.forth",.5),ja=new St(new Bt,Tt.GENERAL,wt.OTHER,["general","any","zoom","enter","exit"],{},".second,.forth",.5),Ba=new St(new Zr,Tt.GENERAL,wt.HIGHLIGHT,["annotation","zoom","show"],{displayTime:.5},".second",.5),Za=new St(new Ir,Tt.ANNOTATION_ARROW,wt.HIGHLIGHT,["annotation","arrow","label","zoom","float","show"],{},".annotation",.5),Da=new St(new rr,Tt.CAMERA,wt.HIGHLIGHT,["camera","zoom"],{scaleFactor:1.5,transformOrigin:"50% 0%"},"*",.5),Ga=new St(new sa,Tt.CAMERA,wt.HIGHLIGHT,["camera","zoom"],{scaleFactor:1.5,transformOrigin:"50% 0%"},"*",.5),Ua=new St(new ur,Tt.BAR_CHART,wt.ENTER,["chart","enter"],{},".chart",1),Fa=new St(new _r,Tt.BAR_CHART,wt.ENTER,["mark","label","enter"],{},{selector:".chart",transform:{type:"filter",expr:'@datum.name === "A"'}},1),za=new St(new Hr,Tt.BAR_CHART,wt.HIGHLIGHT,["mark","label","enter"],{},{selector:".chart",transform:{type:"filter",expr:'@datum.name === "A"'}},1),Va=new St(new yr,Tt.BAR_CHART,wt.ENTER,["chart","enter"],{},".mark",1),Ha=new St(new dr,Tt.BAR_CHART_WITH_LEGEND,wt.ENTER,["chart","enter"],{},".chart",1),Wa=new St(new vr,Tt.BAR_CHART_WITH_LEGEND,wt.ENTER,["chart","enter"],{},".mark",1);class Ka extends Ct["a"]{constructor(){super(),this.templateName="Axes fade in",this.parameters=[new lt["a"]("titleStagger",At["a"].NUMBER,!1,.2),new lt["a"]("symbolStagger",At["a"].NUMBER,!1,0),new lt["a"]("axisElementStagger",At["a"].NUMBER,!1,0),new lt["a"]("ease",At["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new Qe("Fade-in").setTarget(".title,.subtitle,.main-title,.sub-title").set("stagger",this.getParamValue("titleStagger")),t=new Qe("Fade-in").setTarget(".x-axis.symbol").set("stagger",this.getParamValue("symbolStagger")),r=new Qe("Grow").setTarget(".x-axis.domain").updateSettings({direction:"left",ease:this.getParamValue("ease")}),a=new Qe("Grow").setTarget(".y-axis.domain").updateSettings({ease:this.getParamValue("ease")}),n=new Qe("Fade-in").setTarget(".axis.label").set("stagger",this.getParamValue("axisElementStagger")).updateTiming({offset:1}),i=new Qe("Fade-in").setTarget(".axis.tick").set("stagger",this.getParamValue("axisElementStagger")).updateTiming({offset:1});return(new Je).append(e).append(t).append(r).append(a).append(n).append(i)}}const qa=new St(new Ka,Tt.CHART_FRAMEWORK,wt.ENTER,["chart","without-mark","enter"],{},".chart",1),Ja=new St(new cr,Tt.CHART_FRAMEWORK,wt.ENTER,["chart","without-mark","enter"],{},".chart",1);class Ya extends Ct["a"]{constructor(){super(),this.templateName="Fade-in-then-fade-out",this.parameters=[new lt["a"]("displayTime",At["a"].STRING,!1,2)]}createAnimation(){const e=new Qe("Fade-in"),t=new Qe("Fade-out").updateTiming({offset:this.getParamValue("displayTime")});return new Ye([e,t])}}const Xa=new St(new Ya,Tt.GENERAL,wt.HIGHLIGHT,["general","any","opacity","show"],{displayTime:.5},".second,.forth",.5),Qa=new St(new Nr,Tt.CHART_FRAMEWORK,wt.HIGHLIGHT,["general","any","annotation","circle"],{},{selector:".chart",transform:{type:"filter",expr:"@datum === 20"}},1),en=new St(new Ht,Tt.PATH,wt.HIGHLIGHT,["general","any","show","path","enter"],{},".annotation",.5),tn=new St(new er,Tt.GENERAL,wt.HIGHLIGHT,["general","any","highlight"],{},".first,.second",1),rn=new St(new wr,Tt.CIRCLE_CHART,wt.ENTER,[],{},".chart",1),an=new St(new br,Tt.CIRCLE_CHART,wt.ENTER,[],{},".mark",1),nn=new St(new pr,Tt.CIRCLE_CHART_WITH_LEGEND,wt.ENTER,[],{},".chart",1),on=new St(new Tr,Tt.CIRCLE_CHART_WITH_LEGEND,wt.ENTER,[],{},".mark",1),sn=new St(new mr,Tt.PIE_CHART,wt.ENTER,[],{},".third",1),cn=new St(new Er,Tt.PIE_WITH_LEGEND,wt.ENTER,[],{},".third",1),ln=new St(new ra,Tt.PIE_CHART,wt.HIGHLIGHT,[],{},".third",1),un=new St(new sr,Tt.TITLE,wt.ENTER,[],{},".chart",1),dn=new St(new jr,Tt.TEXT,wt.HIGHLIGHT,["chart","without-mark","enter"],{},".annotation",1),pn=new St(new fr,Tt.LINE_CHART_WITH_LEGEND,wt.ENTER,[],{},".chart",1),hn=new St(new kr,Tt.LINE_CHART_WITH_LEGEND,wt.ENTER,[],{},".mark",1),fn=new St(new gr,Tt.LINE_CHART_WITH_LEGEND,wt.ENTER,[],{},".chart",1),gn=new St(new Pr,Tt.LINE_CHART_WITH_LEGEND,wt.ENTER,[],{},".mark",1),mn=new St(new hr,Tt.LINE_CHART,wt.ENTER,[],{},".chart",1),yn=new St(new $r,Tt.LINE_CHART,wt.ENTER,[],{},".mark",1),vn=new St(new Rr,Tt.LINE_CHART_WITH_LEGEND,wt.HIGHLIGHT,[],{},".first",1),_n=[Aa,Ra,Ia,Oa,ka,Sa,ja,Na,xa,en,tn,Da,Ga,Ma,wa,$a,Pa,Za,Qa,Xa,Ba,dn,un,qa,Ja,Ua,Ha,nn,mn,pn,fn,sn,Va,Wa,Fa,an,on,rn,cn,ln,Ta,Ca,ba,Ea,La,za,yn,gn,hn,vn];class bn{constructor(){Object(Ge["a"])(this,"previewerType",void 0),Object(Ge["a"])(this,"previewWrapper",void 0),Object(Ge["a"])(this,"previewerContext",void 0),Object(Ge["a"])(this,"timeline",void 0),this.previewerType=Tt.BLANK}init(e,t){this.previewerContext=t,this.previewWrapper=e}clone(){return this.constructor()}render(){this.clear();const{width:e,height:t}=this.getCanvasSize();this.previewerContext.rootSel.attr("viewBox",`0 0 ${e} ${t}`),this.draw(),setTimeout(()=>this.apply(),0)}clear(){this.previewerContext.rootSel.selectAll("*").remove(),this.previewerContext.globalSelection=null}draw(){throw"This previewer is abstract"}getCanvasSize(){return{width:200,height:150}}apply(){if(this.previewerType===Tt.BLANK)return void(this.timeline=qe["a"].timeline());this.previewerContext.globalSelection=this.previewerContext.rootSel.selectAll("*");const e=this.previewWrapper.createPreviewAnimation(),t=this.previewerContext.createRootContext(),r=t.deriveBy(this.previewWrapper.target);this.timeline=e.create(r),this.timeline.repeat(-1).repeatDelay(1).pause().progress(this.previewWrapper.staticProgress)}pause(){this.timeline?this.timeline.pause().progress(this.previewWrapper.staticProgress):console.warn("Previewer timeline is not ready")}getDuration(){if(this.timeline)return this.timeline.duration();console.warn("Previewer timeline is not ready")}restart(){this.timeline?this.timeline.restart():console.warn("Previewer timeline is not ready")}}class Tn extends bn{constructor(){super(),this.previewerType=Tt.BLANK}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize();e.append("text").attr("transform","translate("+[t/2,r/2]+")").attr("text-anchor","middle").attr("fill","gray").attr("opacity",.5).style("font-family","Verdana, Arial, Helvetica, sans-serif").text("No preview is available")}}class wn extends bn{constructor(){super(),this.previewerType=Tt.GENERAL}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=25,n=5,i=[70,70],o=i.length*a+(i.length+3)*n,s=(t-o)/2,c=(r+Math.max(...i))/2,l=["first","second","third","forth"],u=e.append("g").classed("chart group",!0),d=u.append("g").classed("mark group",!0);d.selectAll(".bar.glyph").data(i).enter().append("rect").each((function(e,t){f["n"](this).classed("bar glyph "+l[t],!0)})).attr("width",a).attr("height",e=>e).attr("x",(e,t)=>s+(t+2)*n+t*a).attr("y",e=>c-e).attr("fill","#409eff").attr("rx",5).attr("ry",5)}}class Sn extends bn{constructor(){super(),this.previewerType=Tt.MOVE}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=20,n=70;e.append("circle").classed("start circle shadow",!0).attr("fill","#409eff").attr("r",a).attr("cx",(t-n)/2).attr("cy",r/2).attr("opacity",.5),e.append("circle").classed("target circle",!0).attr("fill","#409eff").attr("r",a).attr("cx",(t-n)/2).attr("cy",r/2)}}class xn extends bn{constructor(){super(),this.previewerType=Tt.ANNOTATION_ARROW}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=25,n=5,i=[70,83,70,110],o=i.length*a+(i.length+3)*n,s=(t-o)/2,c=(r+Math.max(...i))/2,l=["first","second","third","forth"],u=e.append("g").classed("chart group",!0).attr("transform","scale(1.4)").style("transform-origin",t/2+"px 0px"),d=u.append("g").classed("mark-group",!0);d.selectAll(".bar.mark").data(i).enter().append("rect").each((function(e,t){f["n"](this).classed("mark bar "+l[t],!0)})).attr("width",a).attr("height",e=>e).attr("x",(e,t)=>s+(t+2)*n+t*a).attr("y",e=>c-e).attr("fill","#409eff").attr("rx",5).attr("ry",5),u.append("line").classed("line axis domain",!0).attr("x1",s).attr("y1",c).attr("x2",s+o).attr("y2",c).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const p=u.append("g").classed("annotation-group",!0),h=s+2*n+a/2,g=c-i[0];p.append("text").classed("annotation label",!0).attr("transform",`translate(${h},${g-30})`).style("text-anchor","middle").attr("font-size",20).attr("font-weight","bold").attr("font-family","system-ui").attr("fill","#3b3b3b").text("21"),p.append("g").classed("annotation arrow",!0).attr("transform",`translate(${h-16},${g-30})`).append("svg").attr("width",30).attr("height",30).attr("viewBox","0 0 1024 1024").append("path").attr("d","M819.07712 636.39552l-225.4848 191.488a81.73568 81.73568 0 0 1-53.0432 19.47648 81.77664 81.77664 0 0 1-53.02272-19.47648l-225.4848-191.488a81.92 81.92 0 1 1 106.06592-124.86656l90.5216 76.88192v-329.8304a81.92 81.92 0 0 1 163.84 0v329.8304l90.54208-76.88192a81.89952 81.89952 0 1 1 106.06592 124.86656z").attr("stroke","#3b3b3b")}}class Cn extends bn{constructor(){super(),this.previewerType=Tt.CAMERA}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=25,n=5,i=[70,83,70,110],o=i.length*a+(i.length+3)*n,s=(t-o)/2,c=(r+Math.max(...i))/2,l=["first","second","third","forth"],u=e.append("g").classed("scene chart-group group container",!0),d=u.append("g").classed("mark group",!0);d.selectAll(".bar.glyph").data(i).enter().append("rect").each((function(e,t){f["n"](this).classed("chart mark bar "+l[t],!0)})).attr("width",a).attr("height",e=>e).attr("x",(e,t)=>s+(t+2)*n+t*a).attr("y",e=>c-e).attr("fill","#409eff").attr("rx",5).attr("ry",5),u.append("line").classed("chart line axis domain",!0).attr("x1",s).attr("y1",c).attr("x2",s+o).attr("y2",c).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round")}}class An{constructor({width:e,height:t,topRatio:r,bottomRatio:a,leftRatio:n,rightRatio:i}){Object(Ge["a"])(this,"width",void 0),Object(Ge["a"])(this,"height",void 0),Object(Ge["a"])(this,"topRatio",void 0),Object(Ge["a"])(this,"bottomRatio",void 0),Object(Ge["a"])(this,"leftRatio",void 0),Object(Ge["a"])(this,"rightRatio",void 0),Object(Ge["a"])(this,"origin",void 0),Object(Ge["a"])(this,"top",void 0),Object(Ge["a"])(this,"bottom",void 0),Object(Ge["a"])(this,"left",void 0),Object(Ge["a"])(this,"right",void 0),Object(Ge["a"])(this,"chartHeight",void 0),Object(Ge["a"])(this,"chartWidth",void 0),this.width=e,this.height=t,this.topRatio=r,this.bottomRatio=a,this.leftRatio=n,this.rightRatio=i,this.initLayout()}initLayout(){this.origin={x:this.width*this.leftRatio,y:this.height*(1-this.bottomRatio)},this.top=this.height*this.topRatio,this.bottom=this.height*this.bottomRatio,this.left=this.width*this.leftRatio,this.right=this.width*this.rightRatio,this.chartHeight=this.height-this.top-this.bottom,this.chartWidth=this.width-this.left-this.right}}class $n extends bn{constructor(){super(),this.previewerType=Tt.BAR_CHART}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=[{name:"A",value:22},{name:"B",value:37}],n=[0,20,40],i=new An({width:t,height:r,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.2}),o=.3,s=.8,c=f["i"]().domain(a.map(e=>e.name)).range([0,i.chartWidth]).padding(o),l=f["j"]().domain([0,f["f"](a,e=>e.value)/s]).range([0,i.chartHeight]),u=e.append("g").classed("chart-group",!0),d=u.append("g").classed("axis-group",!0),p=d.append("g").classed("x-axis-group",!0).attr("transform",`translate(${i.origin.x},${i.origin.y})`);p.selectAll("text").data(a).enter().append("text").classed("chart axis x-axis label",!0).attr("ac-data",e=>JSON.stringify(e)).attr("transform",e=>`translate(${c(e.name)+c.bandwidth()/2},0)`).attr("dy",18).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text((e,t)=>["A","B"][t]),p.append("text").classed("chart axis x-axis title",!0).attr("transform",`translate(${i.chartWidth},0)`).attr("dx",10).attr("dy",5).attr("font-weight","bold").attr("fill","#3d3d3d").text("X"),p.append("line").classed("chart axis x-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",i.chartWidth).attr("y2",0).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const h=d.append("g").classed("y-axis-group",!0).attr("transform",`translate(${i.origin.x},${i.top})`);h.selectAll("line.tick").data(n.slice(1)).enter().append("line").classed("chart axis y-axis tick",!0).attr("transform",e=>`translate(0,${i.chartHeight-l(e)})`).attr("x1",0).attr("y1",0).attr("x2",i.chartWidth).attr("y2",0).attr("stroke","#d9d9d9").attr("stroke-width",4).attr("stroke-linecap","round"),h.selectAll("text").data(n).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(0,${i.chartHeight-l(e)})`).attr("dx",-14).attr("dy",8.5).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),h.append("line").classed("chart axis y-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",i.chartHeight).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round"),h.append("text").classed("chart axis y-axis title",!0).attr("dy",-5).attr("dx",-8).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Y");const g=u.append("g").classed("mark-group",!0).attr("transform",`translate(${i.left},${i.top})`);g.selectAll("rect").data(a).enter().append("rect").classed("chart mark bar",!0).attr("ac-data",e=>JSON.stringify(e)).attr("width",c.bandwidth()).attr("height",e=>l(e.value)).attr("x",e=>c(e.name)).attr("y",e=>i.chartHeight-l(e.value)).attr("fill","#409eff").attr("rx",5).attr("ry",5),g.selectAll("text").data(a).enter().append("text").attr("ac-data",e=>JSON.stringify(e)).classed("chart mark label bar-label",!0).attr("transform",e=>`translate(${c(e.name)+c.bandwidth()/2},${i.chartHeight-l(e.value)})`).attr("dy",-10).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e.value);const m=u.append("g").classed("title-group",!0);m.append("text").classed("chart title main-title",!0).attr("transform",`translate(${i.left+i.chartWidth/2},${i.top})`).attr("dy",-20).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Bar Chart")}}class kn extends bn{constructor(){super(),this.previewerType=Tt.BAR_CHART_WITH_LEGEND}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=[{name:"A",value:22},{name:"B",value:37}],n=[{name:"A",value:30},{name:"B",value:15}],i=[0,20,40],o=new An({width:t,height:r,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.2}),s=.3,c=.8,l=f["i"]().domain(a.map(e=>e.name)).range([0,o.chartWidth]).padding(s),u=f["j"]().domain([0,f["f"](a,e=>e.value)/c]).range([0,o.chartHeight]),d=e.append("g").classed("chart-group",!0),p=d.append("g").classed("axis-group",!0),h=p.append("g").classed("x-axis-group",!0).attr("transform",`translate(${o.origin.x},${o.origin.y})`);h.selectAll("text").data(a).enter().append("text").classed("chart axis x-axis label",!0).attr("ac-data",e=>JSON.stringify(e)).attr("transform",e=>`translate(${l(e.name)+l.bandwidth()/2},0)`).attr("dy",18).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text((e,t)=>["A","B"][t]),h.append("text").classed("chart axis x-axis title",!0).attr("transform",`translate(${o.chartWidth},0)`).attr("dx",10).attr("dy",5).attr("font-weight","bold").attr("fill","#3d3d3d").text("X"),h.append("line").classed("chart axis x-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",o.chartWidth).attr("y2",0).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const g=p.append("g").classed("y-axis-group",!0).attr("transform",`translate(${o.origin.x},${o.top})`);g.selectAll("line.tick").data(i.slice(1)).enter().append("line").classed("chart axis y-axis tick",!0).attr("transform",e=>`translate(0,${o.chartHeight-u(e)})`).attr("x1",0).attr("y1",0).attr("x2",o.chartWidth).attr("y2",0).attr("stroke","#d9d9d9").attr("stroke-width",4).attr("stroke-linecap","round"),g.selectAll("text").data(i).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(0,${o.chartHeight-u(e)})`).attr("dx",-14).attr("dy",8.5).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),g.append("line").classed("chart axis y-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",o.chartHeight).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round"),g.append("text").classed("chart axis y-axis title",!0).attr("dy",-5).attr("dx",-8).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Y");const m=d.append("g").classed("mark-group",!0).attr("transform",`translate(${o.left},${o.top})`),y=m.append("g").classed("mark-1-group",!0);y.selectAll("rect").data(a).enter().append("rect").classed("chart mark bar",!0).attr("ac-data",e=>JSON.stringify(e)).attr("width",l.bandwidth()/2).attr("height",e=>u(e.value)).attr("x",e=>l(e.name)-1).attr("y",e=>o.chartHeight-u(e.value)).attr("fill","#409eff").attr("rx",5).attr("ry",5),y.selectAll("text").data(a).enter().append("text").attr("ac-data",e=>JSON.stringify(e)).classed("chart mark label bar-label",!0).attr("transform",e=>`translate(${l(e.name)+l.bandwidth()/4-3},${o.chartHeight-u(e.value)})`).attr("dy",-4).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e.value);const v=m.append("g").classed("mark-2-group",!0);v.selectAll("rect").data(n).enter().append("rect").classed("chart mark bar",!0).attr("ac-data",e=>JSON.stringify(e)).attr("width",l.bandwidth()/2).attr("height",e=>u(e.value)).attr("x",e=>l(e.name)+l.bandwidth()/2+1).attr("y",e=>o.chartHeight-u(e.value)).attr("fill","#9ecae1").attr("rx",5).attr("ry",5),v.selectAll("text").data(n).enter().append("text").attr("ac-data",e=>JSON.stringify(e)).classed("chart mark label bar-label",!0).attr("transform",e=>`translate(${l(e.name)+.75*l.bandwidth()+1},${o.chartHeight-u(e.value)})`).attr("dy",-4).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e.value);const _=d.append("g").classed("mark-group",!0);_.append("text").classed("chart mark legend",!0).attr("transform",`translate(${t-o.right},${o.top})`).attr("dx",0).attr("dy",8).attr("font-weight","bold").attr("fill","#409eff").text("ta"),_.append("rect").classed("chart mark legend",!0).attr("transform",`translate(${t-o.right},${o.top})`).attr("width",18).attr("height",8).attr("x",20).attr("y",0).attr("fill","#409eff"),_.append("text").classed("chart mark legend",!0).attr("transform",`translate(${t-o.right},${o.top})`).attr("dx",0).attr("dy",26).attr("font-weight","bold").attr("fill","#9ecae1").text("tb"),_.append("rect").classed("chart mark legend",!0).attr("transform",`translate(${t-o.right},${o.top})`).attr("width",18).attr("height",8).attr("x",20).attr("y",18).attr("fill","#9ecae1");const b=d.append("g").classed("title-group",!0);b.append("text").classed("chart title main-title",!0).attr("transform",`translate(${o.left+o.chartWidth/2},${o.top})`).attr("dy",-20).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Bar Chart with Legend")}}class Pn extends bn{constructor(){super(),this.previewerType=Tt.CHART_FRAMEWORK}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=[{name:"A",value:22},{name:"B",value:37}],n=[0,20,40],i=new An({width:t,height:r,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.2}),o=.3,s=.8,c=f["i"]().domain(a.map(e=>e.name)).range([0,i.chartWidth]).padding(o),l=f["j"]().domain([0,f["f"](a,e=>e.value)/s]).range([0,i.chartHeight]),u=e.append("g").classed("chart-group",!0),d=u.append("g").classed("axis-group",!0),p=d.append("g").classed("x-axis-group",!0).attr("transform",`translate(${i.origin.x},${i.origin.y})`);p.selectAll("text").data(a).enter().append("text").classed("chart axis x-axis label",!0).attr("ac-data",e=>JSON.stringify(e)).attr("transform",e=>`translate(${c(e.name)+c.bandwidth()/2},0)`).attr("dy",18).attr("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text((e,t)=>["A","B"][t]),p.append("text").classed("chart axis x-axis title",!0).attr("transform",`translate(${i.chartWidth},0)`).attr("dx",10).attr("dy",5).attr("font-weight","bold").attr("fill","#3d3d3d").text("X"),p.append("line").classed("chart axis x-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",i.chartWidth).attr("y2",0).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const h=d.append("g").classed("y-axis-group",!0).attr("transform",`translate(${i.origin.x},${i.top})`);h.selectAll("line.tick").data(n.slice(1)).enter().append("line").classed("chart axis y-axis tick",!0).attr("transform",e=>`translate(0,${i.chartHeight-l(e)})`).attr("x1",0).attr("y1",0).attr("x2",i.chartWidth).attr("y2",0).attr("stroke","#d9d9d9").attr("stroke-width",4).attr("stroke-linecap","round"),h.selectAll("text").data(n).enter().append("text").classed("chart axis y-axis label",!0).attr("ac-data",e=>e).attr("transform",e=>`translate(0,${i.chartHeight-l(e)})`).attr("dx",-14).attr("dy",8.5).attr("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),h.append("line").classed("chart axis y-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",i.chartHeight).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round"),h.append("text").classed("chart axis y-axis title",!0).attr("dy",-5).attr("dx",-8).attr("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Y");const g=u.append("g").classed("title-group",!0);g.append("text").classed("chart title main-title",!0).attr("transform",`translate(${i.left+i.chartWidth/2},${i.top})`).attr("dy",-20).attr("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Chart Title")}}class Rn extends bn{constructor(){super(),this.previewerType=Tt.CIRCLE_CHART}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=[[22,11],[16,39],[22,20],[5,5],[29,39],[30,20],[10,18]],n=[0,15,30],i=[20,40],o=new An({width:t,height:r,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.2}),s=.8,c=.8,l=f["j"]().domain([0,f["f"](a,e=>e[0])/s]).range([0,o.chartWidth]),u=f["j"]().domain([0,f["f"](a,e=>e[1])/c]).range([0,o.chartHeight]),d=e.append("g").classed("chart-group",!0),p=d.append("g").classed("axis-group",!0),h=p.append("g").classed("x-axis-group",!0).attr("transform",`translate(${o.origin.x},${o.origin.y})`);h.selectAll("text").data(n).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(${l(e)},0)`).attr("dx",0).attr("dy",17).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),h.append("text").classed("chart axis x-axis title",!0).attr("transform",`translate(${o.chartWidth},0)`).attr("dx",10).attr("dy",5).attr("font-weight","bold").attr("fill","#3d3d3d").text("X"),h.append("line").classed("chart axis x-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",o.chartWidth).attr("y2",0).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const g=p.append("g").classed("y-axis-group",!0).attr("transform",`translate(${o.origin.x},${o.top})`);g.selectAll("text").data(i).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(0,${o.chartHeight-u(e)})`).attr("dx",-14).attr("dy",0).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),g.append("line").classed("chart axis y-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",o.chartHeight).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round"),g.append("text").classed("chart axis y-axis title",!0).attr("dy",-10).attr("dx",-5).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Y");const m=d.append("g").classed("mark-group",!0).attr("transform",`translate(${o.left},${o.top})`);m.selectAll("circle").data(a).enter().append("circle").classed("chart mark circle",!0).attr("cx",e=>l(e[0])).attr("cy",e=>o.chartHeight-u(e[1])).attr("r",5).attr("fill","#409eff");const y=d.append("g").classed("title-group",!0);y.append("text").classed("chart title main-title",!0).attr("transform",`translate(${o.left+o.chartWidth/2},${o.top})`).attr("dy",-20).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Scatter Chart")}}class En extends bn{constructor(){super(),this.previewerType=Tt.CIRCLE_CHART_WITH_LEGEND}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=[[22,11],[16,39],[22,20],[5,5],[29,39],[30,20],[10,18]],n=[[29,39],[30,20],[10,18]],i=[[22,11],[16,39],[22,20],[5,5]],o=[0,15,30],s=[20,40],c=new An({width:t,height:r,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.35}),l=.8,u=.8,d=f["j"]().domain([0,f["f"](a,e=>e[0])/l]).range([0,c.chartWidth]),p=f["j"]().domain([0,f["f"](a,e=>e[1])/u]).range([0,c.chartHeight]),h=e.append("g").classed("chart-group",!0),g=h.append("g").classed("mark-group",!0);g.append("text").classed("chart mark legend",!0).attr("transform",`translate(${t-c.right},${c.top})`).attr("dx",0).attr("dy",8).attr("font-weight","bold").attr("fill","#409eff").text("ta"),g.append("rect").classed("chart mark legend",!0).attr("transform",`translate(${t-c.right},${c.top})`).attr("width",18).attr("height",8).attr("x",20).attr("y",0).attr("fill","#409eff"),g.append("text").classed("chart mark legend",!0).attr("transform",`translate(${t-c.right},${c.top})`).attr("dx",0).attr("dy",26).attr("font-weight","bold").attr("fill","#9ecae1").text("tb"),g.append("rect").classed("chart mark legend",!0).attr("transform",`translate(${t-c.right},${c.top})`).attr("width",18).attr("height",8).attr("x",20).attr("y",18).attr("fill","#9ecae1");const m=h.append("g").classed("axis-group",!0),y=m.append("g").classed("x-axis-group",!0).attr("transform",`translate(${c.origin.x},${c.origin.y})`);y.selectAll("text").data(o).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(${d(e)},0)`).attr("dx",0).attr("dy",17).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),y.append("text").classed("chart axis x-axis title",!0).attr("transform",`translate(${c.chartWidth},0)`).attr("dx",10).attr("dy",5).attr("font-weight","bold").attr("fill","#3d3d3d").text("X"),y.append("line").classed("chart axis x-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",c.chartWidth).attr("y2",0).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const v=m.append("g").classed("y-axis-group",!0).attr("transform",`translate(${c.origin.x},${c.top})`);v.selectAll("text").data(s).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(0,${c.chartHeight-p(e)})`).attr("dx",-14).attr("dy",0).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),v.append("line").classed("chart axis y-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",c.chartHeight).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round"),v.append("text").classed("chart axis y-axis title",!0).attr("dy",-10).attr("dx",-5).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Y");const _=h.append("g").classed("mark-group",!0),b=_.append("g").classed("x-axis-group",!0).attr("transform",`translate(${c.left},${c.top})`);b.selectAll("circle").data(n).enter().append("circle").classed("chart mark circle",!0).attr("cx",e=>d(e[0])).attr("cy",e=>c.chartHeight-p(e[1])).attr("r",5).attr("fill","#409eff");const T=_.append("g").classed("x-axis-group",!0).attr("transform",`translate(${c.left},${c.top})`);T.selectAll("circle").data(i).enter().append("circle").classed("chart mark circle",!0).attr("cx",e=>d(e[0])).attr("cy",e=>c.chartHeight-p(e[1])).attr("r",5).attr("fill","#9ecae1");const w=h.append("g").classed("title-group",!0);w.append("text").classed("chart title main-title",!0).attr("transform",`translate(${c.left+c.chartWidth/2},${c.top})`).attr("dy",-30).attr("dx",5).attr("font-size",13).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Scatter Chart with Legend")}}class On extends bn{constructor(){super(),this.previewerType=Tt.PIE_CHART}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=[20,25,55],n=55,i=20,o=f["g"]()(a),s=["#409eff","#9ecae1","#2171b5"],c=f["k"](s),l=["first","second","third"],u=f["a"]().innerRadius(i).outerRadius(n).padAngle(.02),d=e.append("g").classed("chart-group",!0),p=d.append("g").classed("mark-group",!0);p.selectAll("path").data(o).enter().append("path").each((function(e,t){f["n"](this).classed("chart mark sector sector-wheel "+l[t],!0)})).attr("transform","translate("+t/2+","+(r/2+10)+")").attr("fill",(e,t)=>c(t)).attr("d",e=>u(e));const h=d.append("g").classed("label-group",!0);h.selectAll("text").data(o).enter().append("text").each((function(e,t){f["n"](this).classed("cchart label sector-label "+l[t],!0)})).attr("transform",e=>"translate("+u.centroid(e)+")").attr("dx",100).attr("dy",90).attr("fill","white").attr("text-anchor","middle").text(e=>e.data+"%")}}class In extends bn{constructor(){super(),this.previewerType=Tt.PIE_WITH_LEGEND}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=[20,25,55],n=55,i=20,o=new An({width:t,height:r,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.35}),s=f["g"]()(a),c=["#409eff","#9ecae1","#2171b5"],l=f["k"](c),u=f["a"]().innerRadius(i).outerRadius(n).padAngle(.02),d=["first","second","third"],p=e.append("g").classed("chart-group",!0),h=p.append("g").classed("mark-group",!0),g=p.append("g").classed("label-group",!0),m=p.append("g").classed("mark-group",!0);for(var y=0;y<a.length;y++)h.append("path").classed("chart mark sector sector-wheel "+d[y],!0).attr("transform","translate("+(t/2-20)+","+(r/2+10)+")").attr("fill",l(y)).attr("d",u(s[y])),g.append("text").classed("chart mark arc-label "+d[y],!0).attr("transform","translate("+u.centroid(s[y])+")").attr("dx",80).attr("dy",90).attr("fill","white").attr("text-anchor","middle").text(s[y].data+"%"),m.append("text").classed("chart mark legend legend-label "+d[y],!0).attr("transform",`translate(${t-40},${o.top})`).attr("dx",0).attr("dy",13*(y+1)-4).attr("font-weight","bold").attr("fill",l(y)).text("ta"),m.append("rect").classed("chart mark legend legend-symbol "+d[y],!0).attr("transform",`translate(${t-40},${o.top})`).attr("width",18).attr("height",8).attr("x",20).attr("y",13*y).attr("fill",l(y))}}class Nn extends bn{constructor(){super(),this.previewerType=Tt.TEXT}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=e.append("g").classed("chart-group",!0),n=a.append("g").classed("annotation-group",!0);n.append("text").classed("annotation label number",!0).attr("transform","translate("+t/2+","+(r/2+10)+")").attr("dy",0).attr("dx",0).attr("font-size",35).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("66%")}}class Mn extends bn{constructor(){super(),this.previewerType=Tt.TITLE}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=e.append("g").classed("chart-group",!0),n=a.append("g").classed("title-group",!0);n.append("text").classed("chart title main-title",!0).attr("transform","translate("+t/3+","+r/3+")").attr("dy",0).attr("dx",0).attr("font-size",25).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("main title"),n.append("text").classed("chart title sub-title",!0).attr("transform","translate("+t/2+","+(r/2+10)+")").attr("dy",0).attr("dx",0).attr("font-size",20).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("—— sub title")}}class Ln extends bn{constructor(){super(),this.previewerType=Tt.LINE_CHART}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=[[5,15],[15,18],[22,20],[29,39]],n=[0,15,30],i=[20,40],o=new An({width:t,height:r,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.2}),s=.8,c=.8,l=f["j"]().domain([0,f["f"](a,e=>e[0])/s]).range([0,o.chartWidth]),u=f["j"]().domain([0,f["f"](a,e=>e[1])/c]).range([0,o.chartHeight]),d=e.append("g").classed("chart-group",!0),p=d.append("g").classed("axis-group",!0),h=p.append("g").classed("x-axis-group",!0).attr("transform",`translate(${o.origin.x},${o.origin.y})`);h.selectAll("text").data(n).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(${l(e)},0)`).attr("dx",0).attr("dy",17).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),h.append("text").classed("chart axis x-axis title",!0).attr("transform",`translate(${o.chartWidth},0)`).attr("dx",10).attr("dy",5).attr("font-weight","bold").attr("fill","#3d3d3d").text("X"),h.append("line").classed("chart axis x-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",o.chartWidth).attr("y2",0).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const g=p.append("g").classed("y-axis-group",!0).attr("transform",`translate(${o.origin.x},${o.top})`);g.selectAll("text").data(i).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(0,${o.chartHeight-u(e)})`).attr("dx",-14).attr("dy",0).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),g.append("line").classed("chart axis y-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",o.chartHeight).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round"),g.append("text").classed("chart axis y-axis title",!0).attr("dy",-10).attr("dx",-5).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Y");const m=d.append("g").classed("mark-group",!0),y=m.append("g").classed("label-group",!0).attr("transform",`translate(${o.left},${o.top})`);y.selectAll("text").data(a).enter().append("text").classed("chart mark label",!0).attr("dx",e=>l(e[0])).attr("dy",e=>o.chartHeight-u(e[1])-15).style("text-anchor","middle").attr("fill","#3d3d3d").text(e=>e[1]);const v=m.append("g").classed("mark-group",!0).attr("transform",`translate(${o.left},${o.top})`);v.selectAll("circle").data(a).enter().append("circle").classed("chart mark circle",!0).attr("cx",e=>l(e[0])).attr("cy",e=>o.chartHeight-u(e[1])).attr("r",5).attr("fill","#409eff");const _=m.append("g").classed("line-group",!0);for(var b=0;b<a.length;b++)a[b][0]=l(a[b][0]),a[b][1]=o.chartHeight-u(a[b][1]);_.append("polyline").classed("chart mark line",!0).attr("transform",`translate(${o.left},${o.top})`).attr("points",a).attr("fill","none").attr("stroke","#409eff").attr("stroke-width",4).attr("stroke-linecap","round");const T=d.append("g").classed("title-group",!0);T.append("text").classed("chart title main-title",!0).attr("transform",`translate(${o.left+o.chartWidth/2},${o.top})`).attr("dy",-20).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Line Chart")}}class jn extends bn{constructor(){super(),this.previewerType=Tt.LINE_CHART_WITH_LEGEND}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=[[5,15],[15,18],[22,20],[29,39]],n=[[5,26],[15,28],[22,36],[29,10]],i=[0,15,30],o=[20,40],s=new An({width:t,height:r,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.2}),c=.8,l=.8,u=f["j"]().domain([0,f["f"](a,e=>e[0])/c]).range([0,s.chartWidth]),d=f["j"]().domain([0,f["f"](a,e=>e[1])/l]).range([0,s.chartHeight]),p=e.append("g").classed("chart-group",!0),h=p.append("g").classed("axis-group",!0),g=h.append("g").classed("x-axis-group",!0).attr("transform",`translate(${s.origin.x},${s.origin.y})`);g.selectAll("text").data(i).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(${u(e)},0)`).attr("dx",0).attr("dy",17).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),g.append("text").classed("chart axis x-axis title",!0).attr("transform",`translate(${s.chartWidth},0)`).attr("dx",10).attr("dy",5).attr("font-weight","bold").attr("fill","#3d3d3d").text("X"),g.append("line").classed("chart axis x-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",s.chartWidth).attr("y2",0).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const m=h.append("g").classed("y-axis-group",!0).attr("transform",`translate(${s.origin.x},${s.top})`);m.selectAll("text").data(o).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(0,${s.chartHeight-d(e)})`).attr("dx",-14).attr("dy",0).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),m.append("line").classed("chart axis y-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",s.chartHeight).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round"),m.append("text").classed("chart axis y-axis title",!0).attr("dy",-3).attr("dx",-5).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Y");const y=p.append("g").classed("mark-group",!0);y.append("text").classed("chart mark legend",!0).attr("transform",`translate(${t-s.right},${s.top})`).attr("dx",0).attr("dy",8).attr("font-weight","bold").attr("fill","#409eff").text("ta"),y.append("rect").classed("chart mark legend",!0).attr("transform",`translate(${t-s.right},${s.top})`).attr("width",18).attr("height",8).attr("x",20).attr("y",0).attr("fill","#409eff"),y.append("text").classed("chart mark legend",!0).attr("transform",`translate(${t-s.right},${s.top})`).attr("dx",0).attr("dy",26).attr("font-weight","bold").attr("fill","#9ecae1").text("tb"),y.append("rect").classed("chart mark legend",!0).attr("transform",`translate(${t-s.right},${s.top})`).attr("width",18).attr("height",8).attr("x",20).attr("y",18).attr("fill","#9ecae1");const v=p.append("g").classed("mark-group",!0),_=v.append("g").classed("mark-group",!0).attr("transform",`translate(${s.left},${s.top})`),b=_.append("g").classed("scatter1-group",!0);b.selectAll("circle").data(a).enter().append("circle").classed("chart mark circle",!0).attr("cx",e=>u(e[0])).attr("cy",e=>s.chartHeight-d(e[1])).attr("r",5).attr("fill","#409eff");const T=_.append("g").classed("scatter2-group",!0);T.selectAll("circle").data(n).enter().append("circle").classed("chart mark circle",!0).attr("cx",e=>u(e[0])).attr("cy",e=>s.chartHeight-d(e[1])).attr("r",5).attr("fill","#9ecae1");for(var w=0;w<a.length;w++)a[w][0]=u(a[w][0]),a[w][1]=s.chartHeight-d(a[w][1]);for(w=0;w<n.length;w++)n[w][0]=u(n[w][0]),n[w][1]=s.chartHeight-d(n[w][1]);const S=v.append("g").classed("line-group",!0),x=S.append("g").classed("line1-group",!0);x.append("polyline").classed("chart mark line first",!0).attr("transform",`translate(${s.left},${s.top})`).attr("points",a).attr("fill","none").attr("stroke","#409eff").attr("stroke-width",4).attr("stroke-linecap","round");const C=S.append("g").classed("line2-group",!0);C.append("polyline").classed("chart mark line second",!0).attr("transform",`translate(${s.left},${s.top})`).attr("points",n).attr("fill","none").attr("stroke","#9ecae1").attr("stroke-width",4).attr("stroke-linecap","round");const A=p.append("g").classed("title-group",!0);A.append("text").classed("chart title main-title",!0).attr("transform",`translate(${s.left+s.chartWidth/2},${s.top})`).attr("dy",-20).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Line Chart with Legend")}}class Bn extends bn{constructor(){super(),this.previewerType=Tt.PATH}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=[[5,10],[40,10],[40,35],[5,35],[5,10]],n=new An({width:t,height:r,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.2}),i=.8,o=.8,s=f["j"]().domain([0,f["f"](a,e=>e[0])/i]).range([0,n.chartWidth]),c=f["j"]().domain([0,f["f"](a,e=>e[1])/o]).range([0,n.chartHeight]),l=e.append("g").classed("chart-group",!0),u=l.append("g").classed("annotation-group",!0);for(var d=0;d<a.length;d++)a[d][0]=s(a[d][0]),a[d][1]=n.chartHeight-c(a[d][1]);u.append("polyline").classed("chart annotation path",!0).attr("transform",`translate(${n.left},${n.top})`).attr("points",a).attr("fill","none").attr("stroke","#409eff").attr("stroke-width",4).attr("stroke-linecap","round")}}class Zn extends bn{constructor(){super(),this.previewerType=Tt.HIGHLIGHT}draw(){const e=this.previewerContext.rootSel,{width:t,height:r}=this.getCanvasSize(),a=25,n=5,i=[70,70,70],o=i.length*a+(i.length+3)*n,s=(t-o)/2,c=(r+Math.max(...i))/2,l=["first","second","third","forth"],u=e.append("g").classed("chart group",!0),d=u.append("g").classed("mark group",!0);d.selectAll(".bar.glyph").data(i).enter().append("rect").each((function(e,t){f["n"](this).classed("bar glyph "+l[t],!0)})).attr("width",a).attr("height",e=>e).attr("x",(e,t)=>s+(t+2)*n+t*a).attr("y",e=>c-e).attr("fill","#409eff").attr("rx",5).attr("ry",5),u.append("rect").attr("width",a).attr("height",70).attr("x",s+5*n+3*a).attr("y",c-70).attr("fill","#409eff").attr("rx",5).attr("ry",5),u.append("line").classed("line axis domain",!0).attr("x1",s).attr("y1",c).attr("x2",s+o).attr("y2",c).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round")}}const Dn=[new Tn,new wn,new Sn,new xn,new Cn,new $n,new kn,new Pn,new Rn,new En,new On,new In,new Nn,new Mn,new Ln,new jn,new Bn,new Zn];function Gn(e,t){null!=e&&Un(e,t)}function Un(e,t){if(null==e||"object"!==typeof e)return!1;for(let r of Object.keys(e)){const a=e[r];let n=t(r,a,e);if(n)return!0;Un(a,t)}return!1}const Fn={traversalObject:Gn};function zn(e){this.message=e}class Vn{constructor(){Object(Ge["a"])(this,"parser",void 0),Object(Ge["a"])(this,"generator",void 0),Object(Ge["a"])(this,"templateLib",void 0),Object(Ge["a"])(this,"previewerManager",void 0),this.parser=new ht,this.templateLib=new bt,_a.forEach(e=>this.templateLib.registerBuildInTemplate(e)),this.previewerManager=new xt(this.templateLib),_n.forEach(e=>this.previewerManager.registerPreviewWrapper(e)),Dn.forEach(e=>this.previewerManager.registerPreviewer(e))}compile(e,t,r={}){console.log("animationJSON",t),null!=t.variable&&null!=t.sequence&&(t=this.createReplacedAnimationJSON(t,t.variable)),Fn.traversalObject(t,(e,t,r)=>{t&&null!=t.variable&&null!=t.sequence&&(r[e]=this.createReplacedAnimationJSON(t,t.variable))});const a=tt.fromJSON(t);if(!a)throw new zn("No Animation!");const n=f["n"](e);this.generator=new _t,this.generator.init(n,this.templateLib,a),n.selectAll("*").each((function(){this._original={},"function"===typeof this.getCTM&&(this._original.CTM=this.getCTM())}));const i=this.generator.generate(),o=qe["a"].timeline({autoRemoveChildren:!1,...r});return o.add(i),o.pause(),o}computePossibleElements(e,t){const r=f["n"](e).node(),a=f["n"](r.cloneNode(!0));return this.generator=new _t,this.generator.init(a,this.templateLib,null),this.generator.computePossibleElements(t)}computeDuration(e,t,r){null!=r&&(t=this.createReplacedAnimationJSON(t,r));const a=tt.fromJSON(t),n=f["n"](e).node(),i=f["n"](n.cloneNode(!0));return this.generator=new _t,this.generator.init(i,this.templateLib,a),this.generator.computeDuration()||1}createReplacedAnimationJSON(e,t){const r=ot.deepCopy(e);return ot.traversalObject(r,(e,r,a)=>{if("string"===typeof r&&r.includes("$"))if(r=r.trim(),r.match(/^\$[0-9a-zA-Z]*$/)){const n=r.substr(1);n in t&&(a[e]=t[n])}else{let n=r;Object.keys(t).forEach(e=>{n=n.replaceAll("$"+e,t[e])}),a[e]=n}}),console.log("animationJSON",r),r}}const Hn={GENERAL:"General",MARK:"Mark",ANNOTATION:"Annotation",CHART:"Chart"};class Wn{constructor(e,t,r,a,n,i){Object(Ge["a"])(this,"name",void 0),Object(Ge["a"])(this,"hardElement",void 0),Object(Ge["a"])(this,"softElement",void 0),Object(Ge["a"])(this,"componentType",void 0),Object(Ge["a"])(this,"animationType",void 0),Object(Ge["a"])(this,"effectList",void 0),this.name=e,this.hardElement=t,this.softElement=r,this.componentType=a,this.animationType=n,this.effectList=i}clone(){return new Wn(this.name,this.hardElement,this.softElement,this.componentType,this.animationType,this.effectList)}getName(){return this.name}getHardElement(){return this.hardElement}getSoftElement(){return this.softElement}getComponentType(){return this.componentType}getAnimationType(){return this.animationType}getEffectList(){return this.effectList}relatedTargets(e){const t=[];return e.forEach(e=>{const r=e.classList;(this.hardElement.some(e=>r.includes(e))||this.softElement.some(e=>r.includes(e)))&&t.push(e)}),t}hasLabel(e){const t=e.classList;return t.includes("x-label")||t.includes("y-label")||t.includes("sector-label")||t.includes("legend-label")}isWanted(e,t){const r=e.classList;let a=[];return t.forEach(e=>{const t=e.split(" | ");a=a.concat(t)}),a.some(t=>"label"===t?this.hasLabel(e):r.includes(t))}shouldAppear(e){return 0===this.hardElement.length&&0===this.softElement.length||!!this.hardElement.every(t=>{const r=t.split(" | "),a=r.length;if(1===a)return"label"===t?e.some(e=>this.hasLabel(e)):e.some(e=>e.classList.includes(t));{let t=!1;return r.forEach(r=>{"label"===r?t||(t=e.some(e=>this.hasLabel(e))):t||(t=e.some(e=>e.classList.includes(r)))}),t}})&&e.every(e=>this.isWanted(e,this.hardElement)||this.isWanted(e,this.softElement))}}const Kn=new Wn("Bar with axis label",["bar","axis symbol | x-symbol | y-symbol"],["bar-label"],Hn.MARK,wt.ENTER,["grow bar and zoom label"]),qn=new Wn("Bar with legend",["bar","legend"],["bar-label"],Hn.MARK,wt.ENTER,["grow bar and fade in legend"]),Jn=new Wn("Line-wipe",["line"],["scatter","label","point"],Hn.MARK,wt.ENTER,["wipe line"]),Yn=new Wn("Lines by legend",["line","legend"],["scatter","label","point"],Hn.MARK,wt.ENTER,["wipe line and fade in legend"]),Xn=new Wn("Lines by order",["line","legend"],["scatter","label","point"],Hn.MARK,wt.ENTER,["wipe line and fade in legend"]),Qn=new Wn("Scatter chart",["scatter | point","axis"],["title","label"],Hn.MARK,wt.ENTER,["fade in scatter and axis"]),ei=new Wn("Scatter-fade in",["scatter | point"],["label"],Hn.MARK,wt.ENTER,["fade in scatter"]),ti=new Wn("Scatter with legend",["scatter | point","legend"],["label"],Hn.MARK,wt.ENTER,["fade in legend and scatter"]),ri=new Wn("Bar-grow",["bar"],["bar-label"],Hn.MARK,wt.ENTER,["grow bar"]),ai=new Wn("Bar-bounce",["bar"],["bar-label"],Hn.MARK,wt.HIGHLIGHT,["move to bar"]),ni=new Wn("Pie-wheel",["arc | sector | pie"],["sector-label","label","sector-line","anno-label"],Hn.MARK,wt.ENTER,["fade in pie"]),ii=new Wn("Pie with legend",["arc | sector | pie","legend"],["sector-label","label","sector-line","anno-label"],Hn.MARK,wt.ENTER,["fade in pie and fly in legend"]),oi=new Wn("Highlight-sector",["arc | sector | pie"],["sector-label","label","sector-line","anno-label"],Hn.MARK,wt.HIGHLIGHT,["fade in pie"]),si=new Wn("Line-highlight",["line"],[],Hn.MARK,wt.HIGHLIGHT,["highlight line"]),ci=new Wn("Fade-in",[],[],Hn.GENERAL,wt.ENTER,["fade in"]),li=new Wn("Grow",[],[],Hn.GENERAL,wt.ENTER,["grow"]),ui=new Wn("Float",[],[],Hn.GENERAL,wt.ENTER,["float"]),di=new Wn("Zoom-enter",[],[],Hn.GENERAL,wt.ENTER,["zoom"]),pi=new Wn("Change-color",[],[],Hn.GENERAL,wt.HIGHLIGHT,["change color"]),hi=new Wn("Show-path",["annotation"],[],Hn.ANNOTATION,wt.HIGHLIGHT,["show path"]),fi=new Wn("Highlight",[],[],Hn.GENERAL,wt.HIGHLIGHT,["highlight"]),gi=new Wn("Camera-zoom",[],[],Hn.GENERAL,wt.HIGHLIGHT,["camera zoom"]),mi=new Wn("Camera-move",[],[],Hn.GENERAL,wt.HIGHLIGHT,["camera move"]),yi=new Wn("Move-to",[],[],Hn.GENERAL,wt.ENTER,["move to"]),vi=new Wn("Move-from",[],[],Hn.GENERAL,wt.ENTER,["move from"]),_i=new Wn("Zoom-exit",[],[],Hn.GENERAL,wt.EXIT,["zoom exit"]),bi=new Wn("Fade-out",[],[],Hn.GENERAL,wt.EXIT,["fade out"]),Ti=new Wn("Fly-in",[],[],Hn.GENERAL,wt.ENTER,["Fly-in"]),wi=new Wn("Zoom-in-then-zoom-out",[],[],Hn.ANNOTATION,wt.HIGHLIGHT,["zoom-in-then-zoom-out"]),Si=new Wn("Show-arrow-label",["annotation","arrow"],[],Hn.ANNOTATION,wt.HIGHLIGHT,["fade in then fade out annotation"]),xi=new Wn("Fade-in-then-fade-out",[],[],Hn.ANNOTATION,wt.HIGHLIGHT,["fade in then fade out"]),Ci=new Wn("Dynamic-number",["annotation"],[],Hn.ANNOTATION,wt.HIGHLIGHT,["dynamtic number"]),Ai=new Wn("Title",["title"],["subtitle"],Hn.CHART,wt.ENTER,["fade in title"]),$i=new Wn("Axes float in",["axis"],["title"],Hn.CHART,wt.ENTER,["float in axis"]),ki=new Wn("Axes fade in",["axis"],["title"],Hn.CHART,wt.ENTER,["fade in axis"]),Pi=new Wn("Bar chart",["bar","axis"],["title","bar-label"],Hn.CHART,wt.ENTER,["grow bar and fade in axis"]),Ri=new Wn("Bar chart with legend",["bar","axis","legend"],["title","bar-label"],Hn.CHART,wt.ENTER,["grow bar and fade in axis and legend"]),Ei=new Wn("Scatter chart with legend",["scatter | point","legend","axis"],["title","label"],Hn.CHART,wt.ENTER,["fade in scatter and axis"]),Oi=new Wn("Line chart",["line","axis"],["scatter","title","label","point"],Hn.CHART,wt.ENTER,["wipe line and fade in axis"]),Ii=new Wn("Line chart by legend",["line","axis"],["scatter","title","legend","label","point"],Hn.CHART,wt.ENTER,["wipe line and fade in axis"]),Ni=new Wn("Line chart by order",["line","axis"],["scatter","title","legend","label","point"],Hn.CHART,wt.ENTER,["wipe line and fade in axis"]),Mi=[Ai,$i,ki,ri,ai,Kn,Pi,qn,Ri,Jn,Oi,si,Yn,Xn,Ii,Ni,ei,Qn,ti,Ei,ni,oi,ii,Si,hi,Ci,wi,xi,pi,fi,ci,li,ui,Ti,di,yi,vi,gi,mi,_i,bi],Li=new Vn;function ji(e,t,r){return Li.compile(e,t,r)}function Bi(){return Li.previewerManager}function Zi(e){return Li.templateLib.getTemplate(e)}function Di(){Li.templateLib.reset()}function Gi(...e){e.forEach(e=>{const t=dt.fromJSON(e);Li.templateLib.registerTemplates(t)})}function Ui(e){const t=Bi().getDefaultWrapper(e);return t?t.templateLabels[0]:"custom"}function Fi(){const e=[];return Li.templateLib.getAllBuildInTemplates().forEach(t=>{e.push({templateName:t.templateName,isBuildIn:!0})}),Li.templateLib.getAllCustomTemplate().forEach(t=>{e.push({templateName:t.templateName,isBuildIn:!1})}),e}function zi(e,t,r){return Li.computeDuration(e,t,r)}function Vi(e,t){return Li.computePossibleElements(e,t)}const Hi={compiler:Li,buildInWrappers:_n,buildInPreviewers:Dn,buildInFilters:Mi,render:ji,getPreviewerManager:Bi,getTemplate:Zi,getTemplateInfoList:Fi,resetTemplateLib:Di,registerTemplates:Gi,getTemplateClass:Ui,computeDuration:zi,computePossibleElements:Vi};var Wi={name:"ExportSVGContainer",data(){return{svg:null,scene:null,framerate:24,width:0,height:0,timeline:null,totalTime:0,curTime:0,svgList:[]}},methods:{exportVideo(){this.loadSVG(),this.$nextTick(()=>{this.collectFrames()})},loadSVG(){this.scene.innerHTML=this.svgStr,this.scene._gsap=null,this.scene.removeAttribute("transform");const e=this.scene.querySelector("svg");this.width=e.getAttribute("width"),this.height=e.getAttribute("height")},collectFrames(){this.timeline=Hi.render(this.scene,this.animationJSON,{}),this.$nextTick(()=>{this.startCollect()})},startCollect(){console.log("start collect"),this.totalTime=this.timeline.totalDuration(),console.log("total duration",this.totalTime),this.timeline.progress(0),this.curTime=0,this.svgList=[],this.$nextTick(this.collectCurrentFrame)},collectCurrentFrame(){const e=this.$el.innerHTML;this.svgList.push(e),this.$nextTick(this.moveToNext)},moveToNext(){this.curTime>this.totalTime?this.$nextTick(this.convertFramesToVideo):(this.timeline.progress(this.curTime/this.totalTime),this.curTime+=1/this.framerate,this.$nextTick(this.collectCurrentFrame))},convertFramesToVideo(){const e=this.scene.querySelector("svg");let t=parseInt(e.getAttribute("width")),r=parseInt(e.getAttribute("height"));const a=540,n=360,i=t>a?a/t:1,o=r>n?n/r:1,s=Math.min(i,o);t=Math.floor(t*s),r=Math.floor(r*s),t+=1&t,r+=1&r,console.log("export",{svgList:this.svgList,audioBuffer:this.audioBuffer,width:t,height:r}),this.$store.commit("editor/setIsExportingFiles",!0);const c=()=>{let e,a,n;try{let i=Le(this.svgList,this.audioBuffer,t,r,this.framerate);e=i.result,a=i.code,n=i.message}catch(i){console.error(i)}console.log("create finished"),0===a?(this.$notify({type:"success",title:"Generate MP4 file successfully"}),De(e,"output.mp4")):this.$notify({type:"error",title:"Fail to generate MP4 file",message:"Message returned: "+n}),this.$store.commit("editor/setIsExportingFiles",!1)};setTimeout(c,1e3)}},mounted(){this.svg=this.$refs.svg,this.scene=this.svg.querySelector(".scene")},watch:{exportSign(){this.exportVideo()}},computed:{...Object(x["c"])("editor",{exportSign:e=>e.exportSign,svgStr:e=>{var t,r;return null!==(t=null===(r=e.scene)||void 0===r?void 0:r.svgStr)&&void 0!==t?t:""},animationJSON:e=>e.animationJSON,audioBuffer:e=>e.audioBuffer})}},Ki=Wi,qi=(r("4267"),Object(l["a"])(Ki,Re,Ee,!1,null,"47eb8106",null)),Ji=qi.exports,Yi={name:"EditorView",components:{ExportSVGContainer:Ji,DebugPanel:me,SVGContainer:X,ControlPanel:H,AniSVGContainer:ne,ProjSelectionPanel:Pe},data(){return{asideWidth:590,asideWidthArray:[210,400,590,780,970],asideWidthScale:null,asideWidthCache:null,showCode:!0,debugPanelHeight:0,activeSidePanel:"",headerHeight:50,footerRatio:.25,footerHeight:0,svgUrl:"",targetDisabled:!1,projSelPanelVisible:!1}},mounted(){let e=0;try{var t;e=parseInt(null!==(t=this.$route.query["example-index"])&&void 0!==t?t:""+e)}catch(n){console.error("Failed to parse example index"),console.log(n)}this.$store.commit("resource/changeProjectId",this.projectList[e].id),this.$store.commit("editor/mountAudioElement",this.$refs.audioEl),this.initAsideWidthScale(),this.setupLeftResizer(),this.setupLeftMiddleResizer();const r=this.$el.querySelector(".left-aside-container");this.debugPanelHeight=r.getBoundingClientRect().height-44,this.$store.commit("editor/changeWindowSize"),this.$store.commit("editor/mountMainContainer",this.$refs.mainContainer);let a=Date.now();window.onresize=()=>{Date.now()-a>100&&(this.$store.commit("editor/changeWindowSize"),a=Date.now())},this.footerHeight=this.footerRatio*this.windowHeight,this.$store.commit("editor/changeHeaderHeight",this.headerHeight),this.$store.commit("editor/changeFooterHeight",this.footerHeight),this.$store.commit("editor/changeLeftPanelWidth",this.asideWidth)},methods:{saveSpec(){this.$store.commit("editor/saveSpec")},clickHeaderText(){this.$router.push("homepage")},openProjSelPanel(){this.projSelPanelVisible=!0},closeProjSelPanel(){this.projSelPanelVisible=!1},exportClick(){this.$store.commit("editor/changeExportSign")},isRenewedOption(e){return this.renewedOptions.has(e)},disableTargetButton(){this.targetDisabled=!0},enableTargetButton(){this.targetDisabled=!1},initAsideWidthScale(){let e=[];for(let t=0;t<this.asideWidthArray.length-1;++t)e.push((this.asideWidthArray[t]+this.asideWidthArray[t+1])/2);this.asideWidthScale=f["l"]().domain(e).range(this.asideWidthArray)},getTTSResult(){this.$store.dispatch("resource/queryTTSAudioGoogle",{el:this})},setupLeftResizer(){const e=this,t=document.getElementById("resize-left");let r=!1,a=!1;t.onmouseenter=function(){r=!0,t.style.background="rgba(33,150,243,0.67)"},t.onmouseleave=function(){r=!1,a||(t.style.background="")},t.onmousedown=function(){return a=!0,document.onmousemove=function(t){const r=t.clientX;e.asideWidth=e.asideWidthScale(r),e.$store.commit("editor/changeLeftPanelWidth",e.asideWidth)},document.onmouseup=function(){a=!1,document.onmousemove=null,document.onmouseup=null,r||(t.style.background="")},!1}},setupLeftMiddleResizer(){const e=this,t=document.getElementById("resize-left-middle");if(!t)return;let r=!1,a=!1;t.onmouseenter=function(){r=!0,t.style.background="rgba(33,150,243,0.67)"},t.onmouseleave=function(){r=!1,a||(t.style.background="")},t.onmousedown=function(){a=!0;const n=document.getElementsByClassName("content-container")[0].getBoundingClientRect();return document.onmousemove=function(t){e.topPercentage=(t.clientY-n.top)/n.height*100,console.log(n,e.topPercentage)},document.onmouseup=function(){a=!1,document.onmousemove=null,document.onmouseup=null,r||(t.style.background="")},!1}},bottomResizerMousedown(){const e=this;let t=Date.now()-100;document.onmousemove=function(r){if(Date.now()-t<100)return;t=Date.now();const a=r.clientY;let n=(e.windowHeight-a)/e.windowHeight;n=Math.max(.1,n),n=Math.min(.8,n),e.footerRatio=n,document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}}},changeDebugPanelStatus(){if(this.showCode=!this.showCode,this.showCode){const e=this.$el.querySelector(".left-aside-container");this.debugPanelHeight=e.getBoundingClientRect().height-44}},changeRightPanel(e){this.activeSidePanel===e?this.activeSidePanel="":this.activeSidePanel=e},undo(){},redo(){},exitEditor(){this.$store.commit("editor/stashScene"),this.$router.push("system")},clearSelection(){},clickLeftCollapseButton(){this.changeDebugPanelStatus(),null===this.asideWidthCache?(this.asideWidthCache=this.asideWidth,this.asideWidth=0):(this.asideWidth=this.asideWidthCache,this.asideWidthCache=null),this.$store.commit("editor/changeLeftPanelWidth",this.asideWidth)}},watch:{projectId(){this.projectId&&this.$store.dispatch("resource/queryProjectSpec2",this.projectId)},windowWidth(){this.$store.commit("editor/updateChartSize")},windowHeight(){this.footerHeight=this.windowHeight*this.footerRatio,this.$store.commit("editor/changeFooterHeight",this.footerHeight),this.$store.commit("editor/updateChartSize")},leftPanelWidth(){this.$store.commit("editor/updateChartSize")},targetPanelWidth(){this.$store.commit("editor/updateChartSize")},footerRatio(){this.footerHeight=this.windowHeight*this.footerRatio,this.$store.commit("editor/changeFooterHeight",this.footerHeight),this.$store.commit("editor/updateChartSize")},currentMode(){"animation"===this.currentMode&&(this.activeSidePanel="effect")}},computed:{...Object(x["c"])("resource",{projectList:e=>e.projectList,examples:()=>[]}),...Object(x["c"])("editor",{scene:e=>e.scene,audioSrc:e=>e.audioSrc,nlpLoading:e=>e.nlpLoading,windowWidth:e=>e.windowWidth,windowHeight:e=>e.windowHeight,aniStatus:e=>e.aniStatus,leftPanelWidth:e=>e.leftPanelWidth,targetPanelWidth:e=>e.targetPanelWidth,currentMode:e=>e.currentMode,timeline:e=>e.timeline,isExportingFiles:e=>e.isExportingFiles}),...Object(x["b"])("editor",["svgPanelInSelecting"]),sampleFileOptions(){return this.examples.map(e=>({label:e.label,value:e}))},projectId:{set(e){this.$store.commit("resource/changeProjectId",e)},get(){return this.$store.state.resource.projectId}},optionGroups(){const e=new Map;this.projectList.forEach(t=>{const r=t.group;("Single chart"===r||"Custom chart"===r||r.includes("Vega"))&&(e.has(r)?e.get(r).push(t):e.set(r,[t]))});const t=[];return e.forEach((e,r)=>{t.push({label:null!==r&&void 0!==r?r:"Other",options:e.map(e=>({label:e.label,value:e}))})}),t},nlpButtonIcon(){return this.nlpLoading?"el-icon-loading":"el-icon-magic-stick"},controlPanelWidth(){return this.windowWidth-this.targetPanelWidth-this.leftPanelWidth},svgHeight(){return this.windowHeight-this.headerHeight-this.footerHeight},renewedOptions(){const e=["vega-lite1","vega-lite2","vega-lite4","vega-lite5","vega-lite6","vega-lite7","vega-lite9","vega-lite21","vega-lite22"];return new Set(e)}}},Xi=Yi,Qi=(r("9ed6"),Object(l["a"])(Xi,w,S,!1,null,"e3fe0db8",null)),eo=Qi.exports,to=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"homepage-view"},[t("el-header",[t("PageHeader")],1),t("el-main",[t("el-col",{attrs:{span:12,offset:6}},[t("el-row",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[t("div",{staticClass:"title-text"},[e._v("WonderFlow: Easy Creation of Narration-Enriched Data Videos")])]),t("el-row",{staticStyle:{"margin-bottom":"20px"}},[t("video",{staticClass:"local-video",staticStyle:{"box-shadow":"0 0 5px #d7d7d7"},attrs:{src:"/video/WonderFlow_video.mp4",controls:"",width:"100%",height:"100%"}})])],1)],1),t("el-footer",[t("PageFooter")],1)],1)},ro=[],ao=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-header"},[t("el-row",{staticStyle:{height:"100%"},attrs:{gutter:5,type:"flex",align:"middle"}},[t("el-col",{attrs:{span:3,offset:6}},[t("span",{staticClass:"header-text",staticStyle:{"user-select":"none",cursor:"pointer"},attrs:{title:"Gaia Homepage"},on:{click:e.clickHome}},[e._v("Gaia")])]),t("el-col",{attrs:{span:9,offset:6}},[t("el-button",{staticClass:"header-button",attrs:{type:"text"},nativeOn:{click:function(t){return e.clickHome.apply(null,arguments)}}},[e._v("Home")]),t("el-button",{staticClass:"header-button",attrs:{type:"text"},nativeOn:{click:function(t){return e.clickGallery.apply(null,arguments)}}},[e._v("Gallery")]),t("el-button",{staticClass:"header-button",attrs:{type:"primary",round:""},nativeOn:{click:function(t){return e.clickLaunch.apply(null,arguments)}}},[e._v("Launch")])],1)],1)],1)},no=[],io={name:"PageHeader",components:{},data(){return{}},methods:{clickHome(){console.log(this.$route),"/homepage"!==this.$route.path&&this.$router.push("homepage")},clickGallery(){"/gallery"!==this.$route.path&&this.$router.push("gallery")},clickLaunch(){"/editor"!==this.$route.path&&this.$router.push("editor")}},mounted(){},computed:{}},oo=io,so=(r("f308"),Object(l["a"])(oo,ao,no,!1,null,"d72812bc",null)),co=so.exports,lo=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-footer"},[t("el-row",{staticStyle:{height:"100%"},attrs:{gutter:5,type:"flex",align:"middle"}},[t("el-col",{attrs:{span:3,offset:6}},[t("span",{staticClass:"footer-text",staticStyle:{"user-select":"none"}},[e._v("WonderFlow")])]),t("el-col",{attrs:{span:12,offset:3}},[e._v(" Make it easy to create narration-enriched data videos ")])],1)],1)},uo=[],po={name:"PageFooter",components:{},data(){return{}},methods:{},mounted(){},computed:{}},ho=po,fo=(r("5f28"),Object(l["a"])(ho,lo,uo,!1,null,"598dec7d",null)),go=fo.exports,mo={name:"HomepageView",components:{PageFooter:go,PageHeader:co},data(){return{}},methods:{},mounted(){},computed:{}},yo=mo,vo=(r("680f"),Object(l["a"])(yo,to,ro,!1,null,"1be0b5f6",null)),_o=vo.exports,bo=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"gallery-view"},[t("el-header",[t("PageHeader")],1),t("el-main",[t("el-col",{attrs:{span:12,offset:6}},[t("el-row",[t("span",{staticClass:"page-text"},[e._v("Gallery")])]),t("el-row",[t("div",{staticClass:"svg-group"},[e._l(e.presetCharts,(function(r){return t("el-card",{key:r.id,staticClass:"svg-item clickable",attrs:{shadow:"hover","body-style":{padding:"0px"}},nativeOn:{click:function(t){return e.handleProjectClick(r)}}},[t("SvgPreviewer",{attrs:{project:r,height:180,width:290}}),t("div",{staticClass:"item-text-container"},[t("div",[e._v(e._s(r.label))]),t("div",{staticStyle:{color:"gray","font-size":"0.9rem"}},[e._v(e._s(r.chartType))])])],1)})),e._l([...Array((3-e.presetCharts.length%3)%3).keys()],(function(e){return t("div",{key:"empty-block-"+e,staticClass:"svg-item"})}))],2)])],1)],1),t("el-footer",[t("PageFooter")],1)],1)},To=[],wo={name:"GalleryView",components:{SvgPreviewer:Ce,PageFooter:go,PageHeader:co},data(){return{}},mounted(){this.$store.dispatch("resource/queryAllSvg").then(()=>{this.$store.commit("resource/changeStaticSvgMapSign")})},methods:{handleProjectClick(e){this.$router.push({path:"example",query:{"example-index":this.projectList.indexOf(e)}})}},computed:{...Object(x["c"])("resource",{projectList:e=>e.projectList}),projectGroupMap(){const e=new Map;return e.set("Single chart",[]),e.set("Custom chart",[]),e.set("Vega Line Chart",[]),this.projectList.forEach(t=>{const r=t.group;"Single chart"!==r&&"Custom chart"!==r&&"Vega Line Chart"!==r||e.get(r).push(t)}),e},presetCharts(){var e,t;const r=null!==(e=this.projectGroupMap.get("Single chart"))&&void 0!==e?e:[],a=null!==(t=this.projectGroupMap.get("Vega Line Chart"))&&void 0!==t?t:[];return r.concat(...a)},customCharts(){var e;return null!==(e=this.projectGroupMap.get("Custom chart"))&&void 0!==e?e:[]}}},So=wo,xo=(r("35db"),Object(l["a"])(So,bo,To,!1,null,"55118168",null)),Co=xo.exports,Ao=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"example-view"},[t("el-header",[t("PageHeader")],1),t("el-main",[t("el-col",{attrs:{span:12,offset:6}},[t("el-row",[t("div",{staticStyle:{width:"100%",display:"flex"}},[t("span",{staticClass:"page-text"},[e._v(e._s(e.project.label))]),t("el-button",{staticClass:"back-button",attrs:{type:"text"},nativeOn:{click:function(t){return e.clickBack.apply(null,arguments)}}},[e._v("< Back to gallery")])],1),t("span",{staticClass:"page-text-small"},[e._v(e._s(e.project.chartType))])]),t("el-row",{staticStyle:{display:"flex","flex-wrap":"wrap","margin-top":"20px"}},[t("SvgPreviewer",{staticStyle:{border:"1px solid #cecece","border-radius":"4px","margin-right":"20px"},attrs:{project:e.project,height:320,width:500}}),t("div",[t("el-button",{staticClass:"launch-button",attrs:{round:"",type:"primary",icon:""},nativeOn:{click:function(t){return e.clickLaunch.apply(null,arguments)}}},[e._v("Open Demo")])],1)],1),t("el-row",{staticStyle:{"margin-top":"10px"}},[t("div",{staticClass:"title-text"},[e._v("Link to Original Video")]),t("a",{staticClass:"content-text",attrs:{href:e.galleryInfo.link}},[e._v(e._s(e.galleryInfo.videoName))])]),t("el-row",{staticStyle:{"margin-top":"10px"}},[t("div",{staticClass:"title-text"},[e._v("Narration")]),t("div",{staticClass:"content-text"},[e._v(e._s(e.galleryInfo.transcript))])]),t("el-row",[t("div",{staticClass:"title-text"},[e._v("Creation Process")]),t("video",{staticClass:"local-video",attrs:{src:`/video/V${e.projectIndex+1}_1.mp4`,controls:"",width:"100%",height:"100%"}})]),t("el-row",[t("div",{staticClass:"title-text"},[e._v("Final Version")]),t("video",{staticClass:"local-video",attrs:{src:`/video/V${e.projectIndex+1}_2.mp4`,controls:"",width:"100%",height:"100%"}})])],1)],1),t("el-footer",[t("PageFooter")],1)],1)},$o=[],ko={name:"ExampleView",components:{SvgPreviewer:Ce,PageFooter:go,PageHeader:co},data(){return{projectIndex:-1,project:{}}},mounted(){let e=1;try{var t;e=parseInt(null!==(t=this.$route.query["example-index"])&&void 0!==t?t:""+e)}catch(r){console.log(r)}this.projectIndex=e,this.project=this.projectList[this.projectIndex],this.$store.dispatch("resource/queryAllSvg").then(()=>{this.$store.commit("resource/changeStaticSvgMapSign")})},methods:{clickBack(){this.$router.push("gallery")},clickLaunch(){this.$router.push({path:"editor",query:{"example-index":this.projectIndex}})}},watch:{},computed:{...Object(x["c"])("resource",{projectList:e=>e.projectList,galleryList:e=>e.galleryList}),galleryInfo(){var e;return this.project&&null!==(e=this.galleryList.find(e=>e.id===this.project.id))&&void 0!==e?e:{}}}},Po=ko,Ro=(r("da2d"),Object(l["a"])(Po,Ao,$o,!1,null,"4a204963",null)),Eo=Ro.exports;const Oo=[{path:"/editor",component:eo},{path:"/test",component:T},{path:"/homepage",component:_o},{path:"/gallery",component:Co},{path:"/example",component:Eo},{path:"/",redirect:"/editor"}];var Io=new n["a"]({mode:"hash",routes:Oo}),No=(r("d9e2"),r("5c96")),Mo=r.n(No);const Lo="api";function jo(e,t,r){const a=Lo+"/nlp/parse";console.log("post",e),_e["a"].post(a,e).then(e=>{t(e.data)}).catch(e=>{r(e)})}function Bo(e,t,r){const a=Lo+"/nlp/generate";console.log("post",e),_e["a"].post(a,e).then(e=>{t(e.data)}).catch(e=>{r(e)})}function Zo(e){if(void 0===e||null===e)return e;let t=Array.isArray(e)?[]:{};for(let r in e)t[r]="object"===typeof e[r]?Zo(e[r]):e[r];return void 0!==e.prototype&&(t.prototype=e.prototype),t}r("b7ef");function Do(e,t){var a=r("b2ba"),n="09336b849227439bb2432601c4850a28",i="eastus",o=a.SpeechConfig.fromSubscription(n,i),s=new a.SpeechSynthesizer(o,null);const c={transcript:e,words:[]},l=[];var u=0;s.wordBoundary=function(e,t){let r=parseFloat((t.audioOffset/1e7).toFixed(3));c.words.push({startTime:u,endTime:r,selected:!1,speakerTag:0}),l.push(t.textOffset),u=r},s.speakTextAsync(e,(function(r){r.reason===a.ResultReason.SynthesizingAudioCompleted?console.log("synthesis finished."):console.error("Speech synthesis canceled, "+r.errorDetails+"\nDid you update the subscription info?"),s.close(),s=void 0;for(let t=0;t<l.length;t++){var n="";n=t!=l.length-1?e.slice(l[t],l[t+1]):e.slice(l[t]),c.words[t].word=n.trim()}const i=new AudioContext;t(c,i.decodeAudioData(r.audioData))}),(function(e){console.trace("err - "+e),s.close(),s=void 0,t(void 0,void 0)}))}function Go(e){if(!e)return null;const t=e.split(",")[0].split(":")[1].split(";")[0],r=atob(e.split(",")[1]),a=new ArrayBuffer(r.length),n=new Uint8Array(a);for(let i=0;i<r.length;i++)n[i]=r.charCodeAt(i);return new Blob([n],{type:t})}async function Uo(e){if(!e)return new Promise(e=>{e(new AudioBuffer({length:8e3,numberOfChannels:2,sampleRate:8e3}))});const t=await e.arrayBuffer(),r=new AudioContext;return r.decodeAudioData(t)}function Fo(e){return e.length/e.sampleRate}function zo(e){const t=e.numberOfChannels,r=e.sampleRate,a=4*r,n=3*r,i=(new AudioContext).createBuffer(t,a,r),o=new Float32Array(n);for(let s=0;s<t;s++)e.copyFromChannel(o,s,0),i.copyToChannel(o,s,0);return i}function Vo(e){const t=e.numberOfChannels,r=e.sampleRate,a=e.length+r,n=e.length,i=(new AudioContext).createBuffer(t,a,r),o=new Float32Array(n);for(let s=0;s<t;s++)e.copyFromChannel(o,s,0),i.copyToChannel(o,s,0);return i}function Ho(e,t){if(0===e.length)return(new AudioContext).createBuffer(2,0,1);const r=e[0].numberOfChannels,a=e[0].sampleRate;let n=e.reduce((e,t)=>e+t.length,0);t&&t.forEach(e=>n+=e*a);const i=(new AudioContext).createBuffer(r,n,a);let o=0;for(let s=0;s<e.length;++s){const a=e[s],n=a.length,c=new Float32Array(n);for(let e=0;e<r;e++)a.copyFromChannel(c,e,0),i.copyToChannel(c,e,o);o+=n,o+=t?t[s]:0}return i}function Wo(e){let t,r,a=e.numberOfChannels,n=e.length*a*2+44,i=new ArrayBuffer(n),o=new DataView(i),s=[],c=0,l=0;for(d(1179011410),d(n-8),d(1163280727),d(544501094),d(16),u(1),u(a),d(e.sampleRate),d(2*e.sampleRate*a),u(2*a),u(16),d(1635017060),d(n-l-4),t=0;t<e.numberOfChannels;t++)s.push(e.getChannelData(t));while(l<n){for(t=0;t<a;t++)r=Math.max(-1,Math.min(1,s[t][c])),r=0|(.5+r<0?32768*r:32767*r),o.setInt16(l,r,!0),l+=2;c++}return new Blob([i],{type:"audio/wav"});function u(e){o.setUint16(l,e,!0),l+=2}function d(e){o.setUint32(l,e,!0),l+=4}}const Ko={dataURItoBlob:Go,blobToAudioBuffer:Uo,audioBufferToBlob:Wo,concatAudio:Ho,computeAudioDuration:Fo,generateTranscript:Do,extend1Sec:Vo,copy3Sec:zo};function qo(e,t){const r=(new DOMParser).parseFromString(e,"image/svg+xml").querySelector("svg"),a=Array.from(r.querySelectorAll("*:not(g,svg,defs,defs *)"));a.forEach(e=>{const t=e.getAttribute("id");t&&""!==t?e.setAttribute("id",t.replaceAll(" ","-")):e.setAttribute("id","ac-"+Object(P["a"])())}),a.forEach(e=>{e.classList.contains(t)||(e.classList.add(t),e.classList.add("unknown-type"))});const n=Yo(a),i={chartType:"unknown",elements:n},o=Jo(r);return console.log("svg model",n,i),{targetModel:i,svgStr:o}}function Jo(e){const t=document.createElement("div");return t.appendChild(e),t.innerHTML}function Yo(e){const t=[];return e.forEach(e=>{const r={},a=e.getAttribute("id"),n=e.getAttribute("class"),i=n.split(" "),o=e.tagName,s={};r.type=i[i.length-1],r.id=a,r.clazz=n,r.data=s,r.tag=o,"text"===o?0!==e.children.length?r.text=Array.from(e.children).reduce((e,t)=>e+" "+t.innerHTML,"").trim():r.text=e.innerHTML:r.text=null,t.push(r)}),t}const Xo={updateSVGModel:qo,domElToString:Jo};var Qo=r("5a51");function es(e,t){const r=(e,t)=>Array.from({length:t-e},(t,r)=>r+e),a=r(e,t+1);return"["+a.join(",")+"]"}function ts(e){const t=[];return Object.keys(e).forEach(r=>{const a=JSON.parse(r),n=e[r];t.push({startIdx:a[0],endIdx:a[a.length-1],indices:r,target:n,icon:E["d"],id:Object(P["a"])()})}),t}function rs(e){const t=new Object;return e.forEach(e=>{t[e.indices]=e.target}),t}function as(e){const t=e.buildInWrappers,r=new Object;return t.forEach(e=>{const t=e.getTemplateName(),a=e.animationType;r[t]=a}),r}const ns=()=>({aniChart:Hi,windowWidth:0,windowHeight:0,headerHeight:0,footerHeight:0,scene:null,enableDrag:!1,sceneEl:null,svgEl:null,aniSceneEl:null,aniSvgEl:null,selectionSvgEl:null,resourceJSON:[],templateJSON:[],animationJSON:{main:{sync:[]}},binderJSON:null,targetModel:null,animationId2jsonItem:new Map,previewAniJSON:{sequence:{sync:[]}},resourceJSONRenderSign:0,templateJSONRenderSign:0,animationJSONRenderSign:0,isSpecTextValid:!0,specTextErrorMsg:"",timeline:null,timelinePanelEl:null,textPanelEl:null,targetPanelEl:null,textPanelEmpty:!1,controllerInitSign:0,svgRenderSign:0,aniSvgRenderSign:0,aniChangeSign:0,mainContainerEl:null,toolboxEl:null,submitToolboxEl:null,staticToolboxEl:null,time:0,timelineRows:[[],[],[]],timelineScale:f["j"]().domain([0,20]),oldTimelineScale:f["j"]().domain([0,20]),timelineWidth:1e3,tlContainerWidth:0,tlContainerWidthBuffer:0,timelineRenderSign:0,targetPanelWidth:0,leftPanelWidth:0,wordTargetIconPos:[],transcriptSrc:{transcript:"",words:[]},groupedTargetsMap:new Map,useAudio:!0,showPotential:!0,audioSrc:"",audioEl:null,audioReady:!1,nlpLinking:!1,nlpLoading:!1,selectionTool:B.NORMAL,selectionConfirm:null,stopConfirm:!1,selectionLeave:null,stopLeave:!1,hideToolbox:!1,animationStyle:{Enter:{color:"#78c679",icon:E["f"]},Emphasis:{color:"#238b45",icon:E["h"]},Exit:{color:"#99d8c9",icon:E["g"]},Annotate:{color:"#f56c6c",icon:E["h"]},Other:{color:"#9e4ccd",icon:E["a"]}},templateStyle:{Chart:{color:f["c"](f["m"][6]),icon:E["b"]},Mark:{color:f["c"](f["m"][4]),icon:E["e"]},Annotation:{color:f["c"](f["m"][3]),icon:E["i"]}},useToAniMap:as(Hi),animationName:"",animationType:"",itemForSettings:null,aniSettings:{},textPanelText:"",audioCompiling:!1,refresh:!0,scrollLeft:0,aniStatus:"stop",compileSuccess:!1,currentMode:"normal",enableFilter:!0,settingPanelVisible:!1,clearTextHighlightSign:!1,itemUpdateTuple:null,highlightItem:null,clickIconSignal:null,exportSvgEl:null,exportSceneEl:null,exportSign:0,audioBuffer:null,isExportingFiles:!1}),is={svgPanelInSelecting:e=>e.selectionTool!==B.NORMAL,aniPlaying:e=>"play"===e.aniStatus},os={queryNLPParseResult({state:e,commit:t}){t("changeNLPLinking",!0);const r=Zo(e.transcriptSrc);r.words.forEach(e=>delete e.selected);var a={};this.state.target.groupedTargetsMap.forEach((e,t)=>{a[t]=Array.from(e)});const n={target_model:e.scene.targetModel,transcript:r,dataGroup:a};jo(n,e=>{t("changeNLPLinking",!1),t("computeWordIdxTargets",e.indices_dict)},e=>{t("changeNLPLinking",!1),Object(No["Notification"])({title:"NLP Parse failed",message:e.message,type:"warning"}),console.log(e)})},queryNLPGenerateResult({state:e,commit:t}){t("changeNLPLoading",!0);const r=Zo(e.transcriptSrc);r.words.forEach(e=>delete e.selected);var a={};this.state.target.groupedTargetsMap.forEach((e,t)=>{a[t]=Array.from(e)});const n=rs(e.wordTargetIconPos),i={target_model:e.scene.targetModel,transcript:r,dataGroup:a,indices_dict:n};console.log("nlp payload",i),Bo(i,r=>{console.log("nlp resp",r);const a=r.AnimationJSON;t("changeNLPLoading",!1),e.wordTargetIconPos=[],t("updateEditorUsingAnimationJSON",null!==a&&void 0!==a?a:{}),t("changeAnimationJSONRenderSign"),Object(No["Notification"])({title:"Generate finished",type:"success"})},e=>{t("changeNLPLoading",!1),Object(No["Notification"])({title:"Generate failed",message:e.message,type:"warning"}),console.log(e)})}},ss={changeAniStatus(e,t){e.aniStatus=t},changeWindowSize(e){e.windowWidth=document.body.clientWidth,e.windowHeight=document.body.clientHeight},changeLeftPanelWidth(e,t){e.leftPanelWidth=t},changeHeaderHeight(e,t){e.headerHeight=t},changeFooterHeight(e,t){e.footerHeight=t},changeScene(e,t){e.scene=t},changeSceneById(e,t){e.scene=this.state.project.scenes[t]},changetextPanelText(e,t){e.textPanelText=t,""===t&&(e.textPanelEmpty=!0)},changeRefresh(e){e.refresh=!e.refresh},mountSceneElement(e,t){e.sceneEl=t},mountAniSceneElement(e,t){e.aniSceneEl=t},mountSvgElement(e,t){e.svgEl=t},mountSelectionSvgElement(e,t){e.selectionSvgEl=t},mountAniSvgElement(e,t){e.aniSvgEl=t},mountAudioElement(e,t){e.audioEl=t},mountMainContainer(e,t){e.mainContainerEl=t},mountTb(e,t){e.toolboxEl=t},mountToolbox(e,t){e.submitToolboxEl=t},mountStaticToolbox(e,t){e.staticToolboxEl=t},changeTempAnimationSelection(e,{aniName:t="",aniType:r=""}){e.animationName=t,e.animationType=r},changeItemForSettings(e,t){e.itemForSettings=t,console.log("changeItemForSettings",e.itemForSettings)},updateItemType(e,{aniName:t,aniType:r}){e.itemForSettings&&(e.itemForSettings.use=t,e.itemForSettings.ani_type=r)},changeItemSettings(e,t){e.aniSettings=t},changeMode(e,t){e.currentMode=t},changeFilterSwitch(e,t){e.enableFilter=t},initToolboxPos(e){const t=e.toolboxEl,r=t.getBoundingClientRect();this.commit("editor/moveToolbox",{ele:e.submitToolboxEl,right:r.right,top:r.top+r.height+10}),this.commit("editor/moveToolbox",{ele:e.staticToolboxEl,right:r.right,top:r.top+r.height+10})},moveToolbox(e,{ele:t,left:r=null,top:a=null,right:n=null,bottom:i=null}){if(t||(t=e.submitToolboxEl),!t)return;const o=e.mainContainerEl,s=o.getBoundingClientRect();t.style.left=r?r-s.left+"px":"",t.style.right=n?s.right-n+"px":"",t.style.top=a?a-s.top+"px":"",t.style.bottom=i?s.bottom-i+"px":""},initLinking(e){var t;null!==(t=e.scene)&&void 0!==t&&t.linking&&this.commit("editor/computeWordIdxTargets",Zo(e.scene.linking))},initWorkspace(e,t=!1){var r,a,n,i,o;e.controllerInitSign^=1,e.selectionTool=B.NORMAL,e.wordTargetIconPos=[],e.indice_dict=new Map,e.timeline&&(e.timeline.kill(),e.timeline.clear(),e.timeline=null),this.commit("editor/changeSvgRenderSign"),setTimeout(()=>{try{var r,a,n,i,o;const s=Zo(null===(r=e.scene)||void 0===r?void 0:r.spec);let c;this.commit("editor/updateEditorUsingResourcesJSON",null!==(a=null===s||void 0===s?void 0:s.charts)&&void 0!==a?a:[]),this.commit("editor/updateEditorUsingTemplateJSON",null!==(n=null===s||void 0===s?void 0:s.templates)&&void 0!==n?n:[]),this.commit("editor/changeTargetBinder",null!==(i=null===s||void 0===s?void 0:s.binder)&&void 0!==i?i:null),c=null!==s&&void 0!==s&&s.binder?Qo["DefaultSession"].getTargetModel(e.aniSvgEl,s.binder):Qo["DefaultSession"].getTargetModel(e.aniSvgEl),this.commit("editor/changeTargetModel",c);const l={main:{sync:[]}};t?this.commit("editor/updateEditorUsingAnimationJSON",null!==(o=null===s||void 0===s?void 0:s.animation)&&void 0!==o?o:l):this.commit("editor/updateEditorUsingAnimationJSON",l),setTimeout(()=>{e.resourceJSONRenderSign^=1,e.templateJSONRenderSign^=1,e.animationJSONRenderSign^=1},0)}catch(s){console.error(s)}}),null!==(r=this.scene)&&void 0!==r&&r.targetModel&&this.commit("target/initTargetModel",Zo(e.scene.targetModel));const s=Zo(null===(a=e.scene)||void 0===a?void 0:a.transcript),c={transcript:"",words:[]};if(null===s||void 0===s||null===(n=s.results)||void 0===n||n.forEach(e=>{e.alternatives.forEach(e=>{c.transcript+=e.transcript,c.words.push(...e.words),e.words.forEach(e=>{e.startTime=parseFloat(e.startTime.replace("s","")),e.endTime=parseFloat(e.endTime.replace("s","")),e.selected=!1})})}),e.transcriptSrc=c,this.commit("editor/changetextPanelText",c.transcript),null!==(i=e.scene)&&void 0!==i&&i.targetModel&&this.commit("target/initTargetModel",Zo(e.scene.targetModel)),null!==(o=e.scene)&&void 0!==o&&o.audioStr){const t=e.scene.audioStr,r=Ko.dataURItoBlob(t);Ko.blobToAudioBuffer(r).then(e=>{const t=Ko.extend1Sec(e),r=Ko.audioBufferToBlob(t),a=window.URL.createObjectURL(r);this.commit("editor/setAudioSrc",a),this.commit("editor/setAudioBuffer",t)})}},changeTargetBinder(e,t){e.binderJSON=t},changeTargetModel(e,t){e.targetModel=t},updateAudio(e,t){e.audioCompiling=!0;let r=this;"string"!==typeof t&&(e.audioCompiling=!1),Ko.generateTranscript(t,(function(t,a){e.transcriptSrc=t,void 0!=a&&a.then(e=>{const t=Ko.extend1Sec(e),a=Ko.audioBufferToBlob(t),n=window.URL.createObjectURL(a);r.commit("editor/setAudioSrc",n),r.commit("editor/setAudioBuffer",t)}).catch(()=>{e.audioReady=!1,e.audioCompiling=!1})}))},resetEditor(e){try{this.commit("editor/updateEditorUsingResourcesJSON",[]),this.commit("editor/updateEditorUsingTemplateJSON",[]),this.commit("editor/updateEditorUsingAnimationJSON",{main:{sync:[]}}),e.wordTargetIconPos=[],setTimeout(()=>{e.resourceJSONRenderSign^=1,e.templateJSONRenderSign^=1,e.animationJSONRenderSign^=1},0)}catch(t){console.error(t)}},updateChartSize(e){const t=e.svgEl,r=e.aniSvgEl;if(!t||!r)return void console.warn("svg el is not ready");const a=t.querySelector("svg");if(!a)return void console.warn("chart element is not ready");const n=a.getAttribute("width"),i=a.getAttribute("height"),o=Math.max(0,e.windowWidth-e.leftPanelWidth-e.targetPanelWidth),s=Math.max(0,e.windowHeight-e.headerHeight-e.footerHeight),c=o/n*.84,l=s/i*.84,u=Math.min(c,l);t.setAttribute("width",n*u),t.setAttribute("height",i*u),t.setAttribute("viewBox",`0 0 ${n} ${i}`),r.setAttribute("width",n*u),r.setAttribute("height",i*u),r.setAttribute("viewBox",`0 0 ${n} ${i}`)},updateEditorUsingResourcesJSON(e,t){e.resourceJSON=t},updateEditorUsingTemplateJSON(e,t){null!=t&&(e.templateJSON=t,console.log("registerOrUpdateTemplate",t),Qo["DefaultSession"].registerOrUpdateTemplates(t),this.commit("editor/updateEditorUsingAnimationJSON",e.animationJSON),e.animationJSONRenderSign^=1)},updateEditorUsingAnimationJSON(e,t){null!==t&&setTimeout(()=>{try{console.log(">>>>",t),e.animationJSON=t;const r=e.binderJSON?Qo["DefaultSession"].resolveJson(t,e.aniSvgEl,e.binderJSON):Qo["DefaultSession"].resolveJson(t,e.aniSvgEl);e.animationId2jsonItem=new Map,e.animationJSON.main.sync.forEach((t,a)=>{e.animationId2jsonItem.set(r.children[a].id,t)}),this.commit("editor/changeSpecTextValidState",{isValid:!0,errorMsg:""}),this.commit("editor/computeTimelineRows",r),setTimeout(()=>{this.commit("editor/updateVisTimeline")},0)}catch(r){console.error("Spec update failed"),console.error(r),this.commit("editor/changeSpecTextValidState",{isValid:!0,errorMsg:r.message}),Object(No["Notification"])({title:"Update timeline failed",message:r.message,type:"warning"})}})},emitAniChangeSign(e){e.aniChangeSign^=1},changeSpecTextValidState(e,{isValid:t,errorMsg:r}){e.isSpecTextValid=t,e.specTextErrorMsg=r},mountTimelinePanel(e,t){e.timelinePanelEl=t},mountTextPanel(e,t){e.textPanelEl=t},mountTargetPanel(e,t){e.targetPanelEl=t},compile(e,{onUpdateFunc:t,notification:r=!0}){e.compileSuccess=!1,e.timeline&&(e.timeline.kill(),e.timeline.clear(),e.timeline=null);try{console.log("compiling animation json",e.aniSvgEl,e.animationJSON);const a=e.binderJSON?Qo["DefaultSession"].compileJson(e.animationJSON,e.aniSvgEl,e.binderJSON):Qo["DefaultSession"].compileJson(e.animationJSON,e.aniSvgEl),n=e.timelineScale.invert(e.timelineWidth);a.addPause(n),Object.assign(a.vars,{onUpdate:t,autoRemoveChildren:!1}),a.pause(),e.timeline=a,r&&Object(No["Notification"])({title:"Compile finished",message:"Play the animation!",type:"success"}),e.compileSuccess=!0}catch(a){console.error(a),Object(No["Notification"])({title:"Compile failed",message:a.message,type:"warning"}),e.compileSuccess=!1}},computeTimelineRows(e,t){const r=[...t.children],a=e=>{var t;return null!==(t=e.timing.offset)&&void 0!==t?t:0},n=e=>a(e)+e.computedTotalDuration;r.sort((e,t)=>n(e)-n(t));const i=r.map(()=>-1),o=r.map(()=>[]);for(let s=r.length-1;s>=1;--s)for(let e=s-1;e>=0;--e)a(r[s])<n(r[e])&&o[s].push(e);for(let s=0;s<r.length;++s){const t=r[s];for(let a=0;a<r.length;a++){while(e.timelineRows.length<=a)e.timelineRows.push([]);const r=e.timelineRows[a],n=o[s].some(e=>i[e]===a);if(!n){r.push(t),i[s]=a;break}}}e.timelineRows=[[]],r.forEach((t,r)=>{const a=i[r];while(a>=e.timelineRows.length)e.timelineRows.push([]);e.timelineRows[a].push(t)})},computeWordIdxTargets(e,t){e.wordTargetIconPos=ts(t)},changeSvgRenderSign(e){e.svgRenderSign^=1,e.aniSvgRenderSign^=1},changeAniSvgRenderSign(e){e.aniSvgRenderSign^=1},changeExportSign(e){e.exportSign^=1},setIsExportingFiles(e,t){e.isExportingFiles=t},addWordTarget(e,{start:t,end:r,target:a}){let n=!1;for(let i=0;i<e.wordTargetIconPos.length;++i){const o=e.wordTargetIconPos[i];if(o.startIdx===t&&o.endIdx===r){o.target.push(...a),o.target=[...new Set(o.target)],n=!0,Object(No["Notification"])({title:"Merged duplicate link",type:"info"});break}}n||e.wordTargetIconPos.push({startIdx:t,endIdx:r,target:a,icon:E["d"],id:Object(P["a"])(),indices:es(t,r)})},editWordTarget(e,t){for(let r=0;r<e.wordTargetIconPos.length;++r)if(e.wordTargetIconPos[r].id===t.id){e.wordTargetIconPos[r].target=t.target;break}},deleteWordTarget(e,t){for(let r=0;r<e.wordTargetIconPos.length;++r)if(e.wordTargetIconPos[r].id===t.id){e.wordTargetIconPos.splice(r,1);break}},changeTlContainerWidth(e,t){const r=e.windowWidth-e.leftPanelWidth-e.targetPanelWidth-t;e.tlContainerWidthBuffer=r,e.tlContainerWidth=r,e.timelineScale.range([0,r]),e.timelineWidth=r,this.commit("editor/updateVisTimeline")},changeTimelineWidth(e,t){const r=t/e.timelineWidth,a=e.timelineScale.domain(),n=e.timelineScale.range();e.timelineScale.domain([0,a[1]*r]).range([0,n[1]*r]),e.timelineWidth=t,this.commit("editor/updateVisTimeline")},updateTimelineScale(e,t){e.timelineWidth/t<e.tlContainerWidth&&(t=e.timelineWidth/e.tlContainerWidth);const r=e.timelineScale.domain(),a=e.timelineScale.range();e.timelineScale.domain([0,r[1]]).range([0,a[1]/t]),e.timelineWidth=e.timelineWidth/t,this.commit("editor/updateVisTimeline"),e.oldTimelineScale.domain([0,r[1]]).range([0,a[1]])},updateTimelineScaleByAudio(e,t){e.timelineScale.domain([0,t/1e3]),this.commit("editor/updateVisTimeline")},updateTimelineSvg(e){const t=f["n"]("#timeline-marks-svg");t.selectAll("*").remove();const r=t.append("g"),a=10,n=a*e.timelineWidth/e.tlContainerWidth,i=f["b"](e.timelineScale).ticks(n),o=r.attr("transform","translate(0,27)").call(i);o.select(".tick:first-of-type text").remove(),o.selectAll(".tick").attr("color","#adadad"),o.selectAll(".tick line").attr("stroke-width","1.5px").attr("y2","-14"),o.selectAll(".tick text").attr("font-size",14).attr("y","-16")},updateItemTiming(e,{itemId:t,start:r,duration:a}){const n=r,i=e.animationId2jsonItem.get(t),o={};null!=n&&(o.offset=n),null!=a&&(o.duration=a),Object.assign(i,o),"offset"in i&&0===i.offset&&delete i.offset,"duration"in i&&0===i.duration&&(i.duration=.01)},appendTimelineItem(e,{rowIdx:t,templateName:r,startX:a}){const n=e.timelineRows[t];let i=e.timelineScale.invert(a);i=Math.round(100*i)/100;const o={use:r,timing:{start:i}};n.push(o),new Error("Never go here"),this.commit("editor/updateVisTimeline"),this.commit("editor/updateAniJSONUsingTimelineRows")},appendItemByTextView(e,{minWordIdx:t,maxWordIdx:r,target:a,toFitDuration:n,settings:i}){var o,s;new Error("Never go here");const c=e.transcriptSrc.words[t].startTime,l=e.transcriptSrc.words[r].endTime,u={use:e.animationName,timing:{start:c,duration:1,offset:0},target:a,ani_type:e.animationType,settings:i};if(n){let e=l-c;u.timing.duration=Math.round(100*e)/100}null!==(o=e.animationJSON)&&void 0!==o&&null!==(s=o.sequence)&&void 0!==s&&s.sync&&(e.animationJSON.sequence.sync.push(u),e.animationJSON={...e.animationJSON},this.commit("editor/computeTimelineRows",e.animationJSON)),this.commit("editor/updateVisTimeline")},updateItemByTextView(e,{item:t,target:r}){new Error("Never go here")},deleteItemByIcon(e,t){for(const r of e.timelineRows){const e=r.indexOf(t.originItem);if(-1!==e){r.splice(e,1);break}}this.commit("editor/updateAniJSONUsingTimelineRows"),this.commit("editor/updateVisTimeline")},updateItemTimingByIcon(e,t){const r=e.timelineRows.flat().find(e=>e.use==t.use&&e.target==t.target),a=t.timing.start,n=t.timing.duration;this.commit("editor/updateItemTiming",{item:r,start:a,duration:n}),this.commit("editor/updateAniJSONUsingTimelineRows"),this.commit("editor/updateVisTimeline")},deleteItem(e,t){for(let r=0;r<e.timelineRows.length;r++){const a=e.timelineRows[r],n=a.indexOf(t);if(n>=0){a.splice(n,1);break}}new Error("Never go here"),this.commit("editor/changeHighlightItem",null),this.commit("editor/changeClearTextHighlightSign"),this.commit("editor/updateVisTimeline"),this.commit("editor/updateAniJSONUsingTimelineRows")},changeSettingPanelVisible(e,t){e.settingPanelVisible=t},changeClearTextHighlightSign(e){e.clearTextHighlightSign^=!0},changeHighlightItem(e,t){e.highlightItem=t},changeClickIconSignal(e,t){e.clickIconSignal=t},updateVisTimeline(e){const t=Math.max(...e.timelineRows.flat().map(e=>{var t,r;return(null!==(t=null===(r=e.timing)||void 0===r?void 0:r.offset)&&void 0!==t?t:0)+e.totalDuration}));while(t>=e.timelineScale.invert(e.timelineWidth))this.commit("editor/changeTimelineWidth",1.5*e.timelineWidth);setTimeout(()=>{e.timelineRenderSign^=1},0),this.commit("editor/updateTimelineSvg")},updateAniJSONUsingTimelineRows(e){var t,r;null!==(t=e.animationJSON)&&void 0!==t&&null!==(r=t.main)&&void 0!==r&&r.sync&&(e.animationJSON.main.sync=e.timelineRows.flat().map(t=>e.animationId2jsonItem.get(t.id)).sort((e,t)=>{var r,a,n,i;return(null!==(r=null===(a=e.timing)||void 0===a?void 0:a.offset)&&void 0!==r?r:0)-(null!==(n=null===(i=t.timing)||void 0===i?void 0:i.offset)&&void 0!==n?n:0)}),e.animationJSONRenderSign^=1,console.log("updateAniJSONUsingTimelineRows",e.animationJSON))},storeVItemTitle(e,t){e.vItemTitle=t},updateItemRow(e,{item:t,rowIdx:r}){const a=e.timelineRows.find(e=>e.includes(t));if(!a)return;const n=e.timelineRows[r];a.splice(a.indexOf(t),1),n.push(t);const i=e=>{var t,r,a,n;return(null!==(t=null===(r=e.timing)||void 0===r?void 0:r.start)&&void 0!==t?t:0)+(null!==(a=null===(n=e.timing)||void 0===n?void 0:n.offset)&&void 0!==a?a:0)};n.sort((e,t)=>i(e)-i(t))},updateItemSettings(e,{item:t,newItemInfo:r}){Object.assign(t,r),new Error("Never go here"),this.commit("editor/updateVisTimeline"),this.commit("editor/updateAniJSONUsingTimelineRows")},changeItemUpdateTuple(e,{itemId:t,newItemInfo:r}){e.itemUpdateTuple={itemId:t,newItemInfo:r}},changeAnimationJSONRenderSign(e){e.animationJSONRenderSign^=1},changeNLPLoading(e,t){e.nlpLoading=t},changeNLPLinking(e,t){e.nlpLinking=t},changeSelectionTool(e,t){e.selectionTool=t,e.hideToolbox=!1},showToolBox(e){e.hideToolbox=!1},registerSelectionConfirm(e,t){e.selectionConfirm=t},clearSelectionConfirm(e,t){e.stopConfirm=!1,t&&e.selectionConfirm&&(e.stopConfirm=e.selectionConfirm()),e.stopConfirm||(e.selectionConfirm=null)},registerSelectionLeave(e,t){e.selectionLeave=t},clearSelectionLeave(e,t){e.stopLeave=!1,t&&e.selectionLeave&&(e.stopLeave=e.selectionLeave()),e.stopLeave||(e.selectionLeave=null)},updateElementClasses(e){const t=this.state.target.fullTargetList;t.forEach(t=>{f["n"](e.sceneEl).select("#"+t.id).attr("class",t.clazz)})},stashScene(e){if(!e.scene)return;const t=["type","id","clazz","data","tag","text"];e.scene.targetModel.elements=this.state.target.fullTargetList.map(e=>{const r={};return t.forEach(t=>r[t]=e[t]),r}),e.scene.spec={charts:e.resourceJSON,templates:e.templateJSON,animation:e.animationJSON};const r=(new DOMParser).parseFromString(e.scene.svgStr,"image/svg+xml").querySelector("svg");e.scene.targetModel.elements.forEach(e=>{f["n"](r).select("#"+e.id).attr("class",e.clazz)}),e.scene.svgStr=Xo.domElToString(r)},setAudioSrc(e,t){e.audioSrc=t,e.setAudioReadyFunc?e.audioEl.removeEventListener("canplaythrough",e.setAudioReadyFunc,!1):e.setAudioReadyFunc=function(){e.audioReady=!0}.bind(this),e.audioReady=!1,e.audioCompiling=!1,e.audioEl.addEventListener("canplaythrough",e.setAudioReadyFunc,!1)},setAudioBuffer(e,t){e.audioBuffer=t},changeUseAudio(e,t){e.useAudio=t},changeTime(e,t){e.time=t},changeShowPotential(e,t){e.showPotential=t},changeAudioReady(e,t){e.audioReady=t},fixScrollPos(e,t){const r=document.querySelector(".timeline-panel").offsetLeft,a=e.oldTimelineScale.invert(e.scrollLeft+t.x-r),n=e.timelineScale(a);e.scrollLeft=Math.max(n-(t.x-r),0)},saveSpec(e){const t={projectId:this.state.resource.projectId,animation:e.animationJSON,templates:e.templateJSON},r=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=URL.createObjectURL(r),n=document.createElement("a");n.href=a,n.download=t.projectId+".json",n.click(),URL.revokeObjectURL(a)}};var cs={namespaced:!0,state:ns,getters:is,actions:os,mutations:ss};function ls(e,t,r){let a="./data/gaia-proj/"+e;_e["a"].get(a).then(e=>{t(e)}).catch(e=>{r(e)})}function us(e,t,r){let a="./data/svg/"+e;return _e["a"].get(a).then(e=>{t(e)}).catch(e=>{r(e)})}function ds(e,t,r){let a="./data/transcript/"+e;return _e["a"].get(a).then(e=>{t(e)}).catch(e=>{r(e)})}function ps(e,t,r){let a="./data/audio/"+e;return _e["a"].get(a).then(e=>{t(e)}).catch(e=>{r(e)})}function hs(e,t,r){let a="./data/target-v2/"+e;return _e["a"].get(a).then(e=>{t(e)}).catch(e=>{r(e)})}var fs=[{id:"bar-chart-task-example",label:"Bar Chart Example",group:"User Study",chartType:"Bar chart"},{id:"dc-courts-task1",label:"2017 DC Courts (Task 1)",group:"User Study",chartType:"Bar chart"},{id:"dc-courts-task2",label:"2017 DC Courts (Task 2)",group:"User Study",chartType:"Bar chart"},{id:"dc-courts-task3",label:"2017 DC Courts (Task 3)",group:"User Study",chartType:"Bar chart"},{id:"sat-score-task4",label:"SAT Score (Task 4)",group:"User Study",chartType:"Bar chart"},{id:"dc-courts-task1-ans",label:"2017 DC Courts (Task 1 Answer)",group:"User Study",chartType:"Bar chart"},{id:"dc-courts-task2-ans",label:"2017 DC Courts (Task 2 Answer)",group:"User Study",chartType:"Bar chart"},{id:"dc-courts-task3-ans",label:"2017 DC Courts (Task 3 Answer)",group:"User Study",chartType:"Bar chart"},{id:"sat-score-task4-ans",label:"SAT Score (Task 4 Answer)",group:"User Study",chartType:"Bar chart"},{id:"dc-courts-0",label:"2017 DC Courts",group:"Single chart",chartType:"Bar chart"},{id:"army-military-comparison-1",label:"GDP Comparison (Tutorial 2)",group:"Single chart",chartType:"Bar chart"},{id:"sat-score-0",label:"SAT Score",group:"Single chart",chartType:"Bar chart"},{id:"army-military-comparison-0",label:"GDP Comparison",group:"Single chart",chartType:"Bar chart"},{id:"bar-chart-0",label:"Simple Bar Chart (Binder)",group:"Single chart",chartType:"Bar chart"},{id:"bar-chart-1",label:"Simple Bar Chart (SSVG)",group:"Single chart",chartType:"Bar chart"},{id:"bar-chart-2",label:"Simple Bar Chart (using template)",group:"Single chart",chartType:"Bar chart"},{id:"bar-chart-3",label:"Simple Bar Chart (Binder, Any type)",group:"Single chart",chartType:"Bar chart"},{id:"bar-chart-4",label:"Simple Bar Chart (SSVG, Any type)",group:"Single chart",chartType:"Bar chart"}],gs=[{id:"australia-fire-example1",videoName:"Why does climate change make wildfires worse?",link:"https://youtu.be/mypEs1SBAUg?t=197",transcript:"In 2019, human-caused and out-of-control fires burned 976200 hectares of the Amazon rainforest. That's the third-highest increase in the rate of deforestation in the Amazon's history. At a 30% jump from the prior year, second only to 1995, which was 95% and 1998 which was 31%."},{id:"accounting-of-pirates-example1",videoName:"How Somalia’s Pirates Make Money",link:"https://youtu.be/dZh0B8AYxac?t=389",transcript:"First, investors get their guaranteed cut of at least 30%. The port, who looked the other way while they parked the ship, gets 5-10%. And the rest is split between the attackers, with a bonus of around $10,000 for being first to board the ship."},{id:"commute-mode-example1",videoName:"Why American public transit is so bad | 2020 Election",link:"https://youtu.be/-ZDZtBRTyeI?t=80",transcript:"The most common American commute is actually from suburb to suburb; routes that public transit in the US usually doesn’t serve. It’s one reason that the overwhelming majority of Americans get to work by driving alone. Most Americans don’t rely on public transit, making it better is rarely a top political priority, which makes things even harder for the people who do rely on neglected transit systems."},{id:"house-prices-example1",videoName:"Why are houses so expensive?",link:"https://youtu.be/vhAXp0xzMFg?t=189",transcript:"Here is a line chart."},{id:"army-military-comparison-example1",videoName:"China vs Japan - Who Would Win - Army / Military Comparison",link:"https://youtu.be/eBV4GmK4kO4?t=33",transcript:"The USA has the world's highest GDP of around 18.5 trillion dollars. It's followed by China with a nominal GDP of 11.8 trillion dollars, and then Japan with a GDP of around 4.8 trillion dollars. The European Union would take second place, but the EU is a combination of 28 states."},{id:"sat-score-example1",videoName:"The problem with America's college entrance exam",link:"https://youtu.be/WjVVwMGJ9S8?t=334",transcript:"Here's a chart of the average SAT scores by family income. Students whose families earn less than $20,000 score around 890 -- way below average. And as we move up the income brackets, students score higher and higher. The wealthiest students -- whose parents earn more than $200,000 -- score an average of 1150."},{id:"scottish-independence-referendum-example1",videoName:"Scottish independence referendum 2014 explained | Guardian Animations",link:"https://youtu.be/zIeVmqVB9pQ?t=29",transcript:"Didn't you just call Scotland a country? Isn't Scotland already a country? The definitive answer to that question is: sort of. Technically Scotland is a country within a country known as the United Kingdom. Scotland may have its own church, its own legal system, its own professional soccer league and its own dietary idiosyncrasies, but it’s still part of the UK, which also includes the countries of England, Wales and Northern Ireland."},{id:"share-of-profits-example1",videoName:"How American CEOs got so rich",link:"https://youtu.be/ylLTMYt24lA?t=299",transcript:"General Motor, Volkswagen and Toyota are three of the biggest motor corporations in the world. In this chart, you can see how much of their profits three companies spend on buybacks. GM has the highest buyback during this period, except 2016. Volkswagen hasn’t done any since 2012, and Toyota’s biggest buyback years are roughly the size of GM’s smallest."},{id:"shortage-of-water-example1",videoName:"Dubai's Plan to Outlive Oil",link:"https://youtu.be/-dsM8zPGqa0?t=159",transcript:"In the Middle East, the entire 3.2 million square kilometer peninsula lacks a single natural river. The United States, in comparison, has 250,000. 98.8% of Dubai’s water has to be pumped from the Persian Gulf and desalinated."},{id:"transportation-mode-example1",videoName:"Why American public transit is so bad | 2020 Election",link:"https://youtu.be/-ZDZtBRTyeI?t=243",transcript:"The people who live in these places are less likely than the national average to drive, and more likely to walk, bike, or take transit."},{id:"wealth-inequality-example1",videoName:"Wealth Inequality in America",link:"https://youtu.be/QPKKQnijnsM?t=161",transcript:"Here's that idea we asked everyone about something like this curve. This isn't too bad we've got some incentive as the wealthiest folks are now about 10 to 20 times better off than the poorest Americans. But hey even the poor folks aren't actually poor since the poverty line has stayed almost entirely off the chart. We have a super healthy middle class with a smooth transition into wealth, and yes Republicans and Democrats alike chose this curve."}],ms={"vega-lite1":{xAxis:"left",yAxis:"bottom",title:"top"},"vega-lite2":{xAxis:"left",yAxis:"bottom",title:"top"},"vega-lite3":{xAxis:"left",yAxis:"bottom",title:"top"},"vega-lite4":{xAxis:"left",yAxis:"bottom",title:"top"},"vega-lite5":{xAxis:"bottom",yAxis:"left",title:"bottom"},"vega-lite6":{xAxis:"bottom",yAxis:"left",title:"bottom"},"vega-lite7":{xAxis:"bottom",yAxis:"left",title:"bottom"},"vega-lite8":{xAxis:"left",yAxis:"bottom",title:"bottom"}};function ys(e){for(var t=e.split("; "),r={},a=0;a<t.length;a++){var n=t[a].split(": ");r[n[0]]=n[1]}return r}function vs(e,t){const r="bar-chart",a=(new DOMParser).parseFromString(e,"image/svg+xml").querySelector("svg"),n=Array.from(a.querySelectorAll("*:not(g,svg,defs,defs *)")).filter(e=>"true"!=e.ariaHidden),i=Array.from(a.querySelectorAll("*")).filter(e=>null!=e.ariaRoleDescription);var o=[];n.forEach(e=>{e.classList.add("chart"),null!=e.ariaLabel&&(e.setAttribute("ac-data",JSON.stringify(ys(e.ariaLabel))),o.push(ys(e.ariaLabel)))}),i.forEach(e=>{const r=e.ariaLabel;switch(e.ariaRoleDescription){case"axis":var a=e.ariaLabel[0].toLowerCase();e.getElementsByClassName("role-axis-tick").length>0&&Array.from(e.getElementsByClassName("role-axis-tick")).forEach(e=>{Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{e.classList.add(t),e.classList.add("axis"),e.classList.add(a+"-axis"),e.classList.add(a+"-tick")})}),e.getElementsByClassName("role-axis-label").length>0&&Array.from(e.getElementsByClassName("role-axis-label")).forEach(e=>{Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{r.includes("discrete")&&e.setAttribute("ac-data",JSON.stringify({TEXT:e.innerHTML})),e.classList.add(t),e.classList.add("axis"),e.classList.add(a+"-axis"),e.classList.add(a+"-label")})}),e.getElementsByClassName("role-axis-domain").length>0&&Array.from(e.getElementsByClassName("role-axis-domain")).forEach(e=>{Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{e.classList.add(t),e.classList.add("axis"),e.classList.add(a+"-axis"),e.classList.add(a+"-domain")})}),e.getElementsByClassName("role-axis-title").length>0&&Array.from(e.getElementsByClassName("role-axis-title")).forEach(e=>{Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{e.classList.add(t),e.classList.add("axis"),e.classList.add(a+"-title")})});break;case"rect mark container":var n=Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)"));n.length>0&&n.forEach(e=>{e.classList.add(t),e.classList.add("mark"),e.classList.add("bar")});break;case"line mark container":var i=Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)"));i.length>0&&i.forEach(e=>{e.classList.add(t),e.classList.add("mark"),e.classList.add("line")});break;case"arc mark container":var o=Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)"));o.length>0&&o.forEach(e=>{e.classList.add(t),e.classList.add("mark"),e.classList.add("sector")});break;case"text mark container":var s=Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)"));s.length>0&&s.forEach(e=>{e.classList.add(t),e.classList.add("mark"),e.classList.add("sector-label")});break;case"point":e.classList.add(t),e.classList.add("mark"),e.classList.add("point");break;case"legend":if(e.getElementsByClassName("role-legend-label").length>0&&e.getElementsByClassName("role-legend-symbol").length>0){var c=Array.from(e.getElementsByClassName("role-legend-label")),l=Array.from(e.getElementsByClassName("role-legend-symbol"));c.forEach((e,r)=>{var a=e.textContent.trim(),n=l[r];Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{e.setAttribute("ac-data",JSON.stringify({TEXT:a})),e.classList.add(t),e.classList.add("legend"),e.classList.add("legend-label")}),Array.from(n.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{e.setAttribute("ac-data",JSON.stringify({TEXT:a})),e.classList.add(t),e.classList.add("legend"),e.classList.add("legend-symbol")})})}break;case"title":Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{e.classList.add(t),e.classList.add("title"),e.classList.add("sub-title")});break}}),Array.from(a.getElementsByClassName("role-axis-grid")).forEach(e=>{Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{e.classList.add(t),e.classList.add("axis"),e.classList.add("grid")})});const s=new Map;n.forEach(e=>{let t=e.classList[e.classList.length-1];var r;t&&s.set(t,(null!==(r=s.get(t))&&void 0!==r?r:0)+1)}),s.forEach((e,t)=>{e>=1&&n.filter(e=>e.classList[e.classList.length-1]===t).forEach((e,r)=>e.setAttribute("id",`${t}-${r}`))}),n.forEach(e=>{const t=e.getAttribute("id");t&&""!==t||e.setAttribute("id",e.classList[e.classList.length-1]+"-ac-"+Object(P["a"])())}),n.forEach(e=>{e.classList.contains(t)||(e.classList.add(t),"rect"===e.tagName?(e.classList.add("background"),e.classList.add("bg-rect")):e.classList.add("unknown-type"))});const c=Ts(n,o),l=void 0===ms[t]?{xAxis:"left",yAxis:"unknown",title:"bottom"}:ms[t],u={chartType:r,elements:c,layout:l,target_type:"vega"},d=_s(a);return{targetModel:u,svgStr:d}}function _s(e){const t=document.createElement("div");return t.appendChild(e),t.innerHTML}function bs(e){let t=e.getAttribute("ac-data");return t?JSON.parse(t):null}function Ts(e,t){const r=[];return e.forEach(e=>{const a={},n=e.getAttribute("id"),i=e.getAttribute("class"),o=i.split(" "),s=e.tagName,c=bs(e);a.type=o[o.length-1],a.id=n,a.clazz=i,a.data=c,a.tag=s,"text"===s?0!==e.children.length?a.text=Array.from(e.children).reduce((e,t)=>e+" "+t.innerHTML,"").trim():a.text=e.innerHTML:a.text=null,null!=a.data&&"TEXT"in a.data&&(a.data=t.filter(e=>JSON.stringify(e).toLowerCase().includes(a.data["TEXT"].toLowerCase()))),r.push(a)}),r}const ws={updateSVGModel:vs,domElToString:_s},Ss=()=>({projectList:fs,galleryList:gs,staticSvgMap:new Map,staticSvgMapSign:!1,projectId:null,projectSpec:null,svgStrMap:new Map,audioStrMap:new Map,transcriptMap:new Map,targetModelMap:new Map,extraProjectSpecMap:new Map,linkingMap:new Map,audioEl:null}),xs={},Cs={async queryProjectSpec2({state:e,commit:t,dispatch:r},a){function n(e){const t=[],a=e.projectId,n=e.chart,i=e.audio;return t.push(r("queryStaticSVG",{projectId:a,svgFileName:n})),t.push(r("queryStaticAudio",{projectId:a,fileName:i})),Promise.all(t)}if(e.extraProjectSpecMap.has(a)){t("changeProjectId",a),t("initResources");const{svgStr:r,targetModel:n,transcript:i,audioStr:o,fakeProjectSpec:s}=e.extraProjectSpecMap.get(a);t("changeProjectSpec",s),t("addSVGStr",{projectId:a,svgStr:r}),t("addStaticSVGStr",{projectId:a,svgStr:r}),t("addAudioStr",{projectId:a,audioStr:o}),t("project/initProjectView",null,{root:!0}),t("editor/changeSceneById",0,{root:!0}),t("editor/initWorkspace",null,{root:!0})}else{t("changeProjectId",a),t("initResources");const e=a+".json5";ls(e,e=>{const r="string"===typeof e.data?ce.a.parse(e.data):e.data;t("changeProjectSpec",r),n(r).then(()=>{t("project/initProjectView",null,{root:!0}),t("editor/changeSceneById",0,{root:!0}),t("editor/initWorkspace",!0,{root:!0})})},e=>{Object(No["Notification"])({title:"Fail to get sample file.",message:e.message,type:"error"}),console.error(e)})}},async queryAllSvg({state:e,commit:t}){e.projectList.forEach(r=>{const a=r.id;if(e.staticSvgMap.has(a))return;const n=a+".json5";ls(n,e=>{console.log("queryProjectSpec success: "+n);const r="string"===typeof e.data?ce.a.parse(e.data):e.data,i=r.chart;if(""!==i){const e=i.trim().replace("./","").replace(".svg",""),r=e+".svg";us(r,e=>{t("addStaticSVGStr",{projectId:a,svgStr:e.data})},e=>{t("addStaticSVGStr",{projectId:a,svgStr:""}),console.error(e)})}},e=>{console.error(e)})})},queryStaticSVG({commit:e},{projectId:t,svgFileName:r}){return us(r,r=>{e("addSVGStr",{projectId:t,svgStr:r.data})},a=>{e("addSVGStr",{projectId:t,svgStr:""}),Object(No["Notification"])({title:`Chart resource ${r} not found.`,message:a.message,type:"warning"}),console.error(a)})},queryStaticAudio({commit:e},{projectId:t,fileName:r}){return ps(r,r=>{e("addAudioStr",{projectId:t,audioStr:r.data})},r=>{e("addAudioStr",{projectId:t,audioStr:""}),Object(No["Notification"])({title:"Fail to get static audio.",message:r.message,type:"error"}),console.log(r)})},queryTranscript({commit:e},{projectId:t,fileName:r}){return ds(r,r=>{e("addTranscript",{projectId:t,transcript:r.data})},a=>{e("addTranscript",{projectId:t,transcript:{}}),Object(No["Notification"])({title:`Transcript resource ${r} not found.`,message:a.message,type:"warning"}),console.error(a)})},queryTargetModel({commit:e},t){const r=t+".json";return hs(r,r=>{e("addTargetModel",{srcId:t,targetModel:r.data})},a=>{e("addTargetModel",{srcId:t,targetModel:null}),r.includes("vega")||(Object(No["Notification"])({title:`Target model ${r} not found.`,message:a.message,type:"warning"}),console.log(a))})},addProject({state:e,commit:t},{srcId:r,svgStr:a}){let n=r.toLowerCase().replace(/\s+/g,"-"),i=0;const o=new Set(e.projectList.map(e=>e.id));let s=n;while(o.has(s))i+=1,s=n+"-"+i;n=s;const c=ws.updateSVGModel(a,n);e.projectList.unshift({id:n,label:n,group:"Custom chart"});const l={svgStr:c.svgStr,targetModel:c.targetModel,transcript:{},audioStr:"",fakeProjectSpec:{projectId:n,scenes:[{charts:[{source:`./${n}.svg`}],animation:{target:"."+n,sequence:{sync:[]}}}]}};e.extraProjectSpecMap.set(n,l),t("addStaticSVGStr",{projectId:n,svgStr:c.svgStr}),t("changeProjectId",n)}},As={changeProjectId(e,t){e.projectId=t},initResources(e){e.projectSpec=null,e.svgStrMap=new Map,e.audioStrMap=new Map,e.transcriptMap=new Map,e.targetModelMap=new Map},changeProjectSpec(e,t){e.projectSpec=t},addSVGStr(e,{projectId:t,svgStr:r}){e.svgStrMap.set(t,r)},addStaticSVGStr(e,{projectId:t,svgStr:r}){e.staticSvgMap.set(t,r),setTimeout(()=>this.commit("resource/changeStaticSvgMapSign"),0)},changeStaticSvgMapSign(e){e.staticSvgMapSign^=!0},addAudioStr(e,{projectId:t,audioStr:r}){e.audioStrMap.set(t,r)},addTranscript(e,{projectId:t,transcript:r}){e.transcriptMap.set(t,r)},addTargetModel(e,{projectId:t,targetModel:r}){e.targetModelMap.set(t,r)},addLinking(e,{srcId:t,linking:r}){e.linkingMap.set(t,r)},updateSVGModel(e,{chartId:t,svgStr:r,targetModel:a}){e.svgStrMap.set(t,r),e.targetModelMap.set(t,a)},registerAudioEl(e,t){e.audioEl=t}};var $s={namespaced:!0,state:Ss,getters:xs,actions:Cs,mutations:As};function ks(){let e=0;const t=(t,r)=>{r.forEach(r=>{t.children.push(new Rs(e++,r,!0))})},r=new Rs(e++,"scene"),a=new Rs(e++,"background");r.children.push(a);const n=new Rs(e++,"chart");r.children.push(n);const i=new Rs(e++,"title");n.children.push(i),t(i,["main-title","sub-title"]);const o=new Rs(e++,"mark");n.children.push(o),t(o,["bar","label bar-label","line","point","area","sector"]);const s=new Rs(e++,"axis");n.children.push(s);const c=new Rs(e++,"legend");n.children.push(c),t(c,["legend-label","legend-symbol"]);const l=new Rs(e++,"x-axis");s.children.push(l),t(l,["domain x-domain","label x-label","tick x-tick","symbol x-symbol","title x-title"]);const u=new Rs(e++,"y-axis");return s.children.push(u),t(u,["domain y-domain","label y-label","tick y-tick","symbol y-symbol","title y-title"]),Ps(r),Rs.toJSON(r)}function Ps(e,t){let r;r=t?t+" "+e.classes:e.classes,e.fullClasses=r,e.children.forEach(e=>Ps(e,r))}class Rs{constructor(e,t,r){Object(Ge["a"])(this,"id",void 0),Object(Ge["a"])(this,"type",void 0),Object(Ge["a"])(this,"classes",void 0),Object(Ge["a"])(this,"fullClasses",void 0),Object(Ge["a"])(this,"children",void 0),Object(Ge["a"])(this,"isLeaf",void 0),this.id=e,this.classes=t;const a=t.split(" ");this.type=a[a.length-1],this.children=[],this.isLeaf=null!==r&&void 0!==r&&r}static toJSON(e){return Object.assign({},e,{children:e.children.map(e=>Rs.toJSON(e))})}}const Es=new Set(["mark","axis","title","annotation","background","legend","unknown-type"]),Os=()=>({chartType:"unknown",fullTargetList:[],selectedTargets:[],groupedTargetsMap:new Map,dataGroupUpdateKeyword:null,fullTargetLoadSign:0,tableSelectionChangeSign:0,dataGroupChangeSign:0,dataGroupClearSign:0,svgSelectionChangeSign:0,visibilityChangeSign:0,new_counter:0,dragDropSVG:null,clientX:0,clientY:0,targetTree:ks(),activeFilters:[]}),Is={isDragging:e=>null!=e.dragDropSVG},Ns={},Ms={initTargetModel(e,t){e.chartType=t.chartType,e.fullTargetList=t.elements,e.groupedTargetsMap=new Map,e.selectedTargets=[],e.fullTargetList.forEach(e=>{e.classList=e.clazz.split(" ").reverse()}),e.fullTargetList.forEach(e=>{let t=e.classList.find(t=>t.match(e.type+"-\\d*"));if(t){const r=t.match(/^.*-(\d*)$/),a=r[1];t=e.type+" #"+a}else t=e.type;e.name=t});const r=new Map;e.fullTargetList.forEach(e=>{var t;r.set(e.name,(null!==(t=r.get(e.name))&&void 0!==t?t:0)+1)}),r.forEach((t,r)=>{t>1&&e.fullTargetList.filter(e=>e.name===r).forEach((e,t)=>e.name=`${r} #${t}`)}),e.fullTargetList.forEach(e=>{const t=e.classList.find(e=>Es.has(e));e.mainClass=null!==t&&void 0!==t?t:null}),e.fullTargetList.forEach(e=>{e.visibility=!0}),e.fullTargetList.forEach(t=>{if(null!==t.data){var r=t.data;r.constructor!=Array&&(r=new Array(r)),r=r.map(e=>JSON.stringify(e).toLowerCase()),t.related_targets=e.fullTargetList.filter(e=>{if(e.id==t.id||null===e.data)return!1;var a=e.data;return a.constructor!=Array&&(a=new Array(a)),a=a.map(e=>JSON.stringify(e).toLowerCase()),a.every(e=>r.includes(e))&&a.length>0})}}),e.fullTargetList.forEach(e=>{var t=null;null!=e.text?t=e.text.toLowerCase().trim():null!=e.data&&(e.type.includes("symbol")||e.type.includes("sector-line"))&&("object"===typeof e.data&&void 0!=e.data.name?t=e.data.name.toLowerCase().trim():("string"===typeof e.data||e.data instanceof String)&&(t=e.data.toLowerCase().trim())),e.keyword=t}),e.fullTargetList.forEach(t=>{if(null!==t.keyword&&void 0!==t.keyword){e.groupedTargetsMap.has(t.keyword)||e.groupedTargetsMap.set(t.keyword,new Set);var r=e.groupedTargetsMap.get(t.keyword);r.add(t.id),null!=t.related_targets&&t.related_targets.forEach(e=>r.add(e.id)),e.groupedTargetsMap.set(t.keyword,r)}}),this.commit("target/changeFullTargetLoadSign"),this.commit("target/changeTableSelectionSign")},updateDataGroup(e,{targets:t,keyword:r,oldkeyword:a}){e.groupedTargetsMap.set(r,new Set(t)),this.commit("target/changeDataGroupSign"),a&&this.commit("target/changeDataGroupKeyword",r)},changeFullTargetLoadSign(e){e.fullTargetLoadSign^=1},changeSelectedTargets(e,t){e.selectedTargets=t},changeSelectedTargetsById(e,t){const r=new Set(t);e.selectedTargets=e.fullTargetList.filter(e=>r.has(e.id))},changeSelectedTargetsByIcon(e,t){if("string"===typeof t.target){const r=new Set(t.target.replace(/[#,]/g,"").split(/[\s\n]/));e.selectedTargets=e.fullTargetList.filter(e=>r.has(e.id))}else if(Array.isArray(t.target)){const r=new Set(t.target);e.selectedTargets=e.fullTargetList.filter(e=>r.has(e.id))}},changeActiveFilters(e,t){e.activeFilters=t},changeTableSelectionSign(e){e.tableSelectionChangeSign^=1},changeDataGroupSign(e){e.dataGroupChangeSign^=1},changeDataGroupKeyword(e,t){e.dataGroupUpdateKeyword=t},resetDataGroupKeyword(e){e.dataGroupUpdateKeyword=null},changeSvgSelectionChangeSign(e){e.svgSelectionChangeSign^=1},changeVisibilityChangeSign(e){e.visibilityChangeSign^=1},changeDragDropSVG(e,t){e.dragDropSVG=t},changeCursorPosition(e,{x:t,y:r}){e.clientX=t,e.clientY=r},setTargetType(e,{targetIdList:t,targetNode:r}){const a=new Set(t),n=e.fullTargetList.filter(e=>a.has(e.id)),i=this.state.editor.scene.chartId;n.forEach(e=>{e.clazz=i+" "+r.fullClasses,e.classList=r.fullClasses.split(" ").reverse(),e.type=r.type;const t=e.classList.find(e=>Es.has(e));e.mainClass=null!==t&&void 0!==t?t:null}),e.fullTargetList=[...e.fullTargetList],this.commit("target/changeTableSelectionSign")},setTargetClass(e,{targetIdList:t,targetClass:r}){const a=new Set(t);e.fullTargetList.forEach((t,n)=>{a.has(t.id)&&(t.mainClass=r,e.fullTargetList[n]=t)}),e.fullTargetList=[...e.fullTargetList]},changeVisibility(e,{showIdList:t,hideIdList:r}){const a=new Set(t),n=new Set(r);for(let i=0;i<e.fullTargetList.length;i++){const t=e.fullTargetList[i];a.has(t.id)?(t.visibility=!0,e.fullTargetList[i]=t):n.has(t.id)&&(t.visibility=!1,e.fullTargetList[i]=t)}this.commit("target/changeVisibilityChangeSign")}};var Ls={namespaced:!0,state:Os,getters:Is,actions:Ns,mutations:Ms};class js{constructor(){Object(Ge["a"])(this,"id",void 0),Object(Ge["a"])(this,"spec",void 0),Object(Ge["a"])(this,"chartId",void 0),Object(Ge["a"])(this,"svgStr",void 0),Object(Ge["a"])(this,"audioStr",void 0),Object(Ge["a"])(this,"transcript",void 0),Object(Ge["a"])(this,"targetModel",void 0),Object(Ge["a"])(this,"sceneEl",void 0),Object(Ge["a"])(this,"audioDuration",void 0),this.id=Object(P["a"])(),this.spec={charts:[],templates:[],animation:null,binder:null}}}const Bs=()=>({isInitialized:!1,scenes:[],selectedScene:null,canvasHeight:500,canvasWidth:800,canvasRenderSign:0,sceneEl:null,animationJSON:null,timeline:null,running:!1,useAudio:!0,audioSrc:"",audioEl:null,audioReady:!1}),Zs={},Ds={async compile({commit:e,dispatch:t}){await t("createAudioSrc"),e("createAnimationJSON"),e("createTimeline")},createAudioSrc({state:e,commit:t}){e.scenes.some(e=>!e.audioSrc)&&(console.warn("Missing audio resources"),t("setAudioSrc",""));const r=e.scenes.map(e=>e.audioStr).map(e=>Ko.dataURItoBlob(e)),a=r.map(e=>Ko.blobToAudioBuffer(e));return Promise.all(a).then(e=>{console.log(e),e.map((e,r)=>{const a=Ko.computeAudioDuration(e);t("setSceneAudioDuration",{sceneIndex:r,duration:a})});const r=e.map(()=>1),a=Ko.concatAudio(e,r),n=Ko.audioBufferToBlob(a),i=window.URL.createObjectURL(n);t("setAudioSrc",i)})}},Gs={initProjectView(e){e.scenes=[];const t=this.state.resource.projectSpec,r=new js,a=r.id=t.projectId,n=r.chartId=t.chart.replace("./","").replace(".svg","");r.spec={charts:[n],templates:t.templates,animation:t.animation,binder:t.binder},r.svgStr=this.state.resource.svgStrMap.get(a),r.audioStr=this.state.resource.audioStrMap.get(a),r.transcript=this.state.resource.transcriptMap.get(a),r.targetModel=this.state.resource.targetModelMap.get(a),r.linking=this.state.resource.linkingMap.get(a),console.log(r),e.scenes.push(r),e.selectedScene=e.scenes[0],e.isInitialized=!0,this.commit("project/changeCanvasRenderSign")},changeSelectedScene(e,t){e.selectedScene=t},addScene(e,{charts:t}){const r=new js;e.scenes.push(r),t&&(r.spec.charts=t)},mountSceneElement(e,t){e.sceneEl=t},createTimeline(e){Hi.resetTemplateLib(),e.scenes.map(e=>e.spec.templates).forEach(e=>{e&&Hi.registerTemplates(...e)}),e.timeline&&(e.timeline.kill(),e.timeline.clear(),e.timeline=null);try{e.timeline=Hi.render(e.sceneEl,e.animationJSON,{});const t=function(){e.running=!1,e.timeline.pause()};e.timeline.eventCallback("onComplete",t)}catch(t){alert(t),console.error(t),Object(No["Notification"])({title:"Compile failed",message:t.message,type:"warning"})}},createAnimationJSON(e){const t=[...e.sceneEl.querySelectorAll(":scope > svg")].reverse(),r=[];e.scenes.forEach((e,a)=>{const n=t[a].id;let i;r.push({target:"#scene-cover-"+a,use:"fade-out",timing:{duration:.5,offset:0===a?0:-.5}}),i=0!==e.spec.animation.sequence.sync.length?Zo(e.spec.animation):{use:"empty",timing:{duration:2}},i.target="."+e.chartId;const o={sequence:{sync:[i,{use:"empty",timing:{duration:e.audioDuration}}]}};r.push(o),r.push({target:"#"+n,use:"fade-out",timing:{duration:.5,offset:1}})}),e.animationJSON={sequence:{concat:r}}},changeCanvasRenderSign(e){e.canvasRenderSign^=1},mountAudioElement(e,t){e.audioEl=t},setAudioSrc(e,t){e.audioSrc=t,e.setAudioReadyFunc?e.audioEl.removeEventListener("canplaythrough",e.setAudioReadyFunc,!1):e.setAudioReadyFunc=function(){e.audioReady=!0},e.audioReady=!1,e.audioEl.addEventListener("canplaythrough",e.setAudioReadyFunc,!1)},changeUseAudio(e,t){e.useAudio=t},changeAudioReady(e,t){e.audioReady=t},setSceneAudioDuration(e,{sceneIndex:t,duration:r}){e.scenes[t].audioDuration=r},playAnimation(e){e.running=!0,e.timeline.resume(),e.audioReady&&e.useAudio&&e.audioEl.play()},pauseAnimation(e){e.running=!1,e.timeline.pause(),e.audioReady&&e.useAudio&&e.audioEl.pause()},restartAnimation(e){e.running=!0,e.timeline.restart(),e.audioReady&&e.useAudio&&(e.audioEl.pause(),e.audioEl.currentTime=0,e.audioEl.play())}};var Us={namespaced:!0,state:Bs,getters:Zs,actions:Ds,mutations:Gs};a["default"].use(x["a"]);var Fs=new x["a"].Store({modules:{editor:cs,resource:$s,target:Ls,project:Us},strict:!1}),zs=(r("143c"),r("b2d6")),Vs=r.n(zs),Hs=r("21a6");const Ws=new a["default"];a["default"].config.productionTip=!1,a["default"].use(n["a"]),a["default"].use(Mo.a,{locale:Vs.a}),a["default"].use(ue.a),a["default"].prototype.$saveAs=Hs["saveAs"],new a["default"]({render:e=>e(d),router:Io,store:Fs}).$mount("#app")},"5a51":function(module,exports,__webpack_require__){(function(global,Buffer){__webpack_require__("c73d"),__webpack_require__("d9e2"),__webpack_require__("14d9"),__webpack_require__("f8c9"),__webpack_require__("5494"),__webpack_require__("5b81"),__webpack_require__("33d1"),__webpack_require__("ea98"),function(e,t){t(exports,__webpack_require__("1c46"),__webpack_require__("f654"),__webpack_require__("52db"),__webpack_require__("22fb"))}(0,(function(exports,crypto,assert,gsap$1,JSON5){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var CompileExec=function(){function e(t,r,a){_classCallCheck(this,e),this._resolved=null,this._planned=null,this._generated=null,this.session=t,this._unresolved=r,this._targetModel=a}return _createClass(e,[{key:"setResolver",value:function(e){return this._resolver=e,this}},{key:"setSynthesizer",value:function(e){return this._synthesizer=e,this}},{key:"templateLibrary",get:function(){return this.session.templateLibrary}},{key:"targetModel",get:function(){if(null===this._unresolved)throw new Error("QuickExec does not contain a TargetModel.");return this._targetModel}},{key:"parsed",get:function(){if(null===this._unresolved)throw new Error("QuickExec does not contain a LogicalAnimation.");return this._unresolved}},{key:"resolved",get:function(){if(null===this._unresolved)throw new Error("QuickExec cannot be used to resolve LogicalAnimation.");return null===this._resolved&&(this._resolved=this._resolver.execute(this._unresolved)),this._resolved}},{key:"planned",get:function(){return null===this._planned&&(this._planned=this._synthesizer.plan(this.resolved)),this._planned}},{key:"generated",get:function(){return null===this._generated&&(this._generated=this._synthesizer.generate(this.planned)),this._generated}}],[{key:"quickExec",value:function(t){return new e(t,null,null)}},{key:"fullyExec",value:function(t,r,a){return new e(t,r,a)}}]),e}();function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _inherits(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}var Package=function(){function e(t,r){_classCallCheck(this,e),this.classMap=new Map,this.subPackageMap=new Map,this.packageName=t,this.parent=r}return _createClass(e,[{key:"isDefault",value:function(){return null===this.parent}},{key:"registerProto",value:function(e){return this.classMap.set(e.name,e),this}},{key:"unregisterProto",value:function(e){return this.classMap["delete"](e)}},{key:"queryAllProto",value:function(){return Array.from(this.classMap.values())}},{key:"queryProto",value:function(e){var t;return null!==(t=this.classMap.get(e))&&void 0!==t?t:null}},{key:"addSubPackage",value:function(e){this.subPackageMap.set(e.packageName,e)}},{key:"querySubPackages",value:function(){return Array.from(this.subPackageMap.values())}},{key:"querySubPackage",value:function(e){var t;return null!==(t=this.subPackageMap.get(e))&&void 0!==t?t:null}}],[{key:"createPackage",value:function(t,r){return new e(t,r)}},{key:"createDefaultPackage",value:function(){return new e("",null)}}]),e}(),commonjsGlobal="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}var freeGlobal$1="object"==typeof commonjsGlobal&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,_freeGlobal=freeGlobal$1,freeGlobal=_freeGlobal,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root$8=freeGlobal||freeSelf||Function("return this")(),_root=root$8,root$7=_root,Symbol$6=root$7.Symbol,_Symbol$1=Symbol$6,Symbol$5=_Symbol$1,objectProto$d=Object.prototype,hasOwnProperty$a=objectProto$d.hasOwnProperty,nativeObjectToString$1=objectProto$d.toString,symToStringTag$1=Symbol$5?Symbol$5.toStringTag:void 0;function getRawTag$1(e){var t=hasOwnProperty$a.call(e,symToStringTag$1),r=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var a=!0}catch(i){}var n=nativeObjectToString$1.call(e);return a&&(t?e[symToStringTag$1]=r:delete e[symToStringTag$1]),n}var _getRawTag=getRawTag$1,objectProto$c=Object.prototype,nativeObjectToString=objectProto$c.toString;function objectToString$1(e){return nativeObjectToString.call(e)}var _objectToString=objectToString$1,Symbol$4=_Symbol$1,getRawTag=_getRawTag,objectToString=_objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$4?Symbol$4.toStringTag:void 0;function baseGetTag$9(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}var _baseGetTag=baseGetTag$9,isArray$9=Array.isArray,isArray_1=isArray$9,isArray$a=getDefaultExportFromCjs(isArray_1);function isObjectLike$b(e){return null!=e&&"object"==typeof e}var isObjectLike_1=isObjectLike$b,baseGetTag$8=_baseGetTag,isArray$8=isArray_1,isObjectLike$a=isObjectLike_1,stringTag$3="[object String]";function isString(e){return"string"==typeof e||!isArray$8(e)&&isObjectLike$a(e)&&baseGetTag$8(e)==stringTag$3}var isString_1=isString,isString$1=getDefaultExportFromCjs(isString_1);function _createForOfIteratorHelper$c(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$d(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$d(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray$d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$d(e,t):void 0}}function _arrayLikeToArray$d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var ProtoManager=function(){function e(){_classCallCheck(this,e),this.rootPackage=Package.createDefaultPackage(),this._protoSize=0}return _createClass(e,[{key:"protoSize",get:function(){return this._protoSize}},{key:"createPackage",value:function(t){var r,a=isString$1(t)?e.splitPath(t):t,n=this.rootPackage,i=_createForOfIteratorHelper$c(a);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.querySubPackage(o);null===s&&(s=Package.createPackage(o,n),n.addSubPackage(s)),n=s}}catch(c){i.e(c)}finally{i.f()}return n}},{key:"queryPackage",value:function(t){for(var r=isString$1(t)?e.splitPath(t):t,a=this.rootPackage,n=0;n<r.length;++n){var i=a.querySubPackage(r[n]);if(null===i)return null;a=i}return a}},{key:"registerProto",value:function(e){var t=e.name,r=e.packageName,a=this.queryPackage(r);if(null===a)a=this.createPackage(r);else if(null!==a.queryProto(t))throw new Error("Proto ".concat(e.fullName," has already been registered."));a.registerProto(e),this._protoSize+=1}},{key:"registerOrUpdateProto",value:function(e){var t=e.name,r=e.packageName,a=this.queryPackage(r);null===a&&(a=this.createPackage(r)),null===a.queryProto(t)?this._protoSize+=1:a.unregisterProto(t),a.registerProto(e)}},{key:"unregisterProto",value:function(e){var t=this.queryProtoByFullName(e);if(null===t)throw new Error("Proto ".concat(e," doesn't exist."));var r=this.queryPackage(t.packageName),a=r.unregisterProto(t.name);return a&&(this._protoSize-=1),a}},{key:"queryProtoByFullName",value:function(t){var r=isString$1(t)?e.splitPath(t):t;if(0===r.length)throw new Error("Invalid proto name path ".concat(t,"."));var a=r.pop(),n=this.queryPackage(r);return n.queryProto(a)}},{key:"containProtoByFullName",value:function(e){return null===this.queryProtoByFullName(e)}},{key:"queryProto",value:function(t){var r=isString$1(t)?e.splitPath(t):t;if(0===r.length)throw new Error("Invalid proto name path ".concat(t,"."));var a=r.pop(),n=r.join("."),i=this.findProto(a).filter((function(e){return e.packageName.endsWith(n)}));if(1===i.length)return i[0];if(0!==i.length){var o=i.find((function(e){return""===e.packageName}));if(void 0!==o)return o;throw new Error("Ambiguous proto name. "+"".concat(i.length," prototypes found: \n")+"".concat(i.map((function(e){return e.fullName})).join("\n"),"\n"))}}},{key:"queryProtoByPackage",value:function(e){var t=this.queryPackage(e);if(null!==t)return t.queryAllProto()}},{key:"queryAllProto",value:function(){var e=[];return this.queryAllProtoHelper(this.rootPackage,e),e}},{key:"queryAllProtoHelper",value:function(e,t){var r=this;e.queryAllProto().forEach((function(e){return t.push(e)})),e.querySubPackages().forEach((function(e){return r.queryAllProtoHelper(e,t)}))}},{key:"findProto",value:function(e){var t=[],r=function r(a){var n=a.queryProto(e);null!==n&&t.push(n),a.querySubPackages().forEach((function(e){return r(e)}))};return r(this.rootPackage),t}}],[{key:"splitPath",value:function(e){if(""===e.trim())return[];var t=e.split(".").map((function(e){return e.trim()})),r=t.every((function(e){return e.match("[a-zA-Z0-9]+")}));if(!r)throw new Error("Invalid package/proto path ".concat(e,"."));return t}}]),e}(),Library=function(){function e(){_classCallCheck(this,e),this.protoManager=new ProtoManager}return _createClass(e,[{key:"size",get:function(){return this.protoManager.protoSize}},{key:"register",value:function(e){var t=this;return Array.isArray(e)?e.forEach((function(e){return t.protoManager.registerProto(e)})):this.protoManager.registerProto(e),this}},{key:"registerOrUpdate",value:function(e){var t=this;return Array.isArray(e)?e.forEach((function(e){return t.protoManager.registerOrUpdateProto(e)})):this.protoManager.registerOrUpdateProto(e),this}},{key:"unregister",value:function(e){return this.protoManager.unregisterProto(e)}},{key:"get",value:function(e){return this.protoManager.queryProto(e)}},{key:"getAll",value:function(){return this.protoManager.queryAllProto()}},{key:"getByPackage",value:function(e){return this.protoManager.queryProtoByPackage(e)}}]),e}();function _createSuper$1a(e){var t=_isNativeReflectConstruct$1b();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1b(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var TemplateLibrary=function(e){_inherits(r,e);var t=_createSuper$1a(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Library),_LoggerManagerClass$l,_LoggerManagerClass$l2,LogLevel;function _defineProperty$1(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _arrayLikeToArray$c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray$c(e)}function _iterableToArray(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _unsupportedIterableToArray$c(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray$c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$c(e,t):void 0}}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray$c(e)||_nonIterableSpread()}function toTreeString(e){return toTreeStringHelper(e).join("\n")}function toTreeStringHelper(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=[],n=""===t,i=t+(n?"":r?"└─ ":"├─ ")+e.toOneLineString();a.push(i);for(var o=e.visitChildren(),s=0;s<o.length;s++){var c=o[s],l=s===o.length-1,u=t+(n?" ":r?"   ":"│  "),d=toTreeStringHelper(c,u,l);a.push.apply(a,_toConsumableArray(d))}return a}(function(e){e["TRACE"]="TRACE",e["DEBUG"]="DEBUG",e["INFO"]="INFO",e["WARN"]="WARN",e["ERROR"]="ERROR"})(LogLevel||(LogLevel={}));var Logger=function(){function e(t,r){_classCallCheck(this,e),this.manager=t,this.caller=r}return _createClass(e,[{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,[LogLevel.TRACE].concat(t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,[LogLevel.DEBUG].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,[LogLevel.INFO].concat(t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,[LogLevel.WARN].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,[LogLevel.ERROR].concat(t))}},{key:"log",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];this.manager.log(e,this.caller,r.map((function(e){return String(e)})).join(" "))}},{key:"logResolve",value:function(e,t,r){var a="Resolve ".concat(e.toString()," -> ").concat(t.toString()," by rule ").concat(r.ruleName,"\n")+"Before:\n".concat(toTreeString(e),"\nAfter:\n").concat(toTreeString(t));this.debug(a)}}]),e}(),LoggerManagerClass=function(){function e(){_classCallCheck(this,e),this.logLevel=LogLevel.TRACE,this._records=[]}return _createClass(e,[{key:"getLogger",value:function(e){return new Logger(this,e)}},{key:"setLogLevel",value:function(e){this.logLevel=e}},{key:"clear",value:function(){this._records=[]}},{key:"log",value:function(t,r,a){var n={timestamp:Date.now(),level:t,caller:r,msg:a};this._records.push(n),e.logLevel2Rank[t]>=e.logLevel2Rank[this.logLevel]&&e.logLevel2Method[t](e.log2Str(n))}},{key:"records",get:function(){return _toConsumableArray(this._records)}}],[{key:"log2Str",value:function(e){return"".concat(new Date(e.timestamp).toLocaleString()," [").concat(e.level,"] [").concat(e.caller,"] ").concat(e.msg)}}]),e}();LoggerManagerClass.logLevel2Method=(_LoggerManagerClass$l={},_defineProperty$1(_LoggerManagerClass$l,LogLevel.TRACE,console.debug),_defineProperty$1(_LoggerManagerClass$l,LogLevel.DEBUG,console.debug),_defineProperty$1(_LoggerManagerClass$l,LogLevel.INFO,console.info),_defineProperty$1(_LoggerManagerClass$l,LogLevel.WARN,console.warn),_defineProperty$1(_LoggerManagerClass$l,LogLevel.ERROR,console.error),_LoggerManagerClass$l),LoggerManagerClass.logLevel2Rank=(_LoggerManagerClass$l2={},_defineProperty$1(_LoggerManagerClass$l2,LogLevel.TRACE,0),_defineProperty$1(_LoggerManagerClass$l2,LogLevel.DEBUG,1),_defineProperty$1(_LoggerManagerClass$l2,LogLevel.INFO,2),_defineProperty$1(_LoggerManagerClass$l2,LogLevel.WARN,3),_defineProperty$1(_LoggerManagerClass$l2,LogLevel.ERROR,4),_LoggerManagerClass$l2);var LoggerManager=new LoggerManagerClass,util,objectUtil;function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(a=r.next()).done);o=!0)if(i.push(a.value),t&&i.length===t)break}catch(c){s=!0,n=c}finally{try{o||null==r["return"]||r["return"]()}finally{if(s)throw n}}return i}}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray$c(e,t)||_nonIterableRest()}(function(e){function t(e){}function r(e){throw new Error}function a(e,t=" | "){return e.map(e=>"string"===typeof e?`'${e}'`:e).join(t)}e.assertEqual=e=>e,e.assertIs=t,e.assertNever=r,e.arrayToEnum=e=>{const t={};for(const r of e)t[r]=r;return t},e.getValidEnumValues=t=>{const r=e.objectKeys(t).filter(e=>"number"!==typeof t[t[e]]),a={};for(const e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"===typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(const r of e)if(t(r))return r},e.isInteger="function"===typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"===typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=a,e.jsonStringifyReplacer=(e,t)=>"bigint"===typeof t?t.toString():t})(util||(util={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(objectUtil||(objectUtil={}));const ZodParsedType=util.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType=e=>{const t=typeof e;switch(t){case"undefined":return ZodParsedType.undefined;case"string":return ZodParsedType.string;case"number":return isNaN(e)?ZodParsedType.nan:ZodParsedType.number;case"boolean":return ZodParsedType.boolean;case"function":return ZodParsedType.function;case"bigint":return ZodParsedType.bigint;case"symbol":return ZodParsedType.symbol;case"object":return Array.isArray(e)?ZodParsedType.array:null===e?ZodParsedType.null:e.then&&"function"===typeof e.then&&e.catch&&"function"===typeof e.catch?ZodParsedType.promise:"undefined"!==typeof Map&&e instanceof Map?ZodParsedType.map:"undefined"!==typeof Set&&e instanceof Set?ZodParsedType.set:"undefined"!==typeof Date&&e instanceof Date?ZodParsedType.date:ZodParsedType.object;default:return ZodParsedType.unknown}},ZodIssueCode=util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),quotelessJson=e=>{const t=JSON.stringify(e,null,2);return t.replace(/"([^"]+)":/g,"$1:")};class ZodError extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},r={_errors:[]},a=e=>{for(const n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(a);else if("invalid_return_type"===n.code)a(n.returnTypeError);else if("invalid_arguments"===n.code)a(n.argumentsError);else if(0===n.path.length)r._errors.push(t(n));else{let e=r,a=0;while(a<n.path.length){const r=n.path[a],i=a===n.path.length-1;i?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(n))):e[r]=e[r]||{_errors:[]},e=e[r],a++}}};return a(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,util.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=(e=>e.message)){const t={},r=[];for(const a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}ZodError.create=e=>{const t=new ZodError(e);return t};const errorMap=(e,t)=>{let r;switch(e.code){case ZodIssueCode.invalid_type:r=e.received===ZodParsedType.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case ZodIssueCode.invalid_literal:r="Invalid literal value, expected "+JSON.stringify(e.expected,util.jsonStringifyReplacer);break;case ZodIssueCode.unrecognized_keys:r="Unrecognized key(s) in object: "+util.joinValues(e.keys,", ");break;case ZodIssueCode.invalid_union:r="Invalid input";break;case ZodIssueCode.invalid_union_discriminator:r="Invalid discriminator value. Expected "+util.joinValues(e.options);break;case ZodIssueCode.invalid_enum_value:r=`Invalid enum value. Expected ${util.joinValues(e.options)}, received '${e.received}'`;break;case ZodIssueCode.invalid_arguments:r="Invalid function arguments";break;case ZodIssueCode.invalid_return_type:r="Invalid function return type";break;case ZodIssueCode.invalid_date:r="Invalid date";break;case ZodIssueCode.invalid_string:"object"===typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"===typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:util.assertNever(e.validation):r="regex"!==e.validation?"Invalid "+e.validation:"Invalid";break;case ZodIssueCode.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case ZodIssueCode.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case ZodIssueCode.custom:r="Invalid input";break;case ZodIssueCode.invalid_intersection_types:r="Intersection results could not be merged";break;case ZodIssueCode.not_multiple_of:r="Number must be a multiple of "+e.multipleOf;break;case ZodIssueCode.not_finite:r="Number must be finite";break;default:r=t.defaultError,util.assertNever(e)}return{message:r}};let overrideErrorMap=errorMap;function setErrorMap(e){overrideErrorMap=e}function getErrorMap(){return overrideErrorMap}const makeIssue=e=>{const{data:t,path:r,errorMaps:a,issueData:n}=e,i=[...r,...n.path||[]],o={...n,path:i};let s="";const c=a.filter(e=>!!e).slice().reverse();for(const l of c)s=l(o,{data:t,defaultError:s}).message;return{...n,path:i,message:n.message||s}},EMPTY_PATH=[];function addIssueToContext(e,t){const r=makeIssue({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,getErrorMap(),errorMap].filter(e=>!!e)});e.common.issues.push(r)}class ParseStatus{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const a of t){if("aborted"===a.status)return INVALID;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const a of t)r.push({key:await a.key,value:await a.value});return ParseStatus.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const a of t){const{key:t,value:n}=a;if("aborted"===t.status)return INVALID;if("aborted"===n.status)return INVALID;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),("undefined"!==typeof n.value||a.alwaysSet)&&(r[t.value]=n.value)}return{status:e.value,value:r}}}const INVALID=Object.freeze({status:"aborted"}),DIRTY=e=>({status:"dirty",value:e}),OK=e=>({status:"valid",value:e}),isAborted=e=>"aborted"===e.status,isDirty=e=>"dirty"===e.status,isValid=e=>"valid"===e.status,isAsync=e=>"undefined"!==typeof Promise&&e instanceof Promise;var errorUtil;(function(e){e.errToObj=e=>"string"===typeof e?{message:e}:e||{},e.toString=e=>"string"===typeof e?e:null===e||void 0===e?void 0:e.message})(errorUtil||(errorUtil={}));class ParseInputLazyPath{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const handleResult=(e,t)=>{if(isValid(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ZodError(e.common.issues);return this._error=t,this._error}}};function processCreateParams(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:a,description:n}=e;if(t&&(r||a))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:n};const i=(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:"undefined"===typeof t.data?{message:null!==a&&void 0!==a?a:t.defaultError}:{message:null!==r&&void 0!==r?r:t.defaultError};return{errorMap:i,description:n}}class ZodType{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return getParsedType(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:getParsedType(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:getParsedType(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(isAsync(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const a={common:{issues:[],async:null!==(r=null===t||void 0===t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null===t||void 0===t?void 0:t.errorMap},path:(null===t||void 0===t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType(e)},n=this._parseSync({data:e,path:a.path,parent:a});return handleResult(a,n)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:null===t||void 0===t?void 0:t.errorMap,async:!0},path:(null===t||void 0===t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType(e)},a=this._parse({data:e,path:r.path,parent:r}),n=await(isAsync(a)?a:Promise.resolve(a));return handleResult(r,n)}refine(e,t){const r=e=>"string"===typeof t||"undefined"===typeof t?{message:t}:"function"===typeof t?t(e):t;return this._refinement((t,a)=>{const n=e(t),i=()=>a.addIssue({code:ZodIssueCode.custom,...r(t)});return"undefined"!==typeof Promise&&n instanceof Promise?n.then(e=>!!e||(i(),!1)):!!n||(i(),!1)})}refinement(e,t){return this._refinement((r,a)=>!!e(r)||(a.addIssue("function"===typeof t?t(r,a):t),!1))}_refinement(e){return new ZodEffects({schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return ZodOptional.create(this,this._def)}nullable(){return ZodNullable.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ZodArray.create(this,this._def)}promise(){return ZodPromise.create(this,this._def)}or(e){return ZodUnion.create([this,e],this._def)}and(e){return ZodIntersection.create(this,e,this._def)}transform(e){return new ZodEffects({...processCreateParams(this._def),schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"===typeof e?e:()=>e;return new ZodDefault({...processCreateParams(this._def),innerType:this,defaultValue:t,typeName:ZodFirstPartyTypeKind.ZodDefault})}brand(){return new ZodBranded({typeName:ZodFirstPartyTypeKind.ZodBranded,type:this,...processCreateParams(this._def)})}catch(e){const t="function"===typeof e?e:()=>e;return new ZodCatch({...processCreateParams(this._def),innerType:this,catchValue:t,typeName:ZodFirstPartyTypeKind.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return ZodPipeline.create(this,e)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const cuidRegex=/^c[^\s-]{8,}$/i,cuid2Regex=/^[a-z][a-z0-9]*$/,ulidRegex=/[0-9A-HJKMNP-TV-Z]{26}/,uuidRegex=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,emailRegex=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\])|(\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\.[A-Za-z]{2,})+))$/,emojiRegex=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,ipv4Regex=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,ipv6Regex=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,datetimeRegex=e=>e.precision?e.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}Z$`):0===e.precision?e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function isValidIP(e,t){return!("v4"!==t&&t||!ipv4Regex.test(e))||!("v6"!==t&&t||!ipv6Regex.test(e))}class ZodString extends ZodType{constructor(){super(...arguments),this._regex=(e,t,r)=>this.refinement(t=>e.test(t),{validation:t,code:ZodIssueCode.invalid_string,...errorUtil.errToObj(r)}),this.nonempty=e=>this.min(1,errorUtil.errToObj(e)),this.trim=()=>new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(e){this._def.coerce&&(e.data=String(e.data));const t=this._getType(e);if(t!==ZodParsedType.string){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.string,received:t.parsedType}),INVALID}const r=new ParseStatus;let a=void 0;for(const i of this._def.checks)if("min"===i.kind)e.data.length<i.value&&(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{code:ZodIssueCode.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if("max"===i.kind)e.data.length>i.value&&(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{code:ZodIssueCode.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if("length"===i.kind){const t=e.data.length>i.value,n=e.data.length<i.value;(t||n)&&(a=this._getOrReturnCtx(e,a),t?addIssueToContext(a,{code:ZodIssueCode.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):n&&addIssueToContext(a,{code:ZodIssueCode.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if("email"===i.kind)emailRegex.test(e.data)||(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{validation:"email",code:ZodIssueCode.invalid_string,message:i.message}),r.dirty());else if("emoji"===i.kind)emojiRegex.test(e.data)||(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{validation:"emoji",code:ZodIssueCode.invalid_string,message:i.message}),r.dirty());else if("uuid"===i.kind)uuidRegex.test(e.data)||(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{validation:"uuid",code:ZodIssueCode.invalid_string,message:i.message}),r.dirty());else if("cuid"===i.kind)cuidRegex.test(e.data)||(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{validation:"cuid",code:ZodIssueCode.invalid_string,message:i.message}),r.dirty());else if("cuid2"===i.kind)cuid2Regex.test(e.data)||(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{validation:"cuid2",code:ZodIssueCode.invalid_string,message:i.message}),r.dirty());else if("ulid"===i.kind)ulidRegex.test(e.data)||(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{validation:"ulid",code:ZodIssueCode.invalid_string,message:i.message}),r.dirty());else if("url"===i.kind)try{new URL(e.data)}catch(n){a=this._getOrReturnCtx(e,a),addIssueToContext(a,{validation:"url",code:ZodIssueCode.invalid_string,message:i.message}),r.dirty()}else if("regex"===i.kind){i.regex.lastIndex=0;const t=i.regex.test(e.data);t||(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{validation:"regex",code:ZodIssueCode.invalid_string,message:i.message}),r.dirty())}else if("trim"===i.kind)e.data=e.data.trim();else if("includes"===i.kind)e.data.includes(i.value,i.position)||(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{code:ZodIssueCode.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty());else if("toLowerCase"===i.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===i.kind)e.data=e.data.toUpperCase();else if("startsWith"===i.kind)e.data.startsWith(i.value)||(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{code:ZodIssueCode.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty());else if("endsWith"===i.kind)e.data.endsWith(i.value)||(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{code:ZodIssueCode.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty());else if("datetime"===i.kind){const t=datetimeRegex(i);t.test(e.data)||(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{code:ZodIssueCode.invalid_string,validation:"datetime",message:i.message}),r.dirty())}else"ip"===i.kind?isValidIP(e.data,i.version)||(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{validation:"ip",code:ZodIssueCode.invalid_string,message:i.message}),r.dirty()):util.assertNever(i);return{status:r.value,value:e.data}}_addCheck(e){return new ZodString({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...errorUtil.errToObj(e)})}url(e){return this._addCheck({kind:"url",...errorUtil.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...errorUtil.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...errorUtil.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...errorUtil.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...errorUtil.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...errorUtil.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...errorUtil.errToObj(e)})}datetime(e){var t;return"string"===typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:"undefined"===typeof(null===e||void 0===e?void 0:e.precision)?null:null===e||void 0===e?void 0:e.precision,offset:null!==(t=null===e||void 0===e?void 0:e.offset)&&void 0!==t&&t,...errorUtil.errToObj(null===e||void 0===e?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...errorUtil.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null===t||void 0===t?void 0:t.position,...errorUtil.errToObj(null===t||void 0===t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...errorUtil.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...errorUtil.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...errorUtil.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...errorUtil.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...errorUtil.errToObj(t)})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function floatSafeRemainder(e,t){const r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,n=r>a?r:a,i=parseInt(e.toFixed(n).replace(".","")),o=parseInt(t.toFixed(n).replace(".",""));return i%o/Math.pow(10,n)}ZodString.create=e=>{var t;return new ZodString({checks:[],typeName:ZodFirstPartyTypeKind.ZodString,coerce:null!==(t=null===e||void 0===e?void 0:e.coerce)&&void 0!==t&&t,...processCreateParams(e)})};class ZodNumber extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));const t=this._getType(e);if(t!==ZodParsedType.number){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.number,received:t.parsedType}),INVALID}let r=void 0;const a=new ParseStatus;for(const n of this._def.checks)if("int"===n.kind)util.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:"integer",received:"float",message:n.message}),a.dirty());else if("min"===n.kind){const t=n.inclusive?e.data<n.value:e.data<=n.value;t&&(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:ZodIssueCode.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),a.dirty())}else if("max"===n.kind){const t=n.inclusive?e.data>n.value:e.data>=n.value;t&&(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:ZodIssueCode.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),a.dirty())}else"multipleOf"===n.kind?0!==floatSafeRemainder(e.data,n.value)&&(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:ZodIssueCode.not_multiple_of,multipleOf:n.value,message:n.message}),a.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:ZodIssueCode.not_finite,message:n.message}),a.dirty()):util.assertNever(n);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,errorUtil.toString(t))}setLimit(e,t,r,a){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:errorUtil.toString(a)}]})}_addCheck(e){return new ZodNumber({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:errorUtil.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:errorUtil.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:errorUtil.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:errorUtil.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:errorUtil.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&util.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ZodNumber.create=e=>new ZodNumber({checks:[],typeName:ZodFirstPartyTypeKind.ZodNumber,coerce:(null===e||void 0===e?void 0:e.coerce)||!1,...processCreateParams(e)});class ZodBigInt extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){this._def.coerce&&(e.data=BigInt(e.data));const t=this._getType(e);if(t!==ZodParsedType.bigint){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.bigint,received:t.parsedType}),INVALID}let r=void 0;const a=new ParseStatus;for(const n of this._def.checks)if("min"===n.kind){const t=n.inclusive?e.data<n.value:e.data<=n.value;t&&(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:ZodIssueCode.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),a.dirty())}else if("max"===n.kind){const t=n.inclusive?e.data>n.value:e.data>=n.value;t&&(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:ZodIssueCode.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),a.dirty())}else"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:ZodIssueCode.not_multiple_of,multipleOf:n.value,message:n.message}),a.dirty()):util.assertNever(n);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,errorUtil.toString(t))}setLimit(e,t,r,a){return new ZodBigInt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:errorUtil.toString(a)}]})}_addCheck(e){return new ZodBigInt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:errorUtil.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}ZodBigInt.create=e=>{var t;return new ZodBigInt({checks:[],typeName:ZodFirstPartyTypeKind.ZodBigInt,coerce:null!==(t=null===e||void 0===e?void 0:e.coerce)&&void 0!==t&&t,...processCreateParams(e)})};class ZodBoolean extends ZodType{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));const t=this._getType(e);if(t!==ZodParsedType.boolean){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.boolean,received:t.parsedType}),INVALID}return OK(e.data)}}ZodBoolean.create=e=>new ZodBoolean({typeName:ZodFirstPartyTypeKind.ZodBoolean,coerce:(null===e||void 0===e?void 0:e.coerce)||!1,...processCreateParams(e)});class ZodDate extends ZodType{_parse(e){this._def.coerce&&(e.data=new Date(e.data));const t=this._getType(e);if(t!==ZodParsedType.date){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.date,received:t.parsedType}),INVALID}if(isNaN(e.data.getTime())){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_date}),INVALID}const r=new ParseStatus;let a=void 0;for(const n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{code:ZodIssueCode.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),r.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(a=this._getOrReturnCtx(e,a),addIssueToContext(a,{code:ZodIssueCode.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),r.dirty()):util.assertNever(n);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ZodDate({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:errorUtil.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:errorUtil.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}ZodDate.create=e=>new ZodDate({checks:[],coerce:(null===e||void 0===e?void 0:e.coerce)||!1,typeName:ZodFirstPartyTypeKind.ZodDate,...processCreateParams(e)});class ZodSymbol extends ZodType{_parse(e){const t=this._getType(e);if(t!==ZodParsedType.symbol){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.symbol,received:t.parsedType}),INVALID}return OK(e.data)}}ZodSymbol.create=e=>new ZodSymbol({typeName:ZodFirstPartyTypeKind.ZodSymbol,...processCreateParams(e)});class ZodUndefined extends ZodType{_parse(e){const t=this._getType(e);if(t!==ZodParsedType.undefined){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.undefined,received:t.parsedType}),INVALID}return OK(e.data)}}ZodUndefined.create=e=>new ZodUndefined({typeName:ZodFirstPartyTypeKind.ZodUndefined,...processCreateParams(e)});class ZodNull extends ZodType{_parse(e){const t=this._getType(e);if(t!==ZodParsedType.null){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.null,received:t.parsedType}),INVALID}return OK(e.data)}}ZodNull.create=e=>new ZodNull({typeName:ZodFirstPartyTypeKind.ZodNull,...processCreateParams(e)});class ZodAny extends ZodType{constructor(){super(...arguments),this._any=!0}_parse(e){return OK(e.data)}}ZodAny.create=e=>new ZodAny({typeName:ZodFirstPartyTypeKind.ZodAny,...processCreateParams(e)});class ZodUnknown extends ZodType{constructor(){super(...arguments),this._unknown=!0}_parse(e){return OK(e.data)}}ZodUnknown.create=e=>new ZodUnknown({typeName:ZodFirstPartyTypeKind.ZodUnknown,...processCreateParams(e)});class ZodNever extends ZodType{_parse(e){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.never,received:t.parsedType}),INVALID}}ZodNever.create=e=>new ZodNever({typeName:ZodFirstPartyTypeKind.ZodNever,...processCreateParams(e)});class ZodVoid extends ZodType{_parse(e){const t=this._getType(e);if(t!==ZodParsedType.undefined){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.void,received:t.parsedType}),INVALID}return OK(e.data)}}ZodVoid.create=e=>new ZodVoid({typeName:ZodFirstPartyTypeKind.ZodVoid,...processCreateParams(e)});class ZodArray extends ZodType{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==ZodParsedType.array)return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:t.parsedType}),INVALID;if(null!==a.exactLength){const e=t.data.length>a.exactLength.value,n=t.data.length<a.exactLength.value;(e||n)&&(addIssueToContext(t,{code:e?ZodIssueCode.too_big:ZodIssueCode.too_small,minimum:n?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(addIssueToContext(t,{code:ZodIssueCode.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(addIssueToContext(t,{code:ZodIssueCode.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>a.type._parseAsync(new ParseInputLazyPath(t,e,t.path,r)))).then(e=>ParseStatus.mergeArray(r,e));const n=[...t.data].map((e,r)=>a.type._parseSync(new ParseInputLazyPath(t,e,t.path,r)));return ParseStatus.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new ZodArray({...this._def,minLength:{value:e,message:errorUtil.toString(t)}})}max(e,t){return new ZodArray({...this._def,maxLength:{value:e,message:errorUtil.toString(t)}})}length(e,t){return new ZodArray({...this._def,exactLength:{value:e,message:errorUtil.toString(t)}})}nonempty(e){return this.min(1,e)}}function deepPartialify(e){if(e instanceof ZodObject){const t={};for(const r in e.shape){const a=e.shape[r];t[r]=ZodOptional.create(deepPartialify(a))}return new ZodObject({...e._def,shape:()=>t})}return e instanceof ZodArray?new ZodArray({...e._def,type:deepPartialify(e.element)}):e instanceof ZodOptional?ZodOptional.create(deepPartialify(e.unwrap())):e instanceof ZodNullable?ZodNullable.create(deepPartialify(e.unwrap())):e instanceof ZodTuple?ZodTuple.create(e.items.map(e=>deepPartialify(e))):e}ZodArray.create=(e,t)=>new ZodArray({type:e,minLength:null,maxLength:null,exactLength:null,typeName:ZodFirstPartyTypeKind.ZodArray,...processCreateParams(t)});class ZodObject extends ZodType{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=util.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){const t=this._getType(e);if(t!==ZodParsedType.object){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:t.parsedType}),INVALID}const{status:r,ctx:a}=this._processInputParams(e),{shape:n,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof ZodNever&&"strip"===this._def.unknownKeys))for(const c in a.data)i.includes(c)||o.push(c);const s=[];for(const c of i){const e=n[c],t=a.data[c];s.push({key:{status:"valid",value:c},value:e._parse(new ParseInputLazyPath(a,t,a.path,c)),alwaysSet:c in a.data})}if(this._def.catchall instanceof ZodNever){const e=this._def.unknownKeys;if("passthrough"===e)for(const t of o)s.push({key:{status:"valid",value:t},value:{status:"valid",value:a.data[t]}});else if("strict"===e)o.length>0&&(addIssueToContext(a,{code:ZodIssueCode.unrecognized_keys,keys:o}),r.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of o){const r=a.data[t];s.push({key:{status:"valid",value:t},value:e._parse(new ParseInputLazyPath(a,r,a.path,t)),alwaysSet:t in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of s){const r=await t.key;e.push({key:r,value:await t.value,alwaysSet:t.alwaysSet})}return e}).then(e=>ParseStatus.mergeObjectSync(r,e)):ParseStatus.mergeObjectSync(r,s)}get shape(){return this._def.shape()}strict(e){return errorUtil.errToObj,new ZodObject({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var a,n,i,o;const s=null!==(i=null===(n=(a=this._def).errorMap)||void 0===n?void 0:n.call(a,t,r).message)&&void 0!==i?i:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(o=errorUtil.errToObj(e).message)&&void 0!==o?o:s}:{message:s}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}extend(e){return new ZodObject({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){const t=new ZodObject({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ZodFirstPartyTypeKind.ZodObject});return t}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ZodObject({...this._def,catchall:e})}pick(e){const t={};return util.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new ZodObject({...this._def,shape:()=>t})}omit(e){const t={};return util.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new ZodObject({...this._def,shape:()=>t})}deepPartial(){return deepPartialify(this)}partial(e){const t={};return util.objectKeys(this.shape).forEach(r=>{const a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}),new ZodObject({...this._def,shape:()=>t})}required(e){const t={};return util.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{const e=this.shape[r];let a=e;while(a instanceof ZodOptional)a=a._def.innerType;t[r]=a}}),new ZodObject({...this._def,shape:()=>t})}keyof(){return createZodEnum(util.objectKeys(this.shape))}}ZodObject.create=(e,t)=>new ZodObject({shape:()=>e,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(t)}),ZodObject.strictCreate=(e,t)=>new ZodObject({shape:()=>e,unknownKeys:"strict",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(t)}),ZodObject.lazycreate=(e,t)=>new ZodObject({shape:e,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(t)});class ZodUnion extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function a(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const a of e)if("dirty"===a.result.status)return t.common.issues.push(...a.ctx.common.issues),a.result;const r=e.map(e=>new ZodError(e.ctx.common.issues));return addIssueToContext(t,{code:ZodIssueCode.invalid_union,unionErrors:r}),INVALID}if(t.common.async)return Promise.all(r.map(async e=>{const r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(a);{let e=void 0;const a=[];for(const i of r){const r={...t,common:{...t.common,issues:[]},parent:null},n=i._parseSync({data:t.data,path:t.path,parent:r});if("valid"===n.status)return n;"dirty"!==n.status||e||(e={result:n,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const n=a.map(e=>new ZodError(e));return addIssueToContext(t,{code:ZodIssueCode.invalid_union,unionErrors:n}),INVALID}}get options(){return this._def.options}}ZodUnion.create=(e,t)=>new ZodUnion({options:e,typeName:ZodFirstPartyTypeKind.ZodUnion,...processCreateParams(t)});const getDiscriminator=e=>e instanceof ZodLazy?getDiscriminator(e.schema):e instanceof ZodEffects?getDiscriminator(e.innerType()):e instanceof ZodLiteral?[e.value]:e instanceof ZodEnum?e.options:e instanceof ZodNativeEnum?Object.keys(e.enum):e instanceof ZodDefault?getDiscriminator(e._def.innerType):e instanceof ZodUndefined?[void 0]:e instanceof ZodNull?[null]:null;class ZodDiscriminatedUnion extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ZodParsedType.object)return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:t.parsedType}),INVALID;const r=this.discriminator,a=t.data[r],n=this.optionsMap.get(a);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(addIssueToContext(t,{code:ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const a=new Map;for(const n of t){const t=getDiscriminator(n.shape[e]);if(!t)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const r of t){if(a.has(r))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(r)}`);a.set(r,n)}}return new ZodDiscriminatedUnion({typeName:ZodFirstPartyTypeKind.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...processCreateParams(r)})}}function mergeValues(e,t){const r=getParsedType(e),a=getParsedType(t);if(e===t)return{valid:!0,data:e};if(r===ZodParsedType.object&&a===ZodParsedType.object){const r=util.objectKeys(t),a=util.objectKeys(e).filter(e=>-1!==r.indexOf(e)),n={...e,...t};for(const i of a){const r=mergeValues(e[i],t[i]);if(!r.valid)return{valid:!1};n[i]=r.data}return{valid:!0,data:n}}if(r===ZodParsedType.array&&a===ZodParsedType.array){if(e.length!==t.length)return{valid:!1};const r=[];for(let a=0;a<e.length;a++){const n=e[a],i=t[a],o=mergeValues(n,i);if(!o.valid)return{valid:!1};r.push(o.data)}return{valid:!0,data:r}}return r===ZodParsedType.date&&a===ZodParsedType.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}class ZodIntersection extends ZodType{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),a=(e,a)=>{if(isAborted(e)||isAborted(a))return INVALID;const n=mergeValues(e.value,a.value);return n.valid?((isDirty(e)||isDirty(a))&&t.dirty(),{status:t.value,value:n.data}):(addIssueToContext(r,{code:ZodIssueCode.invalid_intersection_types}),INVALID)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}ZodIntersection.create=(e,t,r)=>new ZodIntersection({left:e,right:t,typeName:ZodFirstPartyTypeKind.ZodIntersection,...processCreateParams(r)});class ZodTuple extends ZodType{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ZodParsedType.array)return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:r.parsedType}),INVALID;if(r.data.length<this._def.items.length)return addIssueToContext(r,{code:ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),INVALID;const a=this._def.rest;!a&&r.data.length>this._def.items.length&&(addIssueToContext(r,{code:ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const n=[...r.data].map((e,t)=>{const a=this._def.items[t]||this._def.rest;return a?a._parse(new ParseInputLazyPath(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(n).then(e=>ParseStatus.mergeArray(t,e)):ParseStatus.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new ZodTuple({...this._def,rest:e})}}ZodTuple.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ZodTuple({items:e,typeName:ZodFirstPartyTypeKind.ZodTuple,rest:null,...processCreateParams(t)})};class ZodRecord extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ZodParsedType.object)return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:r.parsedType}),INVALID;const a=[],n=this._def.keyType,i=this._def.valueType;for(const o in r.data)a.push({key:n._parse(new ParseInputLazyPath(r,o,r.path,o)),value:i._parse(new ParseInputLazyPath(r,r.data[o],r.path,o))});return r.common.async?ParseStatus.mergeObjectAsync(t,a):ParseStatus.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new ZodRecord(t instanceof ZodType?{keyType:e,valueType:t,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(r)}:{keyType:ZodString.create(),valueType:e,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(t)})}}class ZodMap extends ZodType{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ZodParsedType.map)return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.map,received:r.parsedType}),INVALID;const a=this._def.keyType,n=this._def.valueType,i=[...r.data.entries()].map(([e,t],i)=>({key:a._parse(new ParseInputLazyPath(r,e,r.path,[i,"key"])),value:n._parse(new ParseInputLazyPath(r,t,r.path,[i,"value"]))}));if(r.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const r of i){const a=await r.key,n=await r.value;if("aborted"===a.status||"aborted"===n.status)return INVALID;"dirty"!==a.status&&"dirty"!==n.status||t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}})}{const e=new Map;for(const r of i){const a=r.key,n=r.value;if("aborted"===a.status||"aborted"===n.status)return INVALID;"dirty"!==a.status&&"dirty"!==n.status||t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}}}}ZodMap.create=(e,t,r)=>new ZodMap({valueType:t,keyType:e,typeName:ZodFirstPartyTypeKind.ZodMap,...processCreateParams(r)});class ZodSet extends ZodType{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ZodParsedType.set)return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.set,received:r.parsedType}),INVALID;const a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&(addIssueToContext(r,{code:ZodIssueCode.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&(addIssueToContext(r,{code:ZodIssueCode.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const n=this._def.valueType;function i(e){const r=new Set;for(const a of e){if("aborted"===a.status)return INVALID;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}const o=[...r.data.values()].map((e,t)=>n._parse(new ParseInputLazyPath(r,e,r.path,t)));return r.common.async?Promise.all(o).then(e=>i(e)):i(o)}min(e,t){return new ZodSet({...this._def,minSize:{value:e,message:errorUtil.toString(t)}})}max(e,t){return new ZodSet({...this._def,maxSize:{value:e,message:errorUtil.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}ZodSet.create=(e,t)=>new ZodSet({valueType:e,minSize:null,maxSize:null,typeName:ZodFirstPartyTypeKind.ZodSet,...processCreateParams(t)});class ZodFunction extends ZodType{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ZodParsedType.function)return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.function,received:t.parsedType}),INVALID;function r(e,r){return makeIssue({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,getErrorMap(),errorMap].filter(e=>!!e),issueData:{code:ZodIssueCode.invalid_arguments,argumentsError:r}})}function a(e,r){return makeIssue({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,getErrorMap(),errorMap].filter(e=>!!e),issueData:{code:ZodIssueCode.invalid_return_type,returnTypeError:r}})}const n={errorMap:t.common.contextualErrorMap},i=t.data;return this._def.returns instanceof ZodPromise?OK(async(...e)=>{const t=new ZodError([]),o=await this._def.args.parseAsync(e,n).catch(a=>{throw t.addIssue(r(e,a)),t}),s=await i(...o),c=await this._def.returns._def.type.parseAsync(s,n).catch(e=>{throw t.addIssue(a(s,e)),t});return c}):OK((...e)=>{const t=this._def.args.safeParse(e,n);if(!t.success)throw new ZodError([r(e,t.error)]);const o=i(...t.data),s=this._def.returns.safeParse(o,n);if(!s.success)throw new ZodError([a(o,s.error)]);return s.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ZodFunction({...this._def,args:ZodTuple.create(e).rest(ZodUnknown.create())})}returns(e){return new ZodFunction({...this._def,returns:e})}implement(e){const t=this.parse(e);return t}strictImplement(e){const t=this.parse(e);return t}static create(e,t,r){return new ZodFunction({args:e||ZodTuple.create([]).rest(ZodUnknown.create()),returns:t||ZodUnknown.create(),typeName:ZodFirstPartyTypeKind.ZodFunction,...processCreateParams(r)})}}class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.getter();return r._parse({data:t.data,path:t.path,parent:t})}}ZodLazy.create=(e,t)=>new ZodLazy({getter:e,typeName:ZodFirstPartyTypeKind.ZodLazy,...processCreateParams(t)});class ZodLiteral extends ZodType{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{received:t.data,code:ZodIssueCode.invalid_literal,expected:this._def.value}),INVALID}return{status:"valid",value:e.data}}get value(){return this._def.value}}function createZodEnum(e,t){return new ZodEnum({values:e,typeName:ZodFirstPartyTypeKind.ZodEnum,...processCreateParams(t)})}ZodLiteral.create=(e,t)=>new ZodLiteral({value:e,typeName:ZodFirstPartyTypeKind.ZodLiteral,...processCreateParams(t)});class ZodEnum extends ZodType{_parse(e){if("string"!==typeof e.data){const t=this._getOrReturnCtx(e),r=this._def.values;return addIssueToContext(t,{expected:util.joinValues(r),received:t.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(-1===this._def.values.indexOf(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return addIssueToContext(t,{received:t.data,code:ZodIssueCode.invalid_enum_value,options:r}),INVALID}return OK(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return ZodEnum.create(e)}exclude(e){return ZodEnum.create(this.options.filter(t=>!e.includes(t)))}}ZodEnum.create=createZodEnum;class ZodNativeEnum extends ZodType{_parse(e){const t=util.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==ZodParsedType.string&&r.parsedType!==ZodParsedType.number){const e=util.objectValues(t);return addIssueToContext(r,{expected:util.joinValues(e),received:r.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(-1===t.indexOf(e.data)){const e=util.objectValues(t);return addIssueToContext(r,{received:r.data,code:ZodIssueCode.invalid_enum_value,options:e}),INVALID}return OK(e.data)}get enum(){return this._def.values}}ZodNativeEnum.create=(e,t)=>new ZodNativeEnum({values:e,typeName:ZodFirstPartyTypeKind.ZodNativeEnum,...processCreateParams(t)});class ZodPromise extends ZodType{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ZodParsedType.promise&&!1===t.common.async)return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.promise,received:t.parsedType}),INVALID;const r=t.parsedType===ZodParsedType.promise?t.data:Promise.resolve(t.data);return OK(r.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}ZodPromise.create=(e,t)=>new ZodPromise({type:e,typeName:ZodFirstPartyTypeKind.ZodPromise,...processCreateParams(t)});class ZodEffects extends ZodType{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ZodFirstPartyTypeKind.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null;if("preprocess"===a.type){const e=a.transform(r.data);return r.common.async?Promise.resolve(e).then(e=>this._def.schema._parseAsync({data:e,path:r.path,parent:r})):this._def.schema._parseSync({data:e,path:r.path,parent:r})}const n={addIssue:e=>{addIssueToContext(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"refinement"===a.type){const e=e=>{const t=a.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===r.common.async){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===a.status?INVALID:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?INVALID:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))))}if("transform"===a.type){if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!isValid(e))return e;const i=a.transform(e.value,n);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>isValid(e)?Promise.resolve(a.transform(e.value,n)).then(e=>({status:t.value,value:e})):e)}util.assertNever(a)}}ZodEffects.create=(e,t,r)=>new ZodEffects({schema:e,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:t,...processCreateParams(r)}),ZodEffects.createWithPreprocess=(e,t,r)=>new ZodEffects({schema:t,effect:{type:"preprocess",transform:e},typeName:ZodFirstPartyTypeKind.ZodEffects,...processCreateParams(r)});class ZodOptional extends ZodType{_parse(e){const t=this._getType(e);return t===ZodParsedType.undefined?OK(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ZodOptional.create=(e,t)=>new ZodOptional({innerType:e,typeName:ZodFirstPartyTypeKind.ZodOptional,...processCreateParams(t)});class ZodNullable extends ZodType{_parse(e){const t=this._getType(e);return t===ZodParsedType.null?OK(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ZodNullable.create=(e,t)=>new ZodNullable({innerType:e,typeName:ZodFirstPartyTypeKind.ZodNullable,...processCreateParams(t)});class ZodDefault extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===ZodParsedType.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ZodDefault.create=(e,t)=>new ZodDefault({innerType:e,typeName:ZodFirstPartyTypeKind.ZodDefault,defaultValue:"function"===typeof t.default?t.default:()=>t.default,...processCreateParams(t)});class ZodCatch extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return isAsync(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new ZodError(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new ZodError(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}ZodCatch.create=(e,t)=>new ZodCatch({innerType:e,typeName:ZodFirstPartyTypeKind.ZodCatch,catchValue:"function"===typeof t.catch?t.catch:()=>t.catch,...processCreateParams(t)});class ZodNaN extends ZodType{_parse(e){const t=this._getType(e);if(t!==ZodParsedType.nan){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.nan,received:t.parsedType}),INVALID}return{status:"valid",value:e.data}}}ZodNaN.create=e=>new ZodNaN({typeName:ZodFirstPartyTypeKind.ZodNaN,...processCreateParams(e)});const BRAND=Symbol("zod_brand");class ZodBranded extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class ZodPipeline extends ZodType{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async){const e=async()=>{const e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?INVALID:"dirty"===e.status?(t.dirty(),DIRTY(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})};return e()}{const e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?INVALID:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new ZodPipeline({in:e,out:t,typeName:ZodFirstPartyTypeKind.ZodPipeline})}}const custom=(e,t={},r)=>e?ZodAny.create().superRefine((a,n)=>{var i,o;if(!e(a)){const e="function"===typeof t?t(a):"string"===typeof t?{message:t}:t,s=null===(o=null!==(i=e.fatal)&&void 0!==i?i:r)||void 0===o||o,c="string"===typeof e?{message:e}:e;n.addIssue({code:"custom",...c,fatal:s})}}):ZodAny.create(),late={object:ZodObject.lazycreate};var ZodFirstPartyTypeKind;(function(e){e["ZodString"]="ZodString",e["ZodNumber"]="ZodNumber",e["ZodNaN"]="ZodNaN",e["ZodBigInt"]="ZodBigInt",e["ZodBoolean"]="ZodBoolean",e["ZodDate"]="ZodDate",e["ZodSymbol"]="ZodSymbol",e["ZodUndefined"]="ZodUndefined",e["ZodNull"]="ZodNull",e["ZodAny"]="ZodAny",e["ZodUnknown"]="ZodUnknown",e["ZodNever"]="ZodNever",e["ZodVoid"]="ZodVoid",e["ZodArray"]="ZodArray",e["ZodObject"]="ZodObject",e["ZodUnion"]="ZodUnion",e["ZodDiscriminatedUnion"]="ZodDiscriminatedUnion",e["ZodIntersection"]="ZodIntersection",e["ZodTuple"]="ZodTuple",e["ZodRecord"]="ZodRecord",e["ZodMap"]="ZodMap",e["ZodSet"]="ZodSet",e["ZodFunction"]="ZodFunction",e["ZodLazy"]="ZodLazy",e["ZodLiteral"]="ZodLiteral",e["ZodEnum"]="ZodEnum",e["ZodEffects"]="ZodEffects",e["ZodNativeEnum"]="ZodNativeEnum",e["ZodOptional"]="ZodOptional",e["ZodNullable"]="ZodNullable",e["ZodDefault"]="ZodDefault",e["ZodCatch"]="ZodCatch",e["ZodPromise"]="ZodPromise",e["ZodBranded"]="ZodBranded",e["ZodPipeline"]="ZodPipeline"})(ZodFirstPartyTypeKind||(ZodFirstPartyTypeKind={}));const instanceOfType=(e,t={message:"Input not instance of "+e.name})=>custom(t=>t instanceof e,t),stringType=ZodString.create,numberType=ZodNumber.create,nanType=ZodNaN.create,bigIntType=ZodBigInt.create,booleanType=ZodBoolean.create,dateType=ZodDate.create,symbolType=ZodSymbol.create,undefinedType=ZodUndefined.create,nullType=ZodNull.create,anyType=ZodAny.create,unknownType=ZodUnknown.create,neverType=ZodNever.create,voidType=ZodVoid.create,arrayType=ZodArray.create,objectType=ZodObject.create,strictObjectType=ZodObject.strictCreate,unionType=ZodUnion.create,discriminatedUnionType=ZodDiscriminatedUnion.create,intersectionType=ZodIntersection.create,tupleType=ZodTuple.create,recordType=ZodRecord.create,mapType=ZodMap.create,setType=ZodSet.create,functionType=ZodFunction.create,lazyType=ZodLazy.create,literalType=ZodLiteral.create,enumType=ZodEnum.create,nativeEnumType=ZodNativeEnum.create,promiseType=ZodPromise.create,effectsType=ZodEffects.create,optionalType=ZodOptional.create,nullableType=ZodNullable.create,preprocessType=ZodEffects.createWithPreprocess,pipelineType=ZodPipeline.create,ostring=()=>stringType().optional(),onumber=()=>numberType().optional(),oboolean=()=>booleanType().optional(),coerce={string:e=>ZodString.create({...e,coerce:!0}),number:e=>ZodNumber.create({...e,coerce:!0}),boolean:e=>ZodBoolean.create({...e,coerce:!0}),bigint:e=>ZodBigInt.create({...e,coerce:!0}),date:e=>ZodDate.create({...e,coerce:!0})},NEVER=INVALID;var z=Object.freeze({__proto__:null,defaultErrorMap:errorMap,setErrorMap:setErrorMap,getErrorMap:getErrorMap,makeIssue:makeIssue,EMPTY_PATH:EMPTY_PATH,addIssueToContext:addIssueToContext,ParseStatus:ParseStatus,INVALID:INVALID,DIRTY:DIRTY,OK:OK,isAborted:isAborted,isDirty:isDirty,isValid:isValid,isAsync:isAsync,get util(){return util},get objectUtil(){return objectUtil},ZodParsedType:ZodParsedType,getParsedType:getParsedType,ZodType:ZodType,ZodString:ZodString,ZodNumber:ZodNumber,ZodBigInt:ZodBigInt,ZodBoolean:ZodBoolean,ZodDate:ZodDate,ZodSymbol:ZodSymbol,ZodUndefined:ZodUndefined,ZodNull:ZodNull,ZodAny:ZodAny,ZodUnknown:ZodUnknown,ZodNever:ZodNever,ZodVoid:ZodVoid,ZodArray:ZodArray,ZodObject:ZodObject,ZodUnion:ZodUnion,ZodDiscriminatedUnion:ZodDiscriminatedUnion,ZodIntersection:ZodIntersection,ZodTuple:ZodTuple,ZodRecord:ZodRecord,ZodMap:ZodMap,ZodSet:ZodSet,ZodFunction:ZodFunction,ZodLazy:ZodLazy,ZodLiteral:ZodLiteral,ZodEnum:ZodEnum,ZodNativeEnum:ZodNativeEnum,ZodPromise:ZodPromise,ZodEffects:ZodEffects,ZodTransformer:ZodEffects,ZodOptional:ZodOptional,ZodNullable:ZodNullable,ZodDefault:ZodDefault,ZodCatch:ZodCatch,ZodNaN:ZodNaN,BRAND:BRAND,ZodBranded:ZodBranded,ZodPipeline:ZodPipeline,custom:custom,Schema:ZodType,ZodSchema:ZodType,late:late,get ZodFirstPartyTypeKind(){return ZodFirstPartyTypeKind},coerce:coerce,any:anyType,array:arrayType,bigint:bigIntType,boolean:booleanType,date:dateType,discriminatedUnion:discriminatedUnionType,effect:effectsType,enum:enumType,function:functionType,instanceof:instanceOfType,intersection:intersectionType,lazy:lazyType,literal:literalType,map:mapType,nan:nanType,nativeEnum:nativeEnumType,never:neverType,null:nullType,nullable:nullableType,number:numberType,object:objectType,oboolean:oboolean,onumber:onumber,optional:optionalType,ostring:ostring,pipeline:pipelineType,preprocess:preprocessType,promise:promiseType,record:recordType,set:setType,strictObject:strictObjectType,string:stringType,symbol:symbolType,transformer:effectsType,tuple:tupleType,undefined:undefinedType,union:unionType,unknown:unknownType,void:voidType,NEVER:NEVER,ZodIssueCode:ZodIssueCode,quotelessJson:quotelessJson,ZodError:ZodError}),ParamUsageSpec=z.string().regex(/\$.+/),FilterSpec=z.object({filter:z.string()}),FilterExprSpec=z.object({filterExpr:z.string()}),SelectSpec=z.object({select:z.string()}),SelectAllSpec=z.object({selectAll:z.string()}),SortSpec=z.object({sortBy:z.string(),order:z.union([z.literal("asc"),z.literal("desc"),z.array(z.union([z.number(),z.string()]))])["default"]("asc")}),GroupSpec=z.object({groupBy:z.string()}),SliceSpec=z.object({slice:z.union([z.array(z.union([z.number(),ParamUsageSpec])).min(1).max(3),z.string()])}),AtSpec=z.object({at:z.union([z.number(),ParamUsageSpec])}),TransformSpec=z.union([FilterSpec,FilterExprSpec,SelectSpec,SelectAllSpec,SortSpec,GroupSpec,SliceSpec,AtSpec]),TargetSpec=z.union([z.string(),TransformSpec,z.array(TransformSpec)]),YoyoSpec=z.object({repeat:z.number().min(0).optional(),delay:z.number().min(0).optional()}),AniUnitBaseSpec=z.object({id:z.union([z.number(),z.string()]).optional(),target:z.union([TargetSpec,ParamUsageSpec]).optional(),duration:z.union([z.number().min(0),ParamUsageSpec]).optional(),offset:z.union([z.number(),ParamUsageSpec]).optional(),stagger:z.union([z.number().min(0),ParamUsageSpec]).optional(),reverse:z["boolean"]().optional(),yoyo:z.union([z.literal(!0),YoyoSpec,ParamUsageSpec]).optional()}),SyncSpec=AniUnitBaseSpec.extend({sync:z.lazy((function(){return z.array(AniUnitSpec)}))}),ConcatSpec=AniUnitBaseSpec.extend({concat:z.lazy((function(){return AniUnitSpec.array()}))}),RefSpec=z.intersection(z.object({ref:z.union([z.string(),ParamUsageSpec])}),z.record(z.string(),z.any()),AniUnitBaseSpec),AniUnitSpec=z.union([SyncSpec,ConcatSpec,RefSpec]),WildcardPattern=z.string().regex(/^([a-zA-Z_][a-zA-Z_0-9]*\.)+\*$/),FullNamePattern=z.string().regex(/^([a-zA-Z_][a-zA-Z_0-9]*\.)+[a-zA-Z_][a-zA-Z_0-9]*$/),ImportSpec=z.union([FullNamePattern,WildcardPattern,z.object({class:FullNamePattern,as:z.string().optional()})]),NumberParamSpec=z.union([z.number(),z.object({private:z["boolean"]()["default"](!1),type:z.literal("number")["default"]("number"),value:z.number()}),z.object({private:z["boolean"]()["default"](!1),type:z.literal("number"),value:z.number().optional()})]),StringParamSpec=z.union([z.string(),z.object({private:z["boolean"]()["default"](!1),type:z.literal("string")["default"]("string"),value:z.string()}),z.object({private:z["boolean"]()["default"](!1),type:z.literal("string"),value:z.string().optional()})]),AnimationParamSpec=z.union([AniUnitSpec,z.object({private:z["boolean"]()["default"](!1),type:z.literal("aniUnit")["default"]("aniUnit"),value:AniUnitSpec}),z.object({private:z["boolean"]()["default"](!1),paramType:z.literal("aniUnit"),value:AniUnitSpec.optional()})]),TargetParamSpec=z.union([TargetSpec,z.object({private:z["boolean"]()["default"](!1),type:z.literal("target")["default"]("target"),value:TargetSpec}),z.object({private:z["boolean"]()["default"](!1),type:z.literal("target"),value:TargetSpec.optional()})]),YoyoParamSpec=z.union([YoyoSpec,z.object({private:z["boolean"]()["default"](!1),type:z.literal("yoyo")["default"]("yoyo"),value:YoyoSpec}),z.object({private:z["boolean"]()["default"](!1),type:z.literal("yoyo"),value:YoyoSpec.optional()})]),ParamSpec=z.union([NumberParamSpec,StringParamSpec,AnimationParamSpec,TargetParamSpec,YoyoParamSpec]),AniClassSpec=z.object({name:z.string()["default"]("Main"),package:z.string()["default"](""),import:z.array(ImportSpec)["default"]([]),targetType:z.string()["default"]("Any"),params:z.record(z.string(),ParamSpec)["default"]({}),main:AniUnitSpec});function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _isNativeReflectConstruct$1a(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct(e,t,r){return _construct=_isNativeReflectConstruct$1a()?Reflect.construct.bind():function(e,t,r){var a=[null];a.push.apply(a,t);var n=Function.bind.apply(e,a),i=new n;return r&&_setPrototypeOf(i,r.prototype),i},_construct.apply(null,arguments)}function _wrapNativeSuper(e){var t="function"===typeof Map?new Map:void 0;return _wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(r,e)},_wrapNativeSuper(e)}function _createSuper$19(e){var t=_isNativeReflectConstruct$19();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$19(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var BaseError=function(e){_inherits(r,e);var t=_createSuper$19(r);function r(e){var a;return _classCallCheck(this,r),a=t.call(this),a.message=e,a}return _createClass(r)}(_wrapNativeSuper(Error));function _createSuper$18(e){var t=_isNativeReflectConstruct$18();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$18(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var UnresolvedError=function(e){_inherits(r,e);var t=_createSuper$18(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,null,[{key:"buildByProto",value:function(e,t){var a="UnresolvedError: Visit field ".concat(t," before analysis.\n")+"In proto ".concat(e,".");return new r(a)}},{key:"build",value:function(e){return new r("UnresolvedError: "+e)}}]),r}(BaseError),Transform=_createClass((function e(){_classCallCheck(this,e)}));function _createSuper$17(e){var t=_isNativeReflectConstruct$17();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$17(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var FilterTransform=function(e){_inherits(r,e);var t=_createSuper$17(r);function r(e){var a;return _classCallCheck(this,r),a=t.call(this),a.selector=e,a}return _createClass(r,[{key:"type",get:function(){return"filter"}},{key:"execute",value:function(e){return e.filter(this.selector)}},{key:"toString",value:function(){return"filter(".concat(this.selector,")")}},{key:"clone",value:function(){return new r(this.selector)}}]),r}(Transform);function _createSuper$16(e){var t=_isNativeReflectConstruct$16();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$16(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var SortTransform=function(e){_inherits(r,e);var t=_createSuper$16(r);function r(e){var a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";return _classCallCheck(this,r),a=t.call(this),a.sortBy=e,a.order=n,a}return _createClass(r,[{key:"type",get:function(){return"sort"}},{key:"execute",value:function(e){var t=this.sortBy.replaceAll("@id","__el__.id").replaceAll("@class","Array.from(__el__.classList)").replaceAll("@idx","__idx__").replaceAll("@data","(__el__.data ?? {})").replaceAll("@el","__el__").replaceAll("@coll","__collection__");r.logger.debug("Sort ".concat(e," with sortBy: ").concat(t,", order: ").concat(this.order,"."));for(var a=e.elements,n=new Map,i=0;i<a.length;i++){var o=a[i],s=void 0;try{s=mapperEval(t,o,i,a,e.targetModel)}catch(c){throw r.logger.error("Error while evaluating sortBy: ".concat(t," on group ").concat(o,"."),c),c}n.set(o,s)}return e.sort((function(e,t){return n.get(e)-n.get(t)}))}},{key:"toString",value:function(){return"sort(".concat(this.sortBy,", ").concat(isArray$a(this.order)?"[".concat(this.order.join(", "),"]"):this.order,")")}},{key:"clone",value:function(){return new r(this.sortBy,this.order)}}]),r}(Transform);function mapperEval(__key__,__el__,__idx__,__collection__,__model__){return eval(__key__)}function _createSuper$15(e){var t=_isNativeReflectConstruct$15();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$15(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}SortTransform.logger=LoggerManager.getLogger("SortTransform");var SelectTransform=function(e){_inherits(r,e);var t=_createSuper$15(r);function r(e){var a;return _classCallCheck(this,r),a=t.call(this),a.selector=e,a}return _createClass(r,[{key:"type",get:function(){return"select"}},{key:"execute",value:function(e){return e.select(this.selector)}},{key:"toString",value:function(){return"select(".concat(this.selector,")")}},{key:"clone",value:function(){return new r(this.selector)}}]),r}(Transform);function _createSuper$14(e){var t=_isNativeReflectConstruct$14();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$14(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var SelectAllTransform=function(e){_inherits(r,e);var t=_createSuper$14(r);function r(e){var a;return _classCallCheck(this,r),a=t.call(this),a.selector=e,a}return _createClass(r,[{key:"type",get:function(){return"selectAll"}},{key:"execute",value:function(e){return e.selectAll(this.selector)}},{key:"toString",value:function(){return"selectAll(".concat(this.selector,")")}},{key:"clone",value:function(){return new r(this.selector)}}]),r}(Transform);function _createSuper$13(e){var t=_isNativeReflectConstruct$13();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$13(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var SliceTransform=function(e){_inherits(r,e);var t=_createSuper$13(r);function r(e){var a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return _classCallCheck(this,r),a=t.call(this),a.start=e,a.end=n,a.step=i,a}return _createClass(r,[{key:"type",get:function(){return"slice"}},{key:"execute",value:function(e){return e.slice(this.start,this.end,this.step)}},{key:"toString",value:function(){return"slice(".concat(this.start,", ").concat(this.end,", ").concat(this.step,")")}},{key:"clone",value:function(){return new r(this.start,this.end,this.step)}}]),r}(Transform);function isObject$6(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var isObject_1=isObject$6,isObject$7=getDefaultExportFromCjs(isObject_1),baseGetTag$7=_baseGetTag,isObject$5=isObject_1,asyncTag="[object AsyncFunction]",funcTag$2="[object Function]",genTag$1="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction$2(e){if(!isObject$5(e))return!1;var t=baseGetTag$7(e);return t==funcTag$2||t==genTag$1||t==asyncTag||t==proxyTag}var isFunction_1=isFunction$2,isFunction$3=getDefaultExportFromCjs(isFunction_1);function _createSuper$12(e){var t=_isNativeReflectConstruct$12();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$12(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var FilterExprTransform=function(e){_inherits(r,e);var t=_createSuper$12(r);function r(e){var a;return _classCallCheck(this,r),a=t.call(this),a.predicate=e,a}return _createClass(r,[{key:"type",get:function(){return"filterExpr"}},{key:"execute",value:function(e){if(isString$1(this.predicate)){var t=this.predicate.replaceAll("@id","__el__.id").replaceAll("@class","Array.from(__el__.classList)").replaceAll("@idx","__idx__").replaceAll("@data","(__el__.data ?? {})").replaceAll("@el","__el__").replaceAll("@coll","__collection__"),a=e.targetModel;return r.logger.debug("Filtering ".concat(e," with predicate ").concat(t,".")),e.filter((function(e,n,i){try{return predicateEval(t,e,n,i,a)}catch(o){throw r.logger.error("Error while evaluating predicate expression ".concat(t," on element ").concat(e,"."),o),o}}))}if(isFunction$3(this.predicate))return e.filter(this.predicate);throw new Error("Predicate is neither a string nor a function, but got ".concat(this.predicate))}},{key:"toString",value:function(){return"filterExpr(".concat(this.predicate,")")}},{key:"clone",value:function(){return new r(this.predicate)}}]),r}(Transform);function predicateEval(__predicate__,__el__,__idx__,__collection__,__model__){return eval(__predicate__)}FilterExprTransform.logger=LoggerManager.getLogger("FilterExprTransform");var Target=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];_classCallCheck(this,e),this.transforms=[],this._selection=null,this.transforms=t}return _createClass(e,[{key:"concatAtFront",value:function(e){var t;(t=this.transforms).unshift.apply(t,_toConsumableArray(e.transforms))}},{key:"clone",value:function(){return new e(this.transforms.map((function(e){return e.clone()})))}},{key:"selection",get:function(){if(void 0===this._selection)throw UnresolvedError.build("Visit field elements before resolving.\nIn object Target.");return this._selection},set:function(e){this._selection=e}},{key:"select",value:function(e){return this.transforms.push(new SelectTransform(e)),this}},{key:"selectAll",value:function(e){return this.transforms.push(new SelectAllTransform(e)),this}},{key:"filter",value:function(e){return this.transforms.push(new FilterTransform(e)),this}},{key:"filterExpr",value:function(e){return this.transforms.push(new FilterExprTransform(e)),this}},{key:"sort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";return this.transforms.push(new SortTransform(e,t)),this}},{key:"slice",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.transforms.push(new SliceTransform(e,t,r)),this}}],[{key:"build",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return new e(t)}}]),e}();function listCacheClear$1(){this.__data__=[],this.size=0}var _listCacheClear=listCacheClear$1;function eq$2(e,t){return e===t||e!==e&&t!==t}var eq_1=eq$2,eq$1=eq_1;function assocIndexOf$4(e,t){var r=e.length;while(r--)if(eq$1(e[r][0],t))return r;return-1}var _assocIndexOf=assocIndexOf$4,assocIndexOf$3=_assocIndexOf,arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete$1(e){var t=this.__data__,r=assocIndexOf$3(t,e);if(r<0)return!1;var a=t.length-1;return r==a?t.pop():splice.call(t,r,1),--this.size,!0}var _listCacheDelete=listCacheDelete$1,assocIndexOf$2=_assocIndexOf;function listCacheGet$1(e){var t=this.__data__,r=assocIndexOf$2(t,e);return r<0?void 0:t[r][1]}var _listCacheGet=listCacheGet$1,assocIndexOf$1=_assocIndexOf;function listCacheHas$1(e){return assocIndexOf$1(this.__data__,e)>-1}var _listCacheHas=listCacheHas$1,assocIndexOf=_assocIndexOf;function listCacheSet$1(e,t){var r=this.__data__,a=assocIndexOf(r,e);return a<0?(++this.size,r.push([e,t])):r[a][1]=t,this}var _listCacheSet=listCacheSet$1,listCacheClear=_listCacheClear,listCacheDelete=_listCacheDelete,listCacheGet=_listCacheGet,listCacheHas=_listCacheHas,listCacheSet=_listCacheSet;function ListCache$4(e){var t=-1,r=null==e?0:e.length;this.clear();while(++t<r){var a=e[t];this.set(a[0],a[1])}}ListCache$4.prototype.clear=listCacheClear,ListCache$4.prototype["delete"]=listCacheDelete,ListCache$4.prototype.get=listCacheGet,ListCache$4.prototype.has=listCacheHas,ListCache$4.prototype.set=listCacheSet;var _ListCache=ListCache$4,ListCache$3=_ListCache;function stackClear$1(){this.__data__=new ListCache$3,this.size=0}var _stackClear=stackClear$1;function stackDelete$1(e){var t=this.__data__,r=t["delete"](e);return this.size=t.size,r}var _stackDelete=stackDelete$1;function stackGet$1(e){return this.__data__.get(e)}var _stackGet=stackGet$1;function stackHas$1(e){return this.__data__.has(e)}var _stackHas=stackHas$1,root$6=_root,coreJsData$1=root$6["__core-js_shared__"],_coreJsData=coreJsData$1,coreJsData=_coreJsData,maskSrcKey=function(){var e=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function isMasked$1(e){return!!maskSrcKey&&maskSrcKey in e}var _isMasked=isMasked$1,funcProto$2=Function.prototype,funcToString$2=funcProto$2.toString;function toSource$2(e){if(null!=e){try{return funcToString$2.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var _toSource=toSource$2,isFunction$1=isFunction_1,isMasked=_isMasked,isObject$4=isObject_1,toSource$1=_toSource,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto$1=Function.prototype,objectProto$b=Object.prototype,funcToString$1=funcProto$1.toString,hasOwnProperty$9=objectProto$b.hasOwnProperty,reIsNative=RegExp("^"+funcToString$1.call(hasOwnProperty$9).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative$1(e){if(!isObject$4(e)||isMasked(e))return!1;var t=isFunction$1(e)?reIsNative:reIsHostCtor;return t.test(toSource$1(e))}var _baseIsNative=baseIsNative$1;function getValue$1(e,t){return null==e?void 0:e[t]}var _getValue=getValue$1,baseIsNative=_baseIsNative,getValue=_getValue;function getNative$7(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}var _getNative=getNative$7,getNative$6=_getNative,root$5=_root,Map$4=getNative$6(root$5,"Map"),_Map=Map$4,getNative$5=_getNative,nativeCreate$4=getNative$5(Object,"create"),_nativeCreate=nativeCreate$4,nativeCreate$3=_nativeCreate;function hashClear$1(){this.__data__=nativeCreate$3?nativeCreate$3(null):{},this.size=0}var _hashClear=hashClear$1;function hashDelete$1(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var _hashDelete=hashDelete$1,nativeCreate$2=_nativeCreate,HASH_UNDEFINED$1="__lodash_hash_undefined__",objectProto$a=Object.prototype,hasOwnProperty$8=objectProto$a.hasOwnProperty;function hashGet$1(e){var t=this.__data__;if(nativeCreate$2){var r=t[e];return r===HASH_UNDEFINED$1?void 0:r}return hasOwnProperty$8.call(t,e)?t[e]:void 0}var _hashGet=hashGet$1,nativeCreate$1=_nativeCreate,objectProto$9=Object.prototype,hasOwnProperty$7=objectProto$9.hasOwnProperty;function hashHas$1(e){var t=this.__data__;return nativeCreate$1?void 0!==t[e]:hasOwnProperty$7.call(t,e)}var _hashHas=hashHas$1,nativeCreate=_nativeCreate,HASH_UNDEFINED="__lodash_hash_undefined__";function hashSet$1(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate&&void 0===t?HASH_UNDEFINED:t,this}var _hashSet=hashSet$1,hashClear=_hashClear,hashDelete=_hashDelete,hashGet=_hashGet,hashHas=_hashHas,hashSet=_hashSet;function Hash$1(e){var t=-1,r=null==e?0:e.length;this.clear();while(++t<r){var a=e[t];this.set(a[0],a[1])}}Hash$1.prototype.clear=hashClear,Hash$1.prototype["delete"]=hashDelete,Hash$1.prototype.get=hashGet,Hash$1.prototype.has=hashHas,Hash$1.prototype.set=hashSet;var _Hash=Hash$1,Hash=_Hash,ListCache$2=_ListCache,Map$3=_Map;function mapCacheClear$1(){this.size=0,this.__data__={hash:new Hash,map:new(Map$3||ListCache$2),string:new Hash}}var _mapCacheClear=mapCacheClear$1;function isKeyable$1(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}var _isKeyable=isKeyable$1,isKeyable=_isKeyable;function getMapData$4(e,t){var r=e.__data__;return isKeyable(t)?r["string"==typeof t?"string":"hash"]:r.map}var _getMapData=getMapData$4,getMapData$3=_getMapData;function mapCacheDelete$1(e){var t=getMapData$3(this,e)["delete"](e);return this.size-=t?1:0,t}var _mapCacheDelete=mapCacheDelete$1,getMapData$2=_getMapData;function mapCacheGet$1(e){return getMapData$2(this,e).get(e)}var _mapCacheGet=mapCacheGet$1,getMapData$1=_getMapData;function mapCacheHas$1(e){return getMapData$1(this,e).has(e)}var _mapCacheHas=mapCacheHas$1,getMapData=_getMapData;function mapCacheSet$1(e,t){var r=getMapData(this,e),a=r.size;return r.set(e,t),this.size+=r.size==a?0:1,this}var _mapCacheSet=mapCacheSet$1,mapCacheClear=_mapCacheClear,mapCacheDelete=_mapCacheDelete,mapCacheGet=_mapCacheGet,mapCacheHas=_mapCacheHas,mapCacheSet=_mapCacheSet;function MapCache$2(e){var t=-1,r=null==e?0:e.length;this.clear();while(++t<r){var a=e[t];this.set(a[0],a[1])}}MapCache$2.prototype.clear=mapCacheClear,MapCache$2.prototype["delete"]=mapCacheDelete,MapCache$2.prototype.get=mapCacheGet,MapCache$2.prototype.has=mapCacheHas,MapCache$2.prototype.set=mapCacheSet;var _MapCache=MapCache$2,ListCache$1=_ListCache,Map$2=_Map,MapCache$1=_MapCache,LARGE_ARRAY_SIZE=200;function stackSet$1(e,t){var r=this.__data__;if(r instanceof ListCache$1){var a=r.__data__;if(!Map$2||a.length<LARGE_ARRAY_SIZE-1)return a.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache$1(a)}return r.set(e,t),this.size=r.size,this}var _stackSet=stackSet$1,ListCache=_ListCache,stackClear=_stackClear,stackDelete=_stackDelete,stackGet=_stackGet,stackHas=_stackHas,stackSet=_stackSet;function Stack$1(e){var t=this.__data__=new ListCache(e);this.size=t.size}Stack$1.prototype.clear=stackClear,Stack$1.prototype["delete"]=stackDelete,Stack$1.prototype.get=stackGet,Stack$1.prototype.has=stackHas,Stack$1.prototype.set=stackSet;var _Stack=Stack$1;function arrayEach$1(e,t){var r=-1,a=null==e?0:e.length;while(++r<a)if(!1===t(e[r],r,e))break;return e}var _arrayEach=arrayEach$1,getNative$4=_getNative,defineProperty$2=function(){try{var e=getNative$4(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),_defineProperty=defineProperty$2,defineProperty$1=_defineProperty;function baseAssignValue$2(e,t,r){"__proto__"==t&&defineProperty$1?defineProperty$1(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var _baseAssignValue=baseAssignValue$2,baseAssignValue$1=_baseAssignValue,eq=eq_1,objectProto$8=Object.prototype,hasOwnProperty$6=objectProto$8.hasOwnProperty;function assignValue$3(e,t,r){var a=e[t];hasOwnProperty$6.call(e,t)&&eq(a,r)&&(void 0!==r||t in e)||baseAssignValue$1(e,t,r)}var _assignValue=assignValue$3,assignValue$2=_assignValue,baseAssignValue=_baseAssignValue;function copyObject$5(e,t,r,a){var n=!r;r||(r={});var i=-1,o=t.length;while(++i<o){var s=t[i],c=a?a(r[s],e[s],s,r,e):void 0;void 0===c&&(c=e[s]),n?baseAssignValue(r,s,c):assignValue$2(r,s,c)}return r}var _copyObject=copyObject$5;function baseTimes$2(e,t){var r=-1,a=Array(e);while(++r<e)a[r]=t(r);return a}var _baseTimes=baseTimes$2,baseGetTag$6=_baseGetTag,isObjectLike$9=isObjectLike_1,argsTag$2="[object Arguments]";function baseIsArguments$1(e){return isObjectLike$9(e)&&baseGetTag$6(e)==argsTag$2}var _baseIsArguments=baseIsArguments$1,baseIsArguments=_baseIsArguments,isObjectLike$8=isObjectLike_1,objectProto$7=Object.prototype,hasOwnProperty$5=objectProto$7.hasOwnProperty,propertyIsEnumerable$1=objectProto$7.propertyIsEnumerable,isArguments$3=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike$8(e)&&hasOwnProperty$5.call(e,"callee")&&!propertyIsEnumerable$1.call(e,"callee")},isArguments_1=isArguments$3,isBuffer$2={exports:{}};function stubFalse(){return!1}var stubFalse_1=stubFalse;isBuffer$2.exports,function(e,t){var r=_root,a=stubFalse_1,n=t&&!t.nodeType&&t,i=n&&e&&!e.nodeType&&e,o=i&&i.exports===n,s=o?r.Buffer:void 0,c=s?s.isBuffer:void 0,l=c||a;e.exports=l}(isBuffer$2,isBuffer$2.exports);var isBufferExports=isBuffer$2.exports,MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex$3(e,t){var r=typeof e;return t=null==t?MAX_SAFE_INTEGER$1:t,!!t&&("number"==r||"symbol"!=r&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}var _isIndex=isIndex$3,MAX_SAFE_INTEGER=9007199254740991;function isLength$3(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}var isLength_1=isLength$3,baseGetTag$5=_baseGetTag,isLength$2=isLength_1,isObjectLike$7=isObjectLike_1,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag$3="[object Boolean]",dateTag$2="[object Date]",errorTag$1="[object Error]",funcTag$1="[object Function]",mapTag$4="[object Map]",numberTag$3="[object Number]",objectTag$3="[object Object]",regexpTag$2="[object RegExp]",setTag$4="[object Set]",stringTag$2="[object String]",weakMapTag$2="[object WeakMap]",arrayBufferTag$2="[object ArrayBuffer]",dataViewTag$3="[object DataView]",float32Tag$2="[object Float32Array]",float64Tag$2="[object Float64Array]",int8Tag$2="[object Int8Array]",int16Tag$2="[object Int16Array]",int32Tag$2="[object Int32Array]",uint8Tag$2="[object Uint8Array]",uint8ClampedTag$2="[object Uint8ClampedArray]",uint16Tag$2="[object Uint16Array]",uint32Tag$2="[object Uint32Array]",typedArrayTags={};function baseIsTypedArray$1(e){return isObjectLike$7(e)&&isLength$2(e.length)&&!!typedArrayTags[baseGetTag$5(e)]}typedArrayTags[float32Tag$2]=typedArrayTags[float64Tag$2]=typedArrayTags[int8Tag$2]=typedArrayTags[int16Tag$2]=typedArrayTags[int32Tag$2]=typedArrayTags[uint8Tag$2]=typedArrayTags[uint8ClampedTag$2]=typedArrayTags[uint16Tag$2]=typedArrayTags[uint32Tag$2]=!0,typedArrayTags[argsTag$1]=typedArrayTags[arrayTag$1]=typedArrayTags[arrayBufferTag$2]=typedArrayTags[boolTag$3]=typedArrayTags[dataViewTag$3]=typedArrayTags[dateTag$2]=typedArrayTags[errorTag$1]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag$4]=typedArrayTags[numberTag$3]=typedArrayTags[objectTag$3]=typedArrayTags[regexpTag$2]=typedArrayTags[setTag$4]=typedArrayTags[stringTag$2]=typedArrayTags[weakMapTag$2]=!1;var _baseIsTypedArray=baseIsTypedArray$1;function baseUnary$3(e){return function(t){return e(t)}}var _baseUnary=baseUnary$3,_nodeUtil={exports:{}};_nodeUtil.exports,function(e,t){var r=_freeGlobal,a=t&&!t.nodeType&&t,n=a&&e&&!e.nodeType&&e,i=n&&n.exports===a,o=i&&r.process,s=function(){try{var e=n&&n.require&&n.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(t){}}();e.exports=s}(_nodeUtil,_nodeUtil.exports);var _nodeUtilExports=_nodeUtil.exports,baseIsTypedArray=_baseIsTypedArray,baseUnary$2=_baseUnary,nodeUtil$2=_nodeUtilExports,nodeIsTypedArray=nodeUtil$2&&nodeUtil$2.isTypedArray,isTypedArray$1=nodeIsTypedArray?baseUnary$2(nodeIsTypedArray):baseIsTypedArray,isTypedArray_1=isTypedArray$1,baseTimes$1=_baseTimes,isArguments$2=isArguments_1,isArray$7=isArray_1,isBuffer$1=isBufferExports,isIndex$2=_isIndex,isTypedArray=isTypedArray_1,objectProto$6=Object.prototype,hasOwnProperty$4=objectProto$6.hasOwnProperty;function arrayLikeKeys$2(e,t){var r=isArray$7(e),a=!r&&isArguments$2(e),n=!r&&!a&&isBuffer$1(e),i=!r&&!a&&!n&&isTypedArray(e),o=r||a||n||i,s=o?baseTimes$1(e.length,String):[],c=s.length;for(var l in e)!t&&!hasOwnProperty$4.call(e,l)||o&&("length"==l||n&&("offset"==l||"parent"==l)||i&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||isIndex$2(l,c))||s.push(l);return s}var _arrayLikeKeys=arrayLikeKeys$2,objectProto$5=Object.prototype;function isPrototype$3(e){var t=e&&e.constructor,r="function"==typeof t&&t.prototype||objectProto$5;return e===r}var _isPrototype=isPrototype$3;function overArg$2(e,t){return function(r){return e(t(r))}}var _overArg=overArg$2,overArg$1=_overArg,nativeKeys$1=overArg$1(Object.keys,Object),_nativeKeys=nativeKeys$1,isPrototype$2=_isPrototype,nativeKeys=_nativeKeys,objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty;function baseKeys$1(e){if(!isPrototype$2(e))return nativeKeys(e);var t=[];for(var r in Object(e))hasOwnProperty$3.call(e,r)&&"constructor"!=r&&t.push(r);return t}var _baseKeys=baseKeys$1,isFunction=isFunction_1,isLength$1=isLength_1;function isArrayLike$3(e){return null!=e&&isLength$1(e.length)&&!isFunction(e)}var isArrayLike_1=isArrayLike$3,arrayLikeKeys$1=_arrayLikeKeys,baseKeys=_baseKeys,isArrayLike$2=isArrayLike_1;function keys$3(e){return isArrayLike$2(e)?arrayLikeKeys$1(e):baseKeys(e)}var keys_1=keys$3,copyObject$4=_copyObject,keys$2=keys_1;function baseAssign$1(e,t){return e&&copyObject$4(t,keys$2(t),e)}var _baseAssign=baseAssign$1;function nativeKeysIn$1(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}var _nativeKeysIn=nativeKeysIn$1,isObject$3=isObject_1,isPrototype$1=_isPrototype,nativeKeysIn=_nativeKeysIn,objectProto$3=Object.prototype,hasOwnProperty$2=objectProto$3.hasOwnProperty;function baseKeysIn$1(e){if(!isObject$3(e))return nativeKeysIn(e);var t=isPrototype$1(e),r=[];for(var a in e)("constructor"!=a||!t&&hasOwnProperty$2.call(e,a))&&r.push(a);return r}var _baseKeysIn=baseKeysIn$1,arrayLikeKeys=_arrayLikeKeys,baseKeysIn=_baseKeysIn,isArrayLike$1=isArrayLike_1;function keysIn$3(e){return isArrayLike$1(e)?arrayLikeKeys(e,!0):baseKeysIn(e)}var keysIn_1=keysIn$3,copyObject$3=_copyObject,keysIn$2=keysIn_1;function baseAssignIn$1(e,t){return e&&copyObject$3(t,keysIn$2(t),e)}var _baseAssignIn=baseAssignIn$1,_cloneBuffer={exports:{}};_cloneBuffer.exports,function(e,t){var r=_root,a=t&&!t.nodeType&&t,n=a&&e&&!e.nodeType&&e,i=n&&n.exports===a,o=i?r.Buffer:void 0,s=o?o.allocUnsafe:void 0;function c(e,t){if(t)return e.slice();var r=e.length,a=s?s(r):new e.constructor(r);return e.copy(a),a}e.exports=c}(_cloneBuffer,_cloneBuffer.exports);var _cloneBufferExports=_cloneBuffer.exports;function copyArray$1(e,t){var r=-1,a=e.length;t||(t=Array(a));while(++r<a)t[r]=e[r];return t}var _copyArray=copyArray$1;function arrayFilter$2(e,t){var r=-1,a=null==e?0:e.length,n=0,i=[];while(++r<a){var o=e[r];t(o,r,e)&&(i[n++]=o)}return i}var _arrayFilter=arrayFilter$2;function stubArray$2(){return[]}var stubArray_1=stubArray$2,arrayFilter$1=_arrayFilter,stubArray$1=stubArray_1,objectProto$2=Object.prototype,propertyIsEnumerable=objectProto$2.propertyIsEnumerable,nativeGetSymbols$1=Object.getOwnPropertySymbols,getSymbols$3=nativeGetSymbols$1?function(e){return null==e?[]:(e=Object(e),arrayFilter$1(nativeGetSymbols$1(e),(function(t){return propertyIsEnumerable.call(e,t)})))}:stubArray$1,_getSymbols=getSymbols$3,copyObject$2=_copyObject,getSymbols$2=_getSymbols;function copySymbols$1(e,t){return copyObject$2(e,getSymbols$2(e),t)}var _copySymbols=copySymbols$1;function arrayPush$3(e,t){var r=-1,a=t.length,n=e.length;while(++r<a)e[n+r]=t[r];return e}var _arrayPush=arrayPush$3,overArg=_overArg,getPrototype$3=overArg(Object.getPrototypeOf,Object),_getPrototype=getPrototype$3,arrayPush$2=_arrayPush,getPrototype$2=_getPrototype,getSymbols$1=_getSymbols,stubArray=stubArray_1,nativeGetSymbols=Object.getOwnPropertySymbols,getSymbolsIn$2=nativeGetSymbols?function(e){var t=[];while(e)arrayPush$2(t,getSymbols$1(e)),e=getPrototype$2(e);return t}:stubArray,_getSymbolsIn=getSymbolsIn$2,copyObject$1=_copyObject,getSymbolsIn$1=_getSymbolsIn;function copySymbolsIn$1(e,t){return copyObject$1(e,getSymbolsIn$1(e),t)}var _copySymbolsIn=copySymbolsIn$1,arrayPush$1=_arrayPush,isArray$6=isArray_1;function baseGetAllKeys$2(e,t,r){var a=t(e);return isArray$6(e)?a:arrayPush$1(a,r(e))}var _baseGetAllKeys=baseGetAllKeys$2,baseGetAllKeys$1=_baseGetAllKeys,getSymbols=_getSymbols,keys$1=keys_1;function getAllKeys$1(e){return baseGetAllKeys$1(e,keys$1,getSymbols)}var _getAllKeys=getAllKeys$1,baseGetAllKeys=_baseGetAllKeys,getSymbolsIn=_getSymbolsIn,keysIn$1=keysIn_1;function getAllKeysIn$2(e){return baseGetAllKeys(e,keysIn$1,getSymbolsIn)}var _getAllKeysIn=getAllKeysIn$2,getNative$3=_getNative,root$4=_root,DataView$1=getNative$3(root$4,"DataView"),_DataView=DataView$1,getNative$2=_getNative,root$3=_root,Promise$2=getNative$2(root$3,"Promise"),_Promise=Promise$2,getNative$1=_getNative,root$2=_root,Set$2=getNative$1(root$2,"Set"),_Set=Set$2,getNative=_getNative,root$1=_root,WeakMap$1=getNative(root$1,"WeakMap"),_WeakMap=WeakMap$1,DataView=_DataView,Map$1=_Map,Promise$1=_Promise,Set$1=_Set,WeakMap=_WeakMap,baseGetTag$4=_baseGetTag,toSource=_toSource,mapTag$3="[object Map]",objectTag$2="[object Object]",promiseTag="[object Promise]",setTag$3="[object Set]",weakMapTag$1="[object WeakMap]",dataViewTag$2="[object DataView]",dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map$1),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set$1),weakMapCtorString=toSource(WeakMap),getTag$3=baseGetTag$4;(DataView&&getTag$3(new DataView(new ArrayBuffer(1)))!=dataViewTag$2||Map$1&&getTag$3(new Map$1)!=mapTag$3||Promise$1&&getTag$3(Promise$1.resolve())!=promiseTag||Set$1&&getTag$3(new Set$1)!=setTag$3||WeakMap&&getTag$3(new WeakMap)!=weakMapTag$1)&&(getTag$3=function(e){var t=baseGetTag$4(e),r=t==objectTag$2?e.constructor:void 0,a=r?toSource(r):"";if(a)switch(a){case dataViewCtorString:return dataViewTag$2;case mapCtorString:return mapTag$3;case promiseCtorString:return promiseTag;case setCtorString:return setTag$3;case weakMapCtorString:return weakMapTag$1}return t});var _getTag=getTag$3,objectProto$1=Object.prototype,hasOwnProperty$1=objectProto$1.hasOwnProperty;function initCloneArray$1(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&hasOwnProperty$1.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var _initCloneArray=initCloneArray$1,root=_root,Uint8Array$1=root.Uint8Array,_Uint8Array=Uint8Array$1,Uint8Array=_Uint8Array;function cloneArrayBuffer$3(e){var t=new e.constructor(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t}var _cloneArrayBuffer=cloneArrayBuffer$3,cloneArrayBuffer$2=_cloneArrayBuffer;function cloneDataView$1(e,t){var r=t?cloneArrayBuffer$2(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var _cloneDataView=cloneDataView$1,reFlags=/\w*$/;function cloneRegExp$1(e){var t=new e.constructor(e.source,reFlags.exec(e));return t.lastIndex=e.lastIndex,t}var _cloneRegExp=cloneRegExp$1,Symbol$3=_Symbol$1,symbolProto$1=Symbol$3?Symbol$3.prototype:void 0,symbolValueOf=symbolProto$1?symbolProto$1.valueOf:void 0;function cloneSymbol$1(e){return symbolValueOf?Object(symbolValueOf.call(e)):{}}var _cloneSymbol=cloneSymbol$1,cloneArrayBuffer$1=_cloneArrayBuffer;function cloneTypedArray$1(e,t){var r=t?cloneArrayBuffer$1(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var _cloneTypedArray=cloneTypedArray$1,cloneArrayBuffer=_cloneArrayBuffer,cloneDataView=_cloneDataView,cloneRegExp=_cloneRegExp,cloneSymbol=_cloneSymbol,cloneTypedArray=_cloneTypedArray,boolTag$2="[object Boolean]",dateTag$1="[object Date]",mapTag$2="[object Map]",numberTag$2="[object Number]",regexpTag$1="[object RegExp]",setTag$2="[object Set]",stringTag$1="[object String]",symbolTag$2="[object Symbol]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag$1="[object Float32Array]",float64Tag$1="[object Float64Array]",int8Tag$1="[object Int8Array]",int16Tag$1="[object Int16Array]",int32Tag$1="[object Int32Array]",uint8Tag$1="[object Uint8Array]",uint8ClampedTag$1="[object Uint8ClampedArray]",uint16Tag$1="[object Uint16Array]",uint32Tag$1="[object Uint32Array]";function initCloneByTag$1(e,t,r){var a=e.constructor;switch(t){case arrayBufferTag$1:return cloneArrayBuffer(e);case boolTag$2:case dateTag$1:return new a(+e);case dataViewTag$1:return cloneDataView(e,r);case float32Tag$1:case float64Tag$1:case int8Tag$1:case int16Tag$1:case int32Tag$1:case uint8Tag$1:case uint8ClampedTag$1:case uint16Tag$1:case uint32Tag$1:return cloneTypedArray(e,r);case mapTag$2:return new a;case numberTag$2:case stringTag$1:return new a(e);case regexpTag$1:return cloneRegExp(e);case setTag$2:return new a;case symbolTag$2:return cloneSymbol(e)}}var _initCloneByTag=initCloneByTag$1,isObject$2=isObject_1,objectCreate=Object.create,baseCreate$1=function(){function e(){}return function(t){if(!isObject$2(t))return{};if(objectCreate)return objectCreate(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),_baseCreate=baseCreate$1,baseCreate=_baseCreate,getPrototype$1=_getPrototype,isPrototype=_isPrototype;function initCloneObject$1(e){return"function"!=typeof e.constructor||isPrototype(e)?{}:baseCreate(getPrototype$1(e))}var _initCloneObject=initCloneObject$1,getTag$2=_getTag,isObjectLike$6=isObjectLike_1,mapTag$1="[object Map]";function baseIsMap$1(e){return isObjectLike$6(e)&&getTag$2(e)==mapTag$1}var _baseIsMap=baseIsMap$1,baseIsMap=_baseIsMap,baseUnary$1=_baseUnary,nodeUtil$1=_nodeUtilExports,nodeIsMap=nodeUtil$1&&nodeUtil$1.isMap,isMap$1=nodeIsMap?baseUnary$1(nodeIsMap):baseIsMap,isMap_1=isMap$1,getTag$1=_getTag,isObjectLike$5=isObjectLike_1,setTag$1="[object Set]";function baseIsSet$1(e){return isObjectLike$5(e)&&getTag$1(e)==setTag$1}var _baseIsSet=baseIsSet$1,baseIsSet=_baseIsSet,baseUnary=_baseUnary,nodeUtil=_nodeUtilExports,nodeIsSet=nodeUtil&&nodeUtil.isSet,isSet$1=nodeIsSet?baseUnary(nodeIsSet):baseIsSet,isSet_1=isSet$1,Stack=_Stack,arrayEach=_arrayEach,assignValue$1=_assignValue,baseAssign=_baseAssign,baseAssignIn=_baseAssignIn,cloneBuffer=_cloneBufferExports,copyArray=_copyArray,copySymbols=_copySymbols,copySymbolsIn=_copySymbolsIn,getAllKeys=_getAllKeys,getAllKeysIn$1=_getAllKeysIn,getTag=_getTag,initCloneArray=_initCloneArray,initCloneByTag=_initCloneByTag,initCloneObject=_initCloneObject,isArray$5=isArray_1,isBuffer=isBufferExports,isMap=isMap_1,isObject$1=isObject_1,isSet=isSet_1,keys=keys_1,keysIn=keysIn_1,CLONE_DEEP_FLAG$2=1,CLONE_FLAT_FLAG$1=2,CLONE_SYMBOLS_FLAG$2=4,argsTag="[object Arguments]",arrayTag="[object Array]",boolTag$1="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag$1="[object Number]",objectTag$1="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag$1="[object Symbol]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",cloneableTags={};function baseClone$2(e,t,r,a,n,i){var o,s=t&CLONE_DEEP_FLAG$2,c=t&CLONE_FLAT_FLAG$1,l=t&CLONE_SYMBOLS_FLAG$2;if(r&&(o=n?r(e,a,n,i):r(e)),void 0!==o)return o;if(!isObject$1(e))return e;var u=isArray$5(e);if(u){if(o=initCloneArray(e),!s)return copyArray(e,o)}else{var d=getTag(e),p=d==funcTag||d==genTag;if(isBuffer(e))return cloneBuffer(e,s);if(d==objectTag$1||d==argsTag||p&&!n){if(o=c||p?{}:initCloneObject(e),!s)return c?copySymbolsIn(e,baseAssignIn(o,e)):copySymbols(e,baseAssign(o,e))}else{if(!cloneableTags[d])return n?e:{};o=initCloneByTag(e,d,s)}}i||(i=new Stack);var h=i.get(e);if(h)return h;i.set(e,o),isSet(e)?e.forEach((function(a){o.add(baseClone$2(a,t,r,a,e,i))})):isMap(e)&&e.forEach((function(a,n){o.set(n,baseClone$2(a,t,r,n,e,i))}));var f=l?c?getAllKeysIn$1:getAllKeys:c?keysIn:keys,g=u?void 0:f(e);return arrayEach(g||e,(function(a,n){g&&(n=a,a=e[n]),assignValue$1(o,n,baseClone$2(a,t,r,n,e,i))})),o}cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag$1]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag$1]=cloneableTags[objectTag$1]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag$1]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=!1;var _baseClone=baseClone$2,baseClone$1=_baseClone,CLONE_DEEP_FLAG$1=1,CLONE_SYMBOLS_FLAG$1=4;function cloneDeep(e){return baseClone$1(e,CLONE_DEEP_FLAG$1|CLONE_SYMBOLS_FLAG$1)}var cloneDeep_1=cloneDeep,cloneDeep$1=getDefaultExportFromCjs(cloneDeep_1),Timing=function(){function e(t){var r=t.duration,a=t.offset,n=t.stagger,i=t.yoyo,o=t.reverse;_classCallCheck(this,e),this.reverse=!1,this.duration=r,this.offset=a,this.stagger=n,this.yoyo=i,this.reverse=o}return _createClass(e,[{key:"rewriteBy",value:function(e){null!==e.duration&&(this.duration=e.duration),null!==e.offset&&(this.offset=e.offset),null!==e.stagger&&(this.stagger=e.stagger),null!==e.yoyo&&(this.yoyo=e.yoyo),null!==e.reverse&&(this.reverse=e.reverse)}},{key:"clone",value:function(){return new e({duration:this.duration,offset:this.offset,stagger:this.stagger,yoyo:this.yoyo?cloneDeep$1(this.yoyo):null,reverse:this.reverse})}}],[{key:"build",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.duration,a=t.offset,n=t.stagger,i=t.yoyo,o=t.reverse;return new e({duration:null!==r&&void 0!==r?r:null,offset:null!==a&&void 0!==a?a:null,stagger:null!==n&&void 0!==n?n:null,yoyo:null!==i&&void 0!==i?i:null,reverse:null!==o&&void 0!==o&&o})}}]),e}(),PType;(function(e){e[e["AnimationTemplate"]=0]="AnimationTemplate",e[e["LogicalAnimation"]=1]="LogicalAnimation",e[e["TargetType"]=2]="TargetType",e[e["Binder"]=3]="Binder"})(PType||(PType={}));var Proto=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"fullName",get:function(){return""===this.packageName?this.name:"".concat(this.packageName,".").concat(this.name)}},{key:"toString",value:function(){return"<".concat(this.name,">")}}]),e}();function _createSuper$11(e){var t=_isNativeReflectConstruct$11();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$11(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ResolveError=function(e){_inherits(r,e);var t=_createSuper$11(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,null,[{key:"build",value:function(e){return new r("ResolveError: "+e)}}]),r}(BaseError);const urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",POOL_SIZE_MULTIPLIER=128;let pool,poolOffset,fillPool=e=>{!pool||pool.length<e?(pool=Buffer.allocUnsafe(e*POOL_SIZE_MULTIPLIER),crypto.randomFillSync(pool),poolOffset=0):poolOffset+e>pool.length&&(crypto.randomFillSync(pool),poolOffset=0),poolOffset+=e},nanoid=(e=21)=>{fillPool(e-=0);let t="";for(let r=poolOffset-e;r<poolOffset;r++)t+=urlAlphabet[63&pool[r]];return t};var baseGetTag$3=_baseGetTag,isObjectLike$4=isObjectLike_1,numberTag="[object Number]";function isNumber(e){return"number"==typeof e||isObjectLike$4(e)&&baseGetTag$3(e)==numberTag}var isNumber_1=isNumber,isNumber$1=getDefaultExportFromCjs(isNumber_1);function arrayMap$3(e,t){var r=-1,a=null==e?0:e.length,n=Array(a);while(++r<a)n[r]=t(e[r],r,e);return n}var _arrayMap=arrayMap$3,baseGetTag$2=_baseGetTag,isObjectLike$3=isObjectLike_1,symbolTag="[object Symbol]";function isSymbol$3(e){return"symbol"==typeof e||isObjectLike$3(e)&&baseGetTag$2(e)==symbolTag}var isSymbol_1=isSymbol$3,isArray$4=isArray_1,isSymbol$2=isSymbol_1,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey$1(e,t){if(isArray$4(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!isSymbol$2(e))||(reIsPlainProp.test(e)||!reIsDeepProp.test(e)||null!=t&&e in Object(t))}var _isKey=isKey$1,MapCache=_MapCache,FUNC_ERROR_TEXT="Expected a function";function memoize$1(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT);var r=function(){var a=arguments,n=t?t.apply(this,a):a[0],i=r.cache;if(i.has(n))return i.get(n);var o=e.apply(this,a);return r.cache=i.set(n,o)||i,o};return r.cache=new(memoize$1.Cache||MapCache),r}memoize$1.Cache=MapCache;var memoize_1=memoize$1,memoize=memoize_1,MAX_MEMOIZE_SIZE=500;function memoizeCapped$1(e){var t=memoize(e,(function(e){return r.size===MAX_MEMOIZE_SIZE&&r.clear(),e})),r=t.cache;return t}var _memoizeCapped=memoizeCapped$1,memoizeCapped=_memoizeCapped,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath$1=memoizeCapped((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(rePropName,(function(e,r,a,n){t.push(a?n.replace(reEscapeChar,"$1"):r||e)})),t})),_stringToPath=stringToPath$1,Symbol$2=_Symbol$1,arrayMap$2=_arrayMap,isArray$3=isArray_1,isSymbol$1=isSymbol_1,INFINITY$1=1/0,symbolProto=Symbol$2?Symbol$2.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;function baseToString$1(e){if("string"==typeof e)return e;if(isArray$3(e))return arrayMap$2(e,baseToString$1)+"";if(isSymbol$1(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return"0"==t&&1/e==-INFINITY$1?"-0":t}var _baseToString=baseToString$1,baseToString=_baseToString;function toString$1(e){return null==e?"":baseToString(e)}var toString_1=toString$1,isArray$2=isArray_1,isKey=_isKey,stringToPath=_stringToPath,toString=toString_1;function castPath$6(e,t){return isArray$2(e)?e:isKey(e,t)?[e]:stringToPath(toString(e))}var _castPath=castPath$6;function last$1(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var last_1=last$1,isSymbol=isSymbol_1,INFINITY=1/0;function toKey$4(e){if("string"==typeof e||isSymbol(e))return e;var t=e+"";return"0"==t&&1/e==-INFINITY?"-0":t}var _toKey=toKey$4,castPath$5=_castPath,toKey$3=_toKey;function baseGet$2(e,t){t=castPath$5(t,e);var r=0,a=t.length;while(null!=e&&r<a)e=e[toKey$3(t[r++])];return r&&r==a?e:void 0}var _baseGet=baseGet$2;function baseSlice$1(e,t,r){var a=-1,n=e.length;t<0&&(t=-t>n?0:n+t),r=r>n?n:r,r<0&&(r+=n),n=t>r?0:r-t>>>0,t>>>=0;var i=Array(n);while(++a<n)i[a]=e[a+t];return i}var _baseSlice=baseSlice$1,baseGet$1=_baseGet,baseSlice=_baseSlice;function parent$1(e,t){return t.length<2?e:baseGet$1(e,baseSlice(t,0,-1))}var _parent=parent$1,castPath$4=_castPath,last=last_1,parent=_parent,toKey$2=_toKey;function baseUnset$1(e,t){return t=castPath$4(t,e),e=parent(e,t),null==e||delete e[toKey$2(last(t))]}var _baseUnset=baseUnset$1,baseGetTag$1=_baseGetTag,getPrototype=_getPrototype,isObjectLike$2=isObjectLike_1,objectTag="[object Object]",funcProto=Function.prototype,objectProto=Object.prototype,funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,objectCtorString=funcToString.call(Object);function isPlainObject$1(e){if(!isObjectLike$2(e)||baseGetTag$1(e)!=objectTag)return!1;var t=getPrototype(e);if(null===t)return!0;var r=hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&funcToString.call(r)==objectCtorString}var isPlainObject_1=isPlainObject$1,isPlainObject=isPlainObject_1;function customOmitClone$1(e){return isPlainObject(e)?void 0:e}var _customOmitClone=customOmitClone$1,Symbol$1=_Symbol$1,isArguments$1=isArguments_1,isArray$1=isArray_1,spreadableSymbol=Symbol$1?Symbol$1.isConcatSpreadable:void 0;function isFlattenable$1(e){return isArray$1(e)||isArguments$1(e)||!!(spreadableSymbol&&e&&e[spreadableSymbol])}var _isFlattenable=isFlattenable$1,arrayPush=_arrayPush,isFlattenable=_isFlattenable;function baseFlatten$1(e,t,r,a,n){var i=-1,o=e.length;r||(r=isFlattenable),n||(n=[]);while(++i<o){var s=e[i];t>0&&r(s)?t>1?baseFlatten$1(s,t-1,r,a,n):arrayPush(n,s):a||(n[n.length]=s)}return n}var _baseFlatten=baseFlatten$1,baseFlatten=_baseFlatten;function flatten$1(e){var t=null==e?0:e.length;return t?baseFlatten(e,1):[]}var flatten_1=flatten$1;function apply$1(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var _apply=apply$1,apply=_apply,nativeMax$1=Math.max;function overRest$2(e,t,r){return t=nativeMax$1(void 0===t?e.length-1:t,0),function(){var a=arguments,n=-1,i=nativeMax$1(a.length-t,0),o=Array(i);while(++n<i)o[n]=a[t+n];n=-1;var s=Array(t+1);while(++n<t)s[n]=a[n];return s[t]=r(o),apply(e,this,s)}}var _overRest=overRest$2;function constant$1(e){return function(){return e}}var constant_1=constant$1;function identity$2(e){return e}var identity_1=identity$2,constant=constant_1,defineProperty=_defineProperty,identity$1=identity_1,baseSetToString$1=defineProperty?function(e,t){return defineProperty(e,"toString",{configurable:!0,enumerable:!1,value:constant(t),writable:!0})}:identity$1,_baseSetToString=baseSetToString$1,HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut$1(e){var t=0,r=0;return function(){var a=nativeNow(),n=HOT_SPAN-(a-r);if(r=a,n>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var _shortOut=shortOut$1,baseSetToString=_baseSetToString,shortOut=_shortOut,setToString$2=shortOut(baseSetToString),_setToString=setToString$2,flatten=flatten_1,overRest$1=_overRest,setToString$1=_setToString;function flatRest$2(e){return setToString$1(overRest$1(e,void 0,flatten),e+"")}var _flatRest=flatRest$2,arrayMap$1=_arrayMap,baseClone=_baseClone,baseUnset=_baseUnset,castPath$3=_castPath,copyObject=_copyObject,customOmitClone=_customOmitClone,flatRest$1=_flatRest,getAllKeysIn=_getAllKeysIn,CLONE_DEEP_FLAG=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG=4,omit=flatRest$1((function(e,t){var r={};if(null==e)return r;var a=!1;t=arrayMap$1(t,(function(t){return t=castPath$3(t,e),a||(a=t.length>1),t})),copyObject(e,getAllKeysIn(e),r),a&&(r=baseClone(r,CLONE_DEEP_FLAG|CLONE_FLAT_FLAG|CLONE_SYMBOLS_FLAG,customOmitClone));var n=t.length;while(n--)baseUnset(r,t[n]);return r})),omit_1=omit,omit$1=getDefaultExportFromCjs(omit_1);function _createSuper$10(e){var t=_isNativeReflectConstruct$10();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$10(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var AniPropSchema=z.object({id:z.string().or(z.number())["default"]((function(){return nanoid(10)})),target:z["instanceof"](Target).or(z.string())["default"](Target.build()).transform((function(e){return isString$1(e)?Target.build().selectAll(e):e}))["default"](Target.build()).describe("The target of the animation"),timing:z["instanceof"](Timing).or(z.number())["default"](Timing.build()).transform((function(e){return isNumber$1(e)?Timing.build({duration:e}):e})).describe("The timing of the animation")}),LogicalAnimation=function(e){_inherits(r,e);var t=_createSuper$10(r);function r(e,a){var n;return _classCallCheck(this,r),n=t.call(this),n._props=null,n._templateSrc=null,n._refSrc=null,n.computedDuration=null,n.computedTotalDuration=null,n._meta=e,n._rawProps=a,n._props=n.parseProps(a),n.init(),n}return _createClass(r,[{key:"init",value:function(){}},{key:"type",get:function(){return PType.LogicalAnimation}},{key:"name",get:function(){return this._meta.name}},{key:"packageName",get:function(){return this._meta.packageName}},{key:"imports",get:function(){return this._meta.imports}},{key:"targetType",get:function(){return this._meta.targetType}},{key:"propSchema",get:function(){return this._meta.propSchema}},{key:"setSrc",value:function(e,t){this._refSrc=e,this._templateSrc=t}},{key:"props",value:function(){return this._props}},{key:"prop",value:function(e){return this._props[e]}},{key:"id",get:function(){return this.prop("id")}},{key:"target",get:function(){return this.prop("target")}},{key:"timing",get:function(){return this.prop("timing")}},{key:"refSrc",get:function(){return this._refSrc}},{key:"initialRefSrc",get:function(){var e=this._refSrc;if(null===e)return null;while(null!==e.refSrc)e=e.refSrc;return e}},{key:"templateSrc",get:function(){return this._templateSrc}},{key:"parseProps",value:function(e){var t=this.propSchema.safeParse(e);if(!0!==t.success)throw ResolveError.build(t.error.message);return t.data}},{key:"computeTotalDuration",value:function(e){var t,r=this.computeDuration(e);if(this.timing.yoyo){var a=this.timing.yoyo,n=a.repeat,i=a.delay;r=r*(n+1)+i*n}var o=null!==(t=this.timing.stagger)&&void 0!==t?t:0;return r+this.target.selection.size*o}},{key:"clone",value:function(){throw new Error("Method not implemented.")}},{key:"toString",value:function(){return"".concat(this.name,"(").concat(this.id,")")}},{key:"toOneLineString",value:function(){return"".concat(this.name)+"".concat(null===this.refSrc?"":" ref=".concat(this.templateSrc.name))+" target=".concat(this.getTargetStr())+" timing=".concat(this.getTimingStr())+" props=".concat(this.getPropsStr())}},{key:"getTargetStr",value:function(){var e=this.target.transforms.toString(),t=this.target.selection?this.target.selection.toString():"?";return"[".concat(e,"]->[").concat(t,"]")}},{key:"getTimingStr",value:function(){var e=[];if(e.push(["computedDur",this.computedDuration?this.computedDuration+"s":"?"]),e.push(["computedTotDur",this.computedTotalDuration?this.computedTotalDuration+"s":"?"]),this.timing.duration&&e.push(["dur",this.timing.duration+"s"]),this.timing.offset&&e.push(["offset",this.timing.offset+"s"]),this.timing.stagger&&e.push(["stagger",this.timing.stagger+"s"]),this.timing.reverse&&e.push(["reverse",this.timing.reverse]),this.timing.yoyo){var t=this.timing.yoyo;e.push(["yoyo","(delay=".concat(t.delay,"s,repeat=").concat(t.repeat,")")])}var r=e.map((function(e){var t=_slicedToArray(e,2),r=t[0],a=t[1];return"".concat(r,"=").concat(a)})).join(", ");return"[".concat(r,"]")}},{key:"getPropsStr",value:function(){var e=omit$1(this.props(),["id","target","timing"]),t=Object.entries(e).map((function(e){var t=_slicedToArray(e,2),r=t[0],a=t[1];return"".concat(r,"=").concat(isObject$7(a)?JSON.stringify(a):a)})).join(", ");return"[".concat(t,"]")}}]),r}(Proto),Import=function(){function e(t,r,a){_classCallCheck(this,e),this.pkg=null!==t&&void 0!==t?t:null,this.clazz=null!==r&&void 0!==r?r:null,this.as=null!==a&&void 0!==a?a:null}return _createClass(e,[{key:"isPackageImport",value:function(){return null!==this.pkg}}],[{key:"clazz",value:function(t,r){return new e(null,t,null!==r&&void 0!==r?r:t)}},{key:"pkg",value:function(t){return new e(t)}}]),e}();function _createSuper$$(e){var t=_isNativeReflectConstruct$$();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$$(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ParseError=function(e){_inherits(r,e);var t=_createSuper$$(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,null,[{key:"build",value:function(e){return new r("ParseError: "+e)}},{key:"buildWithPath",value:function(e,t){var a="Failed to parse spec at path ".concat(e,". ").concat(t);return r.build(a)}},{key:"buildByChecker",value:function(e,t){var a=JSON.stringify(t),n="ParseError: Failed to parse spec at path ".concat(e,". Errors: \n").concat(a);return console.error(n),new r(n)}}]),r}(BaseError),ParseContext=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this._props={},this.processStack=[],this._props=t}return _createClass(e,[{key:"basicProp",value:function(e){return this._props[e]}},{key:"prop",value:function(e){assert(e.startsWith("$"),'A parameter usage call must start with "$", got '.concat(e));var t=e.substring(1);if(!(t in this._props))throw new Error("Cannot find parameter '".concat(t,"' when parsing ").concat(this.getProcessPath()));return this._props[t]}},{key:"withProcessPath",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,n=t+("number"===typeof r?"[".concat(r,"]"):"");this.processStack.push(n);var i=e(a);return this.processStack.pop(),i}},{key:"getProcessPath",value:function(){return this.processStack.join(".")}}]),e}();function _createSuper$_(e){var t=_isNativeReflectConstruct$_();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var LeafAniProps=AniPropSchema.extend({}),LeafAnimation=function(e){_inherits(r,e);var t=_createSuper$_(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"visitChildren",value:function(){return[]}},{key:"computeDuration",value:function(e){var t;return null!==(t=this.timing.duration)&&void 0!==t?t:e.config.defaultDuration}},{key:"rescale",value:function(e,t){this.computedDuration*=t,this.computedTotalDuration*=t}}]),r}(LogicalAnimation),GAIA_COMMON_PKG="gaia.common";function _createSuper$Z(e){var t=_isNativeReflectConstruct$Z();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$Z(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var RefAnimationProps=LeafAniProps.extend({ref:z.string()}),RefAnimation=function(e){_inherits(r,e);var t=_createSuper$Z(r);function r(e){return _classCallCheck(this,r),t.call(this,{name:"Ref",packageName:GAIA_COMMON_PKG,imports:[],targetType:"Any",propSchema:RefAnimationProps},e)}return _createClass(r,[{key:"ref",get:function(){return this.prop("ref")}},{key:"refProps",value:function(){return omit$1(this._rawProps,["ref"])}},{key:"refProp",value:function(e){return this.refProps()[e]}}],[{key:"create",value:function(e,t){return isString$1(e)?new r(Object.assign({ref:e},t)):new r(e)}}]),r}(LeafAnimation);function createRef(e,t){return new RefAnimation(null==t?{ref:e}:Object.assign({ref:e},t))}var RefBuilder=function(){function e(){_classCallCheck(this,e),this._props={target:Target.build(),timing:Timing.build()},this._ref=null}return _createClass(e,[{key:"id",value:function(e){return this._props.id=e,this}},{key:"target",value:function(e){return isString$1(e)?this._props.target=Target.build().selectAll(e):this._props.target=e,this}},{key:"timing",value:function(e){return this._props.timing=e,this}},{key:"prop",value:function(e,t){return this._props[e]=t,this}},{key:"props",value:function(e){return Object.assign(this._props,e),this}},{key:"select",value:function(e){return assert(this._props.target instanceof Target),this._props.target.select(e),this}},{key:"selectAll",value:function(e){return assert(this._props.target instanceof Target),this._props.target.selectAll(e),this}},{key:"filter",value:function(e){return assert(this._props.target instanceof Target),this._props.target.filter(e),this}},{key:"filterExpr",value:function(e){return assert(this._props.target instanceof Target),this._props.target.filter(e),this}},{key:"sort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";return assert(this._props.target instanceof Target),this._props.target.sort(e,t),this}},{key:"slice",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return assert(this._props.target instanceof Target),this._props.target.slice(e,t,r),this}},{key:"ref",value:function(e){return this._ref=e,this}},{key:"build",value:function(){if(null==this._ref)throw new Error("Ref is not set");return new RefAnimation(Object.assign({ref:this._ref},this._props))}}]),e}(),Ref=Object.assign(createRef,{builder:function(){return new RefBuilder}}),BaseSpecParser=_createClass((function e(){_classCallCheck(this,e)}));function _createSuper$Y(e){var t=_isNativeReflectConstruct$Y();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$Y(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var TargetTypeComponent=function(){function e(t,r,a){_classCallCheck(this,e),this.ref=t,this.classList=r,this.required=a}return _createClass(e,null,[{key:"build",value:function(t,r){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new e(t,r,a)}}]),e}(),TargetType=function(e){_inherits(r,e);var t=_createSuper$Y(r);function r(e,a,n,i,o){var s;return _classCallCheck(this,r),s=t.call(this),s._name=e,s._packageName=a,s.imports=n,s.classList=i,s.components=o,s}return _createClass(r,[{key:"name",get:function(){return this._name}},{key:"packageName",get:function(){return this._packageName}},{key:"type",get:function(){return PType.TargetType}},{key:"isLeaf",value:function(){return 0===this.components.length}},{key:"clone",value:function(){throw new Error("Not implemented")}}],[{key:"build",value:function(e,t,a){var n=a.imports,i=void 0===n?[]:n,o=a.classList,s=void 0===o?[]:o,c=a.components,l=void 0===c?[]:c;return new r(e,t,i,s,l)}}]),r}(Proto);function _createSuper$X(e){var t=_isNativeReflectConstruct$X();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$X(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var BaseTemplate=function(e){_inherits(r,e);var t=_createSuper$X(r);function r(e){var a;return _classCallCheck(this,r),a=t.call(this),a._meta=e,a}return _createClass(r,[{key:"type",get:function(){return PType.AnimationTemplate}},{key:"meta",get:function(){return this._meta}},{key:"name",get:function(){return this._meta.name}},{key:"packageName",get:function(){return this._meta.packageName}},{key:"targetType",get:function(){return this._meta.targetType}},{key:"propSchema",get:function(){return this._meta.propSchema}},{key:"clone",value:function(){throw new Error("Method not implemented.")}}]),r}(Proto);function _createSuper$W(e){var t=_isNativeReflectConstruct$W();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$W(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var CompositeTemplate=function(e){_inherits(r,e);var t=_createSuper$W(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"create",value:function(e,t){var r=this.propSchema.parse(t);return this.instantiate(e,r)}}]),r}(BaseTemplate);function _createSuper$V(e){var t=_isNativeReflectConstruct$V();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$V(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var JsonCompositeTemplate=function(e){_inherits(r,e);var t=_createSuper$V(r);function r(e,a){var n;return _classCallCheck(this,r),n=t.call(this,e),n.spec=a,n}return _createClass(r,[{key:"instantiate",value:function(e,t){var r=new ParseContext(t);LoggerManager.getLogger("JsonCompositeTemplate").debug("Instantiate ".concat(this.fullName," with props ").concat(JSON.stringify(t)));var a=e.compileExec.session.parser,n=a.parseAnimation(this.spec,r);return n.target.concatAtFront(t.target),n.timing.rewriteBy(t.timing),n}}]),r}(CompositeTemplate);function _createSuper$U(e){var t=_isNativeReflectConstruct$U();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$U(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var AryPropSchema=AniPropSchema.extend({animations:z["instanceof"](LogicalAnimation).array().describe("Child animations")}),AryAnimation=function(e){_inherits(r,e);var t=_createSuper$U(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"children",get:function(){return this.prop("animations")}},{key:"visitChildren",value:function(){return this.prop("animations")}},{key:"animations",get:function(){return this.prop("animations")}}]),r}(LogicalAnimation),identity=identity_1,overRest=_overRest,setToString=_setToString;function baseRest$1(e,t){return setToString(overRest(e,t,identity),e+"")}var _baseRest=baseRest$1;function baseProperty$1(e){return function(t){return null==t?void 0:t[e]}}var _baseProperty=baseProperty$1,isArrayLike=isArrayLike_1,isObjectLike$1=isObjectLike_1;function isArrayLikeObject$1(e){return isObjectLike$1(e)&&isArrayLike(e)}var isArrayLikeObject_1=isArrayLikeObject$1,arrayFilter=_arrayFilter,arrayMap=_arrayMap,baseProperty=_baseProperty,baseTimes=_baseTimes,isArrayLikeObject=isArrayLikeObject_1,nativeMax=Math.max;function unzip$1(e){if(!e||!e.length)return[];var t=0;return e=arrayFilter(e,(function(e){if(isArrayLikeObject(e))return t=nativeMax(e.length,t),!0})),baseTimes(t,(function(t){return arrayMap(e,baseProperty(t))}))}var unzip_1=unzip$1,baseRest=_baseRest,unzip=unzip_1,zip=baseRest(unzip),zip_1=zip,zip$1=getDefaultExportFromCjs(zip_1);function _createForOfIteratorHelper$b(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$b(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$b(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray$b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$b(e,t):void 0}}function _arrayLikeToArray$b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function _createSuper$T(e){var t=_isNativeReflectConstruct$T();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$T(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var SyncPropSchema=AryPropSchema.extend({}),SyncAnimation=function(e){_inherits(r,e);var t=_createSuper$T(r);function r(e){var a;return _classCallCheck(this,r),a=t.call(this,{name:"Sync",packageName:GAIA_COMMON_PKG,imports:[],targetType:"Any",propSchema:SyncPropSchema},e),a.scaleRate=1,a}return _createClass(r,[{key:"offsets",get:function(){var e=this;return this.prop("animations").map((function(t){var r;return(null!==(r=t.timing.offset)&&void 0!==r?r:0)*e.scaleRate}))}},{key:"computeDuration",value:function(e){var t,r=0,a=_createForOfIteratorHelper$b(zip$1(this.animations,this.offsets));try{for(a.s();!(t=a.n()).done;){var n=_slicedToArray(t.value,2),i=n[0],o=n[1],s=i.computedTotalDuration+o;r=Math.max(r,s)}}catch(c){a.e(c)}finally{a.f()}if(null!=this.timing.yoyo)throw new Error("Cannot set yoyo in ".concat(this,". Please use yoyo in child animations."));return r}},{key:"rescale",value:function(e,t){this.scaleRate*=t,this.computedDuration*=t,this.computedTotalDuration*=t,this.children.forEach((function(r){return r.rescale(e,t)}))}},{key:"replace",value:function(e,t){var r=this.animations.indexOf(e);return assert(-1!=r,"Animation not found"),this.animations[r]=t,this}},{key:"getPropsStr",value:function(){var e=Object.assign(omit$1(this.props(),["id","target","timing","animations"]),{animations:"Array(".concat(this.animations.length,")"),scaleRate:this.scaleRate}),t=Object.entries(e).map((function(e){var t=_slicedToArray(e,2),r=t[0],a=t[1];return"".concat(r,"=").concat(a)})).join(", ");return"[".concat(t,"]")}}]),r}(AryAnimation);function createSync(e){return Array.isArray(e)?new SyncAnimation({animations:e}):new SyncAnimation(e)}var SyncBuilder=function(){function e(){_classCallCheck(this,e),this._props={target:Target.build(),timing:Timing.build(),animations:[]}}return _createClass(e,[{key:"id",value:function(e){return this._props.id=e,this}},{key:"target",value:function(e){return isString$1(e)?this._props.target=Target.build().selectAll(e):this._props.target=e,this}},{key:"timing",value:function(e){return this._props.timing=e,this}},{key:"prop",value:function(e,t){return this._props[e]=t,this}},{key:"props",value:function(e){return Object.assign(this._props,e),this}},{key:"select",value:function(e){return assert(this._props.target instanceof Target),this._props.target.select(e),this}},{key:"selectAll",value:function(e){return assert(this._props.target instanceof Target),this._props.target.selectAll(e),this}},{key:"filter",value:function(e){return assert(this._props.target instanceof Target),this._props.target.filter(e),this}},{key:"filterExpr",value:function(e){return assert(this._props.target instanceof Target),this._props.target.filter(e),this}},{key:"sort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";return assert(this._props.target instanceof Target),this._props.target.sort(e,t),this}},{key:"slice",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return assert(this._props.target instanceof Target),this._props.target.slice(e,t,r),this}},{key:"animations",value:function(e){return this._props.animations=e,this}},{key:"append",value:function(e){return this._props.animations.push(e),this}},{key:"build",value:function(){return createSync(this._props)}}]),e}(),Sync=Object.assign(createSync,{builder:function(){return new SyncBuilder}}),baseGetTag=_baseGetTag,isObjectLike=isObjectLike_1,boolTag="[object Boolean]";function isBoolean(e){return!0===e||!1===e||isObjectLike(e)&&baseGetTag(e)==boolTag}var isBoolean_1=isBoolean,isBoolean$1=getDefaultExportFromCjs(isBoolean_1),assignValue=_assignValue,castPath$2=_castPath,isIndex$1=_isIndex,isObject=isObject_1,toKey$1=_toKey;function baseSet$1(e,t,r,a){if(!isObject(e))return e;t=castPath$2(t,e);var n=-1,i=t.length,o=i-1,s=e;while(null!=s&&++n<i){var c=toKey$1(t[n]),l=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(n!=o){var u=s[c];l=a?a(u,c,s):void 0,void 0===l&&(l=isObject(u)?u:isIndex$1(t[n+1])?[]:{})}assignValue(s,c,l),s=s[c]}return e}var _baseSet=baseSet$1,baseGet=_baseGet,baseSet=_baseSet,castPath$1=_castPath;function basePickBy$1(e,t,r){var a=-1,n=t.length,i={};while(++a<n){var o=t[a],s=baseGet(e,o);r(s,o)&&baseSet(i,castPath$1(o,e),s)}return i}var _basePickBy=basePickBy$1;function baseHasIn$1(e,t){return null!=e&&t in Object(e)}var _baseHasIn=baseHasIn$1,castPath=_castPath,isArguments=isArguments_1,isArray=isArray_1,isIndex=_isIndex,isLength=isLength_1,toKey=_toKey;function hasPath$1(e,t,r){t=castPath(t,e);var a=-1,n=t.length,i=!1;while(++a<n){var o=toKey(t[a]);if(!(i=null!=e&&r(e,o)))break;e=e[o]}return i||++a!=n?i:(n=null==e?0:e.length,!!n&&isLength(n)&&isIndex(o,n)&&(isArray(e)||isArguments(e)))}var _hasPath=hasPath$1,baseHasIn=_baseHasIn,hasPath=_hasPath;function hasIn$1(e,t){return null!=e&&hasPath(e,t,baseHasIn)}var hasIn_1=hasIn$1,basePickBy=_basePickBy,hasIn=hasIn_1;function basePick$1(e,t){return basePickBy(e,t,(function(t,r){return hasIn(e,r)}))}var _basePick=basePick$1,basePick=_basePick,flatRest=_flatRest,pick=flatRest((function(e,t){return null==e?{}:basePick(e,t)})),pick_1=pick,pick$1=getDefaultExportFromCjs(pick_1),TargetTypeComponentSpec=z.object({ref:z.string(),class:z.array(z.string())["default"]([]),required:z["boolean"]()["default"](!1)}).strict(),TargetTypeSpec=z.object({type:z.string(),package:z.string()["default"](""),import:z.array(ImportSpec)["default"]([]),class:z.array(z.string())["default"]([]),components:z.array(z.union([z.string(),TargetTypeComponentSpec]))["default"]([])}).strict();function _createForOfIteratorHelper$a(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$a(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$a(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray$a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$a(e,t):void 0}}function _arrayLikeToArray$a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function _createSuper$S(e){var t=_isNativeReflectConstruct$S();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$S(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ConcatPropSchema=AryPropSchema.extend({}),ConcatAnimation=function(e){_inherits(r,e);var t=_createSuper$S(r);function r(e){var a;return _classCallCheck(this,r),a=t.call(this,{name:"Concat",packageName:GAIA_COMMON_PKG,imports:[],targetType:"Any",propSchema:ConcatPropSchema},e),a.scaleRate=1,a}return _createClass(r,[{key:"offsets",get:function(){var e=this;return this.prop("animations").map((function(t){var r;return(null!==(r=t.timing.offset)&&void 0!==r?r:0)*e.scaleRate}))}},{key:"computeDuration",value:function(e){var t,r=0,a=0,n=_createForOfIteratorHelper$a(zip$1(this.animations,this.offsets));try{for(n.s();!(t=n.n()).done;){var i=_slicedToArray(t.value,2),o=i[0],s=i[1];a=a+s+o.computedTotalDuration,r=Math.max(r,a)}}catch(c){n.e(c)}finally{n.f()}if(null!=this.timing.yoyo)throw new Error("Cannot set yoyo in ".concat(this,". Please use yoyo in child animations."));return r}},{key:"rescale",value:function(e,t){this.scaleRate*=t,this.computedDuration*=t,this.computedTotalDuration*=t,this.children.forEach((function(r){return r.rescale(e,t)}))}},{key:"replace",value:function(e,t){var r=this.animations.indexOf(e);return assert(-1!=r,"Animation not found"),this.animations[r]=t,this}},{key:"getPropsStr",value:function(){var e=Object.assign(omit$1(this.props(),["id","target","timing","animations"]),{animations:"Array(".concat(this.animations.length,")"),scaleRate:this.scaleRate}),t=Object.entries(e).map((function(e){var t=_slicedToArray(e,2),r=t[0],a=t[1];return"".concat(r,"=").concat(a)})).join(", ");return"[".concat(t,"]")}}]),r}(AryAnimation);function createConcat(e){return Array.isArray(e)?new ConcatAnimation({animations:e}):new ConcatAnimation(e)}var ConcatBuilder=function(){function e(){_classCallCheck(this,e),this._props={target:Target.build(),timing:Timing.build(),animations:[]}}return _createClass(e,[{key:"id",value:function(e){return this._props.id=e,this}},{key:"target",value:function(e){return isString$1(e)?this._props.target=Target.build().selectAll(e):this._props.target=e,this}},{key:"timing",value:function(e){return this._props.timing=e,this}},{key:"prop",value:function(e,t){return this._props[e]=t,this}},{key:"props",value:function(e){return Object.assign(this._props,e),this}},{key:"select",value:function(e){return assert(this._props.target instanceof Target),this._props.target.select(e),this}},{key:"selectAll",value:function(e){return assert(this._props.target instanceof Target),this._props.target.selectAll(e),this}},{key:"filter",value:function(e){return assert(this._props.target instanceof Target),this._props.target.filter(e),this}},{key:"filterExpr",value:function(e){return assert(this._props.target instanceof Target),this._props.target.filter(e),this}},{key:"sort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";return assert(this._props.target instanceof Target),this._props.target.sort(e,t),this}},{key:"slice",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return assert(this._props.target instanceof Target),this._props.target.slice(e,t,r),this}},{key:"animations",value:function(e){return this._props.animations=e,this}},{key:"append",value:function(e){return this._props.animations.push(e),this}},{key:"build",value:function(){return createConcat(this._props)}}]),e}(),Concat=Object.assign(createConcat,{builder:function(){return new ConcatBuilder}}),Binder=function(){function e(t,r,a){_classCallCheck(this,e),this.from=t,this.to=r,this.rules=a}return _createClass(e,null,[{key:"build",value:function(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return new e(t,r,a)}}]),e}(),BinderRule=function(){function e(t,r,a,n,i,o,s){_classCallCheck(this,e),this.type=t,this.from=r,this.to=a,this.id=n,this.classList=i,this.data=o,this.dataList=s}return _createClass(e,null,[{key:"buildSingleBind",value:function(t){var r=t.from,a=t.to,n=t.id,i=t.classList,o=t.data;return new e("single",r,a,null!==n&&void 0!==n?n:null,null!==i&&void 0!==i?i:[],null!==o&&void 0!==o?o:null,null)}},{key:"buildBatchBind",value:function(t){var r=t.from,a=t.to,n=t.classList,i=t.data,o=t.dataList;return assert(null==i||null==o,"Batch builder rule cannot have both data and dataList."),new e("batch",r,a,null,null!==n&&void 0!==n?n:[],null!==i&&void 0!==i?i:null,null!==o&&void 0!==o?o:null)}}]),e}(),BinderRuleSpec=z.object({from:z.string(),to:z.string(),id:z.string().nonempty("Id cannot be empty if specified").nullable()["default"](null),classList:z.array(z.string())["default"]([]),data:z.record(z.string(),z.any()).nullable()["default"](null),dataList:z.array(z.record(z.string(),z.any())).nullable()["default"](null)}).strict(),BinderSpec=z.object({from:z.string(),to:z.string(),rules:z.array(BinderRuleSpec)["default"]([])}).strict();function _createSuper$R(e){var t=_isNativeReflectConstruct$R();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$R(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var AtTransform=function(e){_inherits(r,e);var t=_createSuper$R(r);function r(e){var a;return _classCallCheck(this,r),a=t.call(this),a.index=e,a}return _createClass(r,[{key:"type",get:function(){return"at"}},{key:"execute",value:function(e){return e.slice(this.index,this.index+1)}},{key:"toString",value:function(){return"at(".concat(this.index,")")}},{key:"clone",value:function(){return new r(this.index)}}]),r}(Transform);function _createForOfIteratorHelper$9(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$9(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$9(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray$9(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$9(e,t):void 0}}function _arrayLikeToArray$9(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function _createSuper$Q(e){var t=_isNativeReflectConstruct$Q();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$Q(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var JsonSpecParser=function(e){_inherits(r,e);var t=_createSuper$Q(r);function r(){return _classCallCheck(this,r),t.call(this)}return _createClass(r,[{key:"parseTemplate",value:function(e,t){r.logger.debug("Parse template\n",JSON.stringify(e,null,2)),t=null!==t&&void 0!==t?t:new ParseContext;var a=AniClassSpec.safeParse(e);if(!1===a.success)throw ParseError.buildWithPath(t.getProcessPath(),"Parsing template. Error: "+a.error.message);var n=a.data;r.logger.debug("Parsed template result\n",JSON.stringify(n,null,2));var i=this.parseImports(n["import"],t),o=n.targetType,s=this.visitParams(t,n.params),c=AniPropSchema.merge(s);return new JsonCompositeTemplate({name:n.name,packageName:n["package"],imports:i,targetType:o,propSchema:c},n.main)}},{key:"parseAnimation",value:function(e,t){var a=this;return r.logger.debug("Parse animation\n",JSON.stringify(e,null,2)),t=null!==t&&void 0!==t?t:new ParseContext,t.withProcessPath((function(){return a.visitAniUnit(t,e)}),"main")}},{key:"parseTargetType",value:function(e,t){var a=this;r.logger.debug("Parse target type\n",JSON.stringify(e,null,2)),t=null!==t&&void 0!==t?t:new ParseContext;var n=TargetTypeSpec.safeParse(e);if(!1===n.success)throw ParseError.buildWithPath(t.getProcessPath(),"Spec:\n".concat(JSON.stringify(e,null,2),"\nError: ").concat(n.error.message));var i=n.data;r.logger.debug("Parsed type result\n",JSON.stringify(i,null,2));var o=this.parseImports(i["import"],t),s=i["class"],c=[];return i.components.forEach((function(e,r){var n;n=isString$1(e)?TargetTypeComponent.build(e,[]):t.withProcessPath((function(){return a.visitTypeComponent(t,e)}),"components",r),c.push(n)})),new TargetType(i.type,i["package"],o,s,c)}},{key:"visitTypeComponent",value:function(e,t){return TargetTypeComponent.build(t.ref,t["class"],t.required)}},{key:"parseImports",value:function(e,t){for(var r=this,a=[],n=function(n){var i=e[n],o=t.withProcessPath((function(){return r.parseOneImportItem(i,t)}),"import",n);a.push(o)},i=0;i<e.length;i++)n(i);return a}},{key:"parseOneImportItem",value:function(e,t){var r;if(isString$1(e))if(e=e.trim(),WildcardPattern.safeParse(e).success){var a=e.substring(0,e.length-2);r=Import.pkg(a)}else{if(!FullNamePattern.safeParse(e).success)throw ParseError.buildWithPath(t.getProcessPath(),"Invalid import spec: ".concat(e));r=Import.clazz(e)}else r=Import.clazz(e["class"],e.as);return r}},{key:"visitParams",value:function(e,t){var r=this,a={};return Object.entries(t).forEach((function(t,n){var i=_slicedToArray(t,2),o=i[0],s=i[1];a[o]=e.withProcessPath((function(){return r.visitParam(e,s)}),"params",n)})),z.object(a)}},{key:"visitParam",value:function(e,t){var r;if(r=NumberParamSpec.safeParse(t),!0===r.success){var a=r.data;return isNumber$1(a)?z.number()["default"](a):(assert(isObject$7(a)&&"number"===a.type),null!=a.value?z.number()["default"](a.value):z.number())}if(r=StringParamSpec.safeParse(t),!0===r.success){var n=r.data;return isString$1(n)?z.string()["default"](n):(assert(isObject$7(n)&&"string"===n.type),null!=n.value?z.string()["default"](n.value):z.string())}throw ParseError.buildWithPath(e.getProcessPath(),"Failed to parse param definition spec. \n"+JSON.stringify(t))}},{key:"visitAniUnit",value:function(e,t){var a,n=this,i=e.withProcessPath((function(){return n.visitTarget(e,t.target)}),"target"),o=pick$1(t,["duration","offset","stagger","yoyo","reverse"]),s={};if("duration"in o)if(isString$1(o.duration)){var c=e.prop(o.duration);assert(isNumber$1(c)),s.duration=c}else s.duration=o.duration;if("offset"in o)if(isString$1(o.offset)){var l=e.prop(o.offset);assert(isNumber$1(l)),s.offset=l}else s.offset=o.offset;if("stagger"in o)if(isString$1(o.stagger)){var u=e.prop(o.stagger);assert(isNumber$1(u)),s.stagger=u}else s.stagger=o.stagger;"yoyo"in o&&(isString$1(o.yoyo)&&(a=e.prop(o.yoyo)),isBoolean$1(a)?s.yoyo={repeat:1,delay:0}:s.yoyo=Object.assign({repeat:1,delay:0},o.yoyo));if("reverse"in o)if(isString$1(o.reverse)){var d=e.prop(o.reverse);assert(isBoolean$1(d)),s.reverse=d}else s.reverse=o.reverse;var p,h=Timing.build(s);if("ref"in t){for(var f=t.ref,g=Object.assign({},t,{id:t.id,target:i,timing:h}),m=0,y=Object.keys(g);m<y.length;m++){var v=y[m],_=g[v];isString$1(_)&&(_=this.tryParamReplace(e,_),g[v]=_)}p=Ref(f,g)}else if("sync"in t){var b=t.sync.map((function(t,r){return e.withProcessPath((function(){return n.visitAniUnit(e,t)}),"sync",r)}));p=Sync({id:t.id,target:i,timing:h,animations:b})}else{if(!("concat"in t))throw ParseError.buildWithPath(e.getProcessPath(),"Unknown animation definition spec.");var T=t.concat.map((function(t,r){return e.withProcessPath((function(){return n.visitAniUnit(e,t)}),"concat",r)}));p=Concat({id:t.id,target:i,timing:h,animations:T})}return r.logger.debug("Parse result:\n".concat(toTreeString(p))),p}},{key:"visitTarget",value:function(e,t){var r=[];if("string"===typeof t){var a=this.tryParamReplace(e,t);assert(isString$1(a),"Param value of filter must be a string. Got ".concat(a,". At ").concat(t));var n=new FilterTransform(a);r.push(n)}else if(t instanceof Array){var i,o=_createForOfIteratorHelper$9(t);try{for(o.s();!(i=o.n()).done;){var s=i.value,c=this.createTransform(e,s);r.push(c)}}catch(u){o.e(u)}finally{o.f()}}else if(null==t);else{if("object"!==_typeof(t))throw ParseError.buildWithPath(e.getProcessPath(),"Unknown target transform spec.");var l=this.createTransform(e,t);r.push(l)}return Target.build(r)}},{key:"createTransform",value:function(e,t){if("filter"in t){var r=this.tryParamReplace(e,t.filter);return assert(isString$1(r),"Param value of filter must be a string. Got ".concat(r,". At ").concat(JSON.stringify(t))),new FilterTransform(r)}if("selectAll"in t){var a=this.tryParamReplace(e,t.selectAll);return assert(isString$1(a),"Param value of selectAll must be a string. Got ".concat(a,". At ").concat(JSON.stringify(t))),new SelectAllTransform(a)}if("select"in t){var n=this.tryParamReplace(e,t.select);return assert(isString$1(n),"Param value of select must be a string. Got ".concat(n,". At ").concat(JSON.stringify(t))),new SelectTransform(n)}if("filterExpr"in t){var i=this.tryParamReplace(e,t.filterExpr);return assert(isString$1(i),"Param value of filterExpr must be a string. Got ".concat(i,". At ").concat(JSON.stringify(t))),new FilterExprTransform(i)}if("sortBy"in t){var o=this.tryParamReplace(e,t.sortBy);assert(isString$1(o),"Param value of sortBy must be a string. Got ".concat(o,". At ").concat(JSON.stringify(t)));var s=t.order;if(isString$1(s)){var c=this.tryParamReplace(e,s);assert("asc"===c||"desc"===c,'Only support "asc" or "desc" for order param.'),s=c}else s="asc";return new SortTransform(o,s)}if("slice"in t){var l=t.slice;if(isString$1(l)){var u=e.prop(l);assert(isArray$a(u),"Slice param must be an array. Got ".concat(u,". At ").concat(l)),l=u}if(isArray$a(l))for(var d=0;d<l.length;d++){var p=l[d];isString$1(p)&&(p=this.tryParamReplace(e,p),l[d]=p)}var h=l,f=_slicedToArray(h,3),g=f[0],m=f[1],y=f[2];return assert(isNumber$1(g),"Slice start must be a number. Got ".concat(g,". At ").concat(l)),assert(null==m||isNumber$1(m),"Slice end must be a number or null. Got ".concat(m,". At ").concat(l)),assert(null==y||isNumber$1(y),"Slice step must be a number or null. Got ".concat(y,". At ").concat(l)),new SliceTransform(g,m,y)}if("at"in t){var v=t.at;if(isString$1(v)){var _=e.prop(v);assert(isNumber$1(_)),v=_}return assert(isNumber$1(v),"At index must be a number. Got ".concat(v,". At ").concat(t)),new AtTransform(v)}throw ParseError.buildWithPath(e.getProcessPath(),"Unknown target transform spec.\n"+JSON.stringify(t))}},{key:"tryParamReplace",value:function(e,t){var r=t;if(t.startsWith("$"))r=e.prop(t);else if(t.includes("$")){var a=t.match(/(?<!\\)\$[a-zA-Z0-9_]+/g);if(a){var n,i=_createForOfIteratorHelper$9(a);try{for(i.s();!(n=i.n()).done;){var o=n.value,s=e.prop(o);assert(isString$1(s)),r=r.replace(o,'"'.concat(s,'"'))}}catch(c){i.e(c)}finally{i.f()}}}return isString$1(r)&&(r=r.replace(/\\\$/g,"$").replace(/\\\\/g,"\\")),r}},{key:"parseBinder",value:function(e,t){r.logger.debug("Parse binder\n",JSON.stringify(e,null,2)),t=null!==t&&void 0!==t?t:new ParseContext;var a=BinderSpec.safeParse(e);if(!1===a.success)throw ParseError.buildWithPath(t.getProcessPath(),"Paring binder. Error: "+a.error.message);var n=a.data;r.logger.debug("Parsed binder result\n",JSON.stringify(n,null,2));var i=n.rules.map((function(e,r){return t.withProcessPath((function(){return null!=e.id?BinderRule.buildSingleBind({from:e.from,to:e.to,id:e.id,classList:e.classList,data:e.data}):BinderRule.buildBatchBind({from:e.from,to:e.to,classList:e.classList,data:e.data,dataList:e.dataList})}),"rules",r)}));return Binder.build(n.from,n.to,i)}}]),r}(BaseSpecParser);JsonSpecParser.logger=LoggerManager.getLogger("JsonSpecParser");var ResolveRule=_createClass((function e(t){_classCallCheck(this,e),this.ruleName=t}));function _createSuper$P(e){var t=_isNativeReflectConstruct$P();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$P(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}AniPropSchema.extend({animation:z["instanceof"](LogicalAnimation).describe("Child animation")});var UnaryAnimation=function(e){_inherits(r,e);var t=_createSuper$P(r);function r(){var e;return _classCallCheck(this,r),e=t.apply(this,arguments),e._child=null,e}return _createClass(r,[{key:"init",value:function(){this._child=this.prop("animation")}},{key:"child",get:function(){return this._child}},{key:"visitChildren",value:function(){return[this._child]}},{key:"computeDuration",value:function(e){return this._child.computedDuration}},{key:"rescale",value:function(e,t){this.child.rescale(e,t)}},{key:"replace",value:function(e){return this._child=e,this}}]),r}(LogicalAnimation);function _createForOfIteratorHelper$8(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$8(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$8(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray$8(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$8(e,t):void 0}}function _arrayLikeToArray$8(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function preorderTraversal(e,t){preorderTraversalHelper(e,t)}function preorderTraversalHelper(e,t){var r=t(e);if(r)return!0;if(e instanceof UnaryAnimation)return preorderTraversalHelper(e.child,t);if(e instanceof AryAnimation){var a,n=_createForOfIteratorHelper$8(e.children);try{for(n.s();!(a=n.n()).done;){var i=a.value,o=preorderTraversalHelper(i,t);if(o)return!0}}catch(s){n.e(s)}finally{n.f()}return!1}if(e instanceof LeafAnimation)return!1;throw ResolveError.build("Fail to call traversal function on an unknown animation.")}function postorderTraversal(e,t){postorderTraversalHelper(e,t)}function postorderTraversalHelper(e,t){var r=!1;if(e instanceof UnaryAnimation)r=postorderTraversalHelper(e.child,t);else if(e instanceof AryAnimation){var a,n=_createForOfIteratorHelper$8(e.children);try{for(n.s();!(a=n.n()).done;){var i=a.value,o=postorderTraversalHelper(i,t);if(o){r=!0;break}}}catch(s){n.e(s)}finally{n.f()}}else if(!(e instanceof LeafAnimation))throw ResolveError.build("Fail to call traversal function on an unknown animation.");return!!r||t(e)}function transformDown(e,t){return transformDownHelper(null,e,t)}function transformDownHelper(e,t,r){var a=r(t);if(a instanceof UnaryAnimation){var n=transformDownHelper(a,a.child,r);n!==a.child&&a.replace(n)}else if(a instanceof AryAnimation){var i,o=_createForOfIteratorHelper$8(a.children);try{for(o.s();!(i=o.n()).done;){var s=i.value,c=transformDownHelper(a,s,r);c!==s&&a.replace(s,c)}}catch(l){o.e(l)}finally{o.f()}}return a}var LogicalAnimationUtils={preorderTraversal:preorderTraversal,postorderTraversal:postorderTraversal,transformDown:transformDown};function _createSuper$O(e){var t=_isNativeReflectConstruct$O();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$O(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ResolveRef=function(e){_inherits(r,e);var t=_createSuper$O(r);function r(){return _classCallCheck(this,r),t.call(this,"ResolveRef")}return _createClass(r,[{key:"apply",value:function(e,t){return LogicalAnimationUtils.transformDown(t,(function(t){if(!(t instanceof RefAnimation))return t;var a=t,n=null;while(1){var i=e.templateLibrary.get(a.ref);if(void 0===i)throw new Error("Template ".concat(a.ref," not found in the library."));r.logger.debug("Resolving ref ".concat(a.ref," to ").concat(i.fullName));var o=i.create(e,a.refProps());if(o.setSrc(a,i),r.logger.debug("Instantiated animation ".concat(o.fullName," with props ").concat(JSON.stringify(a.refProps()))),!(o instanceof RefAnimation)){n=o;break}a=o}return assert(null!==n),n}))}}]),r}(ResolveRule);ResolveRef.logger=LoggerManager.getLogger("ResolveRef");var ResolveContext=function(){function e(t){_classCallCheck(this,e),this.CHECK_PARAMETERS=!0,this.config={defaultDuration:1},this.compileExec=t}return _createClass(e,[{key:"templateLibrary",get:function(){return this.compileExec.templateLibrary}},{key:"targetModel",get:function(){return this.compileExec.targetModel}}]),e}();function _createForOfIteratorHelper$7(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$7(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$7(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray$7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$7(e,t):void 0}}function _arrayLikeToArray$7(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function _createSuper$N(e){var t=_isNativeReflectConstruct$N();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$N(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ResolveTarget=function(e){_inherits(r,e);var t=_createSuper$N(r);function r(){return _classCallCheck(this,r),t.call(this,"ResolveTarget")}return _createClass(r,[{key:"apply",value:function(e,t){var a,n=this,i=e.targetModel,o=i.rootSelection,s=_createForOfIteratorHelper$7(t.target.transforms);try{for(s.s();!(a=s.n()).done;){var c=a.value,l=c.execute(o);r.logger.trace("Converting [".concat(o,"] to [").concat(l,"]")),o=l}}catch(u){s.e(u)}finally{s.f()}return t.target.selection=o,r.logger.debug("Execute ".concat(t.target.transforms.length," transform(s), for ROOT -> ").concat(t,", ")+"converting [".concat(i.rootSelection,"] to [").concat(o,"]")),LogicalAnimationUtils.preorderTraversal(t,(function(e){if(e instanceof UnaryAnimation)n.applyTransform(e,e.child);else if(e instanceof AryAnimation){var t,r=_createForOfIteratorHelper$7(e.children);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.applyTransform(e,a)}}catch(u){r.e(u)}finally{r.f()}}return!1})),t}},{key:"applyTransform",value:function(e,t){var a,n=e.target.selection,i=_createForOfIteratorHelper$7(t.target.transforms);try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.execute(n);r.logger.trace("".concat(o," executed, converting [").concat(n,"] to [").concat(s,"]")),n=s}}catch(c){i.e(c)}finally{i.f()}r.logger.debug("Execute ".concat(t.target.transforms.length," transform(s) for ").concat(e," -> ").concat(t,", ")+"converting [".concat(e.target.selection,"] to [").concat(n,"]")),t.target.selection=n}}]),r}(ResolveRule);function _createSuper$M(e){var t=_isNativeReflectConstruct$M();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$M(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}ResolveTarget.logger=LoggerManager.getLogger("ResolveTarget");var ResolveTiming=function(e){_inherits(r,e);var t=_createSuper$M(r);function r(){return _classCallCheck(this,r),t.call(this,"ResolveTiming")}return _createClass(r,[{key:"apply",value:function(e,t){return LogicalAnimationUtils.postorderTraversal(t,(function(t){var a=t.computeDuration(e);assert(a>=0,"Original duration must be non-negative, "+"but got ".concat(a," in ").concat(t,":\n").concat(toTreeString(t)));var n=t.computeTotalDuration(e);t.computedDuration=a,t.computedTotalDuration=n;var i=t.timing.duration;return null!=i&&i!=n&&0!==n&&(r.logger.debug("Rescaling ".concat(t," from ").concat(n," to ").concat(i)),t.rescale(e,i/n)),!1})),t}}]),r}(ResolveRule);function _createForOfIteratorHelper$6(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$6(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$6(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray$6(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$6(e,t):void 0}}function _arrayLikeToArray$6(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}ResolveTiming.logger=LoggerManager.getLogger("ResolveTiming");var Resolver=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];_classCallCheck(this,e),this.compileExec=t,this.extraRules=r}return _createClass(e,[{key:"getDefaultBatch",value:function(){return[new ResolveRef,new ResolveTarget,new ResolveTiming]}},{key:"getBatch",value:function(){return this.getDefaultBatch().concat(this.extraRules)}},{key:"execute",value:function(t){e.logger.info("Start resolve. Input logical animation:\n"+toTreeString(t));var r,a=new ResolveContext(this.compileExec),n=t,i=_createForOfIteratorHelper$6(this.getBatch());try{for(i.s();!(r=i.n()).done;){var o=r.value;n=o.apply(a,n),e.logger.trace("Applying rule ".concat(o.ruleName,":\n").concat(toTreeString(n)))}}catch(s){i.e(s)}finally{i.f()}return e.logger.info("End resolve. Final logical animation:\n"+toTreeString(n)),n}}]),e}();function _superPropBase(e,t){while(!Object.prototype.hasOwnProperty.call(e,t))if(e=_getPrototypeOf(e),null===e)break;return e}function _get(){return _get="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var a=_superPropBase(e,t);if(a){var n=Object.getOwnPropertyDescriptor(a,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}},_get.apply(this,arguments)}Resolver.logger=LoggerManager.getLogger("Resolver");var SynthesisContext=function(){function e(t){_classCallCheck(this,e),this.compileExec=t}return _createClass(e,[{key:"targetModel",get:function(){return this.compileExec.targetModel}}]),e}();function _createForOfIteratorHelper$5(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$5(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$5(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray$5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$5(e,t):void 0}}function _arrayLikeToArray$5(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var Synthesizer=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];_classCallCheck(this,e),this.compileExec=t,this.extraRules=r}return _createClass(e,[{key:"getDefaultRules",value:function(){return[]}},{key:"getRuleMap",value:function(){var e,t=this.getDefaultRules().concat(this.extraRules),r=new Map,a=_createForOfIteratorHelper$5(t);try{for(a.s();!(e=a.n()).done;){var n=e.value;if(r.has(n.targetName))throw new Error("Rule target name conflict: ".concat(n.targetName));r.set(n.targetName,n)}}catch(i){a.e(i)}finally{a.f()}return r}},{key:"plan",value:function(t){e.logger.info("Start planning. Input logical animation:\n"+toTreeString(t));var r=this.getRuleMap(),a=new SynthesisContext(this.compileExec),n=this.transformUp(t,(function(t){var n=r.get(t.fullName);if(void 0===n)throw new Error("Failed to find implementation of animation class ".concat(t.fullName,". Reason: No rule found."));var i=n.apply(a,t);return e.logger.debug("Synthesized ".concat(t.fullName," to ").concat(i.constructor.name)),i}));return e.logger.info("End planning. Final physical animation:\n"+toTreeString(n)),n}},{key:"generate",value:function(e){var t=new SynthesisContext(this.compileExec);return e.generate(t)}},{key:"transformUp",value:function(e,t){return this.transformUpHelper(e,t)}},{key:"transformUpHelper",value:function(e,t){var r=t(e);r.children=[];var a,n=_createForOfIteratorHelper$5(e.visitChildren());try{for(n.s();!(a=n.n()).done;){var i=a.value,o=this.transformUpHelper(i,t);r.children.push(o)}}catch(s){n.e(s)}finally{n.f()}return r}}]),e}();Synthesizer.logger=LoggerManager.getLogger("Synthesizer");var SynthesisRule=_createClass((function e(t,r){_classCallCheck(this,e),this.ruleName=t,this.targetName=r}));function _createSuper$L(e){var t=_isNativeReflectConstruct$L();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$L(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var MappingRule=function(e){_inherits(r,e);var t=_createSuper$L(r);function r(e,a){var n;return _classCallCheck(this,r),n=t.call(this,"MappingRule",e),n.physicalAnimationClass=a,n}return _createClass(r,[{key:"apply",value:function(e,t){return new this.physicalAnimationClass(t)}}]),r}(SynthesisRule),PhysicalAnimation=function(){function e(t){_classCallCheck(this,e),this._logical=t}return _createClass(e,[{key:"logical",get:function(){return this._logical}},{key:"duration",get:function(){return this._logical.computedDuration}},{key:"totalDuration",get:function(){return this._logical.computedTotalDuration}},{key:"stagger",get:function(){return this._logical.timing.stagger}},{key:"yoyo",get:function(){return this._logical.timing.yoyo}},{key:"reverse",get:function(){return this._logical.timing.reverse}},{key:"elements",get:function(){return this._logical.target.selection.realElements}},{key:"props",value:function(){return this._logical.props()}},{key:"prop",value:function(e){return this._logical.prop(e)}},{key:"generate",value:function(e){return this.doGenerate(e)}},{key:"toString",value:function(){return"PhysicalAnimation ".concat(this._logical.toString())}},{key:"toOneLineString",value:function(){return"PhysicalAnimation ".concat(this._logical.toOneLineString())}},{key:"visitChildren",value:function(){return this.children}}]),e}();function _createSuper$K(e){var t=_isNativeReflectConstruct$K();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$K(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var GsapPhysicalAnimation=function(e){_inherits(r,e);var t=_createSuper$K(r);function r(e){var a;return _classCallCheck(this,r),a=t.call(this,e),a.logger=LoggerManager.getLogger("GsapPhysicalAnimation"),a}return _createClass(r,[{key:"mergeDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.mergeVars(e,{duration:!0,yoyo:!1,reverse:!1})}},{key:"mergeYoyo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.mergeVars(e,{duration:!1,yoyo:!0,reverse:!1})}},{key:"mergeVars",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{duration:!0,yoyo:!0,reverse:!0},r=t.duration,a=t.yoyo,n=t.reverse,i={};return r&&(i.duration=this.duration),a&&null!=this.yoyo&&(i.yoyo=!0,i.repeat=this.yoyo.repeat,i.repeatDelay=this.yoyo.delay,this.logical instanceof LeafAnimation||this.logger.warn("Yoyo is not supported for non-leaf animation ".concat(this.logical," in gsap implementation."))),n&&this.reverse&&(i.runBackwards=!0,this.logger.warn("Reverse is not supported in gsap implementation.")),Object.assign(i,e)}}]),r}(PhysicalAnimation);function _createSuper$J(e){var t=_isNativeReflectConstruct$J();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$J(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var SyncImpl=function(e){_inherits(r,e);var t=_createSuper$J(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this.logical.offsets,r=this.children,a=gsap$1.gsap.timeline();return r.forEach((function(r,n){var i=r.generate(e);null!==i&&a.add(i,t[n])})),Object.assign(a.vars,this.mergeVars()),a}}]),r}(GsapPhysicalAnimation);function _createSuper$I(e){var t=_isNativeReflectConstruct$I();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$I(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ConcatImpl=function(e){_inherits(r,e);var t=_createSuper$I(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this.logical.offsets,r=this.children,a=gsap$1.gsap.timeline(this.mergeVars());return r.forEach((function(r,n){var i=r.generate(e);null!==i&&a.add(i,">"+t[n])})),a}}]),r}(GsapPhysicalAnimation);function _createSuper$H(e){var t=_isNativeReflectConstruct$H();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$H(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var CustomImpl=function(e){_inherits(r,e);var t=_createSuper$H(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this,r=this.elements,a=this.stagger,n=gsap$1.gsap.timeline();return r.forEach((function(r,i){n.add(t.createTw(r,e),0===i?0:"<"+a)})),n}},{key:"createTw",value:function(e,t){var r,a,n=this.props(),i=n.attr,o=n.from,s=n.to,c=n.ease;if(null!=o&&null!=s)r="fromTo";else if(null!=o)r="from";else{if(null==s)throw new Error('CustomImpl: Attribute "from" or "to" must be specified at least one.');r="to"}var l=this.mergeVars({ease:c});switch(r){case"fromTo":a=gsap$1.gsap.fromTo(e,_defineProperty$1({},i,o),Object.assign(Object.assign({},l),_defineProperty$1({},i,s)));break;case"from":a=gsap$1.gsap.from(e,Object.assign(Object.assign({},l),_defineProperty$1({},i,o)));break;case"to":a=gsap$1.gsap.to(e,Object.assign(Object.assign({},l),_defineProperty$1({},i,s)));break;default:throw new Error("Unknown type: ".concat(r))}return a}}]),r}(GsapPhysicalAnimation);function _createSuper$G(e){var t=_isNativeReflectConstruct$G();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$G(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var EmptyImpl=function(e){_inherits(r,e);var t=_createSuper$G(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this,r=this.elements,a=this.stagger,n=gsap$1.gsap.timeline();return r.forEach((function(r,i){n.add(t.createTw(e),0===i?0:"<"+a)})),n}},{key:"createTw",value:function(e){var t=e.targetModel,r=t.getDummyEl(),a=this.mergeVars();return gsap$1.gsap.fromTo(r,{opacity:0},Object.assign({opacity:1},a))}}]),r}(GsapPhysicalAnimation);function _createSuper$F(e){var t=_isNativeReflectConstruct$F();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$F(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var FadeImpl=function(e){_inherits(r,e);var t=_createSuper$F(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this,r=this.elements,a=this.stagger,n=gsap$1.gsap.timeline();return r.forEach((function(r,i){n.add(t.createTw(r,e),0===i?0:"<"+a)})),n}},{key:"createTw",value:function(e,t){var r,a=this.props(),n=a.type,i=a.ease,o=this.mergeVars({ease:i});switch(n){case"in":r=gsap$1.gsap.fromTo(e,{opacity:0},Object.assign(Object.assign({},o),{opacity:1}));break;case"out":r=gsap$1.gsap.fromTo(e,{opacity:1},Object.assign(Object.assign({},o),{opacity:0}));break;default:throw new Error("Unknown type: ".concat(n))}return r}}]),r}(GsapPhysicalAnimation);function getPosition(e,t){var r=e.createSVGPoint(),a=t.getCTM(),n=r.matrixTransform(a);return{x:n.x,y:n.y}}function getSvgBox(e,t){var r=getPosition(e,t),a=r.x,n=r.y,i=t.getBBox(),o=i.x,s=i.y,c=i.width,l=i.height,u=a+o,d=n+s;return{x:u,y:d,width:c,height:l}}function createOrGetG(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(e.querySelector("#".concat(r))){var n=e.querySelector("#".concat(r));return a.forEach((function(e){n.classList.contains(e)||n.classList.add(e)})),n}return createG(t,r,a)}function createG(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=document.createElementNS("http://www.w3.org/2000/svg","g");return a.setAttribute("id",t),a.setAttribute("class",r.join(" ")),e.parentNode.insertBefore(a,e),a.appendChild(e),a}function getRelativeBox(e){var t=e.getBBox(),r=t.height,a=t.width,n=getStrokeWidth(e);return{height:r,width:a,strokeWidth:n,totalHeight:r+2*n,totalWidth:a+2*n,left:-n,top:-n,right:a+n,bottom:r+n}}function getStrokeWidth(e){var t,r=parseInt(null!==(t=e.getAttribute("stroke-width"))&&void 0!==t?t:"0");return e.children.length&&Array.from(e.children).forEach((function(e){var t=getStrokeWidth(e);t>r&&(r=t)})),r}function getArcPath(e,t,r,a,n,i){if(!i)return"M".concat(e," ").concat(t);n%=360,i%=360;var o=0===i;o&&(i=180),i<0&&(i+=360);var s=i>180?1:0,c=n*Math.PI/180,l=(n+i)*Math.PI/180,u=e+r*Math.sin(c),d=t-a*Math.cos(c),p=e+r*Math.sin(l),h=t-a*Math.cos(l);return o?"\n      M ".concat(u," ").concat(d,"\n      A ").concat(r," ").concat(a," 0 1 1 ").concat(p," ").concat(h,"\n      A ").concat(r," ").concat(a," 0 1 1 ").concat(u," ").concat(d,"z"):"\n    M ".concat(u," ").concat(d,"\n    A ").concat(r," ").concat(a," 0 ").concat(s," 1 ").concat(p," ").concat(h,"\n    L ").concat(e," ").concat(t,"z")}function _createSuper$E(e){var t=_isNativeReflectConstruct$E();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$E(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var WipeImpl=function(e){_inherits(r,e);var t=_createSuper$E(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this,r=gsap$1.gsap.timeline(),a=this.stagger;return this.elements.forEach((function(e,n){var i=t.createTw(e),o=0===n?0:"<"+a;r.add(i,o)})),r}},{key:"createTw",value:function(e){var t,r=this.props(),a=r.type,n=r.from,i=r.ease,o=getRelativeBox(e),s=o.left,c=o.top,l=o.right,u=o.bottom,d=o.totalWidth,p=o.totalHeight,h=this.getOffsetFactorMatrix(n),f=_slicedToArray(h,4),g=_slicedToArray(f[0],2),m=g[0],y=g[1],v=_slicedToArray(f[1],2),_=v[0],b=v[1],T=_slicedToArray(f[2],2),w=T[0],S=T[1],x=_slicedToArray(f[3],2),C=x[0],A=x[1],$=this.mergeVars({ease:i}),k="polygon("+"".concat(m*d+s,"px ").concat(y*p+c,"px, ")+"".concat(_*d+l,"px ").concat(b*p+c,"px, ")+"".concat(C*d+l,"px ").concat(A*p+u,"px, ")+"".concat(w*d+s,"px ").concat(S*p+u,"px)"),P="polygon(".concat(s,"px ").concat(c,"px, ").concat(l,"px ").concat(c,"px, ").concat(l,"px ").concat(u,"px, ").concat(s,"px ").concat(u,"px)");switch(a){case"in":t=gsap$1.gsap.fromTo(e,{clipPath:k},Object.assign({clipPath:P},$));break;case"out":t=gsap$1.gsap.fromTo(e,{clipPath:P},Object.assign({clipPath:k},$));break;default:throw new Error("Unknown type: ".concat(a))}return t}},{key:"getOffsetFactorMatrix",value:function(e){switch(e){case"top":return[[0,0],[0,0],[0,-1],[0,-1]];case"bottom":return[[0,1],[0,1],[0,0],[0,0]];case"left":return[[0,0],[-1,0],[0,0],[-1,0]];case"right":return[[1,0],[0,0],[1,0],[0,0]];default:throw new Error("Wrong value of from: ".concat(e,". Must be 'top', 'bottom', 'left' or 'right'. At ").concat(this))}}}]),r}(GsapPhysicalAnimation);function _createSuper$D(e){var t=_isNativeReflectConstruct$D();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$D(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var MoveImpl=function(e){_inherits(r,e);var t=_createSuper$D(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this,r=this.elements,a=this.stagger,n=gsap$1.gsap.timeline();return r.forEach((function(r,i){n.add(t.createTw(r,e),0===i?0:"<"+a)})),n}},{key:"createTw",value:function(e,t){var r,a=this.props(),n=a.from,i=a.to,o=a.ease,s=t.targetModel;if(s.saveOriginalBox(e),null!=n&&null!=i){var c=Object.assign({},n),l=this.mergeYoyo(this.mergeDuration(Object.assign(Object.assign({},i),{ease:o})));r=gsap$1.gsap.fromTo(e,c,l)}else if(null!=n){var u=this.mergeYoyo(this.mergeDuration(Object.assign(Object.assign({},n),{ease:o})));r=gsap$1.gsap.from(e,u)}else{if(null==i)throw new Error("Either from or to must be specified for ".concat(this));var d=this.mergeYoyo(this.mergeDuration(Object.assign(Object.assign({},i),{ease:o})));r=gsap$1.gsap.to(e,d)}return r}}]),r}(GsapPhysicalAnimation);function _createSuper$C(e){var t=_isNativeReflectConstruct$C();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$C(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ZoomImpl=function(e){_inherits(r,e);var t=_createSuper$C(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this,r=this.elements,a=this.stagger,n=gsap$1.gsap.timeline();return r.forEach((function(r,i){n.add(t.createTw(r,e),0===i?0:"<"+a)})),n}},{key:"createTw",value:function(e,t){var r,a=this.props(),n=a.type,i=a.ease,o=this.mergeYoyo(this.mergeDuration({scale:0,transformOrigin:"center center",ease:i}));switch(n){case"in":r=gsap$1.gsap.from(e,o);break;case"out":r=gsap$1.gsap.to(e,o);break;default:throw new Error("Wrong value of type: ".concat(n,". Must be 'in' or 'out'. At ").concat(this))}return r}}]),r}(GsapPhysicalAnimation),_svgPathExp=/[achlmqstvz]|(-?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,_scientific=/[\+\-]?\d*\.?\d+e[\+\-]?\d+/gi,_DEG2RAD=Math.PI/180,_sin=Math.sin,_cos=Math.cos,_abs=Math.abs,_sqrt=Math.sqrt,_isNumber=function(e){return"number"===typeof e},_roundingNum=1e5,_round$1=function(e){return Math.round(e*_roundingNum)/_roundingNum||0};
/*!
   * paths 3.12.2
   * https://greensock.com
   *
   * Copyright 2008-2023, GreenSock. All rights reserved.
   * Subject to the terms at https://greensock.com/standard-license or for
   * Club GreenSock members, the agreement issued with that membership.
   * @author: Jack Doyle, jack@greensock.com
  */function transformRawPath(e,t,r,a,n,i,o){var s,c,l,u,d,p=e.length;while(--p>-1)for(s=e[p],c=s.length,l=0;l<c;l+=2)u=s[l],d=s[l+1],s[l]=u*t+d*a+i,s[l+1]=u*r+d*n+o;return e._dirty=1,e}function arcToSegment(e,t,r,a,n,i,o,s,c){if(e!==s||t!==c){r=_abs(r),a=_abs(a);var l=n%360*_DEG2RAD,u=_cos(l),d=_sin(l),p=Math.PI,h=2*p,f=(e-s)/2,g=(t-c)/2,m=u*f+d*g,y=-d*f+u*g,v=m*m,_=y*y,b=v/(r*r)+_/(a*a);b>1&&(r=_sqrt(b)*r,a=_sqrt(b)*a);var T=r*r,w=a*a,S=(T*w-T*_-w*v)/(T*_+w*v);S<0&&(S=0);var x=(i===o?-1:1)*_sqrt(S),C=x*(r*y/a),A=x*(-a*m/r),$=(e+s)/2,k=(t+c)/2,P=$+(u*C-d*A),R=k+(d*C+u*A),E=(m-C)/r,O=(y-A)/a,I=(-m-C)/r,N=(-y-A)/a,M=E*E+O*O,L=(O<0?-1:1)*Math.acos(E/_sqrt(M)),j=(E*N-O*I<0?-1:1)*Math.acos((E*I+O*N)/_sqrt(M*(I*I+N*N)));isNaN(j)&&(j=p),!o&&j>0?j-=h:o&&j<0&&(j+=h),L%=h,j%=h;var B,Z=Math.ceil(_abs(j)/(h/4)),D=[],G=j/Z,U=4/3*_sin(G/2)/(1+_cos(G/2)),F=u*r,z=d*r,V=d*-a,H=u*a;for(B=0;B<Z;B++)n=L+B*G,m=_cos(n),y=_sin(n),E=_cos(n+=G),O=_sin(n),D.push(m-U*y,y+U*m,E+U*O,O-U*E,E,O);for(B=0;B<D.length;B+=2)m=D[B],y=D[B+1],D[B]=m*F+y*V+P,D[B+1]=m*z+y*H+R;return D[B-2]=s,D[B-1]=c,D}}function stringToRawPath(e){var t,r,a,n,i,o,s,c,l,u,d,p,h,f,g,m=(e+"").replace(_scientific,(function(e){var t=+e;return t<1e-4&&t>-1e-4?0:t})).match(_svgPathExp)||[],y=[],v=0,_=0,b=2/3,T=m.length,w=0,S="ERROR: malformed path: "+e,x=function(e,t,r,a){u=(r-e)/3,d=(a-t)/3,s.push(e+u,t+d,r-u,a-d,r,a)};if(!e||!isNaN(m[0])||isNaN(m[1]))return console.log(S),y;for(t=0;t<T;t++)if(h=i,isNaN(m[t])?(i=m[t].toUpperCase(),o=i!==m[t]):t--,a=+m[t+1],n=+m[t+2],o&&(a+=v,n+=_),t||(c=a,l=n),"M"===i)s&&(s.length<8?y.length-=1:w+=s.length),v=c=a,_=l=n,s=[a,n],y.push(s),t+=2,i="L";else if("C"===i)s||(s=[0,0]),o||(v=_=0),s.push(a,n,v+1*m[t+3],_+1*m[t+4],v+=1*m[t+5],_+=1*m[t+6]),t+=6;else if("S"===i)u=v,d=_,"C"!==h&&"S"!==h||(u+=v-s[s.length-4],d+=_-s[s.length-3]),o||(v=_=0),s.push(u,d,a,n,v+=1*m[t+3],_+=1*m[t+4]),t+=4;else if("Q"===i)u=v+(a-v)*b,d=_+(n-_)*b,o||(v=_=0),v+=1*m[t+3],_+=1*m[t+4],s.push(u,d,v+(a-v)*b,_+(n-_)*b,v,_),t+=4;else if("T"===i)u=v-s[s.length-4],d=_-s[s.length-3],s.push(v+u,_+d,a+(v+1.5*u-a)*b,n+(_+1.5*d-n)*b,v=a,_=n),t+=2;else if("H"===i)x(v,_,v=a,_),t+=1;else if("V"===i)x(v,_,v,_=a+(o?_-v:0)),t+=1;else if("L"===i||"Z"===i)"Z"===i&&(a=c,n=l,s.closed=!0),("L"===i||_abs(v-a)>.5||_abs(_-n)>.5)&&(x(v,_,a,n),"L"===i&&(t+=2)),v=a,_=n;else if("A"===i){if(f=m[t+4],g=m[t+5],u=m[t+6],d=m[t+7],r=7,f.length>1&&(f.length<3?(d=u,u=g,r--):(d=g,u=f.substr(2),r-=2),g=f.charAt(1),f=f.charAt(0)),p=arcToSegment(v,_,+m[t+1],+m[t+2],+m[t+3],+f,+g,(o?v:0)+1*u,(o?_:0)+1*d),t+=r,p)for(r=0;r<p.length;r++)s.push(p[r]);v=s[s.length-2],_=s[s.length-1]}else console.log(S);return t=s.length,t<6?(y.pop(),t=0):s[0]===s[t-2]&&s[1]===s[t-1]&&(s.closed=!0),y.totalPoints=w+t,y}function rawPathToString(e){_isNumber(e[0])&&(e=[e]);var t,r,a,n,i="",o=e.length;for(r=0;r<o;r++){for(n=e[r],i+="M"+_round$1(n[0])+","+_round$1(n[1])+" C",t=n.length,a=2;a<t;a++)i+=_round$1(n[a++])+","+_round$1(n[a++])+" "+_round$1(n[a++])+","+_round$1(n[a++])+" "+_round$1(n[a++])+","+_round$1(n[a])+" ";n.closed&&(i+="z")}return i}
/*!
   * CustomEase 3.12.2
   * https://greensock.com
   *
   * @license Copyright 2008-2023, GreenSock. All rights reserved.
   * Subject to the terms at https://greensock.com/standard-license or for
   * Club GreenSock members, the agreement issued with that membership.
   * @author: Jack Doyle, jack@greensock.com
  */var gsap,_coreInitted,_getGSAP=function(){return gsap||"undefined"!==typeof window&&(gsap=window.gsap)&&gsap.registerPlugin&&gsap},_initCore=function(){gsap=_getGSAP(),gsap?(gsap.registerEase("_CE",CustomEase.create),_coreInitted=1):console.warn("Please gsap.registerPlugin(CustomEase)")},_bigNum=1e20,_round=function(e){return~~(1e3*e+(e<0?-.5:.5))/1e3},_numExp=/[-+=\.]*\d+[\.e\-\+]*\d*[e\-\+]*\d*/gi,_needsParsingExp=/[cLlsSaAhHvVtTqQ]/g,_findMinimum=function(e){var t,r=e.length,a=_bigNum;for(t=1;t<r;t+=6)+e[t]<a&&(a=+e[t]);return a},_normalize=function(e,t,r){r||0===r||(r=Math.max(+e[e.length-1],+e[1]));var a,n=-1*+e[0],i=-r,o=e.length,s=1/(+e[o-2]+n),c=-t||(Math.abs(+e[o-1]-+e[1])<.01*(+e[o-2]-+e[0])?_findMinimum(e)+i:+e[o-1]+i);for(c=c?1/c:-s,a=0;a<o;a+=2)e[a]=(+e[a]+n)*s,e[a+1]=(+e[a+1]+i)*c},_bezierToPoints=function e(t,r,a,n,i,o,s,c,l,u,d){var p,h=(t+a)/2,f=(r+n)/2,g=(a+i)/2,m=(n+o)/2,y=(i+s)/2,v=(o+c)/2,_=(h+g)/2,b=(f+m)/2,T=(g+y)/2,w=(m+v)/2,S=(_+T)/2,x=(b+w)/2,C=s-t,A=c-r,$=Math.abs((a-s)*A-(n-c)*C),k=Math.abs((i-s)*A-(o-c)*C);return u||(u=[{x:t,y:r},{x:s,y:c}],d=1),u.splice(d||u.length-1,0,{x:S,y:x}),($+k)*($+k)>l*(C*C+A*A)&&(p=u.length,e(t,r,h,f,_,b,S,x,l,u,d),e(S,x,T,w,y,v,s,c,l,u,d+1+(u.length-p))),u},CustomEase=function(){function e(e,t,r){_coreInitted||_initCore(),this.id=e,this.setData(t,r)}var t=e.prototype;return t.setData=function(e,t){t=t||{},e=e||"0,0,1,1";var r,a,n,i,o,s,c,l,u,d=e.match(_numExp),p=1,h=[],f=[],g=t.precision||1,m=g<=1;if(this.data=e,(_needsParsingExp.test(e)||~e.indexOf("M")&&e.indexOf("C")<0)&&(d=stringToRawPath(e)[0]),r=d.length,4===r)d.unshift(0,0),d.push(1,1),r=8;else if((r-2)%6)throw"Invalid CustomEase";for(0===+d[0]&&1===+d[r-2]||_normalize(d,t.height,t.originY),this.segment=d,i=2;i<r;i+=6)a={x:+d[i-2],y:+d[i-1]},n={x:+d[i+4],y:+d[i+5]},h.push(a,n),_bezierToPoints(a.x,a.y,+d[i],+d[i+1],+d[i+2],+d[i+3],n.x,n.y,1/(2e5*g),h,h.length-1);for(r=h.length,i=0;i<r;i++)c=h[i],l=h[i-1]||c,(c.x>l.x||l.y!==c.y&&l.x===c.x||c===l)&&c.x<=1?(l.cx=c.x-l.x,l.cy=c.y-l.y,l.n=c,l.nx=c.x,m&&i>1&&Math.abs(l.cy/l.cx-h[i-2].cy/h[i-2].cx)>2&&(m=0),l.cx<p&&(l.cx?p=l.cx:(l.cx=.001,i===r-1&&(l.x-=.001,p=Math.min(p,.001),m=0)))):(h.splice(i--,1),r--);if(r=1/p+1|0,o=1/r,s=0,c=h[0],m){for(i=0;i<r;i++)u=i*o,c.nx<u&&(c=h[++s]),a=c.y+(u-c.x)/c.cx*c.cy,f[i]={x:u,cx:o,y:a,cy:0,nx:9},i&&(f[i-1].cy=a-f[i-1].y);f[r-1].cy=h[h.length-1].y-a}else{for(i=0;i<r;i++)c.nx<i*o&&(c=h[++s]),f[i]=c;s<h.length-1&&(f[i-1]=h[h.length-2])}return this.ease=function(e){var t=f[e*r|0]||f[r-1];return t.nx<e&&(t=t.n),t.y+(e-t.x)/t.cx*t.cy},this.ease.custom=this,this.id&&gsap&&gsap.registerEase(this.id,this.ease),this},t.getSVGData=function(t){return e.getSVGData(this,t)},e.create=function(t,r,a){return new e(t,r,a).ease},e.register=function(e){gsap=e,_initCore()},e.get=function(e){return gsap.parseEase(e)},e.getSVGData=function(t,r){r=r||{};var a,n,i,o,s,c,l,u,d,p,h=r.width||100,f=r.height||100,g=r.x||0,m=(r.y||0)+f,y=gsap.utils.toArray(r.path)[0];if(r.invert&&(f=-f,m=0),"string"===typeof t&&(t=gsap.parseEase(t)),t.custom&&(t=t.custom),t instanceof e)a=rawPathToString(transformRawPath([t.segment],h,0,0,-f,g,m));else{for(a=[g,m],l=Math.max(5,200*(r.precision||1)),o=1/l,l+=2,u=5/l,d=_round(g+o*h),p=_round(m+t(o)*-f),n=(p-m)/(d-g),i=2;i<l;i++)s=_round(g+i*o*h),c=_round(m+t(i*o)*-f),(Math.abs((c-p)/(s-d)-n)>u||i===l-1)&&(a.push(d,p),n=(c-p)/(s-d)),d=s,p=c;a="M"+a.join(",")}return y&&y.setAttribute("d",a),a},e}();function _createSuper$B(e){var t=_isNativeReflectConstruct$B();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$B(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}_getGSAP()&&gsap.registerPlugin(CustomEase),CustomEase.version="3.12.2";var TypeImpl=function(e){_inherits(r,e);var t=_createSuper$B(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this,r=this.elements,a=this.stagger,n=this.props(),i=n.effect,o=gsap$1.gsap.timeline();return r.forEach((function(r,n){assert(r instanceof SVGTextElement,"TypeImpl: TypeImpl only support SVGTextElement, but got: ".concat(r));var s,c=t.splitText(r);switch(i){case"fade":s=t.generateFade(c,e);break;case"show":s=t.generateShow(c,e);break;default:throw new Error("TypeImpl: unknown effect: ".concat(i))}o.add(s,0===n?0:"<"+a)})),o}},{key:"splitText",value:function(e){var t=e.textContent;if(assert(t,"TypeImpl: text is empty: ".concat(t)),e.childElementCount>0)return Array.from(e.children);e.textContent="";var r=t.split("").filter((function(e){return" "!==e&&"\n"!==e})),a=[];return r.forEach((function(t){var r=document.createElementNS("http://www.w3.org/2000/svg","tspan");r.textContent=t,e.appendChild(r),a.push(r)})),a}},{key:"generateFade",value:function(e,t){var r,a=this.duration,n=this.props(),i=n.type,o=n.typeStagger,s=n.ease,c=this.mergeYoyo({ease:s,stagger:o});switch(i){case"in":r=gsap$1.gsap.fromTo(e,{opacity:0},Object.assign({opacity:1},c));break;case"out":r=gsap$1.gsap.fromTo(e,{opacity:1},Object.assign({opacity:0},c));break;default:throw new Error("Unknown type. Expect in or out, but got: ".concat(i))}return r.totalDuration(a),r}},{key:"generateShow",value:function(e,t){var r,a=this.duration,n=this.props(),i=n.type,o=n.typeStagger,s=CustomEase.create("custom","M0,0 C0,0.24 0,1 0.012,1 0.076,1 0.78,1 1,1 "),c=this.mergeYoyo({ease:s,stagger:o});switch(i){case"in":r=gsap$1.gsap.fromTo(e,{opacity:0},Object.assign({opacity:1},c));break;case"out":r=gsap$1.gsap.fromTo(e,{opacity:1},Object.assign({opacity:0},c));break;default:throw new Error("Unknown type. Expect in or out, but got: ".concat(i))}return r.totalDuration(a),r}}]),r}(GsapPhysicalAnimation);function _createSuper$A(e){var t=_isNativeReflectConstruct$A();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$A(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var CutImpl=function(e){_inherits(r,e);var t=_createSuper$A(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this,r=e.targetModel,a=gsap$1.gsap.timeline(),n=this.stagger;return this.elements.forEach((function(e,i){var o=t.createTw(e,r),s=0===i?0:"<"+n;a.add(o,s)})),a}},{key:"createTw",value:function(e,t){var r=this.props(),a=r.type,n=r.from,i=r.ease,o=t.getOrigin();t.saveOriginalBox(e);var s=getRelativeBox(e),c=s.left,l=s.top,u=s.right,d=s.bottom,p=s.totalWidth,h=s.totalHeight,f=this.getOffsetFactorMatrix(n),g=_slicedToArray(f,4),m=_slicedToArray(g[0],2),y=m[0],v=m[1],_=_slicedToArray(g[1],2),b=_[0],T=_[1],w=_slicedToArray(g[2],2),S=w[0],x=w[1],C=_slicedToArray(g[3],2),A=C[0],$=C[1],k=this.mergeVars({ease:i}),P=createOrGetG(o,e,"clip-path-".concat(e.id),["cut"]),R=createOrGetG(o,e,"transform-".concat(e.id),["cut"]),E=gsap$1.gsap.timeline(),O="polygon("+"".concat(y*p+c,"px ").concat(v*h+l,"px, ")+"".concat(b*p+u,"px ").concat(T*h+l,"px, ")+"".concat(A*p+u,"px ").concat($*h+d,"px, ")+"".concat(S*p+c,"px ").concat(x*h+d,"px)"),I="polygon(".concat(c,"px ").concat(l,"px, ").concat(u,"px ").concat(l,"px, ").concat(u,"px ").concat(d,"px, ").concat(c,"px ").concat(d,"px)"),N=this.getMoveVars(n,p,h);switch(a){case"in":E.fromTo(P,{clipPath:O},Object.assign({clipPath:I},k),0),E.fromTo(R,Object.assign({},N),Object.assign({x:0,y:0},k),0);break;case"out":E.fromTo(P,{clipPath:I},Object.assign({clipPath:O},k),0),E.fromTo(R,{x:0,y:0},Object.assign(Object.assign({},N),k),0);break;default:throw new Error("Unknown type: ".concat(a))}return E}},{key:"getMoveVars",value:function(e,t,r){switch(e){case"top":return{x:0,y:-r};case"bottom":return{x:0,y:r};case"left":return{x:-t,y:0};case"right":return{x:t,y:0};default:throw new Error("Wrong value of from: ".concat(e,". Must be 'top', 'bottom', 'left' or 'right'. At ").concat(this))}}},{key:"getOffsetFactorMatrix",value:function(e){switch(e){case"bottom":return[[0,0],[0,0],[0,-1],[0,-1]];case"top":return[[0,1],[0,1],[0,0],[0,0]];case"right":return[[0,0],[-1,0],[0,0],[-1,0]];case"left":return[[1,0],[0,0],[1,0],[0,0]];default:throw new Error("Wrong value of from: ".concat(e,". Must be 'top', 'bottom', 'left' or 'right'. At ").concat(this))}}}]),r}(GsapPhysicalAnimation);function _createSuper$z(e){var t=_isNativeReflectConstruct$z();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$z(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var GrowImpl=function(e){_inherits(r,e);var t=_createSuper$z(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this,r=this.elements,a=this.stagger,n=gsap$1.gsap.timeline();return r.forEach((function(r,i){n.add(t.createTw(r,e),0===i?0:"<"+a)})),n}},{key:"createTw",value:function(e,t){var r,a,n,i,o,s=this.props(),c=s.type,l=s.from,u=s.ease,d=this.mergeVars({ease:u}),p=this.getTransformParam(l),h=p.transformOrigin,f=p.attr;switch(c){case"in":o=gsap$1.gsap.fromTo(e,(r={},_defineProperty$1(r,f,0),_defineProperty$1(r,"transformOrigin",h),r),Object.assign((a={},_defineProperty$1(a,f,1),_defineProperty$1(a,"transformOrigin",h),a),d));break;case"out":o=gsap$1.gsap.fromTo(e,(n={},_defineProperty$1(n,f,1),_defineProperty$1(n,"transformOrigin",h),n),Object.assign((i={},_defineProperty$1(i,f,0),_defineProperty$1(i,"transformOrigin",h),i),d));break;default:throw new Error("Unknown type: ".concat(c))}return o}},{key:"getTransformParam",value:function(e){switch(e){case"top":return{transformOrigin:"center top",attr:"scaleY"};case"bottom":return{transformOrigin:"center bottom",attr:"scaleY"};case"left":return{transformOrigin:"left center",attr:"scaleX"};case"right":return{transformOrigin:"right center",attr:"scaleX"};default:throw new Error("Unknown from: ".concat(e))}}}]),r}(GsapPhysicalAnimation);function _createSuper$y(e){var t=_isNativeReflectConstruct$y();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$y(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ChangeColorImpl=function(e){_inherits(r,e);var t=_createSuper$y(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this,r=this.elements,a=this.stagger,n=gsap$1.gsap.timeline();return r.forEach((function(r,i){n.add(t.createTw(r,e),0===i?0:"<"+a)})),n}},{key:"createTw",value:function(e,t){var r,a=this.props(),n=a.type,i=a.fill,o=a.ease,s=this.mergeVars({ease:o}),c=Object.assign(Object.assign({},s),_defineProperty$1({},this.isLineLike(e)?"stroke":"fill",i));switch(n){case"to":r=gsap$1.gsap.to(e,c);break;case"from":r=gsap$1.gsap.from(e,c);break;default:throw new Error("Unknown type: ".concat(n))}return r}},{key:"isLineLike",value:function(e){return"line"===e.tagName||"polyline"===e.tagName||"polygon"===e.tagName}}]),r}(GsapPhysicalAnimation);function _createSuper$x(e){var t=_isNativeReflectConstruct$x();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$x(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var PathBlinkImpl=function(e){_inherits(r,e);var t=_createSuper$x(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this,r=this.elements,a=this.stagger,n=gsap$1.gsap.timeline();return r.forEach((function(r,i){n.add(t.createTw(r,e),0===i?0:"<"+a)})),n.totalDuration(this.totalDuration),n}},{key:"createTw",value:function(e,t){var r=this.props(),a=r.reverseDirection,n=r.aniTime,i=r.displayTime,o=r.ease,s=this.mergeVars({ease:o},{duration:!1,yoyo:!1,reverse:!1}),c=gsap$1.gsap.timeline();assert(e instanceof SVGGeometryElement,"PathBlinkImpl: element is not SVGGeometryElement: ".concat(e));var l=0;try{l=e.getTotalLength()}catch(u){throw new Error("PathBlinkImpl: get total length failed: ".concat(u,". Cause by: ").concat(e))}return e.setAttribute("stroke-dasharray",String(l)),c.fromTo(e,{strokeDashoffset:a?-l:l},Object.assign(Object.assign({},s),{duration:n,strokeDashoffset:0}),0),c.to(e,{strokeDashoffset:a?l:-l,duration:n},i),this.reverse&&c.reverse(),c}}]),r}(GsapPhysicalAnimation),TypeModelTreeNode=function(){function e(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;_classCallCheck(this,e),this.componentLink=null,this.children=[],this._classList=null,this.nodeId=t,this.targetType=r,this.parent=a,this.componentLink=n}return _createClass(e,[{key:"visitChildren",value:function(){return this.children}},{key:"toOneLineString",value:function(){return"".concat(this.targetType.name," [(").concat(this.nodeId,") class=[").concat(this.classList.join(", "),"]")}},{key:"isLeaf",value:function(){return this.targetType.isLeaf()}},{key:"classList",get:function(){return null===this._classList&&(this._classList=[this.targetType.name].concat(_toConsumableArray(this.targetType.classList)),null!=this.componentLink&&(this._classList=this._classList.concat(this.componentLink.classList)),this._classList.reverse()),this._classList}},{key:"fullClassList",get:function(){var e,t;return this.classList.concat(null!==(t=null===(e=this.parent)||void 0===e?void 0:e.fullClassList)&&void 0!==t?t:[])}}]),e}();function getFormattedXmlString(e){return getFormattedXmlStringHelper(e,0)}function getFormattedXmlStringHelper(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r="  ".repeat(t),a=Array.from(e.attributes).map((function(e){return"".concat(e.name,'="').concat(e.value,'"')})).join(" "),n="<".concat(e.tagName.toLowerCase()).concat(""===a?"":" ").concat(a,">"),i="</".concat(e.tagName.toLowerCase(),">"),o=Array.from(e.childNodes).map((function(e){return e instanceof Element?getFormattedXmlStringHelper(e,t+1):"".concat("  ".repeat(t+1)).concat(e.textContent)})).join("\n");return""===o?"".concat(r).concat(n).concat(i):"".concat(r).concat(n,"\n").concat(o,"\n").concat(r).concat(i)}function domElToStr(e){return"".concat(e.tagName,"#").concat(e.id).trim()}function _createForOfIteratorHelper$4(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$4(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$4(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray$4(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$4(e,t):void 0}}function _arrayLikeToArray$4(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var TargetModel=function(){function e(t){_classCallCheck(this,e),this.session=null,this.rootTargetType=null,this.typeModelTree=null,this.typeModelNodeMap=null,this.typeModelDom=null,this.realElementIdSet=new Set,this.virtualModel=null,this.rootSelection=null,this.origin=t}return _createClass(e,[{key:"getOrigin",value:function(){return this.origin}},{key:"init",value:function(t){this.session=t,this.initRootType(),assert(null!=this.rootTargetType,"rootTargetType is not initialized by initRootType()"),e.logger.debug("Root type: ".concat(this.rootTargetType.fullName)),this.processIdSet(),this.initTypeModelTree(),this.initTypeModelDom(),this.initVirtualModelBackbone(),this.completeVirtualModel(),e.logger.debug("Virtual model created.\n".concat(getFormattedXmlString(this.virtualModel)))}},{key:"initTypeModelTree",value:function(){var t=this,r=0,a=this.session.typeLibrary,n=new Map,i=Import.pkg(this.rootTargetType.packageName),o=function e(o){if(n.set(o.nodeId,o),0!==o.targetType.components.length){var s,c=a.createCaller().setImport(i).setAllImport(o.targetType.imports),l=_createForOfIteratorHelper$4(o.targetType.components);try{for(l.s();!(s=l.n()).done;){var u=s.value,d=c.safeGet(u.ref),p=void 0;switch(d.status){case"ok":p=d.result;break;case"not-found":throw new Error("Type ".concat(u.ref," not found. In ").concat(o.targetType.fullName,"."));case"not-imported":throw new Error("Type ".concat(u.ref," not imported. In ").concat(o.targetType.fullName,"."))}var h=new TypeModelTreeNode(t.getTypeNodeId(r),p,o,u);r++,o.children.push(h),e(h)}}catch(f){l.e(f)}finally{l.f()}}};this.typeModelTree=new TypeModelTreeNode(this.getTypeNodeId(r),this.rootTargetType),r++,o(this.typeModelTree),this.typeModelNodeMap=n,e.logger.trace("Type model tree created.\n",toTreeString(this.typeModelTree))}},{key:"getTypeNodeId",value:function(e){return"g-".concat(e)}},{key:"createVirtualGroup",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=Object.assign(this.session.document.createElement("g"),{data:a});n.setAttribute("id",t),n.setAttribute("class",r.join(" "));for(var i=0,o=Object.entries(a);i<o.length;i++){var s=_slicedToArray(o[i],2),c=s[0],l=s[1];n.hasAttribute(c)?(console.warn("Attribute ".concat(c," already exists in ").concat(n,". Change it to data-").concat(c)),n.setAttribute("data-".concat(c),String(l))):n.setAttribute(c,String(l))}return n}},{key:"initTypeModelDom",value:function(){var e=this,t=function t(r,a,n){var i=e.createVirtualGroup(r.targetType.name,String(r.nodeId),r.classList);null!==a?a.appendChild(i):i.setAttribute("isRoot","true");var o,s=_createForOfIteratorHelper$4(r.children);try{for(s.s();!(o=s.n()).done;){var c=o.value,l=c.classList.concat(n);t(c,i,l)}}catch(u){s.e(u)}finally{s.f()}return i};this.typeModelDom=t(this.typeModelTree,null,this.typeModelTree.classList)}},{key:"initVirtualModelBackbone",value:function(){this.virtualModel=this.createVirtualGroup(this.rootTargetType.fullName,"--g-root",[],{}),e.logger.trace("Virtual model backbone created.\n",getFormattedXmlString(this.virtualModel))}},{key:"queryOneVGroup",value:function(e){var t=this.querySelectorAll(e);return assert(0!==t.length,'Virtual group element not found: "'.concat(e,'".')),assert(t.length<2,'Multiple virtual group elements found: "'.concat(e,'".')),t[0]}},{key:"queryOneTypeNode",value:function(e){var t=this.queryOneVGroup(e);return this.vGroupToTypeNode(t)}},{key:"querySelector",value:function(e){return this.typeModelDom.querySelector(e)}},{key:"querySelectorAll",value:function(e){return Array.from(this.typeModelDom.querySelectorAll(e))}},{key:"vGroupToTypeNode",value:function(e){return this.typeModelNodeMap.get(e.id)}},{key:"getRealElementByVNode",value:function(e){var t=this.getRealElementById(e.id);if(null==t)throw new Error("Cannot get elements from virtual node ".concat(domElToStr(e),". ")+"Might built virtual model incorrectly.");return t}}]),e}();function _createSuper$w(e){var t=_isNativeReflectConstruct$w();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$w(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}TargetModel.logger=LoggerManager.getLogger("TargetModel");var BaseSVGTargetModel=function(e){_inherits(r,e);var t=_createSuper$w(r);function r(e){return _classCallCheck(this,r),t.call(this,e)}return _createClass(r,[{key:"processIdSet",value:function(){var e=this,t=this.origin.querySelectorAll("*");t.forEach((function(t){var r=t.getAttribute("id");null!=r&&""!=r&&e.realElementIdSet.add(r)}))}},{key:"getOrigin",value:function(){return this.origin}},{key:"saveOriginalData",value:function(e,t,r){var a=e;null==a._original&&(a._original={}),a._original[t]=r}},{key:"getOriginalData",value:function(e,t){var r=e;return null==r._original?null:r._original[t]}},{key:"saveOriginalBox",value:function(e){var t=this.getElBox(e);this.saveOriginalData(e,"box",t)}},{key:"getOriginalBox",value:function(e){return this.getOriginalData(e,"box")}},{key:"getBox",value:function(e){var t=this.getRealElementById(e);return assert(t instanceof SVGGraphicsElement,"Can only get box of SVGGraphicsElement, but got ".concat(t.constructor.name,".")),getSvgBox(this.getOrigin(),t)}},{key:"getElBox",value:function(e){return getSvgBox(this.getOrigin(),e)}},{key:"getDefs",value:function(){return null==this.origin.querySelector("defs")&&this.origin.appendChild(document.createElementNS("http://www.w3.org/2000/svg","defs")),this.origin.querySelector("defs")}},{key:"getDummyEl",value:function(){if(null!=this.origin.querySelector("#--dummy"))return this.origin.querySelector("#--dummy");var e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.setAttribute("id","--dummy"),e.setAttribute("class","--dummy"),this.origin.appendChild(e),e}},{key:"createVirtualElement",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=document.createElementNS("http://www.w3.org/2000/svg",e.tagName),i=Object.assign(n,{data:a});i.setAttribute("id",t),i.setAttribute("class",r.join(" "));for(var o=0,s=Object.entries(a);o<s.length;o++){var c=_slicedToArray(s[o],2),l=c[0],u=c[1];e.hasAttribute(l)?(console.warn("Attribute ".concat(l," already exists. Change it to data-").concat(l)),i.setAttribute("data-".concat(l),String(u))):i.setAttribute(l,String(u))}return i}}]),r}(TargetModel);function _createSuper$v(e){var t=_isNativeReflectConstruct$v();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$v(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var CircleImpl=function(e){_inherits(r,e);var t=_createSuper$v(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this,r=e.targetModel;assert(r instanceof BaseSVGTargetModel,"CircleImpl: target model must be BaseSVGTargetModel, but got: ".concat(r));var a=r,n=this.elements,i=this.stagger,o=gsap$1.gsap.timeline();return n.forEach((function(e,r){o.add(t.createTw(e,a),0===r?0:"<"+i)})),o}},{key:"createTw",value:function(e,t){var r=this.props(),a=r.direction,n=r.aniTime,i=r.displayTime,o=r.stroke,s=r.strokeWidth,c=r.ease,l="counterclockwise"===a,u=this.mergeVars({ease:c},{duration:!1,yoyo:!1,reverse:!0}),d=this.addCircle(e,t,o,s),p=gsap$1.gsap.timeline(),h=0;try{h=d.getTotalLength()}catch(f){throw new Error("CircleImpl: get total length failed: ".concat(f,". Cause by: ").concat(d))}return d.setAttribute("stroke-dasharray",String(h)),p.set(d,{opacity:1},0),p.fromTo(d,{strokeDashoffset:l?-h:h},Object.assign(Object.assign({},u),{duration:n,strokeDashoffset:0}),0),p.to(d,{strokeDashoffset:l?h:-h,duration:n},i),p.set(d,{opacity:0},i+n),p}},{key:"addCircle",value:function(e,t,r,a){var n=t.getOriginalBox(e),i=null!==n&&void 0!==n?n:t.getElBox(e),o=i.x,s=i.y,c=i.width,l=i.height,u=t.getOrigin(),d=document.createElementNS("http://www.w3.org/2000/svg","ellipse");return d.setAttribute("transform","translate(".concat(o+c/2,", ").concat(s+l/2,")")),d.setAttribute("rx","".concat(c/2*1.2)),d.setAttribute("ry","".concat(l/2*1.3)),d.setAttribute("fill","none"),d.setAttribute("stroke",r),d.setAttribute("stroke-width",String(a)),d.setAttribute("opacity","0"),u.appendChild(d),d}}]),r}(GsapPhysicalAnimation);function _createSuper$u(e){var t=_isNativeReflectConstruct$u();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$u(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var WheelImpl=function(e){_inherits(r,e);var t=_createSuper$u(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this,r=e.targetModel,a=gsap$1.gsap.timeline(),n=this.stagger;return this.elements.forEach((function(e,i){var o=t.createTw(e,r),s=0===i?0:"<"+n;a.add(o,s)})),a}},{key:"createTw",value:function(e,t){var r,a=this.props(),n=a.type,i=a.startAngle,o=a.sweepAngle,s=a.ease,c=getRelativeBox(e),l=c.totalWidth,u=c.totalHeight,d=t.getElBox(e),p=d.width,h=d.height,f={startAngle:i,sweepAngle:0,cx:p/2,cy:h/2,rx:l,ry:u},g=i,m=o,y=function(){var t=getArcPath(f.cx,f.cy,f.rx,f.ry,f.startAngle,f.sweepAngle).replaceAll("\n"," ");e.setAttribute("clip-path","path('".concat(t,"')"))},v=this.mergeVars({ease:s,onUpdate:y});switch(n){case"in":r=gsap$1.gsap.fromTo(f,{sweepAngle:g},Object.assign({sweepAngle:m},v));break;case"out":r=gsap$1.gsap.fromTo(e,{sweepAngle:m},Object.assign({sweepAngle:g},v));break;default:throw new Error("Unknown type: ".concat(n))}return r}}]),r}(GsapPhysicalAnimation);function _createSuper$t(e){var t=_isNativeReflectConstruct$t();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$t(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var PathDrawImpl=function(e){_inherits(r,e);var t=_createSuper$t(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"doGenerate",value:function(e){var t=this,r=this.elements,a=this.stagger,n=gsap$1.gsap.timeline();return r.forEach((function(r,i){n.add(t.createTw(r,e),0===i?0:"<"+a)})),n.totalDuration(this.totalDuration),n}},{key:"createTw",value:function(e,t){var r=this.props(),a=r.reverseDirection,n=r.ease,i=this.mergeVars({ease:n});assert(e instanceof SVGGeometryElement,"PathBlinkImpl: element is not SVGGeometryElement: ".concat(e));var o=0;try{o=e.getTotalLength()}catch(s){throw new Error("PathBlinkImpl: get total length failed: ".concat(s,". Cause by: ").concat(e))}return e.setAttribute("stroke-dasharray",String(o)),gsap$1.gsap.fromTo(e,{strokeDashoffset:a?-o:o},Object.assign(Object.assign({},i),{strokeDashoffset:0}))}}]),r}(GsapPhysicalAnimation);function _createSuper$s(e){var t=_isNativeReflectConstruct$s();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$s(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var GsapSynthesizer=function(e){_inherits(r,e);var t=_createSuper$s(r);function r(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return _classCallCheck(this,r),t.call(this,e,a)}return _createClass(r,[{key:"getDefaultRules",value:function(){return[new MappingRule("gaia.common.Sync",SyncImpl),new MappingRule("gaia.common.Concat",ConcatImpl),new MappingRule("gaia.common.Custom",CustomImpl),new MappingRule("gaia.common.Empty",EmptyImpl),new MappingRule("gaia.common.Fade",FadeImpl),new MappingRule("gaia.common.Wipe",WipeImpl),new MappingRule("gaia.common.Move",MoveImpl),new MappingRule("gaia.common.Zoom",ZoomImpl),new MappingRule("gaia.common.Cut",CutImpl),new MappingRule("gaia.common.Grow",GrowImpl),new MappingRule("gaia.common.ChangeColor",ChangeColorImpl),new MappingRule("gaia.common.Wheel",WheelImpl),new MappingRule("gaia.text.Type",TypeImpl),new MappingRule("gaia.path.PathBlink",PathBlinkImpl),new MappingRule("gaia.path.PathDraw",PathDrawImpl),new MappingRule("gaia.annotation.Circle",CircleImpl)]}},{key:"generate",value:function(e){return _get(_getPrototypeOf(r.prototype),"generate",this).call(this,e)}}]),r}(Synthesizer);function _createForOfIteratorHelper$3(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$3(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$3(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray$3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$3(e,t):void 0}}function _arrayLikeToArray$3(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function _createSuper$r(e){var t=_isNativeReflectConstruct$r();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$r(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var TypeLibrary=function(e){_inherits(r,e);var t=_createSuper$r(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"createCaller",value:function(){return new TypeLibraryCaller(this)}}]),r}(Library),TypeLibraryCaller=function(){function e(t){_classCallCheck(this,e),this._instance=null,this._aliasMap=new Map,this._importMap=new Map,this._instance=t}return _createClass(e,[{key:"setImport",value:function(t){if(t.isPackageImport()){var r=this._instance.getByPackage(t.pkg);if(null==r)throw new Error("Package ".concat(t.pkg," not found."));var a,n=_createForOfIteratorHelper$3(r);try{for(n.s();!(a=n.n()).done;){var i=a.value;this._importMap.set(i.fullName,i)}}catch(s){n.e(s)}finally{n.f()}e.logger.trace("Import package ".concat(t.pkg," successfully. ")+"Imported types: ".concat(r.map((function(e){return e.fullName})).join(", ")))}else{var o=this._instance.get(t.clazz);if(null==o)throw new Error("Type class ".concat(t.clazz," not found."));this._aliasMap.set(t.as,o.fullName),this._importMap.set(o.fullName,o),e.logger.trace("Import class ".concat(t.clazz," as ").concat(t.as," successfully."))}return this}},{key:"setAllImport",value:function(e){var t=this;return e.forEach((function(e){return t.setImport(e)})),this}},{key:"get",value:function(e){var t=this.safeGet(e),r=t.result,a=t.status;switch(a){case"ok":return r;case"not-found":throw new Error("Type ".concat(e," not found."));case"not-imported":throw new Error("Type ".concat(e," not found. Maybe you forget to import it."))}}},{key:"safeGet",value:function(e){if(this._aliasMap.has(e)){var t=this._aliasMap.get(e),r=this._importMap.get(t);return assert(null!=r),{result:r,status:"ok"}}var a=this._instance.get(e);return null==a?{result:void 0,status:"not-found"}:void 0==this._importMap.get(a.fullName)?{result:void 0,status:"not-imported"}:{result:a,status:"ok"}}}]),e}();TypeLibraryCaller.logger=LoggerManager.getLogger("TypeLibraryCaller");var type$b="Any",Any={package:"gaia.common",type:type$b},type$a="Circle",Circle={package:"gaia.common",type:type$a},type$9="Image",Image={package:"gaia.common",type:type$9},type$8="Line",Line={package:"gaia.common",type:type$8},type$7="Path",Path={package:"gaia.common",type:type$7},type$6="Rect",Rect={package:"gaia.common",type:type$6},type$5="Symbol",_Symbol={package:"gaia.common",type:type$5},type$4="Text",Text={package:"gaia.common",type:type$4},type$3="BarChart",components$3=[{ref:"Text",class:["Title"]},{ref:"Axis",class:["XAxis","X"]},{ref:"Axis",class:["YAxis","Y"]},"BarMark","Annotation"],BarChart={package:"gaia.chart",import:["gaia.common.*"],type:type$3,components:components$3},type$2="BarMark",components$2=[{ref:"Rect",class:["Bar"]},{ref:"Text",class:["BarLabel","Label"]}],BarMark={package:"gaia.chart",import:["gaia.common.*"],type:type$2,components:components$2},type$1="Axis",components$1=[{ref:"Line",class:["Domain"]},{ref:"Line",class:["Tick"]},{ref:"Image",class:["Symbol","AxisSymbol"]},{ref:"Text",class:["Label","AxisLabel"]},{ref:"Text",class:["Title","AxisTitle"]}],Axis={package:"gaia.chart",import:["gaia.common.*"],type:type$1,components:components$1},type="Annotation",components=["Symbol","Line",{ref:"Text",class:["Label"]}],Annotation={package:"gaia.chart",import:["gaia.common.*"],type:type,components:components};function getPresetTypes(e){var t=e.parser;return[t.parseTargetType(Any),t.parseTargetType(Circle),t.parseTargetType(Image),t.parseTargetType(Line),t.parseTargetType(Path),t.parseTargetType(Rect),t.parseTargetType(_Symbol),t.parseTargetType(Text),t.parseTargetType(BarChart),t.parseTargetType(BarMark),t.parseTargetType(Axis),t.parseTargetType(Annotation)]}function _createSuper$q(e){var t=_isNativeReflectConstruct$q();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$q(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var EffectPropSchema=LeafAniProps.extend({}),EffectAnimation=function(e){_inherits(r,e);var t=_createSuper$q(r);function r(e,a,n,i,o){return _classCallCheck(this,r),t.call(this,{name:e,packageName:a,imports:[],targetType:n,propSchema:i},o)}return _createClass(r)}(LeafAnimation);function _createSuper$p(e){var t=_isNativeReflectConstruct$p();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$p(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var EffectTemplate=function(e){_inherits(r,e);var t=_createSuper$p(r);function r(e){return _classCallCheck(this,r),t.call(this,e)}return _createClass(r,[{key:"create",value:function(e,t){var r=this.meta,a=r.name,n=r.packageName,i=r.targetType,o=r.propSchema;return new EffectAnimation(a,n,i,o,t)}}]),r}(BaseTemplate);function _createSuper$o(e){var t=_isNativeReflectConstruct$o();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$o(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var CustomPropSchema=EffectPropSchema.extend({attr:z.string().describe("Attribute to animate"),from:z.union([z.string(),z.number()]).nullable()["default"](null).describe("Starting value of the animation"),to:z.union([z.string(),z.number()]).nullable()["default"](null).describe("Ending value of the animation"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),CustomTemplate=function(e){_inherits(r,e);var t=_createSuper$o(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"Custom",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:CustomPropSchema})}return _createClass(r)}(EffectTemplate);function _createSuper$n(e){var t=_isNativeReflectConstruct$n();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$n(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var FadePropSchema=EffectPropSchema.extend({type:z["enum"](["in","out"])["default"]("in").describe("Fade type of animation (default: in)"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),FadeTemplate=function(e){_inherits(r,e);var t=_createSuper$n(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"Fade",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:FadePropSchema})}return _createClass(r)}(EffectTemplate);function _createSuper$m(e){var t=_isNativeReflectConstruct$m();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$m(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var WipePropSchema=EffectPropSchema.extend({type:z["enum"](["in","out"])["default"]("in").describe("Wipe enter or wipe exit (default: enter)"),from:z["enum"](["bottom","top","left","right"])["default"]("bottom").describe("Wipe direction (default: bottom)"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),WipeTemplate=function(e){_inherits(r,e);var t=_createSuper$m(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"Wipe",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:WipePropSchema})}return _createClass(r)}(EffectTemplate);function _createSuper$l(e){var t=_isNativeReflectConstruct$l();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$l(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var MovePropSchema=EffectPropSchema.extend({from:z.object({x:z.number().or(z.string()).optional(),y:z.number().or(z.string()).optional()}).optional().describe("Move from position (x, y). Example: {x: 100, y: 100} or {x: '-=10', y: '+=10px'}"),to:z.object({x:z.number().or(z.string()).optional(),y:z.number().or(z.string()).optional()}).optional().describe("Move to position (x, y). Example: {x: 100, y: 100} or {x: '-=10', y: '+=10px'}"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),MoveTemplate=function(e){_inherits(r,e);var t=_createSuper$l(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"Move",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:MovePropSchema})}return _createClass(r)}(EffectTemplate);function _createSuper$k(e){var t=_isNativeReflectConstruct$k();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$k(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ZoomPropSchema=EffectPropSchema.extend({type:z["enum"](["in","out"])["default"]("in").describe("Wipe enter or wipe exit (default: enter)"),ease:z.string()["default"]("back.out").describe("Ease of animation (default: back.out)")}),ZoomTemplate=function(e){_inherits(r,e);var t=_createSuper$k(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"Zoom",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:ZoomPropSchema})}return _createClass(r)}(EffectTemplate);function _createSuper$j(e){var t=_isNativeReflectConstruct$j();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$j(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var TypePropSchema=EffectPropSchema.extend({type:z["enum"](["in","out"])["default"]("in").describe("Type of animation (in or out, default: in)"),effect:z["enum"](["fade","show"])["default"]("show").describe("Effect of animation (default: show)"),typeStagger:z.number()["default"](.1).describe("Stagger of animation for each character (default: 0.1)"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),TypeTemplate=function(e){_inherits(r,e);var t=_createSuper$j(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"Type",packageName:"gaia.text",imports:[],targetType:"Text",propSchema:TypePropSchema})}return _createClass(r)}(EffectTemplate);function _createSuper$i(e){var t=_isNativeReflectConstruct$i();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$i(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var CutPropSchema=EffectPropSchema.extend({type:z["enum"](["in","out"])["default"]("in").describe("Wipe enter or wipe exit (default: enter)"),from:z["enum"](["bottom","top","left","right"])["default"]("bottom").describe("Wipe direction (default: bottom)"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),CutTemplate=function(e){_inherits(r,e);var t=_createSuper$i(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"Cut",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:CutPropSchema})}return _createClass(r)}(EffectTemplate);function _createSuper$h(e){var t=_isNativeReflectConstruct$h();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$h(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var CutInPropSchema=EffectPropSchema.extend({from:z["enum"](["bottom","top","left","right"])["default"]("bottom").describe("Wipe direction (default: bottom)"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),CutInTemplate=function(e){_inherits(r,e);var t=_createSuper$h(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"CutIn",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:CutInPropSchema})}return _createClass(r,[{key:"instantiate",value:function(e,t){var r=t.id,a=t.target,n=t.timing,i=t.from,o=t.ease;return Ref.builder().ref("Cut").props({id:r,target:a,timing:n,from:i,type:"in",ease:o}).build()}}]),r}(CompositeTemplate);function _createSuper$g(e){var t=_isNativeReflectConstruct$g();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$g(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var CutOutPropSchema=EffectPropSchema.extend({from:z["enum"](["bottom","top","left","right"])["default"]("bottom").describe("Wipe direction (default: bottom)"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),CutOutTemplate=function(e){_inherits(r,e);var t=_createSuper$g(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"CutOut",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:CutOutPropSchema})}return _createClass(r,[{key:"instantiate",value:function(e,t){var r=t.id,a=t.target,n=t.timing,i=t.from,o=t.ease;return Ref.builder().ref("Cut").props({id:r,target:a,timing:n,from:i,type:"out",ease:o}).build()}}]),r}(CompositeTemplate);function _createSuper$f(e){var t=_isNativeReflectConstruct$f();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$f(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var GrowPropSchema=EffectPropSchema.extend({type:z["enum"](["in","out"])["default"]("in").describe("Type of animation: in, out (default: in)"),from:z["enum"](["bottom","top","left","right"])["default"]("bottom").describe("Animation direction (default: bottom)"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),GrowTemplate=function(e){_inherits(r,e);var t=_createSuper$f(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"Grow",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:GrowPropSchema})}return _createClass(r)}(EffectTemplate);function _createSuper$e(e){var t=_isNativeReflectConstruct$e();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$e(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ChangeColorPropSchema=EffectPropSchema.extend({type:z["enum"](["to","from"])["default"]("to").describe("Type of animation: to, from (default: to)"),fill:z.string()["default"]("#ff0000").describe("Color to fill (default: #ff0000)"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),ChangeColorTemplate=function(e){_inherits(r,e);var t=_createSuper$e(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"ChangeColor",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:ChangeColorPropSchema})}return _createClass(r)}(EffectTemplate);function _createSuper$d(e){var t=_isNativeReflectConstruct$d();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$d(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var MoveFromPropSchema=EffectPropSchema.extend({x:z.number().or(z.string()).optional(),y:z.number().or(z.string()).optional(),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),MoveFromTemplate=function(e){_inherits(r,e);var t=_createSuper$d(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"MoveFrom",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:MoveFromPropSchema})}return _createClass(r,[{key:"instantiate",value:function(e,t){var r=t.id,a=t.target,n=t.timing,i=t.x,o=t.y,s=t.ease;return Ref.builder().ref("Move").props({id:r,target:a,timing:n,from:{x:i,y:o},ease:s}).build()}}]),r}(CompositeTemplate);function _createSuper$c(e){var t=_isNativeReflectConstruct$c();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$c(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var MoveToPropSchema=EffectPropSchema.extend({x:z.number().or(z.string()).optional(),y:z.number().or(z.string()).optional(),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),MoveToTemplate=function(e){_inherits(r,e);var t=_createSuper$c(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"MoveTo",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:MoveToPropSchema})}return _createClass(r,[{key:"instantiate",value:function(e,t){var r=t.id,a=t.target,n=t.timing,i=t.x,o=t.y,s=t.ease;return Ref.builder().ref("Move").props({id:r,target:a,timing:n,to:{x:i,y:o},ease:s}).build()}}]),r}(CompositeTemplate);function _createSuper$b(e){var t=_isNativeReflectConstruct$b();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$b(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var WheelPropSchema=EffectPropSchema.extend({type:z["enum"](["in","out"])["default"]("in").describe('Type of animation: "in" or "out" (default: "in")'),startAngle:z.number()["default"](0).describe("Start angle (in degree) of the circle path (default: 0)"),sweepAngle:z.number()["default"](360).describe("Sweep angle (in degree) of the circle path (default: 360)"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),WheelTemplate=function(e){_inherits(r,e);var t=_createSuper$b(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"Wheel",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:WheelPropSchema})}return _createClass(r)}(EffectTemplate);function _createSuper$a(e){var t=_isNativeReflectConstruct$a();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$a(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var BarLabelEnterPropSchema=AniPropSchema.extend({from:z["enum"](["bottom","top","left","right"])["default"]("bottom").describe("Wipe direction (default: bottom)"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),BarLabelEnterTemplate=function(e){_inherits(r,e);var t=_createSuper$a(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"BarLabelEnter",packageName:"gaia.chart",imports:[],targetType:"gaia.chart.BarChart",propSchema:BarLabelEnterPropSchema})}return _createClass(r,[{key:"instantiate",value:function(e,t){var r=t.id,a=t.target,n=t.timing,i=t.from,o=t.ease,s=Ref.builder().ref("Fade").selectAll(".BarMark .Label").props({type:"in",ease:o}).build(),c=Ref.builder().ref("Wipe").selectAll(".BarMark .Bar").props({from:i,ease:o}).build();return Sync.builder().props({id:r,target:a,timing:n}).append(s).append(c).build()}}]),r}(CompositeTemplate);function _createSuper$9(e){var t=_isNativeReflectConstruct$9();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$9(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var PathBlinkPropSchema=EffectPropSchema.extend({reverseDirection:z["boolean"]()["default"](!1).describe("Reverse animation direction (default: false)"),aniTime:z.number()["default"](1).describe("Animation time for the path (default: 1)"),displayTime:z.number()["default"](3).describe("Display time for the path (default: 3)"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),PathBlinkTemplate=function(e){_inherits(r,e);var t=_createSuper$9(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"PathBlink",packageName:"gaia.path",imports:[],targetType:"Line",propSchema:PathBlinkPropSchema})}return _createClass(r,[{key:"create",value:function(e,t){var r=this.meta,a=r.name,n=r.packageName,i=r.targetType,o=r.propSchema;return new PathBlinkEffect(a,n,i,o,t)}}]),r}(EffectTemplate),PathBlinkEffect=function(e){_inherits(r,e);var t=_createSuper$9(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"computeDuration",value:function(e){var t;return null!==(t=this.timing.duration)&&void 0!==t?t:this.getBlinkDuration()}},{key:"getBlinkDuration",value:function(){return 2*this.prop("aniTime")+this.prop("displayTime")}}]),r}(EffectAnimation);function _createSuper$8(e){var t=_isNativeReflectConstruct$8();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$8(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var PathDrawPropSchema=EffectPropSchema.extend({reverseDirection:z["boolean"]()["default"](!1).describe("Reverse animation direction (default: false)"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),PathDrawTemplate=function(e){_inherits(r,e);var t=_createSuper$8(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"PathDraw",packageName:"gaia.path",imports:[],targetType:"Line",propSchema:PathDrawPropSchema})}return _createClass(r)}(EffectTemplate);function _createSuper$7(e){var t=_isNativeReflectConstruct$7();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$7(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var CirclePropSchema=EffectPropSchema.extend({direction:z["enum"](["clockwise","counterclockwise"])["default"]("clockwise").describe('Direction of the circle path: "clockwise" or "counterclockwise" (default: "clockwise")'),aniTime:z.number()["default"](1).describe("Animation time for the circle path (default: 1)"),displayTime:z.number()["default"](3).describe("Display time for the circle path (default: 3)"),stroke:z.string()["default"]("#ff6868").describe("Stroke color of the circle path (default: #ff6868)"),strokeWidth:z.number()["default"](3).describe("Stroke width of the circle path (default: 3)"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),CircleTemplate=function(e){_inherits(r,e);var t=_createSuper$7(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"Circle",packageName:"gaia.annotation",imports:[],targetType:"Any",propSchema:CirclePropSchema})}return _createClass(r,[{key:"create",value:function(e,t){var r=this.meta,a=r.name,n=r.packageName,i=r.targetType,o=r.propSchema;return new CircleEffect(a,n,i,o,t)}}]),r}(EffectTemplate),CircleEffect=function(e){_inherits(r,e);var t=_createSuper$7(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"computeDuration",value:function(e){var t;return null!==(t=this.timing.duration)&&void 0!==t?t:this.getBlinkDuration()}},{key:"getBlinkDuration",value:function(){return 2*this.prop("aniTime")+this.prop("displayTime")}}]),r}(EffectAnimation);function _createSuper$6(e){var t=_isNativeReflectConstruct$6();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$6(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var WipeInPropSchema=EffectPropSchema.extend({from:z["enum"](["bottom","top","left","right"])["default"]("bottom").describe("Wipe direction (default: bottom)"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),WipeInTemplate=function(e){_inherits(r,e);var t=_createSuper$6(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"WipeIn",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:WipeInPropSchema})}return _createClass(r,[{key:"instantiate",value:function(e,t){var r=t.id,a=t.target,n=t.timing,i=t.from,o=t.ease;return Ref.builder().ref("Wipe").props({id:r,target:a,timing:n,from:i,type:"in",ease:o}).build()}}]),r}(CompositeTemplate);function _createSuper$5(e){var t=_isNativeReflectConstruct$5();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$5(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var WipeOutPropSchema=EffectPropSchema.extend({from:z["enum"](["bottom","top","left","right"])["default"]("bottom").describe("Wipe direction (default: bottom)"),ease:z.string()["default"]("power1.out").describe("Ease of animation (default: power1.out)")}),WipeOutTemplate=function(e){_inherits(r,e);var t=_createSuper$5(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"WipeOut",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:WipeOutPropSchema})}return _createClass(r,[{key:"instantiate",value:function(e,t){var r=t.id,a=t.target,n=t.timing,i=t.from,o=t.ease;return Ref.builder().ref("Wipe").props({id:r,target:a,timing:n,from:i,type:"out",ease:o}).build()}}]),r}(CompositeTemplate);function _createSuper$4(e){var t=_isNativeReflectConstruct$4();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$4(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ZoomInPropSchema=EffectPropSchema.extend({ease:z.string()["default"]("back.out").describe("Ease of animation (default: back.out)")}),ZoomInTemplate=function(e){_inherits(r,e);var t=_createSuper$4(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"ZoomIn",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:ZoomInPropSchema})}return _createClass(r,[{key:"instantiate",value:function(e,t){var r=t.id,a=t.target,n=t.timing,i=t.ease;return Ref.builder().ref("Zoom").props({id:r,target:a,timing:n,type:"in",ease:i}).build()}}]),r}(CompositeTemplate);function _createSuper$3(e){var t=_isNativeReflectConstruct$3();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$3(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ZoomOutPropSchema=EffectPropSchema.extend({ease:z.string()["default"]("back.out").describe("Ease of animation (default: back.out)")}),ZoomOutTemplate=function(e){_inherits(r,e);var t=_createSuper$3(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"ZoomOut",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:ZoomOutPropSchema})}return _createClass(r,[{key:"instantiate",value:function(e,t){var r=t.id,a=t.target,n=t.timing,i=t.ease;return Ref.builder().ref("Wipe").props({id:r,target:a,timing:n,type:"out",ease:i}).build()}}]),r}(CompositeTemplate);function _createSuper$2(e){var t=_isNativeReflectConstruct$2();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$2(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var EmptyPropSchema=EffectPropSchema.extend({}),EmptyTemplate=function(e){_inherits(r,e);var t=_createSuper$2(r);function r(){return _classCallCheck(this,r),t.call(this,{name:"Empty",packageName:"gaia.common",imports:[],targetType:"Any",propSchema:EmptyPropSchema})}return _createClass(r)}(EffectTemplate);function getPresetTemplates(e){return[new CustomTemplate,new EmptyTemplate,new FadeTemplate,new WipeTemplate,new WipeInTemplate,new WipeOutTemplate,new MoveTemplate,new ZoomTemplate,new ZoomInTemplate,new ZoomOutTemplate,new TypeTemplate,new CutTemplate,new CutInTemplate,new CutOutTemplate,new GrowTemplate,new ChangeColorTemplate,new MoveFromTemplate,new MoveToTemplate,new WheelTemplate,new PathBlinkTemplate,new PathDrawTemplate,new BarLabelEnterTemplate,new CircleTemplate]}function _createForOfIteratorHelper$2(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$2(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$2(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray$2(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$2(e,t):void 0}}function _arrayLikeToArray$2(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var TargetSelection=function(){function e(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,e),this.elements=null,this._realElements=null,this.elements=t,this.targetModel=r,this.parent=a}return _createClass(e,[{key:"select",value:function(t){var r,a=_createForOfIteratorHelper$2(this.elements);try{for(a.s();!(r=a.n()).done;){var n=r.value,i=n.querySelector(t);if(null!=i)return new e([i],this.targetModel,this)}}catch(o){a.e(o)}finally{a.f()}return new e([],this.targetModel,this)}},{key:"selectAll",value:function(t){var r=this.elements.map((function(e){return Array.from(e.querySelectorAll(t))})).flat();return new e(r,this.targetModel,this)}},{key:"filter",value:function(t){var r=this;e.logger.trace("Filtering selection with "+("function"===typeof t?"[native function]":t)+".\n Parent selection:\n"+this.toString());var a=null;if(isString$1(t))a=this.elements.filter((function(e){return e.matches(t)}));else{if(!isFunction$3(t))throw new Error("predicate must be a string or a function, but got ".concat(t));a=this.elements.filter((function(e,a){return t(e,a,r.elements)}))}var n=new e(a,this.targetModel,this);return e.logger.trace("Filtering result: ".concat(n.toString())),n}},{key:"sort",value:function(t){var r=this.elements.slice().sort(t);return new e(r,this.targetModel,this)}},{key:"slice",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==r&&(r=this.elements.length),null==a&&(a=1),t<0&&(t=this.elements.length+t),r<0&&(r=this.elements.length+r),t<0||t>=this.elements.length)throw new Error("Start index ".concat(t," out of range. Collection size is ").concat(this.elements.length,". At Selection(").concat(this.toString(),")"));if(r<0||r>this.elements.length)throw new Error("End index ".concat(r," out of range. Collection size is ").concat(this.elements.length,". At Selection(").concat(this.toString(),")"));if(0===a)throw new Error("Step cannot be zero. At ".concat(this));if(a>0){if(t>r)throw new Error("Start index ".concat(t," is larger than end index ").concat(r,". At ").concat(this))}else if(t<r)throw new Error("Start index ".concat(t," is smaller than end index ").concat(r,". At ").concat(this));for(var n=[],i=t;i<r;i+=a)n.push(this.elements[i]);return new e(n,this.targetModel,this)}},{key:"size",get:function(){return this.elements.length}},{key:"realElements",get:function(){var e=this;return null==this._realElements&&(this._realElements=this.elements.map((function(t){return e.targetModel.getRealElementByVNode(t)}))),this._realElements}},{key:"toString",value:function(){return this.elements.map((function(e){return"".concat(e.tagName,"#").concat(e.id)})).join(", ")}}]),e}();function _createForOfIteratorHelper$1(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$1(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$1(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray$1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$1(e,t):void 0}}function _arrayLikeToArray$1(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function _createSuper$1(e){var t=_isNativeReflectConstruct$1();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}TargetSelection.logger=LoggerManager.getLogger("TargetSelection");var BSVGTargetModel=function(e){_inherits(r,e);var t=_createSuper$1(r);function r(e,a){var n;return _classCallCheck(this,r),n=t.call(this,e),n.vNodeId2RealId=new Map,n.binder=a,assert("svg"==a.from,'Attribute "from" of BSVGTargetModel binder must be "svg".'),n}return _createClass(r,[{key:"initRootType",value:function(){if(this.rootTargetType=this.session.typeLibrary.get(this.binder.to),null==this.rootTargetType)throw new Error("Target type ".concat(this.binder.to," not found when processing root target type of BSVGTargetModel."))}},{key:"completeVirtualModel",value:function(){var e,t=this,r=0,a=function(){r++;var e="el-".concat(r);while(t.realElementIdSet.has(e))r++,e="el-".concat(r);return e};if("Any"===this.rootTargetType.name){this.binder.rules.length>0&&TargetModel.logger.warn('Root target type is "Any" but binder has rules. Rules will be ignored.'),null!=this.origin.id&&""!=this.origin.id||(this.origin.id=a()),Array.from(this.origin.querySelectorAll("*")).forEach((function(e){null!=e.id&&""!=e.id||(e.id=a()),t.vNodeId2RealId.set(e.id,e.id)}));var n=this.virtualModel,i=this.origin.cloneNode(!0);return n.appendChild(i),void(this.rootSelection=new TargetSelection([i],this,null))}var o,s=_createForOfIteratorHelper$1(this.binder.rules);try{var c=function(){var r=o.value,n=t.origin.querySelectorAll(r.from);if(0==n.length)return TargetModel.logger.warn("Rule ".concat(JSON.stringify(r)," matched 0 elements. Skip.")),"continue";if("single"===r.type){assert(1==n.length,"A single builder rule ".concat(JSON.stringify(r)," can only match 1 element, but got ").concat(n.length,".")),assert(null==r.dataList,"A single builder rule ".concat(JSON.stringify(r)," cannot have dataList."));var i,s=n[0],c=null!=s.id&&""!=s.id,l=null!=r.id&&""!=r.id;c&&l?i=r.id:c?i=s.id:l?(s.id=r.id,i=r.id):(i=a(),s.id=i),t.vNodeId2RealId.set(i,s.id);var u=t.queryOneTypeNode(r.to),d=u.fullClassList;r.classList.forEach((function(e){d.includes(e)||d.push(e)}));var p=t.createVirtualElement(s,i,d,null!==(e=r.data)&&void 0!==e?e:{});t.virtualModel.appendChild(p)}else{if("batch"!==r.type)throw new Error("Unknown rule type: ".concat(r.type));assert(null==r.data||null==r.dataList,"Batch builder rule ".concat(JSON.stringify(r)," cannot have both data and dataList.")),null!=r.dataList&&assert(n.length==r.dataList.length,"Batch builder rule ".concat(JSON.stringify(r)," matched ").concat(n.length," elements, but got ").concat(r.dataList.length," data."));var h=t.queryOneTypeNode(r.to),f=h.fullClassList;r.classList.forEach((function(e){f.includes(e)||f.push(e)})),n.forEach((function(e,n){var i,o,s=null!=e.id&&""!=e.id;s?i=e.id:(i=a(),e.id=i),t.vNodeId2RealId.set(i,e.id),o=null!=r.dataList?r.dataList[n]:null!=r.data?r.data:{};var c=t.createVirtualElement(e,i,f,null!==o&&void 0!==o?o:{});t.virtualModel.appendChild(c)}))}};for(s.s();!(o=s.n()).done;)c()}catch(u){s.e(u)}finally{s.f()}var l=Array.from(this.virtualModel.children);this.rootSelection=new TargetSelection(l,this,null)}},{key:"getRealElementById",value:function(e){var t=this.vNodeId2RealId.get(e);return assert(null!=t,"Cannot find real id for virtual id ".concat(e,".")),this.origin.querySelector("#".concat(t))}}]),r}(BaseSVGTargetModel);function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var SSVGTargetModel=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var a;return _classCallCheck(this,r),a=t.call(this,e),a.vNodeId2RealId=new Map,a}return _createClass(r,[{key:"initRootType",value:function(){var e,t=this.origin.querySelector("[".concat(r.TARGET_TYPE_ATTR,"]"));if(e=null==t||""==t.getAttribute(r.TARGET_TYPE_ATTR)?"Any":t.getAttribute(r.TARGET_TYPE_ATTR),this.rootTargetType=this.session.typeLibrary.get(e),null==this.rootTargetType)throw new Error("Target type ".concat(e," not found when processing SSVG root target type."))}},{key:"completeVirtualModel",value:function(){var e=this,t=0,a=function(){t++;var r="el-".concat(t);while(e.realElementIdSet.has(r))t++,r="el-".concat(t);return r};if("Any"===this.rootTargetType.name){null!=this.origin.id&&""!=this.origin.id||(this.origin.id=a()),Array.from(this.origin.querySelectorAll("*")).forEach((function(t){null!=t.id&&""!=t.id||(t.id=a()),e.vNodeId2RealId.set(t.id,t.id)}));var n=this.virtualModel,i=this.origin.cloneNode(!0);return n.appendChild(i),void(this.rootSelection=new TargetSelection([i],this,null))}var o=this.origin.querySelectorAll("[".concat(r.TYPE_ATTR,"]"));o.forEach((function(t){var n,i=t.getAttribute(r.TYPE_ATTR),o=t.getAttribute(r.DATA_ATTR),s=null!=t.id&&""!=t.id;s?n=t.id:(n=a(),t.id=n),e.vNodeId2RealId.set(n,t.id);var c=e.queryOneTypeNode(i),l=c.classList;if(t.hasAttribute(r.CLASS_ATTR)){var u=t.getAttribute(r.CLASS_ATTR).split(" ");u.forEach((function(e){l.includes(e)||l.push(e)}))}var d={};null!=o&&""!=o&&(d=JSON5.parse(o));var p=e.createVirtualElement(t,n,l,d);e.virtualModel.appendChild(p)}));var s=Array.from(this.virtualModel.children);this.rootSelection=new TargetSelection(s,this,null)}},{key:"getRealElementById",value:function(e){var t=this.vNodeId2RealId.get(e);return assert(null!=t,"Cannot find real id for virtual id ".concat(e,".")),this.origin.querySelector("#".concat(t))}}]),r}(BaseSVGTargetModel);function _createForOfIteratorHelper(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r["return"]||r["return"]()}finally{if(s)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}SSVGTargetModel.TYPE_ATTR="g-type",SSVGTargetModel.CLASS_ATTR="g-class",SSVGTargetModel.DATA_ATTR="g-data",SSVGTargetModel.TARGET_TYPE_ATTR="g-target-type";var GaiaSession=function(){function e(){_classCallCheck(this,e);var t=this.parser=new JsonSpecParser;this.targetModelFactory=function(e,r,a){return void 0===a?new SSVGTargetModel(r):new BSVGTargetModel(r,t.parseBinder(a))},this.resolverFactory=function(e,t){return new Resolver(t)},this.synthesizerFactory=function(e,t){return new GsapSynthesizer(t)},this.document=document}return _createClass(e,[{key:"init",value:function(){e.logger.debug("Creating preset template library"),this.templateLibrary=new TemplateLibrary,this.templateLibrary.register(getPresetTemplates()),e.logger.debug("Creating preset type library"),this.typeLibrary=new TypeLibrary,this.typeLibrary.register(getPresetTypes(this)),e.logger.info("GaiaSession created. Preset: ".concat(this.templateLibrary.size," templates, ").concat(this.typeLibrary.size," types")),e.logger.trace("Template library: ".concat(this.templateLibrary.getAll().map((function(e){return e.name})).join(", "))),e.logger.trace("Type library: ".concat(this.typeLibrary.getAll().map((function(e){return e.name})).join(", ")))}},{key:"logs",get:function(){return LoggerManager.records}},{key:"registerOrUpdateTemplate",value:function(e){if(void 0!=e)if(e instanceof BaseTemplate)this.templateLibrary.registerOrUpdate(e);else{var t=this.parser.parseTemplate(e);this.templateLibrary.registerOrUpdate(t)}}},{key:"registerOrUpdateTemplates",value:function(e){if(void 0!=e){var t,r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;this.registerOrUpdateTemplate(a)}}catch(n){r.e(n)}finally{r.f()}}}},{key:"unregisterTemplate",value:function(e){var t=this.templateLibrary.get(e);return void 0!=t&&this.templateLibrary.unregister(t.fullName)}},{key:"registerOrUpdateType",value:function(e){if(void 0!=e)if(e instanceof TargetType)this.typeLibrary.registerOrUpdate(e);else{var t=this.parser.parseTargetType(e);this.typeLibrary.registerOrUpdate(t)}}},{key:"registerOrUpdateTypes",value:function(e){if(void 0!=e){var t,r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;this.registerOrUpdateType(a)}}catch(n){r.e(n)}finally{r.f()}}}},{key:"unregisterType",value:function(e){var t=this.typeLibrary.get(e);return void 0!=t&&this.typeLibrary.unregister(t.fullName)}},{key:"compileJson",value:function(t,r){var a;try{var n=this.parser.parseTemplate(t),i=CompileExec.quickExec(this),o=new ResolveContext(i);a=n.create(o,{})}catch(u){throw e.logger.error("Compile JSON failed. Caused by:\n"+u),u}for(var s=arguments.length,c=new Array(s>2?s-2:0),l=2;l<s;l++)c[l-2]=arguments[l];return this.compile.apply(this,[a,r].concat(c))}},{key:"compile",value:function(t,r){try{for(var a=arguments.length,n=new Array(a>2?a-2:0),i=2;i<a;i++)n[i-2]=arguments[i];var o=this.targetModelFactory.apply(this,[this,r].concat(n));o.init(this),e.logger.debug("Target model created");var s=CompileExec.fullyExec(this,t,o);return s.setResolver(this.resolverFactory(this,s)).setSynthesizer(this.synthesizerFactory(this,s)),e.logger.debug("Compile exec created"),s.generated}catch(c){throw e.logger.error("Compile failed. Caused by:\n"+c),c}}},{key:"resolveJson",value:function(t,r){var a;try{var n=this.parser.parseTemplate(t),i=CompileExec.quickExec(this),o=new ResolveContext(i);a=n.create(o,{})}catch(u){throw e.logger.error("Resolve JSON failed. Caused by:\n"+u),u}for(var s=arguments.length,c=new Array(s>2?s-2:0),l=2;l<s;l++)c[l-2]=arguments[l];return this.resolve.apply(this,[a,r].concat(c))}},{key:"resolve",value:function(t,r){try{for(var a=arguments.length,n=new Array(a>2?a-2:0),i=2;i<a;i++)n[i-2]=arguments[i];var o=this.targetModelFactory.apply(this,[this,r].concat(n));o.init(this);var s=CompileExec.fullyExec(this,t,o);return s.setResolver(this.resolverFactory(this,s)),s.resolved}catch(c){throw e.logger.error("Resolve failed. Caused by:\n"+c),c}}},{key:"getTargetModel",value:function(t){try{for(var r=arguments.length,a=new Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];var i=this.targetModelFactory.apply(this,[this,t].concat(a));return i.init(this),i}catch(o){throw e.logger.error("Get target model failed. Caused by:\n"+o),o}}}],[{key:"builder",value:function(){return new GaiaSessionBuilder}}]),e}();GaiaSession.logger=LoggerManager.getLogger("GaiaSession");var GaiaSessionBuilder=function(){function e(){_classCallCheck(this,e),this._session=new GaiaSession}return _createClass(e,[{key:"parser",value:function(e){return this._session.parser=e,this}},{key:"targetModelFactory",value:function(e){return this._session.targetModelFactory=e,this}},{key:"resolverFactory",value:function(e){return this._session.resolverFactory=e,this}},{key:"synthesizerFactory",value:function(e){return this._session.synthesizerFactory=e,this}},{key:"templateLibrary",value:function(e){return this._session.templateLibrary=e,this}},{key:"typeLibrary",value:function(e){return this._session.typeLibrary=e,this}},{key:"document",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return this._session.document=e,this}))},{key:"build",value:function(){return this._session.init(),this._session}}]),e}(),DefaultSession=GaiaSession.builder().build();exports.DefaultSession=DefaultSession,exports.GaiaSession=GaiaSession}))}).call(this,__webpack_require__("c8ba"),__webpack_require__("b639").Buffer)},"5cda":function(e,t,r){},"5f28":function(e,t,r){"use strict";r("cd12")},6:function(e,t){},"614b":function(e,t,r){},"618e":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var a=r("4b58");class n extends a["a"]{constructor(){super(),this.type="native"}}},"624c":function(e,t,r){},"680f":function(e,t,r){"use strict";r("624c")},"6d0c":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return SectorWheelTemplate}));var _Users_carl_Code_Research_MSRA_GaiaUI_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ade3"),core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("5b81"),core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_array_reduce_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("13d5"),core_js_modules_es_array_reduce_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_array_reduce_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("14d9"),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_3__),_core_entities_spec_template_NativeTemplate__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("618e"),_core_entities_spec_parameter_ParamType__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("c66e"),_core_entities_spec_parameter_ParamDefinition__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("a979"),_core_entities_spec_animation_NativeAnimation__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("2bc8"),gsap__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("cffa"),d3__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("898b"),_core_utils_uuid__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("8bce"),_core_const_Element__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("ba84");class SectorWheelTemplate extends _core_entities_spec_template_NativeTemplate__WEBPACK_IMPORTED_MODULE_4__["a"]{constructor(){super(),this.templateName="sector-wheel",this.parameters=[new _core_entities_spec_parameter_ParamDefinition__WEBPACK_IMPORTED_MODULE_6__["a"]("enterOrExit",_core_entities_spec_parameter_ParamType__WEBPACK_IMPORTED_MODULE_5__["a"].STRING,!1,"enter"),new _core_entities_spec_parameter_ParamDefinition__WEBPACK_IMPORTED_MODULE_6__["a"]("duration",_core_entities_spec_parameter_ParamType__WEBPACK_IMPORTED_MODULE_5__["a"].NUMBER,!1,1),new _core_entities_spec_parameter_ParamDefinition__WEBPACK_IMPORTED_MODULE_6__["a"]("ease",_core_entities_spec_parameter_ParamType__WEBPACK_IMPORTED_MODULE_5__["a"].STRING,!1,"power1.out"),new _core_entities_spec_parameter_ParamDefinition__WEBPACK_IMPORTED_MODULE_6__["a"]("stagger",_core_entities_spec_parameter_ParamType__WEBPACK_IMPORTED_MODULE_5__["a"].NUMBER,!1,0),new _core_entities_spec_parameter_ParamDefinition__WEBPACK_IMPORTED_MODULE_6__["a"]("valueMapper",_core_entities_spec_parameter_ParamType__WEBPACK_IMPORTED_MODULE_5__["a"].STRING,!1,"@datum.value"),new _core_entities_spec_parameter_ParamDefinition__WEBPACK_IMPORTED_MODULE_6__["a"]("extraDegree",_core_entities_spec_parameter_ParamType__WEBPACK_IMPORTED_MODULE_5__["a"].NUMBER,!1,5)]}createAnimation(){const e=new SectorWheelAnimation;return e.updateSettings(this.getParamValues()),e}}class SectorWheelAnimation extends _core_entities_spec_animation_NativeAnimation__WEBPACK_IMPORTED_MODULE_7__["a"]{constructor(...e){super(...e),Object(_Users_carl_Code_Research_MSRA_GaiaUI_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"x",void 0),Object(_Users_carl_Code_Research_MSRA_GaiaUI_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"y",void 0),Object(_Users_carl_Code_Research_MSRA_GaiaUI_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"width",void 0),Object(_Users_carl_Code_Research_MSRA_GaiaUI_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"height",void 0)}create(context){const glyphs=context.getGlyphs(this.target),defs=context.getDefsSel(),tl=gsap__WEBPACK_IMPORTED_MODULE_8__["a"].timeline(),{stagger:stagger,valueMapper:valueMapper,extraDegree:extraDegree}=this.settings;let x=1/0,y=1/0,width=0,height=0;glyphs.forEach(e=>{const t=e.getBBox();x=Math.min(x,t.x),y=Math.min(y,t.y),width=Math.max(width,t.x+t.width-x),height=Math.max(height,t.y+t.height-y)}),this.x=x,this.y=y,this.width=width,this.height=height,console.log("sector",x,y,width,height);const expr=valueMapper.replaceAll("@classList","__node__.classList").replaceAll("@id",'__node__.getAttribute("id")').replaceAll("@index","__index__").replaceAll("@datum",'(JSON.parse(__node__.getAttribute("ac-data")) ?? {})').replaceAll("@el","__node__");console.log("sector mapper expr",expr);const values=glyphs.map((__node__,__index__)=>eval(expr)),tot=values.reduce((e,t)=>e+t,0),sums=[0];values.forEach((e,t)=>sums.push(sums[t]+e));const startDegrees=values.map((e,t)=>sums[t]/tot*360),endDegrees=values.map((e,t)=>sums[t+1]/tot*360);return console.log({values:values,startDegrees:startDegrees,endDegrees:endDegrees}),glyphs.forEach((e,t)=>{const r=this.addClipPathToGlyph(defs,e),a=this.createTwForClip(r,e,startDegrees[t]-extraDegree,endDegrees[t]+extraDegree),n=0===t?0:"<"+stagger;tl.add(a,n)}),tl}addClipPathToGlyph(e,t){var r;t.getAttribute("id")||t.setAttribute("id",Object(_core_utils_uuid__WEBPACK_IMPORTED_MODULE_10__["a"])());const a="clip-path-"+t.getAttribute("id");let n=e.select("#"+a);n.empty()&&(n=e.append("clipPath").attr("id",a).classed(_core_const_Element__WEBPACK_IMPORTED_MODULE_11__["b"],!0),t.setAttribute("clip-path",`url(#${a})`));const i=n.select(".sector-wheel");if(!i.empty())return i.node();let o=parseFloat(null!==(r=t.getAttribute("stroke-width"))&&void 0!==r?r:"0");d3__WEBPACK_IMPORTED_MODULE_9__["n"](t).selectAll("*").each((function(){var e;const t=parseFloat(null!==(e=this.getAttribute("stroke-width"))&&void 0!==e?e:"0");o=Math.max(t,o)}));const s=n.append("path").attr("class","sector-wheel").attr("d","");return s.node()}createTwForClip(e,t,r,a){const{ease:n,duration:i}=this.settings,o=r,s=a-r;let c,l;c={startAngle:null!==o&&void 0!==o?o:0,sweepAngle:0,cx:this.x+this.width/2,cy:this.y+this.height/2,rx:Math.max(this.width,this.height),ry:Math.max(this.width,this.height)},console.log(c.cx,c.cy,c),l=s;const u=function(){const t=getArcPath(c.cx,c.cy,c.rx,c.ry,c.startAngle,c.sweepAngle);e.setAttribute("d",t)};return u(),gsap__WEBPACK_IMPORTED_MODULE_8__["a"].to(c,{sweepAngle:l,ease:n,onUpdate:u,duration:i})}}function getArcPath(e,t,r,a,n,i){if(!i)return`M${e} ${t}`;n%=360,i%=360;const o=0===i;o&&(i=180),i<0&&(i+=360);const s=i>180?1:0,c=n*Math.PI/180,l=(n+i)*Math.PI/180,u=e+r*Math.sin(c),d=t-a*Math.cos(c),p=e+r*Math.sin(l),h=t-a*Math.cos(l);return o?`\n      M ${u} ${d}\n      A ${r} ${a} 0 1 1 ${p} ${h}\n      A ${r} ${a} 0 1 1 ${u} ${d}z`:`\n    M ${u} ${d}\n    A ${r} ${a} 0 ${s} 1 ${p} ${h}\n    L ${e} ${t}z`}},7:function(e,t,r){e.exports=r("56d7")},7891:function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return s}));var a=r("ade3"),n=r("5e48"),i=r.n(n);class o{constructor(){Object(a["a"])(this,"transform",void 0)}static getDefaultTarget(){return new s}static simplifyJSON(e){if("object"!==typeof e)return e;const t={};if("selector"in e&&"*"!==e.selector&&""!==e.selector.trim()&&(t.selector=e.selector),"transform"in e){let r=e.transform;if("string"===typeof r&&""!==r.trim()&&(r=i.a.parse(r)),"object"!==typeof r||Array.isArray(r)||(t.transform=r),Array.isArray(r)&&0!==r.length){for(let e=0;e<r.length;e++)"string"===typeof r[e]&&(r[e]=i.a.parse(r[e]));t.transform=r}}return 0!==Object.keys(t).length?1===Object.keys(t).length&&"selector"in t?t.selector:t:void 0}}class s extends o{constructor(e="*",t=[]){super(),Object(a["a"])(this,"selector",void 0),this.selector=e,this.transform=t}}},8:function(e,t){},"8bce":function(e,t,r){"use strict";function a(){let e=[],t="0123456789abcdef";for(let a=0;a<36;a++)e[a]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";let r=e.join("");return r}r.d(t,"a",(function(){return a}))},"8f52":function(e,t,r){"use strict";function a(){let e=[],t="0123456789abcdef";for(let a=0;a<36;a++)e[a]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";let r=e.join("");return r}r.d(t,"a",(function(){return a}))},9:function(e,t){},"95d5":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return SortTransform}));var _Users_carl_Code_Research_MSRA_GaiaUI_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ade3"),core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("5b81"),core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1__),_core_entities_spec_BaseTransform__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("ef41"),d3__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("898b");class SortTransform extends _core_entities_spec_BaseTransform__WEBPACK_IMPORTED_MODULE_2__["a"]{constructor(){super(),Object(_Users_carl_Code_Research_MSRA_GaiaUI_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"type",void 0),Object(_Users_carl_Code_Research_MSRA_GaiaUI_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"data",void 0),Object(_Users_carl_Code_Research_MSRA_GaiaUI_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"attr",void 0),Object(_Users_carl_Code_Research_MSRA_GaiaUI_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"expr",void 0),Object(_Users_carl_Code_Research_MSRA_GaiaUI_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"order",void 0),this.type="sort",this.expr="0"}execute(selection){const reverse="dec"===this.order,nodes=selection.nodes();let expr;expr=this.data?"__node__.__data__."+this.data:this.attr?`__node__.getAttribute("${this.attr}")`:this.expr?this.expr.replaceAll("@classList","__node__.classList").replaceAll("@id",'__node__.getAttribute("id")').replaceAll("@index","__index__").replaceAll("@datum","__node__.__data__").replaceAll("@el","__node__"):"0",console.log("sort expr",expr);const compareFunc=(node,index)=>{let __expr__=expr,__order__=this.order;""!==node.getAttribute("ac-data")&&this.data&&(__expr__='(JSON.parse(__node__.getAttribute("ac-data")) ?? {}).'+this.data);const func=function(__node__,__index__){return Array.isArray(__order__)?__order__.indexOf(eval(__expr__)):eval(__expr__)};return func(node,index)},indexMap=new Map;return nodes.forEach((e,t)=>indexMap.set(e,t)),nodes.sort((e,t)=>{const r=compareFunc(e,indexMap.get(e))-compareFunc(t,indexMap.get(e));return reverse?-r:r}),d3__WEBPACK_IMPORTED_MODULE_3__["o"](nodes)}}},"9dfd":function(e,t,r){},"9ed6":function(e,t,r){"use strict";r("0ee5")},a979:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var a=r("ade3"),n=r("c66e");class i{constructor(e="param",t=n["a"].ANY,r=!0,i){Object(a["a"])(this,"paramName",void 0),Object(a["a"])(this,"paramType",void 0),Object(a["a"])(this,"required",void 0),Object(a["a"])(this,"defaultValue",void 0),this.paramName=e,this.paramType=t.toLowerCase(),this.required=r,this.defaultValue=i}isAcceptable(e){if(void 0===e&&this.required)return!1;switch(this.paramType){case n["a"].NUMBER:return"number"===typeof e;case n["a"].STRING:return"string"===typeof e;case n["a"].OBJECT:return"object"===typeof e;case n["a"].ARRAY:return Array.isArray(e);case n["a"].ANY:return!0;case n["a"].BOOLEAN:return"boolean"===typeof e;case n["a"].NUMBER_OR_ARRAY:return"number"===typeof e||Array.isArray(e);case n["a"].STRING_OR_ARRAY:return"string"===typeof e||Array.isArray(e)}return!1}}},b545:function(e,t,r){"use strict";r("062f")},ba84:function(e,t,r){"use strict";r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}));const a="ani-chart-mask",n="ani-chart-annotation",i="ani-chart-clip-path"},c36b:function(e,t,r){},c66e:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));const a={NUMBER:"number",STRING:"string",OBJECT:"object",ARRAY:"array",ANY:"any",BOOLEAN:"boolean",NUMBER_OR_ARRAY:"number-or-array",STRING_OR_ARRAY:"string-or-array"}},cc38:function(e,t,r){},cd12:function(e,t,r){},ce5a:function(e,t,r){"use strict";r("f052")},d6f6:function(e,t,r){"use strict";r("5cda")},da2d:function(e,t,r){"use strict";r("c36b")},dd03:function(e,t,r){},e1e6:function(e,t,r){},ef41:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var a=r("ade3");class n{constructor(){Object(a["a"])(this,"type",void 0),this.type="unknown"}execute(e){throw"This transform object is abstract."}}},f052:function(e,t,r){},f308:function(e,t,r){"use strict";r("e1e6")},f720:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var a=r("ade3"),n=r("0764"),i=r("7891");class o{constructor(e={}){Object(a["a"])(this,"target",void 0),Object(a["a"])(this,"timing",void 0),Object(a["a"])(this,"type",void 0),Object(a["a"])(this,"settings",void 0),this.target=i["b"].getDefaultTarget(),this.timing=new n["a"],this.type="unknown";const t=this.getDefaultSettings();this.settings=Object.assign(t,e)}setTarget(e){return this.target="string"===typeof e?new i["a"](e):e,this}updateTarget(e){return Object.assign(this.target,e),this}setTiming(e){return this.timing=e,this}updateTiming(e){return Object.keys(e).forEach(t=>{void 0!==e[t]&&(this.timing[t]=e[t])}),this}getDefaultSettings(){return{}}updateSettings(e){return Object.assign(this.settings,e),this}set(e,t){return this.settings[e]=t,this}computeDuration(e){throw"Animation is not implemented"}computePossibleElements(e){throw"Animation is not implemented"}create(e){throw"Animation is not implemented"}}}});
//# sourceMappingURL=app.5b42e265.js.map